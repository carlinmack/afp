<div id="Algebraic_Numbers_Prelim">
<div class="head">
<h1>Theory Algebraic_Numbers_Prelim</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:      René Thiemann
                 Sebastiaan Joosten
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Algebraic Numbers -- Excluding Addition and Multiplication›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory contains basic definition and results on algebraic numbers, namely that
  algebraic numbers are closed under negation, inversion, $n$-th roots, and
  that every rational number is algebraic. For all of these closure properties, corresponding
  polynomial witnesses are available.

  Moreover, this theory contains the uniqueness result,
  that for every algebraic number there is exactly one content-free irreducible polynomial with
  positive leading coefficient for it.
  This result is stronger than similar ones which you find in many textbooks.
  The reason is that here we do not require a least degree construction.

  This is essential, since given some content-free irreducible polynomial for x,
  how should we check whether the degree is optimal. In the formalized result, this is
  not required. The result is proven via GCDs, and that the GCD does not change
  when executed on the rational numbers or on the reals or complex numbers, and that
  the GCD of a rational polynomial can be expressed via the GCD of integer polynomials.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Many results are taken from the textbook \cite[pages 317ff]{AlgNumbers}.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Algebraic_Numbers_Prelim
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Fundamental_Theorem_Algebra.html">HOL-Computational_Algebra.Fundamental_Theorem_Algebra</a>"</span>
  <a href="../Polynomial_Interpolation/Newton_Interpolation.html">Polynomial_Interpolation.Newton_Interpolation</a> <span class="comment1">(* for lemma smult_1 *)</span>
  <a href="../Polynomial_Factorization/Gauss_Lemma.html">Polynomial_Factorization.Gauss_Lemma</a>
  <a href="../Berlekamp_Zassenhaus/Unique_Factorization_Poly.html">Berlekamp_Zassenhaus.Unique_Factorization_Poly</a>
  <a href="../Polynomial_Factorization/Square_Free_Factorization.html">Polynomial_Factorization.Square_Free_Factorization</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> primitive_imp_unit_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pr<span class="main">:</span> <span class="quoted"><span class="quoted">"primitive <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟷</span> degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> degree0_coeffs<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p0</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">p0</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="main">∈</span> set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span><span class="main">.</span> <span class="skolem">p0</span> <span class="keyword1">dvd</span> <span class="bound">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cCons_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> pr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p0</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> primitiveD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_dvd_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dvd_all_coeffs_imp_dvd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span><span class="main">.</span> <span class="free">c</span> <span class="keyword1">dvd</span> <span class="bound">a</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">c</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pCons <span class="skolem">a</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span> <span class="main">+</span> pCons <span class="main">0</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">c</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">...</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_add<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> pCons <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">c</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cCons_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> pCons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">c</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Rings.dvd_mult<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">c</span><span class="main">:]</span> <span class="keyword1">dvd</span> pCons <span class="main">0</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> pCons_0_as_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> irreducible_content<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> primitive <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span><span class="main">.</span> <span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="bound">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> not_primitiveE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> dvd_all_coeffs_imp_dvd<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">*</span> <span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> irreducibleD<span class="main">[</span><span class="operator">OF</span> assms this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> c1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> const_poly_dvd_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_dvd_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> not <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* TODO: move *)</span>
<span class="keyword1"><span class="command">lemma</span></span> linear_irreducible_field<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> irreducibleI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> deg <span class="keyword3"><span class="command">show</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> deg <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_dvd_1<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> p0 <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> degree_mult_eq<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">folded</span> p<span class="main">]</span> assms
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">b</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> a0 b0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primitive_imp_unit_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* TODO: move *)</span>
<span class="keyword1"><span class="command">lemma</span></span> linear_irreducible_int<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cp<span class="main">:</span> <span class="quoted"><span class="quoted">"content <span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> irreducibleI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> deg <span class="keyword3"><span class="command">show</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> deg <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_dvd_1<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> cp<span class="main">[</span><span class="operator">unfolded</span> p is_unit_content_iff<span class="main">,</span> <span class="operator">unfolded</span> content_mult<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"content <span class="skolem">a</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"content <span class="skolem">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> content_ge_0_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> pos_zmult_eq_1_iff_lemma<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> p0 <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> degree_mult_eq<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">folded</span> p<span class="main">]</span> assms
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">b</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> a1 b1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primitive_imp_unit_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> irreducible_connect_rev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> irreducible<span class="hidden">⇩</span><sub>d</sub>I deg<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">r</span>
  <span class="keyword3"><span class="command">assume</span></span> degq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> diff<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> degq <span class="keyword1"><span class="command">have</span></span> nu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_dvd_1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> irreducibleD<span class="main">[</span><span class="operator">OF</span> irr p<span class="main">]</span> nu <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_dvd_1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> degq diff <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">using</span></span> degree_mult_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Polynomial Evaluation of Integer and Rational Polynomials in Fields.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ipoly</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ipoly</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> poly <span class="main">(</span>of_int_poly <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_map_poly_code<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly <span class="free">h</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> fold_coeffs <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">h</span> <span class="bound">a</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="free">p</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">real_of_int_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> real poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">real_of_int_poly</span> <span class="main">≡</span> of_int_poly"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">real_of_rat_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat poly <span class="main">⇒</span> real poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">real_of_rat_poly</span> <span class="main">≡</span> map_poly of_rat"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> of_rat_of_int<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="main">∘</span> of_int <span class="main">=</span> of_int"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_of_rat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="main">(</span>of_rat <span class="free">y</span><span class="main">)</span> <span class="main">=</span> of_rat <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="main">=</span> of_rat <span class="keyword1">o</span> of_int"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> id<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_of_real<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="main">(</span>of_real <span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field<span class="main">,</span>real_algebra_1<span class="main">}</span><span class="main">)</span> <span class="main">=</span> of_real <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="main">=</span> of_real <span class="keyword1">o</span> of_int"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> id<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_ipoly_roots<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span> <span class="main">::</span> real<span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_int_poly <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_roots_finite<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Algebraic Numbers -- Definition, Inverse, and Roots›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A number <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span> <span class="main"><span class="main">::</span></span> <span class="tfree"><span class="tfree">'a</span></span> <span class="main"><span class="main">::</span></span> field"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is algebraic iff it is the root of an integer polynomial.
  Whereas the Isabelle distribution this is defined via the embedding
  of integers in an field via <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Ints<span class="antiquote"><span class="antiquote">}</span></span></span></span>, we work with integer polynomials
  of type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> int<span class="antiquote"><span class="antiquote">}</span></span></span></span> and then use <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ipoly<span class="antiquote"><span class="antiquote">}</span></span></span></span> for evaluating the polynomial at
  a real or complex point.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_altdef_ipoly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> ipoly <span class="bound">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> algebraic_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">the_int</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">the_int</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="keyword1">THE</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> of_int <span class="bound">r</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> map_poly <span class="skolem">the_int</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> of_int_the_int<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span><span class="skolem">the_int</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">unfolding</span></span> the_int_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> theI'<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ints_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> the_int_0_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">the_int</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> of_int_the_int<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_poly of_int <span class="skolem">p'</span> <span class="main">=</span> map_poly <span class="main">(</span>of_int <span class="main">∘</span> <span class="skolem">the_int</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def map_poly_map_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1 of_int_the_int <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> poly_eq_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_map_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> p_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly of_int <span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI notI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">p'</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_p'<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_p' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"map_poly of_int <span class="skolem"><span class="skolem"><span class="skolem">p</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Definition of being algebraic with explicit witness polynomial.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">represents</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0 <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">represents</span>"</span> 51<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">represents</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>ipoly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> representsI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> representsD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> representsE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> represents_imp_degree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> px<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>representsD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int_poly <span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>of_int_poly <span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> poly_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> px<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> representsE_full<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> main<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> represents_imp_degree<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rep<span class="main"><span class="main">]</span></span> rep<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> representsE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> represents_of_rat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="main">(</span>of_rat <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>representsE<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> represents_of_real<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>representsE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_iff_represents<span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">represents</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> algebraic_altdef_ipoly represents_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> represents_irr_non_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> nu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">::</span>int<span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_dvd_1<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> dvd_iff_poly_eq_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> irreducibleD<span class="main">[</span><span class="operator">OF</span> irr this<span class="main">]</span> nu <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">r</span><span class="main">:]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_dvd_1 <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> degree0_coeffs<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> pq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="skolem">r</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> ap <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_int_hom.map_poly_pCons_hom<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> x0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The polynomial encoding a rational number.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_rat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_rat</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> quotient_of <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">[:</span><span class="main">-</span><span class="bound">n</span><span class="main">,</span><span class="bound">d</span><span class="main">:]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">abs_int_poly</span><span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">abs_int_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> lead_coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pos_poly_abs_poly<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>abs_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span> lead_coeff <span class="free">p</span> <span class="main">*</span> sgn <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> abs_sgn<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_int_poly_def mult.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abs_int_poly_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"abs_int_poly <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_int_poly_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_int_poly_eq_0_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"abs_int_poly <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_int_poly_def sgn_eq_0_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> degree_abs_int_poly<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>abs_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_int_poly_def sgn_eq_0_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_int_poly_dvd<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"abs_int_poly <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> abs_int_poly_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(*TODO: move &amp; generalize *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> idom<span class="main">)</span> irreducible_uminus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> irreducible <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="main">...</span> <span class="main">⟷</span> irreducible <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> irreducible_mult_unit_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> irreducible_abs_int_poly<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>abs_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> irreducible <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> abs_int_poly_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> coeff_abs_int_poly<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>abs_int_poly <span class="free">p</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> lead_coeff <span class="free">p</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span> coeff <span class="free">p</span> <span class="free">n</span> <span class="keyword1">else</span> coeff <span class="free">p</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_int_poly_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lead_coeff_abs_int_poly<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>abs_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> abs <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_abs_int_poly_eq_zero_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>abs_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1<span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_int_poly_def sgn_eq_0_iff of_int_poly_hom.hom_uminus<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_int_poly_represents<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs_int_poly <span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>representsE<span class="main">)</span>


<span class="comment1">(* TODO: Move *)</span>
<span class="keyword1"><span class="command">lemma</span></span> content_pCons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"content <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> gcd <span class="free">a</span> <span class="main">(</span>content <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> content_def coeffs_pCons_eq_cCons cCons_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> content_uminus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ring_gcd poly"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"content <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> content <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primitive_abs_int_poly<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"primitive <span class="main">(</span>abs_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> primitive <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_int_poly_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> abs_int_poly_inv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>sgn <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>abs_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_int_poly_def<span class="main">)</span>



<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cf_pos</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cf_pos</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>content <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> lead_coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cf_pos_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cf_pos_poly</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span>
      <span class="bound">c</span> <span class="main">=</span> content <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span>
      <span class="bound">d</span> <span class="main">=</span> <span class="main">(</span>sgn <span class="main">(</span>lead_coeff <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">*</span> <span class="bound">c</span><span class="main">)</span>
    <span class="keyword1">in</span> sdiv_poly <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">d</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sgn_is_unit<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> linordered_idom"</span></span> <span class="comment1">(* find/make better class *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">x</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span><span class="tfree">'a</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>linorder_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cf_pos_poly_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cf_pos_poly <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cf_pos_poly_def sdiv_poly_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cf_pos_poly_eq_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cf_pos_poly <span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cf_pos_poly_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sdiv_poly_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lc0<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> s0<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>lead_coeff <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"content <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_0_0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sc0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">*</span> <span class="var">?c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">from</span></span> content_dvd_coeff sgn_is_unit<span class="main">[</span><span class="operator">OF</span> lc0<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">*</span> <span class="var">?c</span> <span class="keyword1">dvd</span> coeff <span class="free">f</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unit_dvd_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span><span class="var">?s</span> <span class="main">*</span> <span class="var">?c</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> coeff <span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dvd_div_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cf_pos_poly_def Let_def sdiv_poly_def poly_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_map_poly *<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> cf_pos_poly_main<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>sgn <span class="main">(</span>lead_coeff <span class="free">f</span><span class="main">)</span> <span class="main">*</span> content <span class="free">f</span><span class="main">)</span> <span class="main">(</span>cf_pos_poly <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?g1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> content_cf_pos_poly<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"content <span class="main">(</span>cf_pos_poly <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?g2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> lead_coeff_cf_pos_poly<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>cf_pos_poly <span class="free">f</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?g3</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> cf_pos_poly_dvd<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cf_pos_poly <span class="free">f</span> <span class="keyword1">dvd</span> <span class="free">f</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?g4</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> conjI<span class="main">)</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?g1</span></span></span> <span class="var"><span class="quoted"><span class="var">?g2</span></span></span> <span class="var"><span class="quoted"><span class="var">?g3</span></span></span> <span class="var"><span class="quoted"><span class="var">?g4</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> f0<span class="main">:</span> False
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>lead_coeff <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">unfolding</span></span> sgn_if <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≡</span> smult <span class="var">?s</span> <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≡</span> <span class="var">?s</span> <span class="main">*</span> content <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"content <span class="skolem">g</span> <span class="main">=</span> content <span class="main">(</span><span class="main">[:</span><span class="var">?s</span><span class="main">:]</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> content <span class="main">[:</span><span class="var">?s</span><span class="main">:]</span> <span class="main">*</span> content <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> content_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"content <span class="main">[:</span><span class="var">?s</span><span class="main">:]</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> content_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> cg<span class="main">:</span> <span class="quoted"><span class="quoted">"content <span class="skolem">g</span> <span class="main">=</span> content <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> f0
  <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"cf_pos_poly <span class="free">f</span> <span class="main">=</span> sdiv_poly <span class="free">f</span> <span class="skolem">d</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cf_pos_poly_def Let_def d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"primitive_part <span class="skolem">g</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ng</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ng</span> <span class="main">=</span> primitive_part <span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> d
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdiv_poly <span class="free">f</span> <span class="skolem">d</span> <span class="main">=</span> sdiv_poly <span class="skolem">g</span> <span class="main">(</span>content <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cg <span class="keyword1"><span class="command">unfolding</span></span> g_def d_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> coeff_sdiv_poly coeff_smult<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> s<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> div_minus_right<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> fg<span class="main">:</span> <span class="quoted"><span class="quoted">"cf_pos_poly <span class="free">f</span> <span class="main">=</span> primitive_part <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> primitive_part_alt_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> lg<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">g</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def lead_coeff_smult
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> linorder_neqE_linordered_idom sgn_greater sgn_less zero_less_mult_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> g0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> f0 content_primitive_part<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?g2</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> fg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> g0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"content <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> content_times_primitive_part<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted">lead_coeff</span><span class="main">,</span> <span class="operator">unfolded</span> lead_coeff_smult<span class="main">]</span>
    lg content_ge_0_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> lg'<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">ng</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ng_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.antisym dual_order.strict_implies_order zero_less_mult_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> f0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?g3</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> fg ng_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> d0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s f0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="skolem">d</span> <span class="main">(</span>cf_pos_poly <span class="free">f</span><span class="main">)</span> <span class="main">=</span> smult <span class="var">?s</span> <span class="main">(</span>smult <span class="main">(</span>content <span class="free">f</span><span class="main">)</span> <span class="main">(</span>sdiv_poly <span class="main">(</span>smult <span class="var">?s</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>content <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fg primitive_part_alt_def cg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdiv_poly <span class="main">(</span>smult <span class="var">?s</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>content <span class="free">f</span><span class="main">)</span> <span class="main">=</span> smult <span class="var">?s</span> <span class="main">(</span>sdiv_poly <span class="free">f</span> <span class="main">(</span>content <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cg g_def primitive_part_alt_def primitive_part_smult_int sgn_sgn<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="skolem">d</span> <span class="main">(</span>cf_pos_poly <span class="free">f</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>content <span class="free">f</span><span class="main">)</span> <span class="main">(</span>primitive_part <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> primitive_part_alt_def <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> content_times_primitive_part<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> df<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="skolem">d</span> <span class="main">(</span>cf_pos_poly <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> d0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?g1</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> df <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> cf_pos_poly <span class="free">f</span> <span class="main">*</span> <span class="main">[:</span><span class="skolem">d</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> dvdI<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?g4</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* TODO: remove *)</span>
<span class="keyword1"><span class="command">lemma</span></span> irreducible_connect_int<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ir<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"content <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> c primitive_iff_content_eq_1 ir irreducible_primitive_connect <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span>ring_char_0<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> ipoly_cf_pos_poly_eq_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>cf_pos_poly <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> degree_cf_pos_poly<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>cf_pos_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cf_pos_cf_pos_poly<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> cf_pos <span class="main">(</span>cf_pos_poly <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>cf_pos_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> cf_pos_poly_main<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sgn_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cf_pos <span class="main">(</span>cf_pos_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cf_pos_poly_main p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cf_pos_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipoly <span class="main">(</span>cf_pos_poly <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> cf_pos_poly_main<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_eq_0_iff <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipoly <span class="main">(</span>cf_pos_poly <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> cf_pos_poly_eq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"cf_pos_poly <span class="free">f</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> degree <span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> iffI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> df0<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span>  degree0_coeffs<span class="main">[</span><span class="operator">OF</span> df0<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f0</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">f0</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cf_pos_poly <span class="free">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f0 <span class="keyword1"><span class="command">unfolding</span></span> f cf_pos_poly_def Let_def sdiv_poly_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> content_def mult_sgn_abs<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>cf_pos_poly <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> l <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cf_pos_poly <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemma</span></span> irr_cf_poly_rat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>poly_rat <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>poly_rat <span class="free">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"primitive <span class="main">(</span>poly_rat <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_rat <span class="free">x</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">d</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_rat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>poly_rat <span class="free">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"primitive <span class="main">(</span>poly_rat <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> id cf_pos_def <span class="keyword1"><span class="command">using</span></span> d quotient_of_coprime<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> content_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> cf_pos_def<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>poly_rat <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> linear_irreducible_int<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_rat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_rat <span class="free">x</span><span class="main">)</span> <span class="main">(</span>of_rat <span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_rat <span class="free">x</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"poly_rat <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_rat <span class="free">x</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>of_rat <span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> irr_cf_poly_rat<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_rat <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Factorial_Ring.irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_rat <span class="free">x</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">d</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_rat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> of_int <span class="skolem">d</span> <span class="main">=</span> of_int <span class="skolem">n</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> of_int <span class="skolem">n</span> <span class="main">/</span> of_int <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_divide_imp<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> d id <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_rat <span class="free">x</span><span class="main">)</span> <span class="main">(</span>of_rat <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_rat <span class="free">x</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_rat <span class="free">x</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>of_rat <span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_minus of_rat_divide <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quotient_of_div<span class="main"><span class="main">[</span></span><span class="operator">OF</span> x<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_rat_represents_of_rat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_rat <span class="free">x</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span>of_rat <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_smult_0_iff<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipoly <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>


<span class="comment1">(* TODO *)</span>
<span class="keyword1"><span class="command">lemma</span></span> not_irreducibleD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> irreducible <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">z</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">y</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">z</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Factorial_Ring.irreducible_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> cf_pos_poly_represents<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cf_pos_poly <span class="free">p</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> coprime_prod<span class="main">:</span> <span class="comment1">(* TODO: move *)</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> coprime <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span> <span class="main">⟹</span> coprime <span class="free">b</span> <span class="main">(</span><span class="free">d</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_gcd<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> smult_prod<span class="main">:</span> <span class="comment1">(* TODO: move or find corresponding lemma *)</span>
  <span class="quoted"><span class="quoted">"smult <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> monom <span class="free">a</span> <span class="main">0</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> degree_map_poly_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"degree <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> degree_eq_length_coeffs Polynomial.coeffs_map_poly
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>coeffs_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> irreducible_cf_pos_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>cf_pos_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="var">?p</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> irreducible_altdef<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> irr <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> deg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?p</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_dvd_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="keyword1">dvd</span> cf_pos_poly <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> cf_pos_poly_dvd
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> irr<span class="main">[</span><span class="operator">unfolded</span> irreducible_altdef<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cf_pos_poly_dvd<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> dvd_preserving_hom <span class="main">=</span> comm_semiring_1_hom <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom_eq_mult_hom_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">x</span> <span class="main">=</span> <span class="free">hom</span> <span class="free">y</span> <span class="main">*</span> <span class="free">hz</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">hz</span> <span class="main">=</span> <span class="free">hom</span> <span class="bound">z</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">*</span> <span class="bound">z</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> hom_dvd_hom_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">hom</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">hom</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hz</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="free">y</span> <span class="main">=</span> <span class="free">hom</span> <span class="free">x</span> <span class="main">*</span> <span class="skolem">hz</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> hom_eq_mult_hom_imp<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hz</span> <span class="main">=</span> <span class="free">hom</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">sublocale</span></span> unit_preserving_hom
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="free">hom</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hom_dvd_hom_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">sublocale</span></span> zero_hom_0
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">0</span> <span class="keyword1">dvd</span> <span class="free">hom</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> hom_dvd_hom_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> smult_inverse_monom<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> smult <span class="main">(</span>inverse <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">::</span>rat poly<span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[:</span> <span class="free">c</span> <span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> left_inverse right_inverse smult_1 smult_1_left smult_smult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> of_int_monom<span class="main">:</span><span class="quoted"><span class="quoted">"of_int_poly <span class="free">p</span> <span class="main">=</span> <span class="main">[:</span>rat_of_int <span class="free">c</span><span class="main">:]</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[:</span> <span class="free">c</span> <span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> degree_0_content<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"content <span class="free">p</span> <span class="main">=</span> abs <span class="main">(</span>coeff <span class="free">p</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> deg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> degree0_coeffs<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prime_elem_imp_gcd_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span> ring_gcd"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">x</span> <span class="main">⟹</span> gcd <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> normalize <span class="free">x</span> <span class="main">∨</span> gcd <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prime_elem_imp_coprime <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcd_proj1_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> coprime_imp_gcd_eq_1<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> irreducible_pos_gcd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ir<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pos<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">p</span> <span class="free">q</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span><span class="free">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> pos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span>sgn <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span><span class="main">:]</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> prime_elem_imp_gcd_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">,</span> <span class="operator">unfolded</span> prime_elem_iff_irreducible<span class="main">,</span> <span class="operator">OF</span> ir<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> normalize_poly_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> irreducible_pos_gcd_twice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"gcd <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> pq <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> gcd <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> irreducible_pos_gcd <span class="main">[</span><span class="operator">OF</span> p<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> pq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> irreducible_pos_gcd <span class="main">[</span><span class="operator">OF</span> q<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> pq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">interpretation</span></span> of_rat_hom<span class="main">:</span> field_hom_0' <span class="quoted">of_rat</span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_zero_imp_not_unit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> poly_hom.hom_dvd_1<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_prod_mset_zero_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>prod_mset <span class="free">F</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span> <span class="main">∈#</span> <span class="free">F</span><span class="main">.</span> poly <span class="bound">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_mult_zero_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_imp_represents_irreducible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">represents</span> <span class="free">x</span> <span class="main">∧</span> irreducible <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> px0<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> algebraic_altdef_ipoly <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> poly_zero_imp_not_unit<span class="main">[</span><span class="operator">OF</span> px0<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> of_int_poly_hom.hom_dvd_1<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> mset_factors_exist<span class="main">[</span><span class="operator">OF</span> p0 this<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_factors <span class="skolem">F</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> prod_mset <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int_poly <span class="main">...</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span> <span class="main">=</span> prod_mset <span class="main">(</span>image_mset of_int_poly <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">...</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> px0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> poly_prod_mset_zero_iff<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈#</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fx0<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> F <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> fx0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_imp_represents_irreducible_cf_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>field_char_0<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">represents</span> <span class="free">x</span> <span class="main">∧</span> irreducible <span class="bound">p</span> <span class="main">∧</span> lead_coeff <span class="bound">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> primitive <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> algebraic_imp_represents_irreducible<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> px<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cf_pos_poly <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> px irr represents_imp_degree
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="var">?p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"cf_pos <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> irreducible_cf_pos_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cf_pos_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> gcd_of_int_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span>of_int_poly <span class="free">f</span><span class="main">)</span> <span class="main">(</span>of_int_poly <span class="free">g</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span>field_gcd<span class="main">}</span> poly<span class="main">)</span> <span class="main">=</span>
  smult <span class="main">(</span>inverse <span class="main">(</span>of_int <span class="main">(</span>lead_coeff <span class="main">(</span>gcd <span class="free">f</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_int_poly <span class="main">(</span>gcd <span class="free">f</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ia</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_int_poly <span class="main">::</span> <span class="main">_</span> <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ir</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_int_poly <span class="main">::</span> <span class="main">_</span> <span class="main">⇒</span> rat poly"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ra</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly of_rat <span class="main">::</span> <span class="main">_</span> <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ia</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?ra</span> <span class="main">(</span><span class="var">?ir</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">unfolding</span></span> of_rat_hom.map_poly_gcd<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> gcd_rat_to_gcd_int <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_imp_represents_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span>field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">represents</span> <span class="free">x</span> <span class="main">∧</span> irreducible <span class="bound">p</span> <span class="main">∧</span> lead_coeff <span class="bound">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Ex1 <span class="var">?p</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cfp<span class="main">:</span> <span class="quoted"><span class="quoted">"cf_pos <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cf_pos_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> algebraic_imp_represents_irreducible_cf_pos<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex1I<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">assume</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> represents_imp_degree<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> q irreducible_content<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> cfq<span class="main">:</span> <span class="quoted"><span class="quoted">"cf_pos <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cf_pos_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ia</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly of_int <span class="main">::</span> int poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> irreducible_pos_gcd_twice<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> p q cfp cfq <span class="keyword1"><span class="command">have</span></span> gcd<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> p q <span class="keyword1"><span class="command">have</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> inverse <span class="main">(</span>of_int <span class="main">(</span>lead_coeff <span class="main">(</span>gcd <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="var">?ia</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="var">?ia</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="var">?ia</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="var">?ia</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> poly_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> gcd <span class="main">(</span><span class="var">?ia</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="var">?ia</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gcd_greatest<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> smult <span class="skolem">c</span> <span class="main">(</span><span class="var">?ia</span> <span class="main">(</span>gcd <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gcd_of_int_poly c_def <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ia</span> <span class="main">(</span>gcd <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcd<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="skolem">c</span> <span class="main">1</span> <span class="main">=</span> <span class="main">[:</span> <span class="skolem">c</span> <span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> c_def gcd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_iff_poly_eq_0<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_poly_compose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span><span class="free">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> ipoly <span class="free">p</span> <span class="main">(</span>ipoly <span class="free">q</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span><span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> of_int <span class="skolem">a</span> <span class="main">+</span> ipoly <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> ipoly <span class="free">q</span> <span class="free">x</span> <span class="main">*</span> ipoly <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> ipoly <span class="skolem">p</span> <span class="main">(</span>ipoly <span class="free">q</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pCons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">a</span> <span class="main">+</span> ipoly <span class="free">q</span> <span class="free">x</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> ipoly <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>ipoly <span class="free">q</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> map_poly_pCons<span class="main">[</span><span class="operator">OF</span> pCons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Polynomial for unary minus.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_uminus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ring_1 poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_uminus</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">.</span> monom <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="bound">i</span> <span class="main">*</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="bound">i</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_uminus_pCons_pCons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_uminus <span class="main">(</span>pCons <span class="free">a</span> <span class="main">(</span>pCons <span class="free">b</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pCons <span class="free">a</span> <span class="main">(</span>pCons <span class="main">(</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span>poly_uminus <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pCons <span class="free">a</span> <span class="main">(</span>pCons <span class="free">b</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> poly_uminus_def deg sum.atMost_Suc_shift monom_Suc monom_0 sum_pCons_0_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_uminus_def monom_0 monom_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">poly_uminus_inner</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ring_1 list <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly_uminus_inner</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="main">|</span>   <span class="quoted"><span class="quoted">"<span class="free">poly_uminus_inner</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="main">[:</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">:]</span>"</span></span>
  <span class="main">|</span>   <span class="quoted"><span class="quoted">"<span class="free">poly_uminus_inner</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">=</span> pCons <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>pCons <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">poly_uminus_inner</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_uminus_code<span class="main">[</span><span class="operator">code</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_uminus <span class="free">p</span> <span class="main">=</span> poly_uminus_inner <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_uminus <span class="main">(</span>Poly <span class="skolem">as</span><span class="main">)</span> <span class="main">=</span> poly_uminus_inner <span class="skolem">as</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">as</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"length <span class="skolem">as</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">as</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> less
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">as</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_uminus_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">bs</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bs</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_uminus_def monom_0<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">cs</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_uminus_inner_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_uminus_inner <span class="free">as</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> Poly <span class="free">as</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly_uminus_inner.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> degree_poly_uminus_inner<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_uminus_inner <span class="free">as</span><span class="main">)</span> <span class="main">=</span> degree <span class="main">(</span>Poly <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly_uminus_inner.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_uminus_inner<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_uminus_inner <span class="free">as</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>comm_ring_1<span class="main">)</span> <span class="main">=</span> ipoly <span class="main">(</span>Poly <span class="free">as</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly_uminus_inner.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span> ring_distribs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> represents_uminus<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> alg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_uminus <span class="free">p</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> representsD<span class="main">[</span><span class="operator">OF</span> alg<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rp<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_uminus <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> representsI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ 0<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> rp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> content_poly_uminus_inner<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">as</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ring_gcd list"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"content <span class="main">(</span>poly_uminus_inner <span class="free">as</span><span class="main">)</span> <span class="main">=</span> content <span class="main">(</span>Poly <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly_uminus_inner.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Multiplicative inverse is represented by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> reflect_poly<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inverse_pow_minus<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inverse <span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="free">i</span> <span class="main">=</span> inverse <span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> field_class.field_divide_inverse power_diff power_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> inj_idom_hom<span class="main">)</span> reflect_poly_hom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reflect_poly <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">hom</span> <span class="main">(</span>reflect_poly <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"rev <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> reflect_poly_def coeffs_map_poly_hom rev_map
    xs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_reflect_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>reflect_poly <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">*</span> ipoly <span class="free">p</span> <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?or</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_int <span class="main">::</span> int <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_idom_hom <span class="var">?or</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> poly_reflect_poly_nz<span class="main">[</span><span class="operator">OF</span> x<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"map_poly <span class="var">?or</span> <span class="free">p</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_idom_hom.reflect_poly_hom<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hom<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> represents_inverse<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> alg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reflect_poly <span class="free">p</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> representsI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> representsD<span class="main">[</span><span class="operator">OF</span> alg<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rp<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reflect_poly <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reflect_poly_0 reflect_poly_at_0_eq_0_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>reflect_poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ipoly_reflect_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>rp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inverse_roots<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>reflect_poly <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> ipoly <span class="free">p</span> <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ipoly_reflect_poly<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Polynomial for n-th root.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_nth_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_nth_root</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> monom <span class="main">1</span> <span class="free">n</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_nth_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_nth_root <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> ipoly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_nth_root_def ipoly_poly_compose <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_poly_monom poly_monom<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> poly_nth_root_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_nth_root <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_nth_root_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pcompose_eq_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_monom_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> represents_nth_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> alg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_nth_root <span class="free">p</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> representsD<span class="main">[</span><span class="operator">OF</span> alg<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rp<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_nth_root <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> representsI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ 0<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> ipoly_nth_root y rp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> represents_nth_root_odd_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> alg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> odd<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_nth_root <span class="free">p</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span>root <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> represents_nth_root<span class="main"><span class="main">[</span></span><span class="operator">OF</span> odd_real_root_pow<span class="main"><span class="main">[</span></span><span class="operator">OF</span> odd<span class="main"><span class="main">]</span></span> alg<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> represents_nth_root_pos_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> alg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_nth_root <span class="free">p</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span>root <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> represents_nth_root<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ alg<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> id pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> represents_nth_root_neg_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> alg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_uminus <span class="main">(</span>poly_nth_root <span class="main">(</span>poly_uminus <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span>root <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span> root <span class="free">n</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> real_root_minus <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rt
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> represents_uminus<span class="main"><span class="main">[</span></span><span class="operator">OF</span> represents_nth_root_pos_real<span class="main"><span class="main">[</span></span><span class="operator">OF</span> represents_uminus<span class="main"><span class="main">[</span></span><span class="operator">OF</span> alg<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> neg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> represents_csqrt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> alg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_nth_root <span class="numeral">2</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span>csqrt <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> represents_nth_root<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ alg<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> represents_sqrt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> alg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_nth_root <span class="numeral">2</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> represents_nth_root<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ alg<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pos<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> represents_degree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> degree0_coeffs<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> represents_def p<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Polynomial for multiplying a rational number with an algebraic number.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_mult_rat_main</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_mult_rat_main</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom poly<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">fs</span> <span class="main">=</span> coeffs <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span> <span class="bound">k</span> <span class="main">=</span> length <span class="bound">fs</span> <span class="keyword1">in</span>
    poly_of_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">fi</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="bound">fi</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">^</span> <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="bound">fs</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="bound">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_mult_rat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> int poly <span class="main">⇒</span> int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_mult_rat</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> quotient_of <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span> poly_mult_rat_main <span class="bound">n</span> <span class="bound">d</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coeff_poly_mult_rat_main<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>poly_mult_rat_main <span class="free">n</span> <span class="free">d</span> <span class="free">f</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> coeff <span class="free">f</span> <span class="free">i</span> <span class="main">*</span> <span class="free">n</span> <span class="main">^</span> <span class="main">(</span>degree <span class="free">f</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">d</span> <span class="main">^</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>poly_mult_rat_main <span class="free">n</span> <span class="free">d</span> <span class="free">f</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span>coeff <span class="free">f</span> <span class="free">i</span> <span class="main">*</span> <span class="free">d</span> <span class="main">^</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">n</span> <span class="main">^</span> <span class="main">(</span>length <span class="main">(</span>coeffs <span class="free">f</span><span class="main">)</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_mult_rat_main_def Let_def poly_of_list_def coeff_Poly
    <span class="keyword1"><span class="command">unfolding</span></span> nth_default_coeffs_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> nth_default_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_eq_length_coeffs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> degree_poly_mult_rat_main<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> degree <span class="main">(</span>poly_mult_rat_main <span class="free">n</span> <span class="free">d</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> degree <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> degree_def <span class="keyword1"><span class="command">unfolding</span></span> coeff_poly_mult_rat_main <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> degree_def coeff_poly_mult_rat_main id
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_mult_rat_main<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field<span class="main">,</span>ring_char_0<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_mult_rat_main <span class="free">n</span> <span class="free">d</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> of_int <span class="free">n</span> <span class="main">^</span> degree <span class="free">p</span> <span class="main">*</span> ipoly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> of_int <span class="free">d</span> <span class="main">/</span> of_int <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">t</span> <span class="keyword1">else</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span> <span class="skolem">f</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_altdef of_int_hom.coeff_map_poly_hom mult.assoc<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> of_int_mult<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      sum_distrib_left
    <span class="keyword1"><span class="command">unfolding</span></span> of_int_hom.degree_map_poly_hom degree_poly_mult_rat_main<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> d
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..</span>degree <span class="free">p</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="free">n</span> <span class="main">^</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="free">n</span> <span class="main">^</span> degree <span class="free">p</span> <span class="main">/</span> of_int <span class="free">n</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> power_diff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span>coeff <span class="main">(</span>poly_mult_rat_main <span class="free">n</span> <span class="free">d</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">=</span> of_int <span class="free">n</span> <span class="main">^</span> degree <span class="free">p</span> <span class="main">*</span> of_int <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> of_int <span class="free">d</span> <span class="main">/</span> of_int <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> coeff_poly_mult_rat_main
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> degree_poly_mult_rat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_mult_rat <span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> quot<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> of_int <span class="skolem">n</span> <span class="main">/</span> of_int <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms r <span class="keyword1"><span class="command">have</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> quot <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_mult_rat <span class="free">r</span> <span class="free">p</span> <span class="main">=</span> poly_mult_rat_main <span class="skolem">n</span> <span class="skolem">d</span> <span class="free">p</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> poly_mult_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id degree_poly_mult_rat_main<span class="main">[</span><span class="operator">OF</span> n0<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_mult_rat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_mult_rat <span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> of_int <span class="main">(</span>fst <span class="main">(</span>quotient_of <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> degree <span class="free">p</span> <span class="main">*</span> ipoly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> inverse <span class="main">(</span>of_rat <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> quot<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> of_int <span class="skolem">n</span> <span class="main">/</span> of_int <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> r r0 <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> r d n <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">d</span> <span class="main">/</span> of_int <span class="skolem">n</span> <span class="main">=</span> inverse <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> quot <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_mult_rat <span class="free">r</span> <span class="free">p</span> <span class="main">=</span> poly_mult_rat_main <span class="skolem">n</span> <span class="skolem">d</span> <span class="free">p</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> poly_mult_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id ipoly_mult_rat_main<span class="main">[</span><span class="operator">OF</span> d n<span class="main">]</span> quot fst_conv of_rat_inverse<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> inv<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_divide<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_mult_rat_main_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_mult_rat_main <span class="free">n</span> <span class="free">d</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_mult_rat_main <span class="free">n</span> <span class="free">d</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_mult_rat_main_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_mult_rat_main <span class="free">n</span> <span class="free">d</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>poly_mult_rat_main <span class="free">n</span> <span class="free">d</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coeff_poly_mult_rat_main <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> poly_mult_rat_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> r0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_mult_rat <span class="free">r</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> quot<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> of_int <span class="skolem">n</span> <span class="main">/</span> of_int <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> r r0 <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> quot <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_mult_rat <span class="free">r</span> <span class="free">p</span> <span class="main">=</span> poly_mult_rat_main <span class="skolem">n</span> <span class="skolem">d</span> <span class="free">p</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> poly_mult_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> n d <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> represents_mult_rat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_mult_rat <span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span>of_rat <span class="free">r</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> represents_def ipoly_mult_rat<span class="main">[</span><span class="operator">OF</span> r<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Polynomial for adding a rational number on an algebraic number.
  Again, we do not have to factor afterwards.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_add_rat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> int poly <span class="main">⇒</span> int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_add_rat</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> quotient_of <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span>
     <span class="main">(</span>poly_mult_rat_main <span class="bound">d</span> <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">-</span><span class="bound">n</span><span class="main">,</span><span class="bound">d</span><span class="main">:]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_add_rat_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_add_rat <span class="free">r</span> <span class="free">p</span> <span class="main">≡</span> <span class="keyword1">case</span> quotient_of <span class="free">r</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span> <span class="main">⇒</span>
     <span class="keyword1">let</span> <span class="bound">p'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">fs</span> <span class="main">=</span> coeffs <span class="free">p</span><span class="main">;</span> <span class="bound">k</span> <span class="main">=</span> length <span class="bound">fs</span> <span class="keyword1">in</span> poly_of_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">fi</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="bound">fi</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">^</span> <span class="main">(</span><span class="bound">k</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>zip <span class="bound">fs</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
         <span class="bound">p''</span> <span class="main">=</span> <span class="bound">p'</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">-</span><span class="bound">n</span><span class="main">,</span><span class="bound">d</span><span class="main">:]</span>
      <span class="keyword1">in</span> <span class="bound">p''</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_add_rat_def poly_mult_rat_main_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> degree_poly_add_rat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_add_rat <span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> quot<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> of_int <span class="skolem">n</span> <span class="main">/</span> of_int <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_add_rat_def quot split
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_poly_mult_rat_main d<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_add_rat<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_add_rat <span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> degree <span class="free">p</span><span class="main">)</span> <span class="main">*</span> ipoly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> of_rat <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> quot<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> of_int <span class="skolem">n</span> <span class="main">/</span> of_int <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="main">[:</span><span class="main">-</span> <span class="skolem">n</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> of_int <span class="skolem">d</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> of_int <span class="skolem">n</span> <span class="main">+</span> <span class="free">x</span> <span class="main">/</span> of_int <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_add_rat_def quot split
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipoly_mult_rat_main ipoly_poly_compose d r degree_poly_mult_rat_main <span class="dynamic"><span class="dynamic">field_simps</span></span> id of_rat_divide<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_add_rat_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_add_rat <span class="free">r</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> quot<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_div<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> of_int <span class="skolem">n</span> <span class="main">/</span> of_int <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> quotient_of_denom_pos<span class="main">[</span><span class="operator">OF</span> quot<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_add_rat_def quot split
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d pcompose_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> add_rat_roots<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_add_rat <span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> ipoly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> of_rat <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ipoly_add_rat <span class="keyword1"><span class="command">using</span></span> quotient_of_nonzero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> represents_add_rat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_add_rat <span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span>of_rat <span class="free">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> represents_def ipoly_add_rat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(* TODO: move? *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> pos_mult<span class="main">[</span><span class="operator">simplified</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> mult_less_cancel_left_pos<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> mult_less_cancel_left_pos<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_add_rat_pos_neg<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_add_rat <span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>linordered_field<span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> ipoly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> of_rat <span class="free">r</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_add_rat <span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>linordered_field<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> ipoly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> of_rat <span class="free">r</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> quotient_of_nonzero <span class="keyword1"><span class="command">unfolding</span></span> ipoly_add_rat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sgn_ipoly_add_rat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>ipoly <span class="main">(</span>poly_add_rat <span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>linordered_field<span class="main">)</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> of_rat <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"sgn <span class="var">?l</span> <span class="main">=</span> sgn <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> ipoly_add_rat_pos_neg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span><span class="tfree">'a</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  sgn_1_pos sgn_1_neg sgn_eq_0_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deg_nonzero_represents<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="main">::</span> complex<span class="main">.</span> <span class="free">p</span> <span class="keyword1">represents</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_int_poly <span class="free">p</span> <span class="main">::</span> complex poly"</span></span>
  <span class="keyword1"><span class="command">from</span></span> fundamental_theorem_algebra_factorized<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="skolem">c</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">←</span><span class="skolem">as</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">as</span> <span class="main">=</span> degree <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="var">?p</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> deg len <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">as</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> represents_def id<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> as <span class="keyword1"><span class="command">using</span></span> deg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Bivariate_Polynomials">
<div class="head">
<h1>Theory Bivariate_Polynomials</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Resultants›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We need some results on resultants to show that 
  a suitable prime for Berlekamp's algorithm always exists
  if the input is square free. Most of this theory has
  been developed for algebraic numbers, though. We moved this
  theory here, so that algebraic numbers can already use the
  factorization algorithm of this entry.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bivariate Polynomials›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Bivariate_Polynomials
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../Polynomial_Interpolation/Ring_Hom_Poly.html">Polynomial_Interpolation.Ring_Hom_Poly</a>
  <a href="../Subresultants/More_Homomorphisms.html">Subresultants.More_Homomorphisms</a> 
  <a href="../Berlekamp_Zassenhaus/Unique_Factorization_Poly.html">Berlekamp_Zassenhaus.Unique_Factorization_Poly</a> <span class="comment1">(* Only for preserving sublocaling *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Evaluation of Bivariate Polynomials›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_semiring_1 poly poly <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly2</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> poly <span class="main">(</span>poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">[:</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">:]</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly2_by_map<span class="main">:</span> <span class="quoted"><span class="quoted">"poly2 <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> poly <span class="main">(</span>map_poly <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> poly <span class="bound">c</span> <span class="free">x</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> poly2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly2_const<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly2 <span class="main">[:</span><span class="main">[:</span><span class="free">a</span><span class="main">:]</span><span class="main">:]</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly2_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> poly2_smult<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly2 <span class="main">(</span>smult <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> poly <span class="free">a</span> <span class="free">x</span> <span class="main">*</span> poly2 <span class="free">p</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly2_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> poly2_hom<span class="main">:</span> comm_semiring_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly2 <span class="bound">p</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly2_def<span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> poly2_hom<span class="main">:</span> comm_ring_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly2 <span class="bound">p</span> <span class="free">x</span> <span class="free">y</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> poly2_hom<span class="main">:</span> idom_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> poly2 <span class="bound">p</span> <span class="free">x</span> <span class="free">y</span>"</span></span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly2_pCons<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly2 <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> poly <span class="free">a</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">*</span> poly2 <span class="free">p</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly2_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> poly2_monom<span class="main">:</span> <span class="quoted"><span class="quoted">"poly2 <span class="main">(</span>monom <span class="free">a</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> poly <span class="free">a</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_monom poly2_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_poly_as_poly2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly2 <span class="free">p</span> <span class="free">x</span> <span class="main">(</span>poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> poly <span class="main">(</span>poly <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poly2_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemma is an extension rule for bivariate polynomials.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly2_ext<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>ring_char_0<span class="main">,</span>idom<span class="main">}</span> poly poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> poly2 <span class="free">p</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">=</span> poly2 <span class="free">q</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> poly_ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> poly <span class="main">(</span>poly <span class="free">q</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_poly_as_poly2<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">coeff_lift2</span> <span class="main">==</span> <span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">[:</span><span class="main">[:</span> <span class="bound">a</span> <span class="main">:]</span><span class="main">:]</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> coeff_lift2_lift<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff_lift2 <span class="main">=</span> coeff_lift <span class="main">∘</span> coeff_lift"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly_lift</span> <span class="main">=</span> map_poly coeff_lift"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly_lift2</span> <span class="main">=</span> map_poly coeff_lift2"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> degree_poly_lift<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_lift <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_lift_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> degree_map_poly<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_lift_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_lift <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_lift_0_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_lift <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_lift_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">;</span></span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_lift_pCons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_lift <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> pCons <span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="main">(</span>poly_lift <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_lift_def map_poly_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> coeff_poly_lift<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>poly_lift <span class="free">p</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> coeff_lift <span class="main">(</span>coeff <span class="free">p</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> pcompose_conv_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"pcompose <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> poly <span class="main">(</span>poly_lift <span class="free">p</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_lift_hom<span class="main">:</span> inj_comm_monoid_add_hom <span class="quoted">poly_lift</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> map_poly_inj_comm_monoid_add_hom <span class="quoted">coeff_lift</span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_comm_monoid_add_hom poly_lift"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_lift_def <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> poly_lift_hom<span class="main">:</span> inj_comm_semiring_hom <span class="quoted">poly_lift</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> map_poly_inj_comm_semiring_hom <span class="quoted">coeff_lift</span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_comm_semiring_hom poly_lift"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_lift_def <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> poly_lift_hom<span class="main">:</span> inj_comm_ring_hom <span class="quoted">poly_lift</span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> poly_lift_hom<span class="main">:</span> inj_idom_hom <span class="quoted">poly_lift</span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_monoid_add_hom<span class="main">)</span> map_poly_hom_coeff_lift<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">hom_distribs</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span>coeff_lift <span class="free">a</span><span class="main">)</span> <span class="main">=</span> coeff_lift <span class="main">(</span><span class="free">hom</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_ring_hom<span class="main">)</span> map_poly_coeff_lift_hom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_poly <span class="main">(</span>coeff_lift <span class="main">∘</span> <span class="free">hom</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> map_poly <span class="main">(</span>map_poly <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>map_poly coeff_lift <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_lift <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pCons<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> map_poly_pCons<span class="main">[</span><span class="operator">OF</span> pCons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> pCons<span class="main">(</span>2<span class="main">)</span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff_lift <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> map_poly_pCons<span class="main">[</span><span class="operator">OF</span> pCons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> pCons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_poly_lift<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_0 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>poly_lift <span class="free">p</span><span class="main">)</span> <span class="main">[:</span><span class="free">x</span><span class="main">:]</span> <span class="main">=</span> <span class="main">[:</span> poly <span class="free">p</span> <span class="free">x</span> <span class="main">:]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_lift_pCons
    <span class="keyword1"><span class="command">unfolding</span></span> poly_pCons
    <span class="keyword1"><span class="command">unfolding</span></span> pCons <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> degree_poly_lift2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_lift2 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_lift2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_lift2_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_lift2 <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_lift2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_lift2_0_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_lift2 <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_lift2_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">;</span></span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_lift2_pCons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_lift2 <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> pCons <span class="main">[:</span><span class="main">[:</span><span class="free">a</span><span class="main">:]</span><span class="main">:]</span> <span class="main">(</span>poly_lift2 <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_lift2_def map_poly_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_lift2_lift<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_lift2 <span class="main">=</span> poly_lift <span class="main">∘</span> poly_lift"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="skolem">p</span> <span class="main">=</span> <span class="var">?r</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_lift2_def coeff_lift2_lift poly_lift_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly2_poly_lift<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly2 <span class="main">(</span>poly_lift <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> poly <span class="free">p</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">;</span></span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_lift2_nonzero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_lift2 <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_lift2_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Swapping the Order of Variables›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_y_x</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">≤</span>degree <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> monom <span class="main">(</span>monom <span class="main">(</span>coeff <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_y_x_fix_y_deg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ydeg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> degree <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="free">d</span><span class="main">.</span> monom <span class="main">(</span>monom <span class="main">(</span>coeff <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> sum <span class="main">(</span><span class="var">?f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">_</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_y_x_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> atMost_iff
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="free">d</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..</span><span class="var">?d</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>Suc <span class="var">?d</span> <span class="main">..</span> <span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ydeg<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="var">?f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="var">?f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">{..</span><span class="var">?d</span><span class="main">}</span> <span class="main">+</span> sum <span class="main">(</span><span class="var">?f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">{</span>Suc <span class="var">?d</span> <span class="main">..</span> <span class="free">d</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span> Suc <span class="var">?d</span> <span class="main">..</span> <span class="free">d</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> coeff_eq_0<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="var">?f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">{</span>Suc <span class="var">?d</span> <span class="main">..</span> <span class="free">d</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="var">?f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">{..</span><span class="var">?d</span><span class="main">}</span> <span class="main">=</span> sum <span class="main">(</span><span class="var">?f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">{..</span><span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_y_x_fixed_deg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add poly poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≡</span> Max <span class="main">{</span> degree <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> degree <span class="free">p</span> <span class="main">}</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> <span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="free">d</span><span class="main">.</span> monom <span class="main">(</span>monom <span class="main">(</span>coeff <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> poly_y_x_fix_y_deg<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> d_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Max_ge<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_y_x_swapped<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add poly poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≡</span> Max <span class="main">{</span> degree <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> degree <span class="free">p</span> <span class="main">}</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="free">d</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> monom <span class="main">(</span>monom <span class="main">(</span>coeff <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> poly_y_x_fixed_deg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">,</span> <span class="operator">folded</span> d_def<span class="main">]</span> sum.swap <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> poly2_poly_y_x<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly2 <span class="main">(</span>poly_y_x <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> poly2 <span class="free">p</span> <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">unfold_abs_def</span> <span class="main"><span class="main">=</span></span> <span class="quasi_keyword">false</span><span class="main">]</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> poly_as_sum_of_monoms<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> poly_as_sum_of_monoms<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"coeff <span class="free"><span class="free">p</span></span> <span class="main"><span class="main">_</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_y_x_def
  <span class="keyword1"><span class="command">unfolding</span></span> coeff_sum monom_sum
  <span class="keyword1"><span class="command">unfolding</span></span> poly2_hom.hom_sum
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly2_monom poly_monom
  <span class="keyword1"><span class="command">unfolding</span></span> mult.assoc
  <span class="keyword1"><span class="command">unfolding</span></span> mult.commute<span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> poly_monom_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>monom <span class="free">p</span> <span class="free">i</span> <span class="main">*</span> <span class="free">q</span> <span class="main">^</span> <span class="free">j</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> poly <span class="main">(</span>monom <span class="free">p</span> <span class="free">j</span> <span class="main">*</span> <span class="main">[:</span><span class="free">y</span><span class="main">:]</span> <span class="main">^</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>poly <span class="free">q</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_hom.hom_mult
  <span class="keyword1"><span class="command">unfolding</span></span> poly_monom
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_poly_y_x<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>poly <span class="main">(</span>poly_y_x <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> poly <span class="main">(</span>poly <span class="free">p</span> <span class="main">[:</span><span class="free">y</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span>poly <span class="free">q</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> poly_as_sum_of_monoms<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> poly_as_sum_of_monoms<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"coeff <span class="free"><span class="free">p</span></span> <span class="main"><span class="main">_</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_y_x_def
  <span class="keyword1"><span class="command">unfolding</span></span> coeff_sum monom_sum
  <span class="keyword1"><span class="command">unfolding</span></span> poly_hom.hom_sum
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> atMost_iff
  <span class="keyword1"><span class="command">unfolding</span></span> poly2_monom poly_monom
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> poly_monom_mult<span class="main">)</span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_y_x_hom<span class="main">:</span> zero_hom <span class="quoted">poly_y_x</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_y_x_def<span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> poly_y_x_hom<span class="main">:</span> one_hom <span class="quoted">poly_y_x</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_y_x_def monom_0<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> map_poly_sum_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="free">h</span> <span class="main">(</span><span class="bound">p</span> <span class="main">+</span> <span class="bound">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="bound">p</span> <span class="main">+</span> <span class="free">h</span> <span class="bound">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> map_poly <span class="free">h</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span> <span class="main">=</span> map_poly <span class="free">h</span> <span class="main">(</span>sum <span class="free">f</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> map_poly_add<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_y_x_const<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">[:</span><span class="free">p</span><span class="main">:]</span> <span class="main">=</span> poly_lift <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> monom <span class="main">[:</span>coeff <span class="free">p</span> <span class="bound">j</span><span class="main">:]</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_y_x_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_0<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> poly_lift <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> monom <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_lift_hom.hom_sum <span class="keyword1"><span class="command">unfolding</span></span> poly_lift_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> poly_lift <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_as_sum_of_monoms<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_y_x_pCons<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> poly_lift <span class="free">a</span> <span class="main">+</span> map_poly <span class="main">(</span>pCons <span class="main">0</span><span class="main">)</span> <span class="main">(</span>poly_y_x <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> ml<span class="main">:</span> map_poly_comm_monoid_add_hom <span class="quoted"><span class="quoted">"coeff_lift"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> mc<span class="main">:</span> map_poly_comm_monoid_add_hom <span class="quoted"><span class="quoted">"pCons <span class="main">0</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> mm<span class="main">:</span> map_poly_comm_monoid_add_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monom <span class="bound">x</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="comment1">(* I know this is a worst kind of a proof... *)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> poly_y_x_fixed_deg<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> degree_pCons_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> atLeast0AtMost<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> atLeastAtMost_insertL<span class="main"><span class="main">[</span></span><span class="operator">OF</span> le0<span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> coeff_pCons_0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> monom_0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fold</span> coeff_lift_hom.map_poly_hom_monom poly_lift_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fold</span> poly_lift_hom.hom_sum<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> poly_as_sum_of_monoms'<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Max_ge<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">force</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> poly_lift <span class="free"><span class="free">a</span></span> <span class="main"><span class="main">+</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> image_Suc_atLeastAtMost <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> atLeast0AtMost<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> o_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> coeff_pCons_Suc<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> monom_Suc<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poly_y_x_fix_y_deg<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Max <span class="main"><span class="main">{</span></span>degree <span class="main"><span class="main">(</span></span>coeff <span class="main"><span class="main">(</span></span>pCons <span class="free"><span class="free">a</span></span> <span class="free"><span class="free">p</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">|</span></span> <span class="bound"><span class="bound">i</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">i</span></span> <span class="main"><span class="main">≤</span></span> Suc <span class="main"><span class="main">(</span></span>degree <span class="free"><span class="free">p</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Max.coboundedI<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">_</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True poly_y_x_const<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_y_x_pCons_0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span>pCons <span class="main">0</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="main">(</span>pCons <span class="main">0</span><span class="main">)</span> <span class="main">(</span>poly_y_x <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">interpret</span></span> mc<span class="main">:</span> map_poly_comm_monoid_add_hom <span class="quoted"><span class="quoted">"pCons <span class="main">0</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> mm<span class="main">:</span> map_poly_comm_monoid_add_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monom <span class="bound">x</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> poly_y_x_def degree_pCons_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> sum.atMost_Suc_shift<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span> monom_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_y_x_map_poly_pCons_0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span>map_poly <span class="main">(</span>pCons <span class="main">0</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> pCons <span class="main">0</span> <span class="main">(</span>poly_y_x <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> monom <span class="main">(</span>monom <span class="main">(</span>coeff <span class="main">(</span>pCons <span class="main">0</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> pCons <span class="main">0</span> <span class="main">(</span>monom <span class="main">(</span>monom <span class="main">(</span>coeff <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="var">?l</span> <span class="skolem">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span>degree <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">i</span><span class="main">)</span><span class="main">.</span> <span class="var">?r</span> <span class="skolem">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> degree_pCons_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> sum.atMost_Suc_shift<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> monom_Suc<span class="main">)</span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> poly_y_x_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span> pCons_0_hom.degree_map_poly_hom pCons_0_hom.coeff_map_poly_hom<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> *<span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_y_x_hom<span class="main">:</span> comm_monoid_add_hom <span class="quoted"><span class="quoted">"poly_y_x <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add poly poly <span class="main">⇒</span> <span class="main">_</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly poly"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> poly_y_x <span class="skolem">p</span> <span class="main">+</span> poly_y_x <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">q</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> p<span class="main">:</span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> q<span class="main">:</span> <span class="main">(</span>pCons <span class="skolem">b</span> <span class="skolem">q</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> add_pCons<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> poly_y_x_pCons<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> p<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_y_x_const <span class="dynamic"><span class="dynamic">ac_simps</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> poly_y_x<span class="antiquote"><span class="antiquote">}</span></span></span></span> is bijective.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> poly_y_x_poly_lift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span>poly_lift <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="free">p</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> poly_y_x_fix_y_deg<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> poly_as_sum_of_monoms<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_sum monom_0 <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_y_x_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add poly poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span>poly_y_x <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> mm<span class="main">:</span> map_poly_comm_monoid_add_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monom <span class="bound">x</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> mc<span class="main">:</span> map_poly_comm_monoid_add_hom <span class="quoted"><span class="quoted">"pCons <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> pCons_as_add<span class="main">:</span> <span class="quoted"><span class="quoted">"pCons <span class="skolem">a</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span> <span class="main">+</span> pCons <span class="main">0</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> pCons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> pCons_as_add<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_y_x_pCons poly_y_x_poly_lift poly_y_x_map_poly_pCons_0 <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_y_x_hom<span class="main">:</span>
  bijective <span class="quoted"><span class="quoted">"poly_y_x <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add poly poly <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold</span> bijective_eq_bij<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>o_bij<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">poly_y_x</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inv_poly_y_x<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Hilbert_Choice.inv poly_y_x <span class="main">=</span> poly_y_x"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_y_x_hom<span class="main">:</span> comm_monoid_add_isom <span class="quoted">poly_y_x</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pCons_as_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pCons <span class="free">a</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="main">+</span> monom <span class="main">1</span> <span class="main">1</span> <span class="main">*</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monom_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_pCons_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span> <span class="main">(</span>pCons <span class="main">0</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> pCons <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> pCons_0_as_mult<span class="main">:</span><span class="comment1">(*TODO: Move *)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pCons <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1<span class="main">)</span>  <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> pCons <span class="main">0</span> <span class="main">1</span> <span class="main">*</span> <span class="bound">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> map_poly_pCons_0_as_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="main">(</span>pCons <span class="main">0</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[:</span>pCons <span class="main">0</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> pCons_0_as_mult<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> smult_as_map_poly<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_y_x_monom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span>monom <span class="free">a</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>monom <span class="main">1</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>poly_lift <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">interpret</span></span> map_poly_comm_monoid_add_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> poly_y_x_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> degree_monom_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lessThan_Suc_atMost<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> sum.lessThan_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum.neutral<span class="main"><span class="keyword3">,</span></span><span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> poly_as_sum_of_monoms<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> smult_as_map_poly<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monom_altdef<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> x_as_monom x_pow_n<span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_y_x_smult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> poly_lift <span class="free">c</span> <span class="main">*</span> poly_y_x <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="free">c</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> monom <span class="main">(</span>coeff <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> degree_smult_le poly_as_sum_of_monoms' sum.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> monom <span class="main">(</span><span class="free">c</span> <span class="main">*</span> coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">...</span> <span class="main">=</span> poly_lift <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> smult <span class="main">(</span>monom <span class="main">1</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>poly_lift <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_y_x_monom <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> poly_lift <span class="free">c</span> <span class="main">*</span> poly_y_x <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> monom <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_y_x_monom <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_as_sum_of_monoms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_y_x_hom<span class="main">:</span>
  comm_semiring_isom <span class="quoted"><span class="quoted">"poly_y_x <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly poly <span class="main">⇒</span> <span class="main">_</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly poly"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> poly_y_x <span class="skolem">p</span> <span class="main">*</span> poly_y_x <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> mult_pCons_left<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> poly_y_x_smult<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> poly_y_x_pCons_0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> pCons<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_y_x_pCons map_poly_pCons_0_as_mult <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_y_x_hom<span class="main">:</span> comm_ring_isom <span class="quoted"><span class="quoted">"poly_y_x"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> poly_y_x_hom<span class="main">:</span> idom_isom <span class="quoted"><span class="quoted">"poly_y_x"</span></span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Max_degree_coeff_pCons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Max <span class="main">{</span> degree <span class="main">(</span>coeff <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> degree <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
   max <span class="main">(</span>degree <span class="free">a</span><span class="main">)</span> <span class="main">(</span>Max <span class="main">{</span>degree <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> degree <span class="free">p</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> degree_pCons_eq<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> image_Collect<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> atMost_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> atLeast0AtMost<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> atLeastAtMost_insertL<span class="main">[</span><span class="operator">OF</span> le0<span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> image_insert
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Max_insert<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> image_Suc_atLeastAtMost <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> image_image
    <span class="keyword1"><span class="command">unfolding</span></span> atLeast0AtMost <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">lemma</span></span> degree_poly_y_x<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_y_x <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Max <span class="main">{</span> degree <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> degree <span class="free">p</span> <span class="main">}</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?d</span> <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> rhm<span class="main">:</span> map_poly_comm_ring_hom <span class="quoted">coeff_lift</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> monom <span class="main">(</span>monom <span class="main">(</span>coeff <span class="main">(</span>coeff <span class="bound">p</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">j</span>"</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> poly_y_x_pCons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> pCons<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poly_lift <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly <span class="main">(</span>pCons <span class="main">0</span><span class="main">)</span> <span class="main">(</span>poly_y_x <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>linorder_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"degree <span class="var"><span class="var">?a</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"degree <span class="var"><span class="var">?p</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> less
            <span class="keyword1"><span class="command">have</span></span> dle<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">a</span> <span class="main">≤</span> degree <span class="main">(</span>poly_y_x <span class="skolem">p</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> less<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> degree_map_poly_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> poly_y_x_pCons
              <span class="keyword1"><span class="command">unfolding</span></span> degree_add_eq_right<span class="main">[</span><span class="operator">OF</span> less<span class="main">]</span>
              <span class="keyword1"><span class="command">unfolding</span></span> Max_degree_coeff_pCons
              <span class="keyword1"><span class="command">unfolding</span></span> IH<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
              <span class="keyword1"><span class="command">unfolding</span></span> max_absorb2<span class="main">[</span><span class="operator">OF</span> dle<span class="main">]</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> degree_map_poly<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> equal
            <span class="keyword1"><span class="command">have</span></span> dega<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="var">?a</span> <span class="main">=</span> degree <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> degp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_y_x <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="skolem">a</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> equal<span class="main">[</span><span class="operator">unfolded</span> dega<span class="main">]</span>
              <span class="keyword1"><span class="command">using</span></span> degree_map_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pCons <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="skolem">p</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="var">?a</span> <span class="main">+</span> <span class="var">?p</span><span class="main">)</span> <span class="main">=</span> degree <span class="skolem">a</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> equal <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> degree_add_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> equal<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> le_degree<span class="main">)</span>
                <span class="keyword1"><span class="command">unfolding</span></span> coeff_add
                <span class="keyword1"><span class="command">using</span></span> False
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_y_x_pCons
              <span class="keyword1"><span class="command">unfolding</span></span> *
              <span class="keyword1"><span class="command">unfolding</span></span> Max_degree_coeff_pCons
              <span class="keyword1"><span class="command">unfolding</span></span> IH<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
              <span class="keyword1"><span class="command">unfolding</span></span> degp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> greater
            <span class="keyword1"><span class="command">have</span></span> dge<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">a</span> <span class="main">≥</span> degree <span class="main">(</span>poly_y_x <span class="skolem">p</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> greater<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> poly_y_x_pCons
              <span class="keyword1"><span class="command">unfolding</span></span> degree_add_eq_left<span class="main">[</span><span class="operator">OF</span> greater<span class="main">]</span>
              <span class="keyword1"><span class="command">unfolding</span></span> Max_degree_coeff_pCons
              <span class="keyword1"><span class="command">unfolding</span></span> IH<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
              <span class="keyword1"><span class="command">unfolding</span></span> max_absorb1<span class="main">[</span><span class="operator">OF</span> dge<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Resultant">
<div class="head">
<h1>Theory Resultant</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Resultant›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory contains 
  facts about resultants which are required for addition and multiplication
  of algebraic numbers.

  The results are taken from the textbook \cite[pages 227ff and 235ff]{AlgNumbers}.
›</span></span> 

<span class="keyword1"><span class="command">theory</span></span> Resultant
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Fundamental_Theorem_Algebra.html">HOL-Computational_Algebra.Fundamental_Theorem_Algebra</a>"</span> <span class="comment1">(* for lmpoly_base_conv *)</span>
  <a href="../Subresultants/Resultant_Prelim.html">Subresultants.Resultant_Prelim</a>
  <a href="../Berlekamp_Zassenhaus/Unique_Factorization_Poly.html">Berlekamp_Zassenhaus.Unique_Factorization_Poly</a>
  <a href="Bivariate_Polynomials.html">Bivariate_Polynomials</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sylvester matrices and vector representation of polynomials›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vec_of_poly_rev_shifted</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vec_of_poly_rev_shifted</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≡</span>
   vec <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≤</span> degree <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> <span class="bound">i</span> <span class="keyword1">then</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> <span class="bound">i</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vec_of_poly_rev_shifted_dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>vec_of_poly_rev_shifted <span class="free">p</span> <span class="free">n</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> vec_of_poly_rev_shifted_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> col_sylvester<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span>
    vec_of_poly_rev_shifted <span class="free">p</span> <span class="free">n</span> <span class="free">j</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_of_poly_rev_shifted <span class="free">q</span> <span class="free">m</span> <span class="free">j</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> m_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> n_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="var">?l</span> <span class="main">=</span> dim_vec <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_of_poly_rev_shifted_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> index_col<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sylvester_index_mat<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inj_on_diff_nat2<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">{..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> image_diff_atMost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_eq_iff
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?r</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> image_def mem_Collect_eq
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">n</span></span></span><span class="main"><span class="main"><span class="main">-</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sylvester_sum_mat_upper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">.</span> monom <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    monom <span class="main">1</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">_</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ni1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ni1</span> <span class="main">=</span> <span class="free">n</span><span class="main">-</span>Suc <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> ni1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">-</span><span class="free">i</span> <span class="main">=</span> Suc <span class="skolem">ni1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">l</span> <span class="main">=</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> monom <span class="main">(</span>coeff <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="bound">j</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">l</span><span class="main">-</span><span class="bound">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{..</span><span class="skolem">l</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> l<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> lessThan_Suc_atMost<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span><span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> monom <span class="main">(</span>coeff <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∘</span> <span class="var">?p</span><span class="main">)</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> sylvester_index_mat2<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> i j <span class="keyword1"><span class="command">unfolding</span></span> l_def m_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> n_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_diff_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?g</span> <span class="main">∘</span> <span class="var">?p</span><span class="main">)</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ni1
      <span class="keyword1"><span class="command">unfolding</span></span> coeff_monom_Suc
      <span class="keyword1"><span class="command">unfolding</span></span> ni1_def
      <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="var">?g</span> <span class="main">∘</span> <span class="var">?p</span><span class="main">)</span> <span class="skolem">j</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">l</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">l</span><span class="main">.</span> <span class="main">(</span><span class="var">?g</span><span class="main">∘</span><span class="var">?p</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">l</span><span class="main">.</span> <span class="var">?g</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> l_def
    <span class="keyword1"><span class="command">using</span></span> sum.reindex<span class="main">[</span><span class="operator">OF</span> inj_on_diff_nat2<span class="main">,</span><span class="operator">symmetric</span><span class="main">,</span><span class="operator">unfolded</span> image_diff_atMost<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="var">?r</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> degree_mult_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"monom <span class="main">1</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> l_def m_def
      <span class="keyword1"><span class="command">unfolding</span></span> degree_monom_eq<span class="main">[</span><span class="operator">OF</span> one_neq_zero<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> poly_as_sum_of_monoms'<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">l</span><span class="main">.</span> <span class="var">?g</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sylvester_sum_mat_lower<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ni<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> imn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">.</span> monom <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    monom <span class="main">1</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">_</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">l</span> <span class="main">=</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> imn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">mni1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mni1</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> mni1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span><span class="free">i</span> <span class="main">=</span> Suc <span class="skolem">mni1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> imn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> monom <span class="main">(</span>coeff <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="bound">j</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">l</span><span class="main">-</span><span class="bound">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{..</span><span class="skolem">l</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> l<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> lessThan_Suc_atMost<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span><span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> monom <span class="main">(</span>coeff <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span><span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∘</span> <span class="var">?p</span><span class="main">)</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> sylvester_index_mat2<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> ni imn j <span class="keyword1"><span class="command">unfolding</span></span> l_def m_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> n_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_diff_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?g</span> <span class="main">∘</span> <span class="var">?p</span><span class="main">)</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mni1
      <span class="keyword1"><span class="command">unfolding</span></span> coeff_monom_Suc
      <span class="keyword1"><span class="command">unfolding</span></span> mni1_def<span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">...</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">l</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">l</span><span class="main">.</span> <span class="main">(</span><span class="var">?g</span><span class="main">∘</span><span class="var">?p</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">l</span><span class="main">.</span> <span class="var">?g</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum.reindex<span class="main">[</span><span class="operator">OF</span> inj_on_diff_nat2<span class="main">,</span><span class="operator">symmetric</span><span class="main">,</span><span class="operator">unfolded</span> image_diff_atMost<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="var">?r</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> degree_mult_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"monom <span class="main">1</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> l_def n_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> degree_monom_eq<span class="main">[</span><span class="operator">OF</span> one_neq_zero<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> ni imn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> poly_as_sum_of_monoms'<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">l</span><span class="main">.</span> <span class="var">?g</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">vec_of_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="bound">m</span> <span class="main">=</span> degree <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">in</span> vec <span class="main">(</span>Suc <span class="bound">m</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="bound">m</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly_of_vec</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="bound">d</span> <span class="main">=</span> dim_vec <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">in</span> <span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="bound">d</span><span class="main">.</span> monom <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">$</span> <span class="main">(</span><span class="bound">d</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_vec_of_poly<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_of_vec <span class="main">(</span>vec_of_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_of_vec_def vec_of_poly_def Let_def
  <span class="keyword1"><span class="command">unfolding</span></span> dim_vec
  <span class="keyword1"><span class="command">unfolding</span></span> lessThan_Suc_atMost
  <span class="keyword1"><span class="command">using</span></span> poly_as_sum_of_monoms<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_vec_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_vec <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_of_vec_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_vec_0_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add vec"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_of_vec <span class="free">v</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">v</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_vec <span class="free">v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">=</span> <span class="main">_</span> <span class="main">⟷</span> <span class="main">_</span> <span class="main">=</span> <span class="var">?z</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span>dim_vec <span class="free">v</span><span class="main">}</span><span class="main">.</span> <span class="free">v</span> <span class="main">$</span> <span class="main">(</span>dim_vec <span class="free">v</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_of_vec_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_monom_0_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">$</span> <span class="main">(</span>dim_vec <span class="free">v</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">v</span> <span class="main">-</span> Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="var">?z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="var">?z</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> r<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* TODO: move, copied from no longer existing Cayley-Hamilton/Polynomial_extension *)</span>
<span class="keyword1"><span class="command">lemma</span></span> degree_sum_smaller<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> degree <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> degree <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_add_less assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> degree_poly_of_vec_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_monoid_add vec"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">v</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_of_vec <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_of_vec_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> degree_sum_smaller<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> dim <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">unfolding</span></span> lessThan_iff
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_0 degree_monom_eq dim monom_eq_0_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> coeff_poly_of_vec<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>poly_of_vec <span class="free">v</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$</span> <span class="main">(</span>dim_vec <span class="free">v</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">&lt;</span>dim_vec <span class="free">v</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$</span> <span class="main">(</span>dim_vec <span class="free">v</span> <span class="main">-</span> Suc <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?m</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_of_vec_def Let_def coeff_sum coeff_monom <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_vec <span class="free">v</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> False<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.remove<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">i</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> True<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> True<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vec_of_poly_rev_shifted_scalar_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">v</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≡</span> poly_of_vec <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">v</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec_of_poly_rev_shifted <span class="free">p</span> <span class="free">n</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="free">m</span><span class="main">-</span>Suc <span class="free">j</span><span class="main">)</span> <span class="main">∙</span> <span class="free">v</span> <span class="main">=</span> coeff <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">j</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> id1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="main">+</span> <span class="bound">i</span> <span class="main">-</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">+</span> Suc <span class="free">j</span> <span class="main">-</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="free">j</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="free">j</span> <span class="main">≤</span> <span class="bound">i</span> <span class="keyword1">then</span> coeff <span class="free">p</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> Suc <span class="free">j</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span>  <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="var">?g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span>          
        <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">j</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">j</span> <span class="main">-</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">v</span> <span class="main">$</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">(</span><span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> vec_of_poly_rev_shifted_def coeff_mult m scalar_prod_def n q_def
      coeff_poly_of_vec 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> id1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">j</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">j</span> <span class="main">-</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{..</span><span class="free">j</span><span class="main">}</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">-</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">j</span> <span class="main">-</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="main">_</span> <span class="main">(</span><span class="var">?R1</span> <span class="main">∪</span> <span class="var">?R2</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="var">?R1</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="var">?R2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="var">?R2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="var">?R1</span> <span class="main">+</span> <span class="main">0</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="var">?R1</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="var">?F</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="var">?F</span> <span class="main">(</span><span class="main">(</span><span class="var">?R1</span> <span class="main">∩</span> <span class="main">{..</span><span class="free">m</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="var">?R1</span> <span class="main">-</span> <span class="main">{..</span><span class="free">m</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="main">_</span> <span class="main">(</span><span class="var">?R</span> <span class="main">∪</span> <span class="var">?R'</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="var">?F</span> <span class="var">?R</span> <span class="main">+</span> sum <span class="var">?F</span> <span class="var">?R'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?F</span> <span class="var">?R'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span> 
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="free">m</span>"</span></span> 
        <span class="keyword1"><span class="command">from</span></span> coeff_eq_0<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">[</span></span><span class="operator">folded</span> m<span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> sum <span class="var">?F</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> sum <span class="var">?g</span> <span class="main">(</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="free">j</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="free">j</span> <span class="main">≤</span> <span class="bound">i</span><span class="main">}</span> 
      <span class="main">∪</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="free">j</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="free">j</span> <span class="main">≤</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="main">_</span> <span class="main">(</span><span class="var">?L1</span> <span class="main">∪</span> <span class="var">?L2</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="var">?g</span> <span class="var">?L1</span> <span class="main">+</span> sum <span class="var">?g</span> <span class="var">?L2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g</span> <span class="var">?L2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g</span> <span class="var">?L1</span> <span class="main">+</span> <span class="main">0</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> coeff <span class="free">p</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> Suc <span class="free">j</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">v</span> <span class="main">$</span> <span class="bound">i</span><span class="main">)</span> <span class="var">?L1</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="var">?G</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="var">?G</span> <span class="main">(</span><span class="var">?L1</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">+</span> Suc <span class="free">j</span> <span class="main">-</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">m</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="var">?L1</span> <span class="main">-</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">+</span> Suc <span class="free">j</span> <span class="main">-</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">m</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="main">_</span> <span class="main">(</span><span class="var">?L</span> <span class="main">∪</span> <span class="var">?L'</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="var">?G</span> <span class="var">?L</span> <span class="main">+</span> sum <span class="var">?G</span> <span class="var">?L'</span>"</span></span>      
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?G</span> <span class="var">?L'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> Suc <span class="free">j</span> <span class="main">-</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="free">m</span>"</span></span> 
        <span class="keyword1"><span class="command">from</span></span> coeff_eq_0<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">[</span></span><span class="operator">folded</span> m<span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.neutral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> sum <span class="var">?G</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bij</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="main">-</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> Suc <span class="free">j</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> 
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> Suc <span class="free">j</span> <span class="main">-</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> Suc <span class="free">j</span> <span class="main">≥</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="var">?bij</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?bij</span> <span class="main">`</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xy <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> tedious <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> l r
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?bij</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> j<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def tedious<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sylvester_vec_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_0 poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> degree <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_of_vec <span class="main">(</span>transpose_mat <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span>
    poly_of_vec <span class="main">(</span>vec_first <span class="free">v</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> poly_of_vec <span class="main">(</span>vec_last <span class="free">v</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">note</span></span> mn<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> m_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> n_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Tv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"transpose_mat <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>vec_first <span class="free">v</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>vec_last <span class="free">v</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"dim_vec <span class="var">?Tv</span> <span class="main">=</span> <span class="free">n</span> <span class="main">+</span> <span class="free">m</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> if_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="keyword1">then</span> <span class="bound">y</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="keyword1">then</span> <span class="bound">y</span> <span class="main">*</span> <span class="bound">z</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="var">?l</span> <span class="skolem">i</span> <span class="main">=</span> coeff <span class="var">?r</span> <span class="skolem">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> i_mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> i_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> i_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="var">?r</span> <span class="skolem">i</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∑</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> vec_first <span class="free">v</span> <span class="free">n</span> <span class="main">$</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> coeff <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
            <span class="main">(</span><span class="main">∑</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">.</span> vec_last <span class="free">v</span> <span class="free">m</span> <span class="main">$</span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span> Suc <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> coeff <span class="free">q</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">_</span> <span class="main">+</span> sum <span class="var">?g</span> <span class="main">_</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> coeff_add coeff_mult Let_def 
        <span class="keyword1"><span class="command">unfolding</span></span> coeff_poly_of_vec dim if_distrib
        <span class="keyword1"><span class="command">unfolding</span></span> atMost_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> sum.inter_filter<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> sum.inter_filter<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> mem_Collect_eq
        <span class="keyword1"><span class="command">unfolding</span></span> i_n i_m
        <span class="keyword1"><span class="command">unfolding</span></span> lessThan_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> coeff_eq_0<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> i_mn x <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">q</span> <span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> coeff_eq_0<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> i_mn x <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?g</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="var">?r</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> coeff <span class="var">?l</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> coeff_poly_of_vec dim sum.distrib<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="var">?l</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>transpose_mat <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">v</span><span class="main">)</span> <span class="main">$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> coeff_poly_of_vec dim sum.distrib<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> coeff <span class="main">(</span><span class="free">p</span> <span class="main">*</span> poly_of_vec <span class="main">(</span>vec_first <span class="free">v</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> poly_of_vec <span class="main">(</span>vec_last <span class="free">v</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> index_mult_mat_vec<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> row_transpose<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> col_sylvester<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> mn <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> vec_first_last_append<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> scalar_prod_append<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> carrier_vecI<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> vec_of_poly_rev_shifted_scalar_prod<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> vec_of_poly_rev_shifted_scalar_prod<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span><span class="skolem">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> vec_first <span class="free">v</span> <span class="free">n</span> <span class="main">$</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> coeff <span class="free">p</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
        <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span><span class="skolem">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="keyword1">then</span> vec_last <span class="free">v</span> <span class="free">m</span> <span class="main">$</span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span> Suc <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> coeff <span class="free">q</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> coeff_poly_of_vec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vec_first <span class="free">v</span> <span class="free">n</span>"</span></span><span class="main">,</span><span class="operator">unfolded</span> dim_vec_first<span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> coeff_poly_of_vec<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vec_last <span class="free">v</span> <span class="free">m</span>"</span></span><span class="main">,</span><span class="operator">unfolded</span> dim_vec_last<span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> coeff_mult<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> coeff <span class="var">?r</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> coeff_add coeff_mult Let_def
        <span class="keyword1"><span class="command">unfolding</span></span> coeff_poly_of_vec dim<span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Homomorphism and Resultant›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here we prove Lemma~7.3.1 of the textbook.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span><span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_ring_hom<span class="main">)</span> resultant_sub_map_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span>resultant_sub <span class="free">m</span> <span class="free">n</span> <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> resultant_sub <span class="free">m</span> <span class="free">n</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r'</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mh</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> det <span class="main">(</span>sylvester_mat_sub <span class="free">m</span> <span class="free">n</span> <span class="main">(</span><span class="var">?mh</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="var">?mh</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> resultant_sub_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> sylvester_mat_sub_map<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> resultant_sub_def<span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*
lemma (in comm_ring_hom) resultant_map_poly:
  fixes p q :: "'a poly"
    defines "p' ≡ map_poly hom p"
    defines "q' ≡ map_poly hom q"
    defines "m ≡ degree p"
    defines "n ≡ degree q"
    defines "m' ≡ degree p'"
    defines "n' ≡ degree q'"
    defines "r ≡ resultant p q"
    defines "r' ≡ resultant p' q'"
  shows "m' = m ⟹ n' = n ⟹ hom r = r'"
    and "m' = m ⟹ hom r = hom (coeff p m')^(n-n') * r'"
    and "m' ≠ m ⟹ n' = n ⟹
      hom r = (if even n then 1 else (-1)^(m-m')) * hom (coeff q n)^(m-m') * r'"
      (is "_ ⟹ _ ⟹ ?goal")
    and "m' ≠ m ⟹ n' ≠ n ⟹ hom r = 0"
proof -
  have m'm: "m' ≤ m" unfolding m_def m'_def p'_def using degree_map_poly_le by auto
  have n'n: "n' ≤ n" unfolding n_def n'_def q'_def using degree_map_poly_le by auto

  have coeffp'[simp]: "⋀i. coeff p' i = hom (coeff p i)" unfolding p'_def by auto
  have coeffq'[simp]: "⋀i. coeff q' i = hom (coeff q i)" unfolding q'_def by auto

  let ?f = "λi. (if even n then 1 else (-1)^i) * hom (coeff q n)^i"

  have "hom r = resultant_sub m n p' q'"
    unfolding r_def resultant_sub
    unfolding m_def n_def p'_def q'_def
    by(rule resultant_sub_map_poly)
  also have "... = ?f (m-m') * resultant_sub m' n p' q'"
    using resultant_sub_trim_upper[of p' "m-m'" n q',folded m'_def] m'm
    by (auto simp: power_minus[symmetric])
  also have "... = ?f (m-m') * hom (coeff p m')^(n-n') * r'"
    using resultant_sub_trim_lower[of m' q' "n-n'" p'] n'n
    unfolding r'_def resultant_sub m'_def n'_def by auto
  finally have main: "hom r = ?f (m-m') * hom (coeff p m')^(n-n') * r'" by auto

  { assume "m' = m"
    thus "hom r = hom (coeff p m')^(n-n') * r'" using main by auto
    thus "n' = n ⟹ hom r = r'" by auto
  }
  assume "m' ≠ m"
  hence m'm: "m' &lt; m" using m'm by auto
  thus "n' = n ⟹ ?goal" using main by simp
  assume "n' ≠ n"
  hence "n' &lt; n" using n'n by auto
  hence "hom (coeff q n) = 0"
    unfolding coeffq'[symmetric] unfolding n'_def by(rule coeff_eq_0)
  hence "hom (coeff q n) ^ (m-m') = 0" using m'm by (simp add: power_0_left)
  from main[unfolded this]
  show "hom r = 0" using power_0_Suc by auto
qed
*)</span>
  
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Resultant as Polynomial Expression›</span></span>
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This context provides notions for proving Lemma 7.2.1 of the textbook.›</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">mk_poly_sub</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_poly_sub</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">mk_poly_sub</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> mat_addcol <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">-</span>Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">mk_poly_sub</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="quoted"><span class="quoted">"<span class="free">mk_poly</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> mk_poly_sub <span class="main">(</span>map_mat coeff_lift <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly_sub_dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>mk_poly_sub <span class="free">A</span> <span class="free">l</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>mk_poly_sub <span class="free">A</span> <span class="free">l</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">j</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly_sub_carrier<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">nc</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_poly_sub <span class="free">A</span> <span class="free">l</span> <span class="free">j</span> <span class="main">∈</span> carrier_mat <span class="free">nr</span> <span class="free">nc</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> carrier_matI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly_dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"dim_col <span class="main">(</span>mk_poly <span class="free">A</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
  <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>mk_poly <span class="free">A</span><span class="main">)</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mk_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly_sub_others<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="free">j'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j'</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_poly_sub <span class="free">A</span> <span class="free">l</span> <span class="free">j</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j'</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">j</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly_others<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="free">A</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_poly <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span> <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mk_poly_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mk_poly_sub_others<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> i j <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly_delete<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_delete <span class="main">(</span>mk_poly <span class="free">A</span><span class="main">)</span> <span class="free">i</span> <span class="main">(</span>dim_col <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> map_mat coeff_lift <span class="main">(</span>mat_delete <span class="free">A</span> <span class="free">i</span> <span class="main">(</span>dim_col <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> eq_matI<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> mat_delete_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> col_mk_poly_sub<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="free">j'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j'</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="main">(</span>mk_poly_sub <span class="free">A</span> <span class="free">l</span> <span class="free">j</span><span class="main">)</span> <span class="free">j'</span> <span class="main">=</span> col <span class="free">A</span> <span class="free">j'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> eq_vecI<span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> det_mk_poly_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly mat<span class="main">)</span> <span class="main">∈</span> carrier_mat <span class="free">n</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>mk_poly_sub <span class="free">A</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> det <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> i
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mk_poly_sub.simps
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> det_addcol<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mk_poly_sub_carrier<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> det_mk_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 mat"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>mk_poly <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span> det <span class="free">A</span> <span class="main">:]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> dim_col <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_mat coeff_lift <span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="main">(</span>dim_row <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> sq<span class="main">:</span> <span class="quoted"><span class="quoted">"map_mat coeff_lift <span class="free">A</span> <span class="main">∈</span> carrier_mat <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> True<span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_poly_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> det_mk_poly_sub<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sq<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> dim_col <span class="free">A</span> <span class="main">⟷</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="main">(</span>mk_poly <span class="free">A</span><span class="main">)</span> <span class="main">=</span> dim_col <span class="main">(</span>mk_poly <span class="free">A</span><span class="main">)</span> <span class="main">⟷</span> False"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mk_poly_dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> det_def <span class="keyword1"><span class="command">unfolding</span></span> f2 f3 if_False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">mk_poly2_row</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_poly2_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">pv</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">pv</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">mk_poly2_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">pv</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span>
   <span class="free">mk_poly2_row</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">pv</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">|<span class="hidden">⇩</span><sub>v</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">↦</span> <span class="free"><span class="bound"><span class="entity">pv</span></span></span> <span class="main">$</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> monom <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">$$</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">mk_poly2_col</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_poly2_col</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">pv</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">pv</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">mk_poly2_col</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">pv</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span>
   mk_poly2_row <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> Suc <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">mk_poly2_col</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">pv</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mk_poly2</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> mk_poly2_col <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>dim_row <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly2_row_dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>mk_poly2_row <span class="free">A</span> <span class="free">d</span> <span class="free">j</span> <span class="free">pv</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="free">pv</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">pv</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly2_col_dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="main">(</span>mk_poly2_col <span class="free">A</span> <span class="free">pv</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> dim_vec <span class="free">pv</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">j</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">pv</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly2_row<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> dim_vec <span class="free">pv</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_poly2_row <span class="free">A</span> <span class="free">d</span> <span class="free">j</span> <span class="free">pv</span> <span class="free">n</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">pv</span> <span class="main">$</span> <span class="free">i</span> <span class="main">+</span> monom <span class="main">(</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="free">d</span> <span class="keyword1">else</span> <span class="free">pv</span> <span class="main">$</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">pv</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mk_poly2_row.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">i</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly2_row_col<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dim<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">pv</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_poly2_row <span class="free">A</span> <span class="free">d</span> <span class="free">j</span> <span class="free">pv</span> <span class="free">n</span> <span class="main">=</span> <span class="free">pv</span> <span class="main">+</span> map_vec <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> monom <span class="bound">a</span> <span class="free">d</span><span class="main">)</span> <span class="main">(</span>col <span class="free">A</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span> <span class="keyword1"><span class="command">using</span></span> mk_poly2_row<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">pv</span></span><span class="main">]</span> j <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly2_col<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">pv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly vec"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">=</span> dim_vec <span class="free">pv</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_poly2_col <span class="free">A</span> <span class="free">pv</span> <span class="free">j</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="free">pv</span> <span class="main">$</span> <span class="free">i</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j'</span><span class="main">&lt;</span><span class="free">j</span><span class="main">.</span> monom <span class="main">(</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> dim_col <span class="free">A</span> <span class="main">-</span> Suc <span class="bound">j'</span><span class="main">)</span><span class="main">)</span> <span class="bound">j'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dim
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">j</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">pv</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mk_poly2_col.simps
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mk_poly2_row<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Suc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly2_pre<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_poly2 <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j'</span><span class="main">&lt;</span>dim_col <span class="free">A</span><span class="main">.</span> monom <span class="main">(</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> dim_col <span class="free">A</span> <span class="main">-</span> Suc <span class="bound">j'</span><span class="main">)</span><span class="main">)</span> <span class="bound">j'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mk_poly2_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mk_poly2_col<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_poly2 <span class="free">A</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j'</span><span class="main">&lt;</span>dim_col <span class="free">A</span><span class="main">.</span> monom <span class="main">(</span><span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="bound">j'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span> <span class="main">-</span> Suc  <span class="bound">j'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="var">?S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> dim_col <span class="free">A</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> Suc <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">using</span></span> i c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">l</span> <span class="main">-</span> <span class="bound">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> sum <span class="main">(</span><span class="var">?f</span> <span class="main">∘</span> <span class="var">?g</span><span class="main">)</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_def mk_poly2_pre<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dim
    <span class="keyword1"><span class="command">unfolding</span></span> lessThan_Suc_atMost
    <span class="keyword1"><span class="command">using</span></span> sum.reindex<span class="main">[</span><span class="operator">OF</span> inj_on_diff_nat2<span class="main">,</span><span class="operator">symmetric</span><span class="main">,</span><span class="operator">unfolded</span> image_diff_atMost<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly2_sylvester_upper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_poly2 <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> monom <span class="main">1</span> <span class="main">(</span>degree <span class="free">q</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mk_poly2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sylvester_sum_mat_upper<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> sylvester_mat_dim lessThan_Suc_atMost <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly2_sylvester_lower<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> degree <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> imn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_poly2 <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span> <span class="main">=</span> monom <span class="main">1</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mk_poly2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> imn <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> mi imn <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">unfolding</span></span> sylvester_mat_dim
  <span class="keyword1"><span class="command">using</span></span> sylvester_sum_mat_lower<span class="main">[</span><span class="operator">OF</span> mi imn<span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sylvester_sum_mat_lower<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> mi imn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> foo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 vec"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monom <span class="main">1</span> <span class="free">d</span> <span class="keyword1">⋅<span class="hidden">⇩</span><sub>v</sub></span> map_vec coeff_lift <span class="free">v</span> <span class="main">=</span> map_vec <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> monom <span class="bound">a</span> <span class="free">d</span><span class="main">)</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eq_vecI<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> index_map_vec index_col
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polynomial.smult_monom<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly_sub_corresp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dimA<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> Suc <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dimpv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dim_vec <span class="free">pv</span> <span class="main">=</span> dim_row <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">pv</span> <span class="main">+</span> col <span class="main">(</span>mk_poly_sub <span class="main">(</span>map_mat coeff_lift <span class="free">A</span><span class="main">)</span> <span class="free">l</span> <span class="free">j</span><span class="main">)</span> <span class="free">l</span> <span class="main">=</span>
    mk_poly2_col <span class="free">A</span> <span class="free">pv</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">insert</span> j<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_row <span class="free">A</span> <span class="main">≤</span> dim_vec <span class="free">pv</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dimpv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dimA <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eq_vecI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> mk_poly2_row<span class="main">[</span><span class="operator">OF</span> le<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_0<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> dim_col <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> mk_poly_sub.simps
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> col_addcol<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comm_add_vec<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> carrier_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> carrier_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> assoc_add_vec<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> carrier_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> carrier_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> carrier_vecI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> j<span class="main">]</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mk_poly2_col.simps<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mk_poly2_row_col<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> col_mk_poly_sub<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> col_map_mat<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> dimA <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">unfolding</span></span> foo dimA <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> col_mk_poly_mk_poly2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="main">(</span>mk_poly <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> mk_poly2 <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> dim_col <span class="free">A</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">=</span> Suc <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">using</span></span> dim <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mk_poly_def mk_poly2_def dim
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mk_poly_sub_corresp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> dim<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">using</span></span> dim <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> left_zero_vec<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> carrier_vecI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> dim <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> mk_poly_mk_poly2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1 mat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dim<span class="main">:</span> <span class="quoted"><span class="quoted">"dim_col <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_poly <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span>dim_col <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> mk_poly2 <span class="free">A</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mk_poly <span class="free">A</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span>dim_col <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> col <span class="main">(</span>mk_poly <span class="free">A</span><span class="main">)</span> <span class="main">(</span>dim_col <span class="free">A</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> index_col<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> dim i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> col_mk_poly_mk_poly2<span class="main">[</span><span class="operator">OF</span> dim<span class="main">]</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_poly_sylvester_upper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_poly <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> monom <span class="main">1</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sylvester_mat <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">+</span><span class="free">n</span> <span class="main">=</span> dim_col <span class="var">?S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">+</span><span class="free">n</span> <span class="main">=</span> dim_row <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="var">?S</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> mk_poly_mk_poly2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> mk_poly2 <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mk_poly2_sylvester_upper<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">unfolding</span></span> n_def m_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mk_poly_sylvester_lower<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ni<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> imn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_poly <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> monom <span class="main">1</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sylvester_mat <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">+</span><span class="free">n</span> <span class="main">=</span> dim_col <span class="var">?S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">+</span><span class="free">n</span> <span class="main">=</span> dim_row <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dim_col <span class="var">?S</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> dim_row <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> imn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> mk_poly_mk_poly2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> mk_poly2 <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">$</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mk_poly2_sylvester_lower<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> ni imn <span class="keyword1"><span class="command">unfolding</span></span> n_def m_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next lemma corresponds to Lemma 7.2.1.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> resultant_as_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> degp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> degq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">q'</span><span class="main">.</span> degree <span class="bound">p'</span> <span class="main">&lt;</span> degree <span class="free">q</span> <span class="main">∧</span> degree <span class="bound">q'</span> <span class="main">&lt;</span> degree <span class="free">p</span> <span class="main">∧</span>
         <span class="main">[:</span> resultant <span class="free">p</span> <span class="free">q</span> <span class="main">:]</span> <span class="main">=</span> <span class="bound">p'</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="bound">q'</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> dim_row <span class="main">(</span>mk_poly <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> coeff_lift <span class="main">(</span>cofactor <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="bound">i</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> monom <span class="main">1</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> monom <span class="main">1</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> degc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> dmn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">+</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">+</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def m_def n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> resultant <span class="free">p</span> <span class="free">q</span> <span class="main">:]</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">d</span><span class="main">.</span> mk_poly <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="skolem">m</span><span class="main">+</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span>
        cofactor <span class="main">(</span>mk_poly <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> resultant_def
    <span class="keyword1"><span class="command">unfolding</span></span> det_mk_poly<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> m_def n_def d_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> laplace_expansion_column<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"degree <span class="free"><span class="free">p</span></span> <span class="main"><span class="main">+</span></span> degree <span class="free"><span class="free">q</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> carrier_matI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> degp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> dim_row <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cofactor <span class="main">(</span>mk_poly <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> det <span class="main">(</span>mat_delete <span class="main">(</span>mk_poly <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cofactor_def<span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
      <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="skolem">m</span><span class="main">+</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff_lift <span class="main">(</span>det <span class="main">(</span>mat_delete <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mk_poly_delete<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> d2<span class="main"><span class="main">]</span></span><span class="main">]</span> degp degq
      <span class="keyword1"><span class="command">unfolding</span></span> m_def n_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">+</span><span class="skolem">m</span><span class="main">+</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">+</span><span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i<span class="main">[</span><span class="operator">folded</span> mnd<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cofactor <span class="main">(</span>mk_poly <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> c_def cofactor_def <span class="dynamic"><span class="dynamic">hom_distribs</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="skolem">d</span><span class="main">.</span> mk_poly <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">m</span><span class="main">+</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">(</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span> <span class="main">..&lt;</span><span class="skolem">d</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dmn <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> ivl_disj_un<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">n</span><span class="main">..&lt;</span><span class="skolem">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">i</span> <span class="main">=</span> monom <span class="main">1</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="skolem">i</span> <span class="main">*</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> m_def n_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mk_poly_sylvester_upper<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">*</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p'_def sum_distrib_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">n</span><span class="main">..&lt;</span><span class="skolem">d</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">i</span> <span class="main">=</span> monom <span class="main">1</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">n</span> <span class="main">-</span> Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="skolem">i</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> m_def n_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mk_poly_sylvester_lower<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">unfolding</span></span> dmn n_def m_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">{</span><span class="skolem">n</span><span class="main">..&lt;</span><span class="skolem">d</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="skolem">n</span><span class="main">..&lt;</span><span class="skolem">d</span><span class="main">.</span> monom <span class="main">1</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">n</span> <span class="main">-</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="var">?h</span> <span class="main">_</span> <span class="main">*</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> sum_distrib_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">n</span><span class="main">..&lt;</span><span class="skolem">d</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">+</span><span class="skolem">n</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dmn<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?h</span> <span class="main">...</span> <span class="main">=</span> sum <span class="main">(</span><span class="var">?h</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">+</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q'_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span>resultant <span class="free">p</span> <span class="free">q</span><span class="main">:]</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="free">q</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p'</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p'_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> degree_sum_smaller<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> degq<span class="main">[</span><span class="operator">folded</span> n_def<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.strict_trans1<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> degree_mult_le<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> add.right_neutral degc
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.strict_trans1<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> degree_monom_le<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q'</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> q'_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> degree_sum_smaller<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> degp<span class="main">[</span><span class="operator">folded</span> m_def<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="skolem">m</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="skolem">m</span><span class="main">-</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.strict_trans1<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> degree_mult_le<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> add.right_neutral degc
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.strict_trans1<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> degree_monom_le<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Resultant as Nonzero Polynomial Expression›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> resultant_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> xp<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xq<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> degp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> degq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> resultant <span class="free">p</span> <span class="free">q</span> <span class="main">:]</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> resultant_as_poly<span class="main">[</span><span class="operator">OF</span> degp degq<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> poly <span class="main">(</span><span class="skolem">p'</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mpoly_base_conv<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="free">q</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> poly <span class="free">p</span> <span class="free">x</span> <span class="main">*</span> poly <span class="skolem">p'</span> <span class="free">x</span> <span class="main">+</span> poly <span class="free">q</span> <span class="free">x</span> <span class="main">*</span> poly <span class="skolem">q'</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poly2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> xp xq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> degp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">0</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xp degree_0_id<span class="main">[</span><span class="operator">OF</span> degp<span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mpoly_base_conv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">using</span></span> degp deg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> degq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">[:</span><span class="main">0</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xq degree_0_id<span class="main">[</span><span class="operator">OF</span> degq<span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mpoly_base_conv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q <span class="keyword1"><span class="command">using</span></span> degq deg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_resultant_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly2 <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly2 <span class="free">q</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>resultant <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> resultant_as_poly<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> resultant <span class="free">p</span> <span class="free">q</span> <span class="main">:]</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> poly <span class="main">(</span><span class="skolem">p'</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">[:</span><span class="free">y</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mpoly_base_conv<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="free">q</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">...</span> <span class="free">x</span> <span class="main">=</span> poly2 <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">*</span> poly2 <span class="skolem">p'</span> <span class="free">x</span> <span class="free">y</span> <span class="main">+</span> poly2 <span class="free">q</span> <span class="free">x</span> <span class="free">y</span> <span class="main">*</span> poly2 <span class="skolem">q'</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poly2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p0 q0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> degp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span> coeff <span class="free">p</span> <span class="main">0</span> <span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> degree_0_id<span class="main"><span class="main">[</span></span><span class="operator">OF</span> degp<span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="main">0</span> <span class="main">^</span> degree <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> resultant_const<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">...</span> <span class="free">x</span> <span class="main">=</span> poly <span class="main">(</span>coeff <span class="free">p</span> <span class="main">0</span><span class="main">)</span> <span class="free">x</span> <span class="main">^</span> degree <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> poly2 <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">^</span> degree <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly2_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> p<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p0 <span class="keyword1"><span class="command">using</span></span> deg degp zero_power <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> degq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">[:</span> coeff <span class="free">q</span> <span class="main">0</span> <span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> degree_0_id<span class="main"><span class="main">[</span></span><span class="operator">OF</span> degq<span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> coeff <span class="free">q</span> <span class="main">0</span> <span class="main">^</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> resultant_const<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">...</span> <span class="free">x</span> <span class="main">=</span> poly <span class="main">(</span>coeff <span class="free">q</span> <span class="main">0</span><span class="main">)</span> <span class="free">x</span> <span class="main">^</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> poly2 <span class="free">q</span> <span class="free">x</span> <span class="free">y</span> <span class="main">^</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly2_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> q<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q0 <span class="keyword1"><span class="command">using</span></span> deg degq zero_power <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> resultant_as_nonzero_poly_weak<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> degp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> degq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> r0<span class="main">:</span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">q'</span><span class="main">.</span> degree <span class="bound">p'</span> <span class="main">&lt;</span> degree <span class="free">q</span> <span class="main">∧</span> degree <span class="bound">q'</span> <span class="main">&lt;</span> degree <span class="free">p</span> <span class="main">∧</span>
         <span class="main">[:</span> resultant <span class="free">p</span> <span class="free">q</span> <span class="main">:]</span> <span class="main">=</span> <span class="bound">p'</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="bound">q'</span> <span class="main">*</span> <span class="free">q</span> <span class="main">∧</span> <span class="bound">p'</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">q'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">q'</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p'</span> <span class="main">&lt;</span> degree <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q'</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> resultant <span class="free">p</span> <span class="free">q</span> <span class="main">:]</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> resultant_as_poly<span class="main">[</span><span class="operator">OF</span> degp degq<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI notI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> resultant <span class="free">p</span> <span class="free">q</span> <span class="main">:]</span> <span class="main">=</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> main <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> d0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> degree <span class="main">(</span><span class="skolem">q'</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_pCons_0<span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">q'</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> degree <span class="skolem">q'</span> <span class="main">+</span> degree <span class="free">q</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> degree_mult_eq<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> q0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> d0 degq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> r0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> resultant <span class="free">p</span> <span class="free">q</span> <span class="main">:]</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">*</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> main <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span>
      <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> d0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> degree <span class="main">(</span><span class="skolem">p'</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_pCons_0<span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">p'</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="skolem">p'</span> <span class="main">+</span> degree <span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> degree_mult_eq<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> p0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> d0 degp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> r0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ Next lemma corresponds to Lemma 7.2.2 of the textbook ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> resultant_as_nonzero_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> degp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> degq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">q'</span><span class="main">.</span> degree <span class="bound">p'</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> degree <span class="bound">q'</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">∧</span>
         <span class="main">[:</span> resultant <span class="free">p</span> <span class="free">q</span> <span class="main">:]</span> <span class="main">=</span> <span class="bound">p'</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="bound">q'</span> <span class="main">*</span> <span class="free">q</span> <span class="main">∧</span> <span class="bound">p'</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">q'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> resultant_as_nonzero_poly_weak degp degq
    <span class="keyword1"><span class="command">unfolding</span></span> m_def n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> transpose_mat <span class="main">(</span>sylvester_mat <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> carrier_mat <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def m_def n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="skolem">S</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True
    <span class="keyword1"><span class="command">unfolding</span></span> resultant_def S_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> det_transpose<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> carrier_vec <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> det_0_iff_vec_prod_zero<span class="main">[</span><span class="operator">OF</span> S<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_of_vec <span class="main">(</span><span class="skolem">S</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_vec <span class="main">(</span>vec_first <span class="skolem">v</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> poly_of_vec <span class="main">(</span>vec_last <span class="skolem">v</span> <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="main">_</span> <span class="main">+</span> <span class="var">?q</span> <span class="main">*</span> <span class="main">_</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> sylvester_vec_poly<span class="main">[</span><span class="operator">OF</span> v<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> m_def n_def<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">folded</span> m_def n_def S_def<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> split<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_first <span class="skolem">v</span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_last <span class="skolem">v</span> <span class="free">m</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vec_first_last_append<span class="main">[</span><span class="operator">simplified</span> add.commute<span class="main">]</span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> resultant <span class="free">p</span> <span class="free">q</span> <span class="main">:]</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="var">?q</span> <span class="main">*</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">using</span></span> main <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> p'0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">*</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> main <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degq n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vec_last <span class="skolem">v</span> <span class="free">m</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_of_vec_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="skolem">v</span> <span class="free">n</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">...</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p'0 <span class="keyword1"><span class="command">unfolding</span></span> poly_of_vec_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> v0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> q'0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> main <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degp m_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vec_first <span class="skolem">v</span> <span class="free">n</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_of_vec_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1">@<span class="hidden">⇩</span><sub>v</sub></span> vec_last <span class="skolem">v</span> <span class="free">m</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q'0 <span class="keyword1"><span class="command">unfolding</span></span> poly_of_vec_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> v0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="var">?p</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_poly_of_vec_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vec_first <span class="skolem">v</span> <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> degq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="var">?q</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_poly_of_vec_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"vec_last <span class="skolem">v</span> <span class="free">m</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> degp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Corresponds to Lemma 7.2.3 of the textbook›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> resultant_zero_imp_common_factor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ufd poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r0<span class="main">:</span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neq0_conv<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> degp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> degq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> cop<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p'</span> <span class="main">&lt;</span> degree <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q'</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p'0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q'0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> resultant_as_nonzero_poly<span class="main">[</span><span class="operator">OF</span> degp degq<span class="main">]</span> r0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">*</span> <span class="free">p</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_neg_iff_add_eq_0<span class="main">)</span>
    
    <span class="keyword1"><span class="command">from</span></span> some_gcd.coprime_mult_cross_dvd<span class="main">[</span><span class="operator">OF</span> cop this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> dvd_imp_degree_le<span class="main">[</span><span class="operator">OF</span> this q'0<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≤</span> degree <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> q' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> degp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">x</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> degree_eq_zeroE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">^</span> degree <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> resultant_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> not_coprime_iff_common_factor
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> deg degp dvd_0_right dvd_refl less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> poly_dvd_1<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> degq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">x</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> degree_eq_zeroE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"resultant <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">^</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> resultant_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> not_coprime_iff_common_factor
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> deg degq dvd_0_right dvd_refl less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> poly_dvd_1<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> resultant_non_zero_imp_coprime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"resultant <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field poly<span class="main">)</span> <span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> nz'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">f</span> <span class="free">g</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> degree <span class="free">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">[:</span>resultant <span class="free">f</span> <span class="free">g</span><span class="main">:]</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> nz <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">g</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> resultant_as_nonzero_poly_weak<span class="main">[</span><span class="operator">OF</span> this nz<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">&lt;</span> degree <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&lt;</span> degree <span class="free">f</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">*</span> <span class="free">f</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> some_gcd <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">*</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> id<span class="main">[</span><span class="operator">unfolded</span> f g<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">j</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> id<span class="main">,</span> <span class="operator">of</span> <span class="quoted">degree</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">h</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">j</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">h</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">j</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> degree <span class="skolem">h</span> <span class="main">+</span> degree <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="skolem">j</span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> id r<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">using</span></span> is_unit_iff_degree some_gcd.gcd_dvd_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> deg_g<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> divides_degree<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">g</span></span><span class="main">,</span> <span class="operator">unfolded</span> deg_g<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_unit_right_imp_coprime<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> g<span class="main">:</span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> <span class="main">[:</span><span class="main">0</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> nz<span class="main">[</span><span class="operator">unfolded</span> this resultant_const<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> nz' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> deg_f<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> divides_degree<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">f</span></span><span class="main">,</span> <span class="operator">unfolded</span> deg_f<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_unit_left_imp_coprime<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> f<span class="main">:</span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">[:</span><span class="main">0</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> nz<span class="main">[</span><span class="operator">unfolded</span> this resultant_const<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> nz' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Algebraic_Numbers">
<div class="head">
<h1>Theory Algebraic_Numbers</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:       René Thiemann 
                  Akihisa Yamada
    Contributors: Manuel Eberl (algebraic integers)
    License:      BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Algebraic Numbers: Addition and Multiplication›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory contains the remaining field operations for algebraic numbers, namely
  addition and multiplication.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Algebraic_Numbers
  <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Algebraic_Numbers_Prelim.html">Algebraic_Numbers_Prelim</a>
  <a href="Resultant.html">Resultant</a>
  <a href="../Polynomial_Factorization/Polynomial_Divisibility.html">Polynomial_Factorization.Polynomial_Divisibility</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> coeff_hom<span class="main">:</span> monoid_add_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> coeff <span class="bound">p</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> coeff_hom<span class="main">:</span> comm_monoid_add_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> coeff <span class="bound">p</span> <span class="free">i</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> coeff_hom<span class="main">:</span> group_add_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> coeff <span class="bound">p</span> <span class="free">i</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> coeff_hom<span class="main">:</span> ab_group_add_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> coeff <span class="bound">p</span> <span class="free">i</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> coeff_0_hom<span class="main">:</span> monoid_mult_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> coeff <span class="bound">p</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_mult<span class="main">)</span>
<span class="keyword1"><span class="command">interpretation</span></span> coeff_0_hom<span class="main">:</span> semiring_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> coeff <span class="bound">p</span> <span class="main">0</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> coeff_0_hom<span class="main">:</span> comm_monoid_mult_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> coeff <span class="bound">p</span> <span class="main">0</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> coeff_0_hom<span class="main">:</span> comm_semiring_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">.</span> coeff <span class="bound">p</span> <span class="main">0</span>"</span></span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Addition of Algebraic Numbers›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">x_y</span> <span class="main">≡</span> <span class="main">[:</span> <span class="main">[:</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span> <span class="main">:]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly_x_minus_y</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> poly_lift <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> x_y"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coeff_xy_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>x_y <span class="main">^</span> <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly poly<span class="main">)</span> <span class="free">k</span> <span class="main">=</span>
          monom <span class="main">(</span>of_nat <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> monom <span class="main">(</span>monom <span class="main">1</span> <span class="main">1</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> monom <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">1</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"monom <span class="main">1</span> <span class="skolem">b</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">=</span> monom <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="skolem">k</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monom_altdef minus_one_power_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">X</span> <span class="main">+</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> of_nat <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">X</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">Y</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> binomial_ring<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> of_nat <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> monom <span class="main">(</span>monom <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_def Y_def monom_power mult_monom mult.assoc<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> monom <span class="main">(</span>monom <span class="main">(</span>of_nat <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_poly smult_monom<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">…</span> <span class="free">k</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">n</span> <span class="main">-</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">then</span> monom <span class="main">(</span>of_nat <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_poly coeff_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="free">n</span><span class="main">-</span><span class="free">k</span><span class="main">}</span><span class="main">.</span> monom <span class="main">(</span>of_nat <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_cong_right<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">+</span> <span class="skolem">Y</span> <span class="main">=</span> x_y"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_def Y_def x_y_def monom_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following polynomial represents the sum of two algebraic numbers.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_add</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_add</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> resultant <span class="main">(</span>poly_x_minus_y <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>poly_lift <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">poly_add</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has desired root›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_x_minus_y_hom<span class="main">:</span>
  comm_ring_hom <span class="quoted">poly_x_minus_y</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_x_minus_y_def <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly2_x_y<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly2 x_y <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_y_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> degree_poly_x_minus_y<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_x_minus_y_def x_y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_x_minus_y_pCons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_x_minus_y <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="main">[:</span> <span class="free">a</span> <span class="main">:]</span><span class="main">:]</span> <span class="main">+</span> poly_x_minus_y <span class="free">p</span> <span class="main">*</span> x_y"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_x_minus_y_def x_y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_poly_poly_x_minus_y<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>poly <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> poly <span class="free">q</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_distribs x_y_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly2_poly_x_minus_y<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly2 <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">interpretation</span></span> x_y_mult_hom<span class="main">:</span> zero_hom_0 <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly poly<span class="main">.</span> x_y <span class="main">*</span> <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly poly"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"x_y <span class="main">*</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_y_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_neg_iff_add_eq_0 minus_equation_iff minus_pCons synthetic_div_unique_lemma<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> x_y_nonzero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"x_y <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_y_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> degree_x_y<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree x_y <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_y_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> x_y_mult_hom<span class="main">:</span> inj_comm_monoid_add_hom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom poly poly<span class="main">.</span> x_y <span class="main">*</span> <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"x_y <span class="main">*</span> <span class="skolem">p</span> <span class="main">=</span> x_y <span class="main">*</span> <span class="skolem">q</span> <span class="main">⟹</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly poly"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="skolem">q</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> p<span class="main">:</span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> p<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> mult_pCons_right<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"x_y <span class="main">*</span> <span class="main">(</span>monom <span class="skolem">a</span> <span class="main">0</span> <span class="main">+</span> pCons <span class="main">0</span> <span class="main">1</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> x_y <span class="main">*</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> pCons_0_as_mult<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> smult_prod<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monom <span class="skolem">a</span> <span class="main">0</span> <span class="main">+</span> pCons <span class="main">0</span> <span class="main">1</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pCons <span class="skolem">a</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pCons_as_add <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_0 monom_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_x_minus_y_hom<span class="main">:</span> inj_idom_hom <span class="quoted">poly_x_minus_y</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_x_minus_y <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_lift <span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> x_y <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_x_minus_y_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> p <span class="main">=</span> this<span class="main">[</span><span class="operator">unfolded</span> poly_lift_pCons pcompose_pCons<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> a0<span class="main">:</span> True
      <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"x_y <span class="main">*</span> poly_lift <span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> x_y <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_lift <span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> x_y <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> a0<span class="main">:</span> False
      <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span><span class="main">:]</span> <span class="main">=</span> <span class="main">-</span> x_y <span class="main">*</span> poly_lift <span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> x_y"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_neg_iff_add_eq_0<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">[:</span><span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span><span class="main">:]</span> <span class="main">=</span> degree <span class="main">(</span>x_y <span class="main">*</span> poly_lift <span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> x_y<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> degree <span class="main">(</span>x_y<span class="main">::</span><span class="tfree">'a</span> poly poly<span class="main">)</span> <span class="main">+</span> degree <span class="main">(</span>poly_lift <span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> x_y<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pcompose_eq_0<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_y_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p0<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span>comm_ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>poly_add <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> poly_add_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> poly_resultant_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> disjI2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_zero q0 y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> degq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> x y<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> poly_add<span class="antiquote"><span class="antiquote">}</span></span></span></span> is nonzero›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We first prove that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> poly_lift<span class="antiquote"><span class="antiquote">}</span></span></span></span> preserves factorization. The result will be essential
  also in the next section for division of algebraic numbers.
›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_lift_hom<span class="main">:</span>
  unit_preserving_hom <span class="quoted"><span class="quoted">"poly_lift <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span> poly <span class="main">⇒</span> <span class="main">_</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly_lift <span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span>poly_lift <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">dvd</span> poly_y_x <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_y_x_poly_lift<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_lift_hom<span class="main">:</span>
  factor_preserving_hom <span class="quoted"><span class="quoted">"poly_lift<span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>idom poly <span class="main">⇒</span> <span class="tfree">'a</span> poly poly"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">p</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>poly_lift <span class="skolem">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> irreducible_not_unit<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> poly_lift_hom.hom_dvd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poly_lift <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> irreducible <span class="main">(</span>poly_lift <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> irreducible_altdef<span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> p0 p1
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">dvd</span> poly_lift <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poly_lift <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span> <span class="main">=</span> poly_lift <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> poly_y_x <span class="main">(</span>poly_lift <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">p</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_y_x_poly_lift monom_0<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> poly_y_x <span class="skolem">q</span> <span class="main">*</span> poly_y_x <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">p</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> qp<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_y_x <span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="main">[:</span><span class="skolem">p</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvdI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> dvd_const<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> p0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_y_x <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> degree_0_id<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> qs<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_y_x <span class="skolem">q</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">s</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_lift <span class="skolem">s</span> <span class="main">=</span> poly_y_x <span class="main">(</span>poly_y_x <span class="main">(</span>poly_lift <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> poly_y_x <span class="main">[:</span><span class="skolem">s</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_y_x_poly_lift monom_0<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qs<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> sq<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_lift <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> qp<span class="main">[</span><span class="operator">unfolded</span> qs<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> sp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> const_poly_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> irreducibleD'<span class="main">[</span><span class="operator">OF</span> p this<span class="main">]</span> sq q pq <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> poly_x_minus_y<span class="antiquote"><span class="antiquote">}</span></span></span></span> is a factor-preserving homomorphism. This is
  essential for this section. This is easy since <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> poly_x_minus_y<span class="antiquote"><span class="antiquote">}</span></span></span></span> can be represented
  as the composition of two factor-preserving homomorphisms.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_x_minus_y_as_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_x_minus_y <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> x_y<span class="main">)</span> <span class="main">∘</span> poly_lift"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> poly_x_minus_y_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">context</span></span> idom_isom <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> comm_semiring_isom<span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> poly_x_minus_y_hom<span class="main">:</span>
  factor_preserving_hom <span class="quoted"><span class="quoted">"poly_x_minus_y <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom poly <span class="main">⇒</span> <span class="tfree">'a</span> poly poly"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> x_y_hom<span class="main">:</span> bijective <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="main">::</span> <span class="tfree">'a</span> poly poly<span class="main">.</span> <span class="bound">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> x_y"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> bijective_eq_bij<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> id_imp_bij<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly poly"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> x_y <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> x_y <span class="main">=</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> x_y_def <span class="dynamic"><span class="dynamic">hom_distribs</span></span> pcompose_pCons<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> x_y_hom<span class="main">:</span> idom_isom <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="main">::</span> <span class="tfree">'a</span> poly poly<span class="main">.</span> <span class="bound">p</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> x_y"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"factor_preserving_hom <span class="main">(</span>poly_x_minus_y <span class="main">::</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> poly_x_minus_y_as_comp<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> factor_preserving_hom_comp<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Now we show that results of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> poly_x_minus_y<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> poly_lift<span class="antiquote"><span class="antiquote">}</span></span></span></span> are coprime.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_y_x_const<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">[:</span><span class="main">[:</span><span class="free">a</span><span class="main">:]</span><span class="main">:]</span> <span class="main">=</span> <span class="main">[:</span><span class="main">[:</span><span class="free">a</span><span class="main">:]</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_y_x_def monom_0<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">y_x</span> <span class="main">==</span> <span class="main">[:</span> <span class="main">[:</span> <span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span> <span class="main">:]</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_y_x_x_y<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_y_x x_y <span class="main">=</span> y_x"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_y_def poly_y_x_def monom_Suc monom_0<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> y_x<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly2 y_x <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">-</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly_y_minus_x</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> poly_lift <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> y_x"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> poly_y_minus_x_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_y_minus_x <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_y_minus_x_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> poly_y_minus_x_pCons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_y_minus_x <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="main">[:</span> <span class="free">a</span> <span class="main">:]</span><span class="main">:]</span> <span class="main">+</span> poly_y_minus_x <span class="free">p</span> <span class="main">*</span> y_x"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_y_minus_x_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> poly_y_x_poly_x_minus_y<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span> <span class="main">=</span> poly_y_minus_x <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> poly_x_minus_y_pCons <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> degree_poly_y_minus_x<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_y_x <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_y_minus_x_def poly_y_x_poly_x_minus_y<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dvd_all_coeffs_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1"</span></span> <span class="comment1">(* No addition needed! *)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">pi</span> <span class="main">∈</span> set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span><span class="main">.</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="bound">pi</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="keyword1">dvd</span> coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..</span>degree <span class="free">p</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span>Suc <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">..}</span><span class="main">.</span> <span class="free">x</span> <span class="keyword1">dvd</span> coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> <span class="free">x</span> <span class="keyword1">dvd</span> coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ball_Un coeff_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeffs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> primitive_imp_no_constant_factor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1<span class="main">,</span> semiring_no_zero_divisors<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pr<span class="main">:</span> <span class="quoted"><span class="quoted">"primitive <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_factors <span class="free">F</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈#</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> F fF <span class="keyword1"><span class="command">have</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> mset_factors_imp_dvd<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f0</span></span> <span class="keyword2"><span class="keyword">where</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">f0</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> degree0_coeffs<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> fp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="skolem">f0</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f0</span> <span class="keyword1">dvd</span> coeff <span class="free">p</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> const_poly_dvd_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> primitiveD<span class="main">[</span><span class="operator">OF</span> pr<span class="main">]</span> dvd_all_coeffs_iff <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f0</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeffs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> f0 irr <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coprime_poly_x_minus_y_poly_lift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ufd poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> degp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> degq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> pr<span class="main">:</span> <span class="quoted"><span class="quoted">"primitive <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span> <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> degp <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dvd_const<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> degp <span class="keyword1"><span class="command">have</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> mset_factors_exist<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">,</span> <span class="operator">OF</span> p0 p<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_factors <span class="skolem">F</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> poly_x_minus_y_hom.hom_mset_factors
  <span class="keyword1"><span class="command">have</span></span> pF<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_factors <span class="main">(</span>image_mset poly_x_minus_y <span class="skolem">F</span><span class="main">)</span> <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> degq <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">q</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dvd_const<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> degq <span class="keyword1"><span class="command">have</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> mset_factors_exist<span class="main">[</span><span class="operator">OF</span> q0 q<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_factors <span class="skolem">G</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> poly_lift_hom.hom_mset_factors
  <span class="keyword1"><span class="command">have</span></span> pG<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_factors <span class="main">(</span>image_mset poly_lift <span class="skolem">G</span><span class="main">)</span> <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> coprime <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span> <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> not_coprime_iff_common_factor<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> rp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> rq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> rU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">note</span></span> poly_lift_hom.hom_dvd
  <span class="keyword1"><span class="command">from</span></span> rp p0 <span class="keyword1"><span class="command">have</span></span> r0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> mset_factors_exist<span class="main">[</span><span class="operator">OF</span> r0 rU<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_factors <span class="skolem">H</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> hH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈#</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> H mset_factors_imp_dvd <span class="keyword1"><span class="command">have</span></span> hr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> irreducible_not_unit<span class="main">[</span><span class="operator">OF</span> h<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> hr rp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> irreducible_dvd_imp_factor<span class="main">[</span><span class="operator">OF</span> this h pF<span class="main">]</span> p0
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈#</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fh<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_x_minus_y <span class="skolem">f</span> <span class="keyword1">ddvd</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> hr rq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> irreducible_dvd_imp_factor<span class="main">[</span><span class="operator">OF</span> this h pG<span class="main">]</span> q0
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈#</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gh<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_lift <span class="skolem">g</span> <span class="keyword1">ddvd</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> fh gh <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_x_minus_y <span class="skolem">f</span> <span class="keyword1">ddvd</span> poly_lift <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ddvd_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span>poly_x_minus_y <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">ddvd</span> poly_y_x <span class="main">(</span>poly_lift <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span>poly_lift <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">g</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_y_x_poly_lift monom_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> ddvd<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_y_x <span class="main">(</span>poly_x_minus_y <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">ddvd</span> <span class="main">[:</span><span class="skolem">g</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_y_x <span class="main">(</span>poly_x_minus_y <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_pCons_0 dvd_0_left_iff dvd_const<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> primitive_imp_no_constant_factor<span class="main">[</span><span class="operator">OF</span> pr F f<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_add_nonzero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ufd poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> pr<span class="main">:</span> <span class="quoted"><span class="quoted">"primitive <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_add <span class="free">p</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> degp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_0_eq order_degree order_root p0 x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gr0I<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> degq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_0_eq order_degree order_root q0 y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gr0I<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_add <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> resultant_zero_imp_common_factor<span class="main">[</span><span class="operator">OF</span> _ this<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> poly_add_def<span class="main"><span class="main">]</span></span><span class="main">]</span> degp
   <span class="keyword2"><span class="keyword">and</span></span> coprime_poly_x_minus_y_poly_lift<span class="main">[</span><span class="operator">OF</span> degp degq pr<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Summary for addition›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we lift the results to one that uses <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ipoly<span class="antiquote"><span class="antiquote">}</span></span></span></span>, by showing some homomorphism lemmas.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_ring_hom<span class="main">)</span> map_poly_x_minus_y<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_poly <span class="main">(</span>map_poly <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span> <span class="main">=</span> poly_x_minus_y <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> mp<span class="main">:</span> map_poly_comm_ring_hom <span class="quoted"><span class="free">hom</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> mmp<span class="main">:</span> map_poly_comm_ring_hom <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> x_y_def <span class="dynamic"><span class="dynamic">hom_distribs</span></span> poly_x_minus_y_pCons<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_ring_hom<span class="main">)</span> hom_poly_lift<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_poly <span class="main">(</span>map_poly <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span> <span class="main">=</span> poly_lift <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_lift_def
    <span class="keyword1"><span class="command">unfolding</span></span> map_poly_map_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted">coeff_lift</span><span class="main">,</span><span class="operator">OF</span> coeff_lift_hom.hom_zero<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> map_poly_coeff_lift_hom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> lead_coeff_poly_x_minus_y<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span>lead_coeff <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> degree <span class="free">p</span><span class="main">)</span><span class="main">:]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> degree <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> poly_x_minus_y_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> lead_coeff_comp<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_y_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smult_as_map_poly<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> degree_coeff_poly_x_minus_y<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span> semiring_char_0<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>coeff <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span> <span class="main">-</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&gt;</span> degree <span class="free">p</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&gt;</span> degree <span class="free">p</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> coeff_eq_0<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lead_coeff_poly_x_minus_y<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_poly_x_minus_y<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> degree <span class="free">p</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>coeff <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span>
            degree <span class="main">(</span><span class="main">∑</span><span class="bound">j</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="main">[:</span>coeff <span class="free">p</span> <span class="bound">j</span><span class="main">:]</span> <span class="main">*</span> coeff <span class="main">(</span>x_y <span class="main">^</span> <span class="bound">j</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> degree <span class="main">(</span>sum <span class="var">?f</span> <span class="main">_</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_x_minus_y_def pcompose_conv_poly poly_altdef coeff_sum n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> insert <span class="skolem">n</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="var">?f</span> <span class="main">…</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">n</span> <span class="main">+</span> sum <span class="var">?f</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="var">?f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> degree <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def coeff_xy_power degree_monom_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>sum <span class="var">?f</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> degree_sum_smaller<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="main">[:</span>coeff <span class="free">p</span> <span class="skolem">j</span><span class="main">:]</span> <span class="main">*</span> coeff <span class="main">(</span>x_y <span class="main">^</span> <span class="skolem">j</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">-</span> <span class="free">i</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def coeff_xy_power degree_monom_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>x_y <span class="main">^</span> <span class="skolem">j</span> <span class="main">::</span> <span class="tfree">'a</span> poly poly<span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> coeff_eq_0<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_power_eq<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">i</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> degree <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="main">[:</span>coeff <span class="free">p</span> <span class="skolem">j</span><span class="main">:]</span> <span class="main">*</span> coeff <span class="main">(</span>x_y <span class="main">^</span> <span class="skolem">j</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> degree <span class="free">p</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> n_def›</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_add_eq_left<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coeff_0_poly_x_minus_y <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_x_minus_y_def x_y_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> idom_hom<span class="main">)</span> poly_add_hom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span>lead_coeff <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span>poly_add <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> poly_add <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> mh<span class="main">:</span> map_poly_idom_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_add_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mh.resultant_map_poly<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> degree_map_poly_2<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> lead_coeff_poly_x_minus_y<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> degree_map_poly_2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q0 map_poly_x_minus_y<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span><span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> zero_hom<span class="main">)</span> hom_lead_coeff_nonzero_imp_map_poly_hom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">hom</span> <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_poly_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> idom"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="main">(</span>lead_coeff <span class="free">q</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">q</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_add <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms of_int_hom.hom_lead_coeff_nonzero_imp_map_poly_hom<span class="main">[</span><span class="operator">OF</span> q0<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_add <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_int_hom.poly_add_hom<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p0 q0<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_monoid_gcd<span class="main">)</span> gcd_list_eq_0_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"listgcd <span class="free">xs</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primitive_field_poly<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"primitive <span class="main">(</span><span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field poly<span class="main">)</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> primitive_iff_some_content_dvd_1<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dvd_field_iff coeffs_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_poly_add_nonzero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">q</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="main">(</span>lead_coeff <span class="free">q</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_add <span class="free">p</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int_poly <span class="main">(</span>poly_add <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> of_int_hom.poly_add_hom<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_add_nonzero<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>of_int_hom.hom_lead_coeff_nonzero_imp_map_poly_hom<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> represents_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">represents</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_add <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> representsI ipoly_poly_add ipoly_poly_add_nonzero<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Division of Algebraic Numbers›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_x_mult_y</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">poly_x_mult_y</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∑</span> <span class="bound">i</span> <span class="main">≤</span> degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">.</span> monom <span class="main">(</span>monom <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coeff_poly_x_mult_y<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>poly_x_mult_y <span class="free">p</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> monom <span class="main">(</span>coeff <span class="free">p</span> <span class="free">i</span><span class="main">)</span> <span class="free">i</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="main">(</span>monom <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">j</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">{..</span>degree <span class="free">p</span><span class="main">}</span>"</span></span>
   <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="var">?A</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_x_mult_y_def coeff_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sum <span class="var">?f</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?f</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_x_mult_y_def coeff_eq_0 coeff_sum<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_x_mult_y_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_x_mult_y <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">cs</span> <span class="main">=</span> coeffs <span class="free">p</span>
  <span class="keyword1">in</span> poly_of_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">ai</span><span class="main">)</span><span class="main">.</span> monom <span class="bound">ai</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="bound">cs</span><span class="main">]</span> <span class="bound">cs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def poly_of_list_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> coeff_poly_x_mult_y<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"zip <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">ai</span><span class="main">)</span><span class="main">.</span> monom <span class="bound">ai</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monom <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> coeff <span class="main">(</span>Poly <span class="main">(</span>map <span class="var">?f</span> <span class="var">?xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="var">?f</span> <span class="var">?xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="var">?xs</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> degree_eq_length_coeffs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> coeff_Poly nth_default_nth<span class="main">[</span><span class="operator">OF</span> n<span class="main">]</span> nth_map<span class="main">[</span><span class="operator">OF</span> nn<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_coeffs_coeff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>Poly <span class="main">(</span>map <span class="var">?f</span> <span class="var">?xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coeff_Poly
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nth_default_beyond<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> degree <span class="free">p</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> degree_eq_length_coeffs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monom <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coeff_eq_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_div</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_div</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> resultant <span class="main">(</span>poly_x_mult_y <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>poly_lift <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> poly_div<span class="antiquote"><span class="antiquote">}</span></span></span></span> has desired roots.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly2_poly_x_mult_y<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly2 <span class="main">(</span>poly_x_mult_y <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> poly_as_sum_of_monoms<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> poly_x_mult_y_def <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly2_monom poly_monom power_mult_distrib <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_div<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>poly_div <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> poly_div_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> poly_resultant_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> disjI2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_zero q0 y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> degq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> x y y0<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly2_poly_x_mult_y<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> poly_div<span class="antiquote"><span class="antiquote">}</span></span></span></span> is nonzero.›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_x_mult_y_hom<span class="main">:</span> ring_hom <span class="quoted"><span class="quoted">"poly_x_mult_y <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span>ring_char_0<span class="main">}</span> poly <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly2_ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly2_poly_x_mult_y <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_x_mult_y_hom<span class="main">:</span> inj_ring_hom <span class="quoted"><span class="quoted">"poly_x_mult_y <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span>ring_char_0<span class="main">}</span> poly <span class="main">⇒</span> <span class="main">_</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted">poly_x_mult_y</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly2 <span class="main">(</span><span class="var">?h</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> poly2_poly_x_mult_y<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> degree_poly_x_mult_y<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span> ring_char_0<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_x_mult_y <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">≤</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_degree <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_poly_x_mult_y<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≤</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_x_mult_y_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> degree_sum_le le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> degree_monom_le<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_x_mult_y_hom<span class="main">:</span> unit_preserving_hom <span class="quoted"><span class="quoted">"poly_x_mult_y <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0 poly <span class="main">⇒</span> <span class="main">_</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poly_x_mult_y <span class="main">::</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> unit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="skolem">f</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="var">?h</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="var">?h</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">0</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_dvd_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_monom_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> unit <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> poly_y_x_o_poly_lift <span class="main">=</span> o_def<span class="main">[</span><span class="operator">of</span> <span class="quoted">poly_y_x</span> <span class="quoted">poly_lift</span><span class="main">,</span> <span class="operator">unfolded</span> poly_y_x_poly_lift<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> irreducible_dvd_degree<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>field poly<span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">g</span>"</span></span>
 <span class="quoted"><span class="quoted">"irreducible <span class="free">g</span>"</span></span>
 <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">=</span> degree <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> irreducible_altdef degree_0 dvd_refl is_unit_field_poly linorder_neqE_nat poly_divides_conv0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> coprime_poly_x_mult_y_poly_lift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> degp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> degq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="free">q</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>poly_x_mult_y <span class="free">p</span><span class="main">)</span> <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> degp <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dvd_const<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> degp <span class="keyword1"><span class="command">have</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> mset_factors_exist<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">,</span> <span class="operator">OF</span> p0 p<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_factors <span class="skolem">F</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pF<span class="main">:</span> <span class="quoted"><span class="quoted">"prod_mset <span class="main">(</span>image_mset poly_x_mult_y <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> poly_x_mult_y <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> degq <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_unit <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dvd_const<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> degq <span class="keyword1"><span class="command">have</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> mset_factors_exist<span class="main">[</span><span class="operator">OF</span> q0 q<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_factors <span class="skolem">G</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> poly_lift_hom.hom_mset_factors
  <span class="keyword1"><span class="command">have</span></span> pG<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_factors <span class="main">(</span>image_mset poly_lift <span class="skolem">G</span><span class="main">)</span> <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> poly_y_x_hom.hom_mset_factors<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> pG<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_factors <span class="main">(</span>image_mset coeff_lift <span class="skolem">G</span><span class="main">)</span> <span class="main">[:</span><span class="free">q</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_y_x_poly_lift monom_0 image_mset.compositionality poly_y_x_o_poly_lift<span class="main">)</span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> coprime <span class="main">(</span>poly_x_mult_y <span class="free">p</span><span class="main">)</span> <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> coprime <span class="main">(</span>poly_y_x <span class="main">(</span>poly_x_mult_y <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>poly_y_x <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> coprime_iff_coprime<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> not_coprime_iff_common_factor<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> rp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">dvd</span> poly_y_x <span class="main">(</span>poly_x_mult_y <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> rq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">dvd</span> poly_y_x <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> rU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> rp p0 <span class="keyword1"><span class="command">have</span></span> r0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> mset_factors_exist<span class="main">[</span><span class="operator">OF</span> r0 rU<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"mset_factors <span class="skolem">H</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">≠</span> <span class="main">{#}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> hH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈#</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> H mset_factors_imp_dvd <span class="keyword1"><span class="command">have</span></span> hr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> irreducible_not_unit<span class="main">[</span><span class="operator">OF</span> h<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> hU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> hr rp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> poly_y_x <span class="main">(</span>poly_x_mult_y <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> this<span class="main">[</span><span class="operator">folded</span> pF<span class="main">,</span><span class="operator">unfolded</span> poly_y_x_hom.hom_prod_mset image_mset.compositionality<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> prime_elem_dvd_prod_mset<span class="main">[</span><span class="operator">OF</span> h<span class="main"><span class="main">[</span></span><span class="operator">folded</span> prime_elem_iff_irreducible<span class="main"><span class="main">]</span></span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈#</span> <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> poly_y_x <span class="main">(</span>poly_x_mult_y <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> irrF<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f F <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> dvd_trans<span class="main">[</span><span class="operator">OF</span> hr rq<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="main">[:</span><span class="free">q</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_y_x_poly_lift monom_0<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> irreducible_dvd_imp_factor<span class="main">[</span><span class="operator">OF</span> this h pG<span class="main">]</span> q0
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈#</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="skolem">g</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> dvd_trans<span class="main">[</span><span class="operator">OF</span> gh hf<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="skolem">g</span><span class="main">:]</span> <span class="keyword1">dvd</span> poly_y_x <span class="main">(</span>poly_x_mult_y <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dvd_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> f_0<span class="main">:</span> False
    <span class="keyword1"><span class="command">from</span></span> poly_hom.hom_dvd<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> poly <span class="main">(</span>poly_y_x <span class="main">(</span>poly_x_mult_y <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">[:</span><span class="main">0</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">[:</span>poly <span class="skolem">f</span> <span class="main">0</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> poly2_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly2_poly_x_mult_y<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> g G <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mset_factorsE <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> irreducible_not_unit<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> dvd_iff_poly_eq_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> irreducible_dvd_degree<span class="main">[</span><span class="operator">OF</span> this irrF<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">f</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> degree1_coeffs<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> True <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="skolem">c</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> g G <span class="keyword1"><span class="command">have</span></span> irrG<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> poly_hom.hom_dvd<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> poly <span class="main">(</span>poly_y_x <span class="main">(</span>poly_x_mult_y <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f poly_x_mult_y_code Let_def c poly_y_x_pCons map_poly_monom poly_monom poly_lift_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f dvd_def <span class="keyword1"><span class="command">using</span></span> c 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[:</span></span></span> inverse <span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span> <span class="main"><span class="main"><span class="main">:]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> g01<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> divides_degree<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> irrG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">g</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> degree1_coeffs<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> g01<span class="main">[</span><span class="operator">unfolded</span> dvd_def<span class="main">]</span> g <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> id <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> id<span class="main">,</span> <span class="operator">of</span> <span class="quoted">degree</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> degree_mult_eq<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> 
      <span class="keyword1"><span class="command">unfolding</span></span> g <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> degree0_coeffs<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">kk</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">kk</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> id<span class="main">[</span><span class="operator">unfolded</span> g k<span class="main">]</span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> True this nz <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈#</span> <span class="skolem">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈#</span> <span class="skolem">G</span>›</span></span> F G
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>mset_factors_imp_dvd <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span>dvdE<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_div_nonzero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p_0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="free">q</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_div <span class="free">p</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> degp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_0_eq order_degree order_root p0 x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gr0I<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> degq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_0_eq order_degree order_root q0 y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gr0I<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_div <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> resultant_zero_imp_common_factor<span class="main">[</span><span class="operator">OF</span> _ this<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> poly_div_def<span class="main"><span class="main">]</span></span><span class="main">]</span> degp
   <span class="keyword2"><span class="keyword">and</span></span> coprime_poly_x_mult_y_poly_lift<span class="main">[</span><span class="operator">OF</span> degp degq<span class="main">]</span> p_0
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Summary for division›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we lift the results to one that uses <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ipoly<span class="antiquote"><span class="antiquote">}</span></span></span></span>, by showing some homomorphism lemmas.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> inj_comm_ring_hom<span class="main">)</span> poly_x_mult_y_hom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_x_mult_y <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="main">(</span>map_poly <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>poly_x_mult_y <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> mh<span class="main">:</span> map_poly_inj_comm_ring_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> mmh<span class="main">:</span> map_poly_inj_comm_ring_hom <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_x_mult_y_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> inj_comm_ring_hom<span class="main">)</span> poly_div_hom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span> <span class="main">(</span>poly_div <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> poly_div <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>map_poly <span class="free">hom</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">hom</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">interpret</span></span> mh<span class="main">:</span> map_poly_inj_comm_ring_hom<span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_div_def mh.resultant_hom<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_x_mult_y_hom<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_poly_div<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">q</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_div <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> of_int_hom.poly_div_hom<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> poly_div<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_poly_div_nonzero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">q</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="free">q</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_div <span class="free">p</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int_poly <span class="main">(</span>poly_div <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> of_int_hom.poly_map_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_int_hom.poly_div_hom<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> poly_div_nonzero<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> represents_div<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">represents</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_div <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> representsI ipoly_poly_div ipoly_poly_div_nonzero<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Multiplication of Algebraic Numbers›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_mult</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly_mult</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> poly_div <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>reflect_poly <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> represents_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> px<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">represents</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q_0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_mult <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> q_0 qy <span class="keyword1"><span class="command">have</span></span> y0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> represents_inverse<span class="main">[</span><span class="operator">OF</span> y0 qy<span class="main">]</span> y0 px q_0
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_mult <span class="free">p</span> <span class="free">q</span> <span class="keyword1">represents</span> <span class="free">x</span> <span class="main">/</span> <span class="main">(</span>inverse <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> represents_div<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> y0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Summary: Closure Properties of Algebraic Numbers›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_representsI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span> <span class="main">⟹</span> algebraic <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> represents_def algebraic_altdef_ipoly <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_of_rat<span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>of_rat <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> algebraic_representsI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> poly_rat_represents_of_rat<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_uminus<span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span> <span class="main">⟹</span> algebraic <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> algebraic_imp_represents_irreducible <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> algebraic_representsI represents_uminus<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span> <span class="main">⟹</span> algebraic <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> algebraic_of_rat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> algebraic_imp_represents_irreducible <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> algebraic_representsI represents_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span> <span class="main">⟹</span> algebraic <span class="free">y</span> <span class="main">⟹</span> algebraic <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> algebraic_imp_represents_irreducible_cf_pos <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> algebraic_representsI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> represents_add<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_div<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> algebraic_of_rat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x y <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> px<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">represents</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> algebraic_imp_represents_irreducible<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> False px represents_irr_non_0<span class="main">[</span><span class="operator">OF</span> irr qy<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> algebraic_representsI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> represents_div<span class="main"><span class="main">]</span></span> qy<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_times<span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span> <span class="main">⟹</span> algebraic <span class="free">y</span> <span class="main">⟹</span> algebraic <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> algebraic_div<span class="main">[</span><span class="operator">OF</span> _ algebraic_inverse<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_root<span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span> <span class="main">⟹</span> algebraic <span class="main">(</span>root <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> algebraic_imp_represents_irreducible_cf_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 
    algebraic_representsI<span class="main">[</span><span class="operator">OF</span> represents_nth_root_neg_real<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ this<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    algebraic_representsI<span class="main">[</span><span class="operator">OF</span> represents_nth_root_pos_real<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ this<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    algebraic_of_rat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_nth_root<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> algebraic <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> algebraic <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> algebraic_imp_represents_irreducible_cf_pos <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> algebraic_representsI represents_nth_root<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More on algebraic integers›</span></span>

<span class="comment1">(* TODO: this is actually equal to @{term "(-1)^(m*n)"}, but we need a bit more theory on
   permutations to show this with a reasonable amount of effort. *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_add_sign</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_add_sign</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> signof <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">+</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="bound">i</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">else</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lead_coeff_poly_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span> semiring_char_0<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>poly_add <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span> <span class="main">=</span> poly_add_sign <span class="free">m</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> sylvester_mat <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span> <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">π</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">m</span> <span class="main">+</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> π<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_nat_permutes<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> π_def inj_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">π</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def π_def sylvester_index_mat m_def n_def<span class="main">)</span>

<span class="comment1">(*
  have "{(i,j). i ∈ {..&lt;m+n} ∧ j ∈ {..&lt;m+n} ∧ i &lt; j ∧ π i &gt; π j} =
        {..&lt;n} × {n..&lt;m+n}" (is "?lhs = ?rhs")
  proof (intro equalityI subsetI)
    fix ij assume "ij ∈ ?lhs"
    thus "ij ∈ ?rhs"
      by (simp add: π_def split: prod.splits if_splits) auto
  qed (auto simp: π_def)
  hence "inversions_on {..&lt;m+n} π = n * m"
    by (simp add: inversions_on_def)
  hence "signof π = (-1)^(m*n)"
    using π by (simp add: signof_def sign_def evenperm_iff_even_inversions)
*)</span>

  <span class="keyword1"><span class="command">have</span></span> indices_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(+)</span> <span class="free">n</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> atLeast0LessThan<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">σ</span><span class="main">.</span> signof <span class="bound">σ</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">f</span> <span class="skolem">π</span><span class="main">)</span> <span class="main">=</span> degree <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">π</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def degree_mult_eq signof_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">π</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_prod_eq_sum_degree<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">π</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">π</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> indices_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum.union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum.reindex<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">π</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def sylvester_index_mat π_def m_def n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">π</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def sylvester_index_mat π_def m_def n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> deg_f1<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">f</span> <span class="skolem">π</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> deg_f2<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">f</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">*</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">≠</span> <span class="skolem">π</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">σ</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def *<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">note</span></span> nz <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> σ_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> permutes_in_image<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="main">_</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">f</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> degree <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def degree_mult_eq signof_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_prod_eq_sum_degree<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> indices_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum.union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum.reindex<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> σ_less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def sylvester_index_mat π_def m_def n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_strict_mono_ex1<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ_less
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def sylvester_index_mat π_def m_def n_def degree_coeff_poly_x_minus_y<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="skolem">σ</span> <span class="bound">i</span> <span class="main">≠</span> <span class="skolem">π</span> <span class="bound">i</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> nex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="skolem">σ</span> <span class="bound">i</span> <span class="main">≠</span> <span class="skolem">π</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span><span class="skolem">k</span><span class="main">.</span> <span class="skolem">σ</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">π</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
          <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> 0
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">π</span> <span class="keyword1">permutes</span> <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="main">_</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">π</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
            <span class="keyword1"><span class="command">using</span></span> Suc.prems Suc.IH that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> nz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span><span class="main">,</span> <span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span> <span class="main">≥</span> <span class="free">n</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≥</span> <span class="free">m</span><span class="main">-</span>Suc <span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms σ_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span>Suc <span class="skolem">k</span>"</span></span><span class="main">]</span> Suc.prems
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def sylvester_index_mat m_def n_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
              <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> <span class="free">m</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="skolem">j</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> j_def<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> σ_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span>Suc <span class="skolem">k</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> j_def<span class="main">)</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">π</span> <span class="skolem">j</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> nex <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="skolem">j</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> π_def<span class="main">)</span>
              <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">σ</span> <span class="skolem">j</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> permutes_inj<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="main">_</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> inj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span>›</span></span> σ_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span>Suc <span class="skolem">k</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> 
                <span class="keyword1"><span class="command">unfolding</span></span> j_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
            <span class="keyword1"><span class="command">qed</span></span>
          
            <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span> Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> j_def<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span>Suc <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">π</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IH<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> j_def<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> j_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span><span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">j</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> π_def <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> π_def<span class="main">)</span>
            <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> permutes_inj<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="main">_</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> inj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">≥</span> <span class="free">m</span><span class="main">-</span>Suc <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">-</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">-</span> Suc <span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span>
            <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">π</span> <span class="skolem">i</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> eq Suc.prems <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> IH i
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eq Suc.prems <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> π_def<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> IH i <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> nex <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">π</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="free">n</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">=</span> <span class="skolem">π</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="main">≠</span> <span class="skolem">π</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">π</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> σ_less<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">π</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> π_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def m_def n_def sylvester_index_mat degree_coeff_poly_x_minus_y<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">f</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">*</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="skolem">f</span> <span class="skolem">π</span><span class="main">)</span> <span class="main">=</span> poly_add_sign <span class="free">m</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="skolem">f</span> <span class="skolem">π</span><span class="main">)</span> <span class="main">=</span> signof <span class="skolem">π</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">π</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def signof_def lead_coeff_prod<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">π</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">π</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">π</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> indices_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> prod.union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod.reindex<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">π</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> lead_coeff <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def m_def n_def π_def sylvester_index_mat<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">π</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> lead_coeff <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def m_def n_def π_def sylvester_index_mat<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"signof <span class="skolem">π</span> <span class="main">=</span> poly_add_sign <span class="free">m</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> π_def poly_add_sign_def m_def n_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> if_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>poly_add <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span>
          lead_coeff <span class="main">(</span>det <span class="main">(</span>sylvester_mat <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span> <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_add_def resultant_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="main">(</span>sylvester_mat <span class="main">(</span>poly_x_minus_y <span class="free">p</span><span class="main">)</span> <span class="main">(</span>poly_lift <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">π</span></span> <span class="main">|</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">π</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> det_def m_def n_def M_def f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">π</span><span class="main">.</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> insert <span class="skolem">π</span> <span class="main">(</span><span class="main">{</span><span class="bound">π</span><span class="main">.</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">π</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> π <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">π</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">f</span> <span class="skolem">π</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_permutations<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">…</span> <span class="main">=</span> lead_coeff <span class="main">(</span><span class="skolem">f</span> <span class="skolem">π</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="skolem">π</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">*</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> degree_sum_smaller deg_f2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> m_def n_def finite_permutations<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> deg_f1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_coeff_add_le<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lead_coeff <span class="main">(</span><span class="skolem">f</span> <span class="skolem">π</span><span class="main">)</span> <span class="main">=</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lead_coeff_poly_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span> ring_char_0<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≡</span> degree <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">q</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>poly_mult <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>reflect_poly <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_reflect_poly_eq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> sylvester_mat <span class="main">(</span>poly_x_mult_y <span class="free">p</span><span class="main">)</span> <span class="main">(</span>poly_lift <span class="main">(</span>reflect_poly <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def sylvester_index_mat m_def n_def coeff_poly_x_mult_y<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> indices_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(+)</span> <span class="free">n</span> <span class="main">`</span> <span class="main">{..&lt;</span><span class="free">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> atLeast0LessThan<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">σ</span><span class="main">.</span> signof <span class="bound">σ</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">f</span> id<span class="main">)</span> <span class="main">=</span> degree <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def degree_mult_eq signof_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_prod_eq_sum_degree<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">,</span> <span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> indices_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum.union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum.reindex<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def sylvester_index_mat m_def n_def coeff_poly_x_mult_y degree_monom_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">,</span> <span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def sylvester_index_mat m_def n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> deg_f1<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">f</span> id<span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">*</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac id_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> deg_f2<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">f</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">*</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">≠</span> id"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">σ</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def *<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">note</span></span> nz <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> σ_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">using</span></span> permutes_in_image<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="main">_</span>›</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">f</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">=</span> degree <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">.</span> <span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def degree_mult_eq signof_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_prod_eq_sum_degree<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> indices_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum.union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum.reindex<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> σ_less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def sylvester_index_mat m_def n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_strict_mono_ex1<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> σ_less
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def sylvester_index_mat m_def n_def degree_coeff_poly_x_minus_y coeff_poly_x_mult_y
                 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> degree_monom_le<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="skolem">σ</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">i</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> nex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="skolem">σ</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
          <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">i</span><span class="main">)</span>
          <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="free">n</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> nex <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≥</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="main">_</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_def<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="free">n</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
              <span class="keyword1"><span class="command">using</span></span> that less.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> less.IH<span class="main">)</span> <span class="operator">auto</span>

            <span class="keyword1"><span class="command">from</span></span> nz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> i σ_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def sylvester_index_mat m_def n_def<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="skolem">i</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">σ</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="skolem">i</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">(</span><span class="skolem">σ</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">σ</span> <span class="skolem">i</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> IH<span class="main">)</span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> permutes_inj<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="keyword1">permutes</span> <span class="main">_</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> inj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="main">=</span> id"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">σ</span> <span class="main">≠</span> id›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">σ</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">+</span> <span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> σ_less<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def m_def n_def sylvester_index_mat degree_coeff_poly_x_minus_y
                       coeff_poly_x_mult_y <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> degree_monom_le<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> degree <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="skolem">σ</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">f</span> <span class="skolem">σ</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">*</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="skolem">f</span> id<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="skolem">f</span> id<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def signof_def lead_coeff_prod sign_id<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">,</span> <span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> indices_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> prod.union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod.reindex<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> lead_coeff <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def m_def n_def sylvester_index_mat
                                       coeff_poly_x_mult_y degree_monom_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> lead_coeff <span class="main">(</span><span class="skolem">M</span> <span class="main">$$</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">,</span> <span class="free">n</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">m</span><span class="main">.</span> lead_coeff <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def m_def n_def sylvester_index_mat<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>poly_mult <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> lead_coeff <span class="main">(</span>det <span class="skolem">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_mult_def resultant_def M_def poly_div_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"det <span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound"><span class="bound">π</span></span> <span class="main">|</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">π</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> det_def m_def n_def M_def f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">π</span><span class="main">.</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> insert id <span class="main">(</span><span class="main">{</span><span class="bound">π</span><span class="main">.</span> <span class="bound">π</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span>id<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_id<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="main">…</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span><span class="main">}</span><span class="main">-</span><span class="main">{</span>id<span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">f</span> id"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_permutations<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">…</span> <span class="main">=</span> lead_coeff <span class="main">(</span><span class="skolem">f</span> id<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="main">∑</span><span class="bound">σ</span><span class="main">∈</span><span class="main">{</span><span class="bound">σ</span><span class="main">.</span> <span class="bound">σ</span> <span class="keyword1">permutes</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">}</span><span class="main">}</span><span class="main">-</span><span class="main">{</span>id<span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">*</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> degree_sum_smaller deg_f2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> m_def n_def finite_permutations<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> deg_f1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_coeff_add_le<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lead_coeff <span class="main">(</span><span class="skolem">f</span> id<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_int_plus <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> algebraic_int_altdef_ipoly<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">q</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> algebraic_int_altdef_ipoly<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> deg_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> degree_eq_zeroE<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> poly_add_sign <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>degree <span class="skolem">q</span><span class="main">)</span> <span class="main">*</span> poly_add <span class="skolem">p</span> <span class="skolem">q</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p q deg_pos
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def lead_coeff_mult poly_add_sign_def signof_def lead_coeff_poly_add<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">r</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ipoly_poly_add r_def of_int_poly_hom.hom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> algebraic_int_altdef_ipoly<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_int_times <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> algebraic_int_altdef_ipoly<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">q</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> algebraic_int_altdef_ipoly<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> deg_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> degree_eq_zeroE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Polynomial.order <span class="main">0</span> <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monom <span class="main">1</span> <span class="skolem">n</span> <span class="keyword1">dvd</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def monom_1_dvd_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> q_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q'</span> <span class="main">*</span> monom <span class="main">1</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.order <span class="main">0</span> <span class="skolem">q</span> <span class="main">=</span> Polynomial.order <span class="main">0</span> <span class="skolem">q'</span> <span class="main">+</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_split <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> order_mult<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q'</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_split order_root<span class="main">)</span>    

  <span class="keyword1"><span class="command">have</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">q'</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">q'</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q_split q
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_int_poly_hom.hom_mult poly_monom lead_coeff_mult degree_monom_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> deg_pos'<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Nat.gr0I<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> degree_eq_zeroE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">q'</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">q'</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monom_1_dvd_iff' poly_0_coeff_0<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="keyword1">represents</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p q' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> represents_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_mult <span class="skolem">p</span> <span class="skolem">q'</span> <span class="keyword1">represents</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> represents_mult<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_0_coeff_0<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>poly_mult <span class="skolem">p</span> <span class="skolem">q'</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p deg_pos q' deg_pos'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lead_coeff_mult lead_coeff_poly_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> algebraic_int_altdef_ipoly represents_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_int_power <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span> <span class="main">⟹</span> algebraic_int <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_int_diff <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> algebraic_int_plus<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> algebraic_int_minus<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_int_sum <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> algebraic_int <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span><span class="main">)</span>
    <span class="main">⟹</span> algebraic_int <span class="main">(</span>sum <span class="free">f</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_int_prod <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> algebraic_int <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span><span class="main">)</span>
    <span class="main">⟹</span> algebraic_int <span class="main">(</span>prod <span class="free">f</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_int_nth_root_real_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>root <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> algebraic_int <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>root <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>root <span class="free">n</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="free">n</span> <span class="keyword1">then</span> <span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="keyword1">else</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sgn_power_root<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_int_power_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> algebraic_int <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> algebraic_int_root<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>monom <span class="main">1</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_monom<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> degree_monom_eq›</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_int_power_iff' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> algebraic_int <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span> <span class="main">⟷</span> algebraic_int <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> algebraic_int_power_iff<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_int_sqrt_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>sqrt <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> algebraic_int <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sqrt_def algebraic_int_nth_root_real_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_int_csqrt_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>csqrt <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> algebraic_int <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>csqrt <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>csqrt <span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> algebraic_int_power<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> algebraic_int_norm_complex <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span><span class="free">z</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span>norm <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic_int <span class="main">(</span><span class="free">z</span> <span class="main">*</span> cnj <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> cnj <span class="free">z</span> <span class="main">=</span> of_real <span class="main">(</span>norm <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> complex_norm_square <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> x_y

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Sturm_Rat">
<div class="head">
<h1>Theory Sturm_Rat</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Separation of Roots: Sturm›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We adapt the existing theory on Sturm's theorem to work on rational numbers instead of real 
  numbers. The reason is that we want to implement real numbers as real algebraic numbers with the
  help of Sturm's theorem to separate the roots. To this end, we just copy the definitions of
  of the algorithms w.r.t. Sturm and let them be executed on rational numbers. We then
  prove that corresponds to a homomorphism and therefore can transfer the existing soundness results.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Sturm_Rat
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../Sturm_Sequences/Sturm_Theorem.html">Sturm_Sequences.Sturm_Theorem</a>
  <a href="Algebraic_Numbers_Prelim.html">Algebraic_Numbers_Prelim</a>
  <a href="../Berlekamp_Zassenhaus/Square_Free_Int_To_Square_Free_GFp.html">Berlekamp_Zassenhaus.Square_Free_Int_To_Square_Free_GFp</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> UnivPoly.coeff

<span class="comment1">(* TODO: Move *)</span>
<span class="keyword1"><span class="command">lemma</span></span> root_primitive_part <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>semiring_gcd<span class="main">,</span> semiring_no_zero_divisors<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"poly <span class="main">(</span>primitive_part <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> content <span class="free">p</span> <span class="main">*</span> poly <span class="main">(</span>primitive_part <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> content_times_primitive_part poly_smult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="main">(</span>primitive_part <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*TODO: Move*)</span>
<span class="keyword1"><span class="command">lemma</span></span> irreducible_primitive_part<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"primitive_part <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> irreducible_content<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">unfolded</span> primitive_iff_content_eq_1<span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primitive_part_def abs_poly_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Interface for Separating Roots›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For a given rational polynomial, we need to know how many real roots are in a given closed interval,
  and how many real roots are in an interval $(-\infty,r]$.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> root_info <span class="main">=</span> Root_Info <span class="main">(</span><span class="free"><span class="entity">l_r</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> rat <span class="main">⇒</span> nat"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">number_root</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> nat"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> l_r
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> number_root

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">count_roots_interval_sf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> <span class="main">(</span>real <span class="main">⇒</span> real <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">×</span> <span class="main">(</span>real <span class="main">⇒</span> nat<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">count_roots_interval_sf</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> sturm_squarefree <span class="free"><span class="bound"><span class="entity">p</span></span></span>
    <span class="keyword1">in</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> sign_changes <span class="bound">ps</span> <span class="bound">a</span> <span class="main">-</span> sign_changes <span class="bound">ps</span> <span class="bound">b</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span><span class="main">.</span> sign_changes_neg_inf <span class="bound">ps</span> <span class="main">-</span> sign_changes <span class="bound">ps</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">count_roots_interval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> <span class="main">(</span>real <span class="main">⇒</span> real <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">×</span> <span class="main">(</span>real <span class="main">⇒</span> nat<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">count_roots_interval</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> sturm <span class="free"><span class="bound"><span class="entity">p</span></span></span>
    <span class="keyword1">in</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> sign_changes <span class="bound">ps</span> <span class="bound">a</span> <span class="main">-</span> sign_changes <span class="bound">ps</span> <span class="bound">b</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span><span class="main">.</span> sign_changes_neg_inf <span class="bound">ps</span> <span class="main">-</span> sign_changes <span class="bound">ps</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> count_roots_interval_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"square_free <span class="free">p</span> <span class="main">⟹</span> count_roots_interval <span class="free">p</span> <span class="main">=</span> count_roots_interval_sf <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> count_roots_interval_def count_roots_interval_sf_def sturm_squarefree_def
    square_free_iff_separable separable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> count_roots_interval_sf<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> cr<span class="main">:</span> <span class="quoted"><span class="quoted">"count_roots_interval_sf <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">cr</span><span class="main">,</span><span class="free">nr</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">cr</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span>card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">nr</span> <span class="free">a</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> 
    <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span> 
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="main">_</span> <span class="main">=</span> <span class="var">?R</span> <span class="main">∪</span> <span class="var">?S</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> RS<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?R</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">∩</span> <span class="var">?S</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_roots_finite<span class="main">)</span>   
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">cr</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span>card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">nr</span> <span class="free">a</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cr <span class="keyword1"><span class="command">unfolding</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> id<span class="main">,</span> <span class="operator">of</span> <span class="quoted">card</span><span class="main">]</span> card_Un_disjoint<span class="main">[</span><span class="operator">OF</span> RS<span class="main">]</span> 
    count_roots_interval_sf_def count_roots_between_correct<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    count_roots_below_correct<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> count_roots_below_def
    count_roots_between_def Let_def <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> count_roots_interval<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> cr<span class="main">:</span> <span class="quoted"><span class="quoted">"count_roots_interval <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">cr</span><span class="main">,</span><span class="free">nr</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"square_free <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">cr</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span>card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">nr</span> <span class="free">a</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> count_roots_interval_sf<span class="main">[</span><span class="operator">OF</span> _ cr<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">unfolded</span></span> count_roots_interval_iff<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> sf<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main">]</span> 
    sf<span class="main">[</span><span class="operator">unfolded</span> square_free_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">root_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">×</span> rat <span class="main">×</span> rat <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">root_cond</span> <span class="free"><span class="bound"><span class="entity">plr</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">plr</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">⇒</span> of_rat <span class="bound">l</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> of_rat <span class="bound">r</span> <span class="main">∧</span> ipoly <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">root_info_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"root_info <span class="main">⇒</span> int poly <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">root_info_cond</span> <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> <span class="bound">b</span> <span class="main">⟶</span> root_info.l_r <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span><span class="main">.</span> root_info.number_root <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="bound">a</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> real_of_rat <span class="bound">a</span> <span class="main">∧</span> ipoly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> root_info_condD<span class="main">:</span> <span class="quoted"><span class="quoted">"root_info_cond <span class="free">ri</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> root_info.l_r <span class="free">ri</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="quoted"><span class="quoted">"root_info_cond <span class="free">ri</span> <span class="free">p</span> <span class="main">⟹</span> root_info.number_root <span class="free">ri</span> <span class="free">a</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> real_of_rat <span class="free">a</span> <span class="main">∧</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> root_info_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">count_roots_interval_sf_rat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> root_info"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">count_roots_interval_sf_rat</span>  <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">pp</span> <span class="main">=</span> real_of_int_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="bound">cr</span><span class="main">,</span><span class="bound">nr</span><span class="main">)</span> <span class="main">=</span> count_roots_interval_sf <span class="bound">pp</span>
  <span class="keyword1">in</span> Root_Info <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">cr</span> <span class="main">(</span>of_rat <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>of_rat <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">nr</span> <span class="main">(</span>of_rat <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">count_roots_interval_rat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> root_info"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">count_roots_interval_rat</span>  <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">pp</span> <span class="main">=</span> real_of_int_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span>
    <span class="main">(</span><span class="bound">cr</span><span class="main">,</span><span class="bound">nr</span><span class="main">)</span> <span class="main">=</span> count_roots_interval <span class="bound">pp</span>
  <span class="keyword1">in</span> Root_Info <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">cr</span> <span class="main">(</span>of_rat <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>of_rat <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">nr</span> <span class="main">(</span>of_rat <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">count_roots_rat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">count_roots_rat</span>  <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>count_roots <span class="main">(</span>real_of_int_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> count_roots_interval_sf_rat<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"root_info_cond <span class="main">(</span>count_roots_interval_sf_rat <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_int_poly <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted">real_of_rat</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ri</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"count_roots_interval_sf_rat <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cr</span></span> <span class="skolem"><span class="skolem">nr</span></span> <span class="keyword2"><span class="keyword">where</span></span> cr<span class="main">:</span> <span class="quoted"><span class="quoted">"count_roots_interval_sf <span class="var">?p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cr</span><span class="main">,</span><span class="skolem">nr</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ri</span> <span class="main">=</span> Root_Info <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="skolem">cr</span> <span class="main">(</span><span class="var">?r</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span><span class="var">?r</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">nr</span> <span class="main">(</span><span class="var">?r</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> count_roots_interval_sf_rat_def Let_def cr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"root_info.l_r <span class="var">?ri</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="skolem">cr</span> <span class="main">(</span><span class="var">?r</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span><span class="var">?r</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"root_info.number_root <span class="var">?ri</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">nr</span> <span class="main">(</span><span class="var">?r</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> cr <span class="main">=</span> count_roots_interval_sf<span class="main">[</span><span class="operator">OF</span> p cr<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_info_cond_def id
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nr</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∧</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cr<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">rat</span>
    <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> ab <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">a</span> <span class="main">≤</span> <span class="var">?r</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_less_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> cr<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cr</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>Collect <span class="main">(</span>root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> split <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> of_rat_of_int_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly of_rat <span class="main">(</span>of_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> of_int_poly <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> square_free_of_int_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"square_free <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"square_free <span class="main">(</span>of_int_poly <span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_gcd<span class="main">,</span> field_char_0<span class="main">}</span> poly<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square_free <span class="main">(</span>map_poly of_rat <span class="main">(</span>of_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> poly<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> of_rat_hom.square_free_map_poly <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> square_free_int_rat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_rat_of_int_poly <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> count_roots_interval_rat<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"square_free <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"root_info_cond <span class="main">(</span>count_roots_interval_rat <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> sf <span class="keyword1"><span class="command">have</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"square_free <span class="main">(</span>real_of_int_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> square_free_of_int_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sf <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> square_free_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> count_roots_interval_sf_rat<span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> count_roots_interval_rat_def count_roots_interval_sf_rat_def 
    Let_def count_roots_interval_iff<span class="main">[</span><span class="operator">OF</span> sf<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> count_roots_rat<span class="main">:</span> <span class="quoted"><span class="quoted">"count_roots_rat <span class="free">p</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> count_roots_rat_def count_roots_correct <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Implementing Sturm on Rational Polynomials›</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">sturm_aux_rat</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sturm_aux_rat</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">::</span> rat poly<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> degree <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">]</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">#</span> <span class="free">sturm_aux_rat</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pat_completeness</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span>degree <span class="main">∘</span> snd<span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
                <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def degree_mod_less'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sturm_aux_rat<span class="main">:</span> <span class="quoted"><span class="quoted">"sturm_aux <span class="main">(</span>real_of_rat_poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>real_of_rat_poly <span class="free">q</span><span class="main">)</span> <span class="main">=</span> 
  map real_of_rat_poly <span class="main">(</span>sturm_aux_rat <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sturm_aux_rat.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> map_poly_inj_idom_hom <span class="quoted">of_rat</span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">note</span></span> deg <span class="main">=</span> of_int_hom.degree_map_poly_hom
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> sturm_aux.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real_of_rat_poly <span class="skolem">p</span>"</span></span><span class="main">]</span> sturm_aux_rat.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sturm_rat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sturm_rat</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> sturm_aux_rat <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>pderiv <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sturm_rat<span class="main">:</span> <span class="quoted"><span class="quoted">"sturm <span class="main">(</span>real_of_rat_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> map real_of_rat_poly <span class="main">(</span>sturm_rat <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sturm_rat_def sturm_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> of_rat_hom.map_poly_pderiv<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> sturm_aux_rat<span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_number_rootat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat poly <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">poly_number_rootat</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> sgn <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_neg_number_rootat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat poly <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">poly_neg_number_rootat</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> even <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="keyword1">then</span> sgn <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>
                                       <span class="keyword1">else</span> <span class="main">-</span>sgn <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_number_rootat<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_inf <span class="main">(</span>real_of_rat_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> real_of_rat <span class="main">(</span>poly_number_rootat <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_inf_def poly_number_rootat_def of_int_hom.degree_map_poly_hom of_rat_hom.coeff_map_poly_hom
    real_of_rat_sgn <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_neg_number_rootat<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_neg_inf <span class="main">(</span>real_of_rat_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> real_of_rat <span class="main">(</span>poly_neg_number_rootat <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_neg_inf_def poly_neg_number_rootat_def of_int_hom.degree_map_poly_hom of_rat_hom.coeff_map_poly_hom
    real_of_rat_sgn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sign_changes_rat</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sign_changes_rat</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>rat<span class="main">)</span> <span class="main">=</span>
    length <span class="main">(</span>remdups_adj <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sign_changes_number_rootat</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sign_changes_number_rootat</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span> 
    length <span class="main">(</span>remdups_adj <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map poly_number_rootat <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sign_changes_neg_number_rootat</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sign_changes_neg_number_rootat</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span> 
      length <span class="main">(</span>remdups_adj <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map poly_neg_number_rootat <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_of_rat_list_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"list_neq <span class="main">(</span>map real_of_rat <span class="free">xs</span><span class="main">)</span> <span class="main">0</span> 
  <span class="main">=</span> map real_of_rat <span class="main">(</span>list_neq <span class="free">xs</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> real_of_rat_remdups_adj<span class="main">:</span> <span class="quoted"><span class="quoted">"remdups_adj <span class="main">(</span>map real_of_rat <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> map real_of_rat <span class="main">(</span>remdups_adj <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> remdups_adj.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sign_changes_rat<span class="main">:</span> <span class="quoted"><span class="quoted">"sign_changes <span class="main">(</span>map real_of_rat_poly <span class="free">ps</span><span class="main">)</span> <span class="main">(</span>real_of_rat <span class="free">x</span><span class="main">)</span>
  <span class="main">=</span> sign_changes_rat <span class="free">ps</span> <span class="free">x</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> list_neq <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> length <span class="main">(</span>remdups_adj <span class="main">(</span>list_neq <span class="main">(</span>map real_of_rat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">xa</span><span class="main">.</span>  <span class="main">(</span>sgn <span class="main">(</span>poly <span class="bound">xa</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sign_changes_def real_of_rat_sgn o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_changes_rat_def real_of_rat_list_neq 
    <span class="keyword1"><span class="command">unfolding</span></span> real_of_rat_remdups_adj <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sign_changes_neg_number_rootat<span class="main">:</span> <span class="quoted"><span class="quoted">"sign_changes_neg_inf <span class="main">(</span>map real_of_rat_poly <span class="free">ps</span><span class="main">)</span>
  <span class="main">=</span>  sign_changes_neg_number_rootat <span class="free">ps</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> length <span class="main">(</span>remdups_adj <span class="main">(</span>list_neq <span class="main">(</span>map real_of_rat <span class="main">(</span>map poly_neg_number_rootat <span class="free">ps</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sign_changes_neg_inf_def o_def real_of_rat_sgn poly_neg_number_rootat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_changes_neg_number_rootat_def real_of_rat_list_neq 
    <span class="keyword1"><span class="command">unfolding</span></span> real_of_rat_remdups_adj <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sign_changes_number_rootat<span class="main">:</span> <span class="quoted"><span class="quoted">"sign_changes_inf <span class="main">(</span>map real_of_rat_poly <span class="free">ps</span><span class="main">)</span>
  <span class="main">=</span>  sign_changes_number_rootat <span class="free">ps</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> length <span class="main">(</span>remdups_adj <span class="main">(</span>list_neq <span class="main">(</span>map real_of_rat <span class="main">(</span>map poly_number_rootat <span class="free">ps</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sign_changes_inf_def
    <span class="keyword1"><span class="command">unfolding</span></span> map_map o_def real_of_rat_sgn poly_number_rootat <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_changes_number_rootat_def real_of_rat_list_neq 
    <span class="keyword1"><span class="command">unfolding</span></span> real_of_rat_remdups_adj <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> count_roots_interval_rat_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"count_roots_interval_rat <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">rp</span> <span class="main">=</span> map_poly rat_of_int <span class="free">p</span><span class="main">;</span> <span class="bound">ps</span> <span class="main">=</span> sturm_rat <span class="bound">rp</span>
    <span class="keyword1">in</span> Root_Info 
      <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> sign_changes_rat <span class="bound">ps</span> <span class="bound">a</span> <span class="main">-</span> sign_changes_rat <span class="bound">ps</span> <span class="bound">b</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="bound">rp</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span><span class="main">.</span> sign_changes_neg_number_rootat <span class="bound">ps</span> <span class="main">-</span> sign_changes_rat <span class="bound">ps</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> count_roots_interval_rat_def Let_def count_roots_interval_def split of_rat_of_int_poly<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">real</span><span class="main">]</span>
    sturm_rat sign_changes_rat 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sign_changes_neg_number_rootat<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> count_roots_rat_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"count_roots_rat <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">rp</span> <span class="main">=</span> map_poly rat_of_int <span class="free">p</span> <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> sturm_rat <span class="bound">rp</span>
    <span class="keyword1">in</span> sign_changes_neg_number_rootat <span class="bound">ps</span> <span class="main">-</span> sign_changes_number_rootat <span class="bound">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> count_roots_rat_def Let_def sturm_rat count_roots_code of_rat_of_int_poly<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">real</span><span class="main">]</span>
    sign_changes_neg_number_rootat sign_changes_number_rootat
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> count_roots_interval_sf_rat

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally we provide an even more efficient implementation which
  avoids the "poly p x = 0" test, but it is restricted to irreducible polynomials.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">root_info</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> root_info"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">root_info</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> degree <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> 
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">x</span> <span class="main">=</span> Rat.Fract <span class="main">(</span><span class="main">-</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">1</span><span class="main">)</span>
     <span class="keyword1">in</span> Root_Info <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">l</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">r</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>  <span class="main">(</span><span class="main">λ</span> <span class="bound">b</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">b</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> 
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">rp</span> <span class="main">=</span> map_poly rat_of_int <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span> <span class="bound">ps</span> <span class="main">=</span> sturm_rat <span class="bound">rp</span> <span class="keyword1">in</span> 
   Root_Info <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> sign_changes_rat <span class="bound">ps</span> <span class="bound">a</span> <span class="main">-</span> sign_changes_rat <span class="bound">ps</span> <span class="bound">b</span><span class="main">)</span>
      <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span><span class="main">.</span> sign_changes_neg_number_rootat <span class="bound">ps</span> <span class="main">-</span> sign_changes_rat <span class="bound">ps</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> root_info<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"root_info_cond <span class="main">(</span>root_info <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> deg<span class="main">:</span> True
  <span class="keyword1"><span class="command">from</span></span> degree1_coeffs<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> deg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>real_of_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> roots1<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">unfolded</span> roots1_def<span class="main">]</span> p
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ipoly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">/</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> idd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> real_of_rat <span class="skolem">aa</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span>
                 <span class="bound">x</span> <span class="main">≤</span> real_of_rat <span class="skolem">ba</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> real_of_int <span class="main">(</span><span class="main">-</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="skolem">a</span><span class="main">}</span> 
   <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> real_of_rat <span class="skolem">aa</span> <span class="main">≤</span> real_of_int <span class="main">(</span><span class="main">-</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="skolem">a</span> <span class="main">∧</span>
                 real_of_int <span class="main">(</span><span class="main">-</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="skolem">a</span> <span class="main">≤</span> real_of_rat <span class="skolem">ba</span> <span class="keyword1">then</span> <span class="main">{</span>real_of_int <span class="main">(</span><span class="main">-</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="skolem">a</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">aa</span> <span class="skolem">ba</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> iddd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> real_of_rat <span class="skolem">aa</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> real_of_int <span class="main">(</span><span class="main">-</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="skolem">a</span><span class="main">}</span>
    <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> real_of_int <span class="main">(</span><span class="main">-</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="skolem">a</span> <span class="main">≤</span> real_of_rat <span class="skolem">aa</span> <span class="keyword1">then</span> <span class="main">{</span>real_of_int <span class="main">(</span><span class="main">-</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="skolem">a</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">aa</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> id4<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">x</span> <span class="main">=</span> real_of_rat <span class="main">(</span>rat_of_int <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_info_def deg <span class="keyword1"><span class="command">unfolding</span></span> root_info_cond_def id root_cond_def split
    <span class="keyword1"><span class="command">unfolding</span></span> p Fract_of_int_quotient Let_def idd iddd 
    <span class="keyword1"><span class="command">unfolding</span></span> id4 of_rat_divide<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> of_rat_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> irr_d<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deg irr irreducible_connect_rev<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_int_rat<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>of_int_poly <span class="free">p</span> <span class="main">::</span> rat poly<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> irreducible_root_free<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> idd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="main">(</span>of_int_poly <span class="free">p</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">rat</span>
    <span class="keyword1"><span class="command">unfolding</span></span> root_free_def <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"root_info <span class="free">p</span> <span class="main">=</span> count_roots_interval_rat <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> root_info_def if_False count_roots_interval_rat_code Let_def idd <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> count_roots_interval_rat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> irreducible<span class="hidden">⇩</span><sub>d</sub>_square_free<span class="main"><span class="main">[</span></span><span class="operator">OF</span> irr_d<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Factors_of_Int_Poly">
<div class="head">
<h1>Theory Factors_of_Int_Poly</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Getting Small Representative Polynomials via Factorization›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this theory we import a factorization algorithm for 
  integer polynomials to turn a representing polynomial of some algebraic number into
  a list of irreducible polynomials where exactly one list element
  represents the same number. Moreover, we prove
  that the certain polynomial operations preserve irreducibility, so that
  no factorization is required.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Factors_of_Int_Poly
  <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../Berlekamp_Zassenhaus/Factorize_Int_Poly.html">Berlekamp_Zassenhaus.Factorize_Int_Poly</a>
  <a href="Algebraic_Numbers_Prelim.html">Algebraic_Numbers_Prelim</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> degree_of_gcd<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>gcd <span class="free">q</span> <span class="free">r</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟷</span>
 degree <span class="main">(</span>gcd <span class="main">(</span>of_int_poly <span class="free">q</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span> poly<span class="main">)</span> <span class="main">(</span>of_int_poly <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_rat <span class="main">::</span> rat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> rpoly<span class="main">:</span> field_hom' <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_add of_rat_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">p</span> <span class="main">=</span> map_poly <span class="main">(</span><span class="var">?r</span> <span class="keyword1">o</span> of_int<span class="main">)</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> o_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> map_poly <span class="var">?r</span> <span class="main">(</span>map_poly of_int <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int_poly <span class="skolem">p</span> <span class="main">=</span> map_poly <span class="var">?r</span> <span class="main">(</span>map_poly of_int <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> id <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcd_rat_to_gcd_int<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">factors_of_int_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> int poly list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">factors_of_int_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> map <span class="main">(</span>abs_int_poly <span class="keyword1">o</span> fst<span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>factorize_int_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> factors_of_int_poly_const<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"factors_of_int_poly <span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> degree0_coeffs<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span> <span class="skolem">a</span> <span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p factors_of_int_poly_def
    factorize_int_poly_generic_def x_split_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def factorize_int_last_nz_poly_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> factors_of_int_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">rp</span> <span class="main">≡</span> ipoly <span class="main">::</span> int poly <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_gcd<span class="main">,</span>field_char_0<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"factors_of_int_poly <span class="free">p</span> <span class="main">=</span> <span class="free">qs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="free">qs</span> <span class="main">⟹</span> irreducible <span class="bound">q</span> <span class="main">∧</span> lead_coeff <span class="bound">q</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> degree <span class="bound">q</span> <span class="main">≤</span> degree <span class="free">p</span> <span class="main">∧</span> degree <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">rp</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="free">rp</span> <span class="bound">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">rp</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∃!</span> <span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="free">rp</span> <span class="bound">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"distinct <span class="free">qs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">qis</span></span> <span class="keyword2"><span class="keyword">where</span></span> factt<span class="main">:</span> <span class="quoted"><span class="quoted">"factorize_int_poly <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">qis</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> factors_of_int_poly_def factt<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> qs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">qs</span> <span class="main">=</span> map <span class="main">(</span>abs_int_poly <span class="main">∘</span> fst<span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">qis</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> fact <span class="main">=</span> factorize_int_poly<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> factt<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> fact_mem <span class="main">=</span> factorize_int_poly<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> factt<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> sqf<span class="main">:</span> <span class="quoted"><span class="quoted">"square_free_factorization <span class="free">p</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">qis</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fact<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> sff <span class="main">=</span> square_free_factorizationD<span class="main">[</span><span class="operator">OF</span> sqf<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> sff'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Polynomial.smult <span class="skolem">c</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span> <span class="skolem">qis</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sff<span class="main">(</span>1<span class="main">)</span> prod.distinct_set_conv_list<span class="main">[</span><span class="operator">OF</span> sff<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">assume</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> qi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qis</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> abs_int_poly <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> split_list<span class="main">[</span><span class="operator">OF</span> qi<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qis1</span></span> <span class="skolem"><span class="skolem">qis2</span></span> <span class="keyword2"><span class="keyword">where</span></span> qis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qis</span> <span class="main">=</span> <span class="skolem">qis1</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">qis2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sff' qis dvd_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"smult <span class="skolem"><span class="skolem"><span class="skolem">c</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">r</span></span></span> <span class="main"><span class="main"><span class="main">^</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">i</span></span></span> <span class="main"><span class="main"><span class="main">*</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">∏</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">a</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">←</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">qis1</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span>  <span class="skolem"><span class="skolem"><span class="skolem">qis2</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">a</span></span></span> <span class="main"><span class="main"><span class="main">^</span></span></span> Suc <span class="bound"><span class="bound"><span class="bound">i</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> fact_mem<span class="main">[</span><span class="operator">OF</span> qi<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> r0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> qi factt <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> dvd <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">≤</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_imp_degree_le<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> fact_mem<span class="main">[</span><span class="operator">OF</span> qi<span class="main">]</span> r0
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">q</span> <span class="main">∧</span> lead_coeff <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> degree <span class="skolem">q</span> <span class="main">≤</span> degree <span class="free">p</span> <span class="main">∧</span> degree <span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> qr lead_coeff_abs_int_poly <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">qs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> distinct_conv_nth
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">qs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">qis</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="skolem">qis</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">qs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> abs_int_poly <span class="main">(</span>fst <span class="main">(</span><span class="skolem">qis</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">qs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> abs_int_poly <span class="main">(</span>fst <span class="main">(</span><span class="skolem">qis</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qi</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> qi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qis</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">qi</span><span class="main">,</span> <span class="skolem">I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qj</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> qj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qis</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">qj</span><span class="main">,</span> <span class="skolem">J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> sff<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> distinct_conv_nth<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> ij diff<span class="main">]</span> qi qj
    <span class="keyword1"><span class="command">have</span></span> diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">qi</span><span class="main">,</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">qj</span><span class="main">,</span> <span class="skolem">J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ij qi qj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">qi</span><span class="main">,</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qis</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">qj</span><span class="main">,</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qis</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> sff<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this diff<span class="main">]</span> sff<span class="main">(</span>2<span class="main">)</span> this
    <span class="keyword1"><span class="command">have</span></span> cop<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">qi</span> <span class="skolem">qj</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">qi</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">qj</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> i <span class="main">=</span> cf_pos_poly_main<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">qi</span></span><span class="main">,</span> <span class="operator">unfolded</span> smult_prod monom_0<span class="main">]</span>
    <span class="keyword1"><span class="command">note</span></span> j <span class="main">=</span> cf_pos_poly_main<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">qj</span></span><span class="main">,</span> <span class="operator">unfolded</span> smult_prod monom_0<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> cop<span class="main">(</span>2<span class="main">)</span> i <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">qs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> id qi<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> cop<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="free">qs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">qs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> id qi qj fst_conv
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> coprime_prod<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[:</span></span>sgn <span class="main"><span class="main">(</span></span>lead_coeff <span class="skolem"><span class="skolem">qi</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">:]</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[:</span></span>sgn <span class="main"><span class="main">(</span></span>lead_coeff <span class="skolem"><span class="skolem">qj</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">:]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> cop
      <span class="keyword1"><span class="command">unfolding</span></span> i j <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_eq_0_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">qs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="free">qs</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">qs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">qs</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>gcd <span class="main">(</span><span class="free">qs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">qs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> degree <span class="main">(</span><span class="free">qs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> deg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> cop <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> fact<span class="main">(</span>1<span class="main">)</span> p <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sff<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_int <span class="main">::</span> int <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly <span class="var">?r</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> rp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">p</span><span class="main">.</span> <span class="free">rp</span> <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="main">(</span><span class="var">?rp</span> <span class="bound">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rp_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">rp</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">rp</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="skolem">qis</span><span class="main">.</span> <span class="bound">x</span> <span class="main">^</span> Suc <span class="bound">y</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sff'<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> rp <span class="dynamic"><span class="dynamic">hom_distribs</span></span> <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">∈</span>set <span class="skolem">qis</span><span class="main">.</span> poly <span class="main">(</span><span class="var">?rp</span> <span class="main">(</span><span class="bound">q</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> qs rp of_int_poly_hom.hom_prod_list poly_prod_list_zero_iff set_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">∈</span>set <span class="skolem">qis</span><span class="main">.</span> poly <span class="main">(</span><span class="var">?rp</span> <span class="bound">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> of_int_poly_hom.hom_power poly_power_zero_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">q</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="skolem">qis</span><span class="main">.</span> poly <span class="main">(</span><span class="var">?rp</span> <span class="bound">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="free">rp</span> <span class="bound">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rp qs snd_conv o_def bex_simps set_map
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rp</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="free">rp</span> <span class="bound">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">rp</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> iff <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rtq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rp</span> <span class="skolem">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> qi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q'</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qis</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> abs_int_poly <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="free">rp</span> <span class="bound">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ex1I<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> q<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> rtq<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rtr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rp</span> <span class="skolem">r</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> rj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r'</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">qis</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> abs_int_poly <span class="skolem">r'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> rtr rtq <span class="keyword1"><span class="command">have</span></span> rtr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rp</span> <span class="skolem">r'</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rtq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rp</span> <span class="skolem">q'</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rp rr' qq' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> rtr rtq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="var">?rp</span> <span class="skolem">q'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="var">?rp</span> <span class="skolem">r'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rp
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_eq_0_iff_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> gcd <span class="main">(</span><span class="var">?rp</span> <span class="skolem">q'</span><span class="main">)</span> <span class="main">(</span><span class="var">?rp</span> <span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="var">?rp</span> <span class="skolem">q'</span><span class="main">)</span> <span class="main">(</span><span class="var">?rp</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> degree <span class="main">(</span>gcd <span class="main">(</span><span class="var">?rp</span> <span class="skolem">q'</span><span class="main">)</span> <span class="main">(</span><span class="var">?rp</span> <span class="skolem">r'</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_unit_gcd_iff is_unit_iff_degree is_unit_pCons_iff one_poly_eq_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gcd <span class="skolem">q'</span> <span class="skolem">r'</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> degree <span class="main">(</span>gcd <span class="skolem">q'</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> gcd_eq_0_iff degree_of_gcd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q'</span></span> <span class="quoted"><span class="skolem">r'</span></span><span class="main">,</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> coprime <span class="skolem">q'</span> <span class="skolem">r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> sff<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> qi rj<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> <span class="skolem">r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rr' qq' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> factors_int_poly_represents<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span>field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span>factors_of_int_poly <span class="free">p</span><span class="main">)</span><span class="main">.</span>
    <span class="bound">q</span> <span class="keyword1">represents</span> <span class="free">x</span> <span class="main">∧</span> irreducible <span class="bound">q</span> <span class="main">∧</span> lead_coeff <span class="bound">q</span> <span class="main">&gt;</span> <span class="main">0</span>  <span class="main">∧</span> degree <span class="bound">q</span> <span class="main">≤</span> degree <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> representsD<span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> fact <span class="main">=</span> factors_of_int_poly<span class="main">[</span><span class="operator">OF</span> refl<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> fact<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> p<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> rt <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span>factors_of_int_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> fact<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> q<span class="main">]</span> rt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ q<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> represents_def irreducible_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> irreducible_represents_imp_degree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span>field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">f</span> <span class="main">≤</span> degree <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> factors_of_int_poly<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> refl<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> factors_of_int_poly<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> refl<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
     assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">h</span> <span class="main">≤</span> degree <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?af</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"abs_int_poly <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ah</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"abs_int_poly <span class="skolem">h</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> af<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="var">?af</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?af</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="var">?af</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> ah<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="var">?ah</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ah</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="var">?ah</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> algebraic_imp_represents_unique<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> af ah <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?af</span> <span class="main">=</span> <span class="var">?ah</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> algebraic_iff_represents <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> id<span class="main">,</span> <span class="operator">of</span> <span class="quoted">degree</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹degree <span class="skolem">h</span> <span class="main">≤</span> degree <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> irreducible_preservation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span>field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">represents</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≥</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="keyword1">represents</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="bound">q</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="free">x</span> <span class="main">∧</span> degree <span class="main">(</span><span class="free">f</span> <span class="bound">q</span><span class="main">)</span> <span class="main">≤</span> degree <span class="bound">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> pr<span class="main">:</span> <span class="quoted"><span class="quoted">"primitive <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span> <span class="main">=</span> abs_int_poly <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> dp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> represents_degree<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> dq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> represents_degree<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> dp <span class="keyword1"><span class="command">have</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x deg irr p0
  <span class="keyword1"><span class="command">have</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">pp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">pp</span> <span class="main">≥</span> degree <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cf_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">pp</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pp_def lead_coeff_abs_int_poly <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> representsI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> ax<span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> algebraic_altdef_ipoly represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this irreducible_connect_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> pr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this dq <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    r<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> degree <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">*</span> <span class="skolem">rr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">=</span> degree <span class="skolem">r</span> <span class="main">+</span> degree <span class="skolem">rr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dq <span class="keyword1"><span class="command">unfolding</span></span> q
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> r <span class="keyword1"><span class="command">have</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">rr</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">rr</span> <span class="main">&lt;</span> degree <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> representsD<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> y<span class="main">,</span> <span class="operator">unfolded</span> q <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">r</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> ipoly <span class="skolem">rr</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> r rr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">represents</span> <span class="free">y</span> <span class="main">∨</span> <span class="skolem">rr</span> <span class="keyword1">represents</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> r rr <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">represents</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> degree <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> f<span class="main">[</span><span class="operator">OF</span> r<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> deg r<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> degree <span class="skolem">pp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> factors_int_poly_represents<span class="main">[</span><span class="operator">OF</span> r<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> r<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> degree <span class="skolem">pp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> algebraic_imp_represents_unique<span class="main">[</span><span class="operator">OF</span> ax<span class="main">]</span> r irr cf_pos x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">pp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> deg <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">declare</span></span> irreducible_const_poly_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_uminus_irreducible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span><span class="free">p</span> <span class="main">::</span> int poly<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>poly_uminus <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> deg_nonzero_represents<span class="main">[</span><span class="operator">OF</span> deg<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> represents_uminus<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_uminus <span class="free">p</span> <span class="keyword1">represents</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> irreducible_preservation<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p x y<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> deg irreducible_imp_primitive<span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"primitive <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"primitive <span class="main">(</span>poly_uminus <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">represents</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> represents_uminus<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_uminus <span class="skolem">q</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_uminus <span class="skolem">q</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="skolem">x</span> <span class="main">∧</span> degree <span class="main">(</span>poly_uminus <span class="skolem">q</span><span class="main">)</span> <span class="main">≤</span> degree <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reflect_poly_irreducible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span>field_gcd<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>reflect_poly <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> represents_inverse<span class="main">[</span><span class="operator">OF</span> x0 x<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reflect_poly <span class="free">p</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> x0 <span class="keyword1"><span class="command">have</span></span> ix0<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> irreducible_preservation<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p x y<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> x irreducible_imp_primitive<span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"primitive <span class="main">(</span>reflect_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> content_reflect_poly<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">represents</span> <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> represents_inverse<span class="main">[</span><span class="operator">OF</span> ix0 this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reflect_poly <span class="skolem">q</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> degree_reflect_poly_le
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reflect_poly <span class="skolem">q</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="free">x</span> <span class="main">∧</span> degree <span class="main">(</span>reflect_poly <span class="skolem">q</span><span class="main">)</span> <span class="main">≤</span> degree <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> p<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_reflect_poly_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_add_rat_irreducible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>cf_pos_poly <span class="main">(</span>poly_add_rat <span class="free">r</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> deg_nonzero_represents<span class="main">[</span><span class="operator">OF</span> deg<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> represents_add_rat<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"cf_pos_poly <span class="main">(</span>poly_add_rat <span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span>of_rat <span class="free">r</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> irreducible_preservation<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p x y<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">represents</span> <span class="main">(</span>of_rat <span class="free">r</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> represents_add_rat<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">r</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_add_rat <span class="main">(</span><span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_minus<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_add_rat <span class="main">(</span><span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="skolem">x</span> <span class="main">∧</span> degree <span class="main">(</span>poly_add_rat <span class="main">(</span><span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">≤</span> degree <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> p<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_mult_rat_irreducible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>cf_pos_poly <span class="main">(</span>poly_mult_rat <span class="free">r</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> deg_nonzero_represents<span class="main">[</span><span class="operator">OF</span> deg<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> represents_mult_rat<span class="main">[</span><span class="operator">OF</span> r x<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"cf_pos_poly <span class="main">(</span>poly_mult_rat <span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span>of_rat <span class="free">r</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> irreducible_preservation<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p x y<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> r<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
    <span class="keyword1"><span class="command">from</span></span> r <span class="keyword1"><span class="command">have</span></span> r'<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">represents</span> <span class="main">(</span>of_rat <span class="free">r</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> represents_mult_rat<span class="main">[</span><span class="operator">OF</span> r' this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_mult_rat <span class="main">(</span>inverse <span class="free">r</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_divide <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly_mult_rat <span class="main">(</span>inverse <span class="free">r</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="skolem">x</span> <span class="main">∧</span> degree <span class="main">(</span>poly_mult_rat <span class="main">(</span>inverse <span class="free">r</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">≤</span> degree <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> p r<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> coeff_lift_hom<span class="main">:</span>
  factor_preserving_hom <span class="quoted"><span class="quoted">"coeff_lift <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">}</span> <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>



<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Real_Algebraic_Numbers">
<div class="head">
<h1>Theory Real_Algebraic_Numbers</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      Sebastiaan Joosten
                 René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Real Algebraic Numbers›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Whereas we previously only proved the closure properties of algebraic numbers, this
  theory adds the numeric computations that are required to separate the roots, and to
  pick unique representatives of algebraic numbers. 

  The development is split into three major parts. First, an ambiguous representation of 
  algebraic numbers is used, afterwards another layer is used with special treatment of rational numbers
  which still does not admit unique representatives, and finally, a quotient type is created modulo 
  the equivalence.
  
  The theory also contains a code-setup to implement real numbers via real algebraic numbers.›</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The results are taken from the textbook \cite[pages 329ff]{AlgNumbers}.›</span></span>


<span class="keyword1"><span class="command">theory</span></span> Real_Algebraic_Numbers
<span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="../Abstract-Rewriting/SN_Order_Carrier.html">Abstract-Rewriting.SN_Order_Carrier</a>"</span>
  <a href="../Deriving/Compare_Rat.html">Deriving.Compare_Rat</a>
  <a href="../Deriving/Compare_Real.html">Deriving.Compare_Real</a>
  <a href="../Jordan_Normal_Form/Gauss_Jordan_IArray_Impl.html">Jordan_Normal_Form.Gauss_Jordan_IArray_Impl</a>
  <a href="Algebraic_Numbers.html">Algebraic_Numbers</a>
  <a href="Sturm_Rat.html">Sturm_Rat</a>
  <a href="Factors_of_Int_Poly.html">Factors_of_Int_Poly</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For algebraic numbers, it turned out that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> gcd_int_poly<span class="antiquote"><span class="antiquote">}</span></span></span></span> is not
  preferable to the default implementation of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> gcd<span class="antiquote"><span class="antiquote">}</span></span></span></span>, which just implements
  Collin's primitive remainder sequence.›</span></span>
<span class="keyword1"><span class="command">declare</span></span> gcd_int_poly_code<span class="main">[</span><span class="operator">code_unfold</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="comment1">(*TODO: move *)</span>
<span class="keyword1"><span class="command">lemma</span></span> ex1_imp_Collect_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="free">x</span> <span class="main">⟷</span> Collect <span class="free">P</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> iffI conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> conj_imp_eq_imp_imp<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Ex1 <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Collect <span class="free">P</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> Px<span class="main">:</span> <span class="quoted"><span class="quoted">"Collect <span class="free">P</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ex1 <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Px <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ex1_Collect_singleton<span class="main">[</span><span class="operator">consumes</span> 2<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Collect <span class="free">P</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> ex1_imp_Collect_singleton<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ex1_iff_Collect_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> Collect <span class="free">P</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ex1_imp_Collect_singleton<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> bij_imp_ex1_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃!</span><span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> l <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> Collect <span class="main">(</span><span class="free">P</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Hilbert_Choice.inv <span class="free">f</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_image_Collect_eq<span class="main">[</span><span class="operator">OF</span> bij<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Hilbert_Choice.inv <span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bij bij_inv_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Collect <span class="free">P</span> <span class="main">=</span> <span class="main">{</span><span class="free">f</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> ex1_imp_Collect_singleton<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">y</span><span class="main">}</span> <span class="main">=</span> Collect <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_Choice.inv <span class="free">f</span> <span class="main">`</span> <span class="main">…</span> <span class="main">=</span> Collect <span class="main">(</span><span class="free">P</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_image_Collect_eq<span class="main">[</span><span class="operator">OF</span> bij_imp_bij_inv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bij<span class="main"><span class="main">]</span></span><span class="main">]</span> bij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inv_inv_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Collect <span class="main">(</span><span class="free">P</span> <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>Hilbert_Choice.inv <span class="free">f</span> <span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> ex1_imp_Collect_singleton<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_ex1_imp_the_shift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ex1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Hilbert_Choice.inv <span class="free">f</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ex1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> the1I2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ex1<span class="main">[</span><span class="operator">folded</span> bij_imp_ex1_iff<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> the1I2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ex1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Hilbert_Choice.inv <span class="free">f</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_is_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_imp_Collect_image<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> Hilbert_Choice.inv <span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?g</span> <span class="main">`</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?g</span> <span class="main">`</span> <span class="free">f</span> <span class="main">`</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_comp inv_o_cancel<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bij_is_inj<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> bij<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="var">?l</span> <span class="main">=</span> <span class="main">{</span><span class="free">f</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij bij_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_imp_card_image<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> card <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij bij_iff card.infinite finite_imageD inj_onI inj_on_iff_eq_card<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_imp_card<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> bij_imp_Collect_image<span class="main">[</span><span class="operator">OF</span> bij<span class="main">]</span> bij_imp_card_image<span class="main">[</span><span class="operator">OF</span> bij_imp_bij_inv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bij<span class="main"><span class="main">]</span></span><span class="main">]</span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_add<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> group_add<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?g1</span></span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> bij_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?g2</span></span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> inv_add<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Hilbert_Choice.inv <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?g3</span></span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> inv_minus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Hilbert_Choice.inv <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?g4</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> id"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> o_bij<span class="main">[</span><span class="operator">OF</span> 1 2<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?g1</span></span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> o_bij<span class="main">[</span><span class="operator">OF</span> 2 1<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?g2</span></span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> inv_unique_comp<span class="main">[</span><span class="operator">OF</span> 2 1<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?g3</span></span></span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> inv_unique_comp<span class="main">[</span><span class="operator">OF</span> 1 2<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?g4</span></span></span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> ex1_shift<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> bij_imp_ex1_iff<span class="main">[</span><span class="operator">OF</span> bij_add<span class="main">]</span> bij_imp_ex1_iff<span class="main">[</span><span class="operator">OF</span> bij_minus<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> ex1_the_shift<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ex1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">y</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> group_add<span class="main">.</span> <span class="free">P</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bij_ex1_imp_the_shift<span class="main">[</span><span class="operator">OF</span> bij_add ex1<span class="main">]</span> bij_ex1_imp_the_shift<span class="main">[</span><span class="operator">OF</span> bij_minus ex1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> card_shift_image<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> group_add<span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> card <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">d</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> card <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_imp_card_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bij_add<span class="main"><span class="main">]</span></span> bij_imp_card_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bij_minus<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> irreducible_root_free<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span>comm_ring_1<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"root_free <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>nat"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> greater
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> dvdE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_dvd_1<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> greater <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_mult_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> deg<span class="main">,</span> <span class="operator">folded</span> p<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">r</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_dvd_1<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> p irr irreducibleD<span class="main">[</span><span class="operator">OF</span> irr p<span class="main">]</span> dvd <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_free_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> less <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> deg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p0</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">p0</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree0_coeffs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> irr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> root_free_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> root_free_def<span class="main">)</span>


<span class="comment1">(* **************************************************************** *)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Real Algebraic Numbers -- Innermost Layer›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We represent a real algebraic number <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>α›</span></span></span></span> by a tuple (p,l,r):
    <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>α›</span></span></span></span> is the unique root in the interval [l,r]
    and l and r have the same sign. We always assume that p is normalized, i.e.,
    p is the unique irreducible and positive content-free polynomial 
    which represents the algebraic number.

  This representation clearly admits duplicate representations for the same number, e.g.
  (...,x-3, 3,3) is equivalent to (...,x-3,2,10).›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Definitions›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> real_alg_1 <span class="main">=</span> <span class="quoted"><span class="quoted">"int poly <span class="main">×</span> rat <span class="main">×</span> rat"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">poly_real_alg_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly_real_alg_1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rai_ub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rai_ub</span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rai_lb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rai_lb</span> <span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">roots_below</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">y</span> <span class="main">::</span> real<span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> ipoly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span><span class="main">(</span>input<span class="main">)</span> <span class="entity">unique_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unique_root</span> <span class="free"><span class="bound"><span class="entity">plr</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃!</span> <span class="bound">x</span><span class="main">.</span> root_cond <span class="free"><span class="bound"><span class="entity">plr</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">the_unique_root</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">the_unique_root</span> <span class="free"><span class="bound"><span class="entity">plr</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> root_cond <span class="free"><span class="bound"><span class="entity">plr</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">real_of_1</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">real_of_1</span> <span class="main">≡</span> the_unique_root"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> root_condI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="main">(</span>rai_lb <span class="free">plr</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> of_rat <span class="main">(</span>rai_ub <span class="free">plr</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span>poly_real_alg_1 <span class="free">plr</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="free">plr</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> root_cond_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> root_condE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="free">plr</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="main">(</span>rai_lb <span class="free">plr</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> of_rat <span class="main">(</span>rai_ub <span class="free">plr</span><span class="main">)</span> <span class="main">⟹</span> ipoly <span class="main">(</span>poly_real_alg_1 <span class="free">plr</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> root_cond_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="free">plr</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≡</span> the_unique_root <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≡</span> poly_real_alg_1 <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≡</span> rai_lb <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≡</span> rai_ub <span class="free">plr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> unique_rootD<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="free">l</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> of_rat <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="free">plr</span> <span class="free">x</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟷</span> root_cond <span class="free">plr</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟷</span> root_cond <span class="free">plr</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> the_unique_root_eqI<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="free">plr</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="free">plr</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ur <span class="keyword3"><span class="command">show</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="free">plr</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> theI'<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">plr</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">plr</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_def l_def r_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> x<span class="main">[</span><span class="operator">unfolded</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="free">l</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> of_rat <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x ur
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="free">plr</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="free">plr</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟷</span> root_cond <span class="free">plr</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟷</span> root_cond <span class="free">plr</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unique_rootE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="free">plr</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≡</span> the_unique_root <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≡</span> poly_real_alg_1 <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≡</span> rai_lb <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≡</span> rai_ub <span class="free">plr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="free">l</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> of_rat <span class="free">r</span> <span class="main">⟹</span> ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> root_cond <span class="free">plr</span> <span class="free">x</span> <span class="main">⟹</span>
        <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">⟷</span> root_cond <span class="free">plr</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟷</span> root_cond <span class="free">plr</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> main<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> x_def p_def l_def r_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> unique_rootD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ur<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> unique_rootI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">y</span><span class="main">.</span> root_cond <span class="free">plr</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="free">plr</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="free">plr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_cond</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>lead_coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> irreducible <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_condI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_cond_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_condD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"root_free <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"square_free <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> poly_cond_def <span class="keyword1"><span class="command">using</span></span> irreducible_root_free irreducible_imp_square_free cf_pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_condE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span> <span class="main">⟹</span> lead_coeff <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> root_free <span class="free">p</span> <span class="main">⟹</span> square_free <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>poly_condD<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">invariant_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">invariant_1</span> <span class="free"><span class="bound"><span class="entity">tup</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">tup</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">⇒</span>
    unique_root <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∧</span> sgn <span class="bound">l</span> <span class="main">=</span> sgn <span class="bound">r</span> <span class="main">∧</span> poly_cond <span class="bound">p</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> invariant_1I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>rai_lb <span class="free">plr</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>rai_ub <span class="free">plr</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_cond <span class="main">(</span>poly_real_alg_1 <span class="free">plr</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">plr</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> invariant_1_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">plr</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≡</span> the_unique_root <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≡</span> poly_real_alg_1 <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≡</span> rai_lb <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≡</span> rai_ub <span class="free">plr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> invariant_1D<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="free">plr</span> <span class="free">x</span>"</span></span>
    <span class="quoted"><span class="quoted">"sgn <span class="free">l</span> <span class="main">=</span> sgn <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">x</span> <span class="main">=</span> of_rat <span class="main">(</span>sgn <span class="free">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="free">plr</span>"</span></span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"primitive <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> invariant_1_root_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">y</span><span class="main">.</span> root_cond <span class="free">plr</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_rat <span class="free">l</span> <span class="main">::</span> real"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_rat <span class="free">r</span> <span class="main">::</span> real"</span></span>
  <span class="keyword1"><span class="command">have</span></span> plr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">plr</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">plr</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_def l_def r_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="free">l</span> <span class="main">=</span> sgn <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pc<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> invariant_1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ur <span class="keyword3"><span class="command">show</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="free">plr</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_def plr <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> theI'<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> plr<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">x</span> <span class="main">=</span> of_rat <span class="main">(</span>sgn <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>linorder_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> less
    <span class="keyword1"><span class="command">with</span></span> bnd<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> equal
    <span class="keyword1"><span class="command">with</span></span> bnd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹sgn <span class="free">l</span> <span class="main">=</span> sgn <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> rc<span class="main">[</span><span class="operator">unfolded</span> plr<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> greater
    <span class="keyword1"><span class="command">with</span></span> bnd<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹sgn <span class="free">l</span> <span class="main">=</span> sgn <span class="free">r</span>›</span></span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> greater <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> the_unique_root_eqI<span class="main">[</span><span class="operator">OF</span> ur<span class="main">]</span> rc
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">y</span><span class="main">.</span> root_cond <span class="free">plr</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> poly_zero<span class="main">[</span><span class="operator">OF</span> x<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> sgn bnd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> pc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> pc <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"primitive <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> irreducible_imp_primitive<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> invariant_1E<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">plr</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≡</span> the_unique_root <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≡</span> poly_real_alg_1 <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≡</span> rai_lb <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≡</span> rai_ub <span class="free">plr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="free">plr</span> <span class="free">x</span> <span class="main">⟹</span>
      sgn <span class="free">l</span> <span class="main">=</span> sgn <span class="free">r</span> <span class="main">⟹</span> sgn <span class="free">x</span> <span class="main">=</span> of_rat <span class="main">(</span>sgn <span class="free">r</span><span class="main">)</span> <span class="main">⟹</span> unique_root <span class="free">plr</span> <span class="main">⟹</span> poly_cond <span class="free">p</span> <span class="main">⟹</span> degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span>
      primitive <span class="free">p</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> main<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> x_def p_def l_def r_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> invariant_1D<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> invariant_1_realI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">plr</span> <span class="main">::</span> <span class="quoted">real_alg_1</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≡</span> poly_real_alg_1 <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≡</span> rai_lb <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≡</span> rai_ub <span class="free">plr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="free">plr</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">l</span> <span class="main">=</span> sgn <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="free">plr</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">plr</span> <span class="main">∧</span> real_of_1 <span class="free">plr</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> the_unique_root_eqI<span class="main">[</span><span class="operator">OF</span> ur x<span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">plr</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> invariant_1I<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> real_of_1_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_0_0<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> invariant_1_pos<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">r</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">r</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> invariant_1_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="free">l</span> <span class="main">=</span> sgn <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> unique_rootD<span class="main">(</span>1-2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ur<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="free">l</span> <span class="main">≤</span> <span class="var">?x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">≤</span> <span class="var">?r</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> rc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>rat"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>linorder_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> greater
    <span class="keyword1"><span class="command">with</span></span> sgn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">l</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> l0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_1_pos<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">with</span></span> greater l0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> equal
    <span class="keyword1"><span class="command">with</span></span> real_of_1_0<span class="main">[</span><span class="operator">OF</span> rc<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> less
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> le<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">with</span></span> less sgn <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_1_neg<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">invariant_1_2</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">invariant_1_2</span> <span class="free"><span class="bound"><span class="entity">rai</span></span></span> <span class="main">≡</span> invariant_1 <span class="free"><span class="bound"><span class="entity">rai</span></span></span> <span class="main">∧</span> degree <span class="main">(</span>poly_real_alg_1 <span class="free"><span class="bound"><span class="entity">rai</span></span></span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_cond2</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly_cond2</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> poly_cond <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> degree <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_cond2I<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">p</span> <span class="main">⟹</span> degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> poly_cond2 <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_cond2_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_cond2D<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_cond2_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_cond2E<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">p</span> <span class="main">⟹</span> degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_cond2_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> invariant_1_2_poly_cond2<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">rai</span> <span class="main">⟹</span> poly_cond2 <span class="main">(</span>poly_real_alg_1 <span class="free">rai</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invariant_1_def invariant_1_2_def poly_cond2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> invariant_1_2I<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">rai</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_real_alg_1 <span class="free">rai</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">rai</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> invariant_1_2_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> invariant_1_2E<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">rai</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">rai</span> <span class="main">⟹</span> degree <span class="main">(</span>poly_real_alg_1 <span class="free">rai</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> invariant_1_2_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> invariant_1_2_realI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">plr</span> <span class="main">::</span> <span class="quoted">real_alg_1</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≡</span> poly_real_alg_1 <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≡</span> rai_lb <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≡</span> rai_ub <span class="free">plr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="free">plr</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="free">l</span> <span class="main">=</span> sgn <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">plr</span> <span class="main">∧</span> real_of_1 <span class="free">plr</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> invariant_1_realI<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> p sgn ur <span class="keyword1"><span class="command">unfolding</span></span> p_def l_def r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Real Algebraic Numbers = Rational + Irrational Real Algebraic Numbers›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the next representation of real algebraic numbers, we distinguish between
  rational and irrational numbers. The advantage is that whenever we only work on
  rational numbers, there is not much overhead involved in comparison to the 
  existing implementation of real numbers which just supports the rational numbers.
  For irrational numbers we additionally store the number of the root, counting from
  left to right. For instance $-\sqrt{2}$ and $\sqrt{2}$ would be root number 1 and 2
  of $x^2 - 2$.›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions and Algorithms on Raw Type›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> real_alg_2 <span class="main">=</span> Rational <span class="quoted">rat</span> <span class="main">|</span> Irrational <span class="quoted">nat</span> <span class="quoted">real_alg_1</span>

  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">invariant_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">invariant_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">rai</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>invariant_1_2 <span class="free"><span class="bound"><span class="entity">rai</span></span></span>
    <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> card<span class="main">(</span>roots_below <span class="main">(</span>poly_real_alg_1 <span class="free"><span class="bound"><span class="entity">rai</span></span></span><span class="main">)</span> <span class="main">(</span>real_of_1 <span class="free"><span class="bound"><span class="entity">rai</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">invariant_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">real_of_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">real_of_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> of_rat <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">real_of_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">rai</span></span></span><span class="main">)</span> <span class="main">=</span> real_of_1 <span class="free"><span class="bound"><span class="entity">rai</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">of_rat_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">of_rat_2</span> <span class="main">=</span> Rational"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> of_rat_2<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span>of_rat_2 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_rat <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>of_rat_2 <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_2_def<span class="main">)</span>

<span class="comment1">(* Invariant type *)</span>
<span class="keyword1"><span class="command">typedef</span></span> real_alg_3 <span class="main">=</span> <span class="quoted"><span class="quoted">"Collect invariant_2"</span></span> 
  <span class="keyword2"><span class="keyword">morphisms</span></span> rep_real_alg_3 Real_Alg_Invariant 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Rational <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_real_alg_3

<span class="keyword1"><span class="command">lift_definition</span></span> real_of_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_3 <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">real_of_2</span> <span class="keyword1"><span class="command">.</span></span>

<span class="comment1">(* *************** *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions and Algorithms on Quotient Type›</span></span>

<span class="keyword1"><span class="command">quotient_type</span></span> real_alg <span class="main">=</span> <span class="quoted">real_alg_3</span> <span class="main">/</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> real_of_3 <span class="bound">x</span> <span class="main">=</span> real_of_3 <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">morphisms</span></span> rep_real_alg Real_Alg_Quotient
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> equivp_def<span class="main">)</span> <span class="operator">metis</span>

<span class="comment1">(* real_of *)</span>
<span class="keyword1"><span class="command">lift_definition</span></span> real_of <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">real_of_3</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_of_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of <span class="free">x</span> <span class="main">=</span> real_of <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="comment1">(* ********************** *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sign›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sgn_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sgn_1</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> sgn <span class="main">(</span>rai_ub <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> sgn_1<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">x</span> <span class="main">⟹</span> real_of_rat <span class="main">(</span>sgn_1 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>real_of_1 <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sgn_1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sgn_1_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">x</span> <span class="main">⟹</span> invariant_1 <span class="free">y</span> <span class="main">⟹</span> real_of_1 <span class="free">x</span> <span class="main">=</span> real_of_1 <span class="free">y</span> <span class="main">⟹</span> sgn_1 <span class="free">x</span> <span class="main">=</span> sgn_1 <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_1_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> invariant_1E<span class="main">)</span>

<span class="comment1">(* ********************** *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Normalization: Bounds Close Together›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unique_root_lr<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rai_lb <span class="free">plr</span> <span class="main">≤</span> rai_ub <span class="free">plr</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≤</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poly_real_alg_1 <span class="free">plr</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ur<span class="main">[</span><span class="operator">unfolded</span> root_cond_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> ex1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">.</span> of_rat <span class="var">?l</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> of_rat <span class="var">?r</span> <span class="main">∧</span> ipoly <span class="var">?p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">plr</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="var">?l</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> of_rat <span class="var">?r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="var">?p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> bnd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="var">?l</span> <span class="main">≤</span> of_rat <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≤</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_less_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> map_poly_zero_hom_0 <span class="main">=</span> base<span class="main">:</span> zero_hom_0
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">sublocale</span></span> zero_hom_0 <span class="quoted"><span class="quoted">"map_poly <span class="free">hom</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> of_int_poly_hom<span class="main">:</span>
  map_poly_zero_hom_0 <span class="quoted"><span class="quoted">"of_int <span class="main">::</span> int <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>ring_1<span class="main">,</span> ring_char_0<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_roots_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> finite <span class="main">{</span><span class="bound">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span> ring_char_0<span class="main">}</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_roots_finite<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> roots_below_the_unique_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"roots_below <span class="free">p</span> <span class="main">(</span>the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> roots_below <span class="free">p</span> <span class="main">(</span>of_rat <span class="free">r</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"roots_below <span class="free">p</span> <span class="var">?x</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ur <span class="keyword1"><span class="command">have</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> unique_rootD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ur <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="var">?x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> the_unique_root_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> rc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="var">?x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≤</span> of_rat <span class="free">r</span> <span class="main">∧</span> ipoly <span class="free">p</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword1"><span class="command">have</span></span> l1x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">{</span><span class="var">?x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">fold</span> x<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> rb<span class="main">:</span><span class="quoted"><span class="quoted">"roots_below <span class="free">p</span> <span class="main">(</span>of_rat <span class="free">r</span><span class="main">)</span> <span class="main">=</span> roots_below <span class="free">p</span> <span class="var">?x</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="var">?x</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">≤</span> of_rat <span class="free">r</span> <span class="main">∧</span> ipoly <span class="free">p</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> emp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">⟹</span>
                  <span class="bound">x</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">ra</span><span class="main">.</span> <span class="var">?x</span> <span class="main">≤</span> <span class="bound">ra</span> <span class="main">∧</span> <span class="bound">ra</span> <span class="main">≤</span> real_of_rat <span class="free">r</span> <span class="main">∧</span> ipoly <span class="free">p</span> <span class="bound">ra</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l1x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> rb <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unique_root_sub_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span> <span class="main">(</span>the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> between<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">l'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">≤</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> between <span class="keyword1"><span class="command">have</span></span> ord<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">l</span> <span class="main">≤</span> of_rat <span class="free">l'</span>"</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">r'</span> <span class="main">≤</span> of_rat <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> rc <span class="keyword1"><span class="command">have</span></span> lr'<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">l'</span> <span class="main">≤</span> of_rat <span class="free">r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> ord <span class="keyword1"><span class="command">have</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">l</span> <span class="main">≤</span> real_of_rat <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l'</span><span class="main">,</span> <span class="free">r'</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> rc<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> ord <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>root_condI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> the_unique_root_eqI<span class="main">[</span><span class="operator">OF</span> ur this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> the_unique_root_eqI<span class="main">[</span><span class="operator">OF</span> this rc<span class="main">]</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> invariant_1_sub_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span> <span class="main">(</span>the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> between<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">l'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">≤</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"real_of_1 <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span> <span class="main">=</span> real_of_1 <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted">real_of_rat</span>
  <span class="keyword1"><span class="command">note</span></span> rcD <span class="main">=</span> invariant_1D<span class="main">[</span><span class="operator">OF</span> rc<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> rc
  <span class="keyword1"><span class="command">have</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l'</span><span class="main">,</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l'</span><span class="main">,</span> <span class="free">r'</span><span class="main">)</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI unique_root_sub_interval<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ sub between<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_1 <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span> <span class="main">=</span> real_of_1 <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> rcD<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> split<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="free">l</span> <span class="main">≤</span> <span class="var">?r</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> unique_rootD<span class="main">[</span><span class="operator">OF</span> ur<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="free">l'</span> <span class="main">≤</span> <span class="var">?r</span> <span class="free">r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> lr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">≤</span> <span class="free">r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">l'</span> <span class="main">=</span> sgn <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>rat"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> less
    <span class="keyword1"><span class="command">with</span></span> lr lr' between <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> equal <span class="keyword1"><span class="command">with</span></span> rcD<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_0_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> equal between lr' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> greater
    <span class="keyword1"><span class="command">with</span></span> rcD<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> rcD<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">l</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> lr lr' between <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> between ur rc <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invariant_1_def id<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> root_sign_change<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span>
    p0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span><span class="main">::</span>real poly<span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    pd_ne0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">d</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
    <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">d'</span></span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">.</span> <span class="bound">d'</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟶</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="bound">d'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="bound">d'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">d</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">d</span> <span class="main">⟹</span>
          sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
          sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
          <span class="main">0</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
          <span class="main">∀</span><span class="bound"><span class="bound">d'</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="bound">d'</span> <span class="main">≤</span> <span class="bound">d</span> <span class="main">⟶</span>
                 sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="bound">d'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="bound">d'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
          <span class="free">thesis</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> pd_ne0 <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d1</span></span> <span class="keyword2"><span class="keyword">where</span></span> d1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span><span class="main">.</span> <span class="main">0</span><span class="main">&lt;</span><span class="bound">h</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">&lt;</span> <span class="skolem">d1</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> DERIV_pos_inc_left<span class="main">[</span><span class="operator">OF</span> poly_DERIV 1<span class="main">]</span> p0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d2</span></span> <span class="keyword2"><span class="keyword">where</span></span> d2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span><span class="main">.</span> <span class="main">0</span><span class="main">&lt;</span><span class="bound">h</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">&lt;</span> <span class="skolem">d2</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="bound">h</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> DERIV_pos_inc_right<span class="main">[</span><span class="operator">OF</span> poly_DERIV 1<span class="main">]</span> p0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> g0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span>min <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d1 d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> m1<span class="main">:</span><span class="quoted"><span class="quoted">"min <span class="skolem">d1</span> <span class="skolem">d2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m2<span class="main">:</span><span class="quoted"><span class="quoted">"min <span class="skolem">d1</span> <span class="skolem">d2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">d2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&lt;</span> min <span class="skolem">d1</span> <span class="skolem">d2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> a1<span class="main">]</span> d2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> a1<span class="main">]</span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> d<span class="main">=</span>this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> a<span class="main"><span class="main">[</span></span><span class="operator">OF</span> g0<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span><span class="operator">insert</span> d g0 m1 m2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d1</span></span> <span class="keyword2"><span class="keyword">where</span></span> d1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span><span class="main">.</span> <span class="main">0</span><span class="main">&lt;</span><span class="bound">h</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">&lt;</span> <span class="skolem">d1</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> DERIV_neg_dec_left<span class="main">[</span><span class="operator">OF</span> poly_DERIV 2<span class="main">]</span> p0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d2</span></span> <span class="keyword2"><span class="keyword">where</span></span> d2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span><span class="main">.</span> <span class="main">0</span><span class="main">&lt;</span><span class="bound">h</span> <span class="main">⟹</span> <span class="bound">h</span> <span class="main">&lt;</span> <span class="skolem">d2</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="bound">h</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> DERIV_neg_dec_right<span class="main">[</span><span class="operator">OF</span> poly_DERIV 2<span class="main">]</span> p0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> g0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span>min <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d1 d2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> m1<span class="main">:</span><span class="quoted"><span class="quoted">"min <span class="skolem">d1</span> <span class="skolem">d2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m2<span class="main">:</span><span class="quoted"><span class="quoted">"min <span class="skolem">d1</span> <span class="skolem">d2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">d2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&lt;</span> min <span class="skolem">d1</span> <span class="skolem">d2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> a1<span class="main">]</span> d2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> a1<span class="main">]</span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> d<span class="main">=</span>this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> a<span class="main"><span class="main">[</span></span><span class="operator">OF</span> g0<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span><span class="operator">insert</span> d g0 m1 m2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rational_root_free_degree_iff<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> rf<span class="main">:</span> <span class="quoted"><span class="quoted">"root_free <span class="main">(</span>map_poly rat_of_int <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> of_rat <span class="skolem">y</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?x</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Rats_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> rt<span class="main">[</span><span class="operator">unfolded</span> x<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly rat_of_int <span class="free">p</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> rf <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_free_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> degree1_coeffs<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> rt<span class="main">[</span><span class="operator">unfolded</span> p <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">a</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> of_int <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> of_int <span class="skolem">a</span><span class="main">)</span> <span class="main">/</span> of_int <span class="skolem">b</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">-</span> of_rat <span class="main">(</span>of_int <span class="skolem">a</span><span class="main">)</span> <span class="main">/</span> of_rat <span class="main">(</span>of_int <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_rat <span class="main">(</span><span class="main">-</span> of_int <span class="skolem">a</span> <span class="main">/</span> of_int <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_rat_minus of_rat_divide <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rational_poly_cond_iff<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rational_root_free_degree_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> poly_condD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span><span class="main">]</span> irreducible_connect_rev<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible<span class="hidden">⇩</span><sub>d</sub> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> irreducible<span class="hidden">⇩</span><sub>d</sub>_int_rat<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>map_poly rat_of_int <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"root_free <span class="main">(</span>map_poly rat_of_int <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> irreducible_root_free<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_cond_degree_gt_1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="main">ℚ</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> rational_poly_cond_iff<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_cond2_no_rat_root<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="main">(</span>real_of_rat <span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> poly_cond_degree_gt_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">x</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> gt_rat_sign_change<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="free">plr</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≡</span> poly_real_alg_1 <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≡</span> rai_lb <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≡</span> rai_ub <span class="free">plr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> in_interval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">r</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_rat <span class="free">y</span> <span class="main">&gt;</span> the_unique_root <span class="free">plr</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?gt</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> plr<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">plr</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">plr</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_def l_def r_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?gt</span> <span class="main">≠</span> <span class="main">(</span>real_of_rat <span class="free">y</span> <span class="main">&gt;</span> the_unique_root <span class="free">plr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> a <span class="main">=</span> this<span class="main">[</span><span class="operator">unfolded</span> plr<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> nz <span class="main">=</span> poly_cond2_no_rat_root<span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> p0_real<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_int_poly <span class="free">p</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real poly<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_int_poly <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> urD <span class="main">=</span> unique_rootD<span class="main">[</span><span class="operator">OF</span> ur<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ur</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted">real_of_rat</span>
  <span class="keyword1"><span class="command">from</span></span> poly_cond2_no_rat_root p
  <span class="keyword1"><span class="command">have</span></span> ru<span class="main">:</span><span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> in_interval <span class="keyword1"><span class="command">have</span></span> in'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="free">l</span> <span class="main">≤</span> <span class="var">?r</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="free">y</span> <span class="main">≤</span> <span class="var">?r</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_rat_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> p square_free_of_int_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> square_free_rsquarefree
  <span class="keyword1"><span class="command">have</span></span> rsf<span class="main">:</span><span class="quoted"><span class="quoted">"rsquarefree <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ur3<span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="var">?p</span> <span class="var">?ur</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> urD<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> ur <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ur</span> <span class="main">≤</span> of_rat <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> unique_rootE<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> nz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="main">(</span>real_of_rat <span class="free">r</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> ur3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">r</span> <span class="main">≠</span> real_of_1 <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ur</span> <span class="main">&lt;</span> <span class="var">?r</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> ur2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?r</span> <span class="free">r</span> <span class="main">-</span> <span class="var">?ur</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">from</span></span> rsquarefree_roots rsf ur3
  <span class="keyword1"><span class="command">have</span></span> pd_nonz<span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="main">(</span>pderiv <span class="var">?p</span><span class="main">)</span> <span class="var">?ur</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d'</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> <span class="bound">d'</span> <span class="main">≤</span> <span class="skolem">d</span> <span class="main">⟹</span>
             sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span><span class="var">?ur</span> <span class="main">+</span> <span class="bound">d'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span><span class="var">?ur</span> <span class="main">+</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span><span class="var">?ur</span> <span class="main">-</span> <span class="bound">d'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span><span class="var">?ur</span> <span class="main">-</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span><span class="var">?ur</span> <span class="main">-</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span><span class="var">?ur</span> <span class="main">+</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span><span class="var">?ur</span> <span class="main">+</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> d_ge_0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> root_sign_change<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ur3 pd_nonz<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sr<span class="main">:</span><span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span><span class="var">?ur</span> <span class="main">+</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span><span class="var">?r</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="free">r</span> <span class="main">-</span> <span class="var">?ur</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d'<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ur2 True<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">hence</span></span> less<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?ur</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">&lt;</span> <span class="var">?r</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> no_roots_inbetween_imp_same_sign<span class="main"><span class="main">[</span></span><span class="operator">OF</span> less<span class="main"><span class="main">,</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ur 1 d_ge_0 <span class="keyword1"><span class="command">have</span></span> ran<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">l</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> real_of_rat <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> unique_rootE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1 d_ge_0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> ur <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> ran <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="free">l</span> <span class="main">&lt;</span> <span class="var">?ur</span> <span class="main">-</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="free">l</span> <span class="main">&lt;</span> <span class="var">?ur</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?ur</span> <span class="main">-</span> <span class="var">?r</span> <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ur</span> <span class="main">-</span> <span class="var">?r</span> <span class="free">l</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="var">?ur</span> <span class="main">=</span> <span class="var">?r</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> urD <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">hence</span></span> sl<span class="main">:</span><span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span><span class="var">?ur</span> <span class="main">-</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span><span class="var">?r</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span><span class="var">?r</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span><span class="var">?r</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span><span class="var">?ur</span> <span class="main">-</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> no_roots_inbetween_imp_same_sign<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ur 1 d_ge_0 <span class="keyword1"><span class="command">have</span></span> ran<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">l</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> real_of_rat <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> unique_rootE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1 d_ge_0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> ur <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> ran <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d'<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> ur3<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> diff_sign<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">l</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d'<span class="main">(</span>2-<span class="main">)</span> sr sl real_of_rat_sgn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ur'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> real_of_rat <span class="free">l</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> real_of_rat <span class="free">y</span> <span class="main">⟹</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="var">?r</span> <span class="free">y</span> <span class="main">≤</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span> <span class="free">y</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> nz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> id ur <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> unique_rootE<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> neq <span class="main">=</span> this
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def
      <span class="keyword1"><span class="command">using</span></span> 1 a ur <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> unique_rootE<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> conjunct2<span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> 1<span class="main">(</span>2-<span class="main">)</span> the_unique_root_eqI<span class="main">[</span><span class="operator">OF</span> ur<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> neq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> ur''<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> real_of_rat <span class="free">y</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> real_of_rat <span class="free">r</span> <span class="main">⟶</span> poly <span class="main">(</span>real_of_int_poly <span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="var">?r</span> <span class="free">y</span> <span class="main">≤</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> urD<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?r</span> <span class="free">y</span> <span class="main">&gt;</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">y</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> sgn<span class="main">:</span><span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span>real_of_rat <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="var">?p</span> <span class="main">(</span>real_of_rat <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True diff_sign
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_of_rat_sgn<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ly<span class="main">:</span><span class="quoted"><span class="quoted">"of_rat <span class="free">l</span> <span class="main">&lt;</span> <span class="main">(</span>of_rat <span class="free">y</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_interval True diff_sign less_eq_rat_def of_rat_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> no_roots_inbetween_imp_same_sign<span class="main">[</span><span class="operator">OF</span> ly<span class="main">,</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span><span class="main">]</span> sgn ur' True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> ne<span class="main">:</span><span class="quoted"><span class="quoted">"sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="main">(</span>real_of_rat <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="main">(</span>real_of_rat <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_of_rat_sgn<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ry<span class="main">:</span><span class="quoted"><span class="quoted">"of_rat <span class="free">y</span> <span class="main">&lt;</span> <span class="main">(</span>of_rat <span class="free">r</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_interval False diff_sign less_eq_rat_def of_rat_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"real_of_rat <span class="free">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> real_of_rat <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> no_roots_inbetween_imp_same_sign<span class="main">[</span><span class="operator">OF</span> ry<span class="main">,</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span><span class="main">]</span> ne <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> lx<span class="main">:</span><span class="quoted"><span class="quoted">"real_of_rat <span class="free">l</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_interval
      <span class="keyword1"><span class="command">using</span></span> False a urD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ur</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x lx ur <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> the_unique_root_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> diff_sign<span class="main">(</span>1<span class="main">)</span> a ru <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sgn_0_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tighten_poly_bounds</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span> rat <span class="main">×</span> rat <span class="main">×</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tighten_poly_bounds</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">sr</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">;</span> <span class="bound">sm</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="bound">m</span><span class="main">)</span> <span class="keyword1">in</span> 
    <span class="keyword1">if</span> <span class="bound">sm</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">sr</span></span></span>
     <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="bound">m</span><span class="main">,</span><span class="bound">sm</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">sr</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tighten_poly_bounds<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds <span class="free">l</span> <span class="free">r</span> <span class="free">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">,</span><span class="free">sr'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span>  <span class="quoted"><span class="quoted">"poly_cond2 <span class="free">p</span>"</span></span>   
  <span class="keyword2"><span class="keyword">and</span></span> sr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sr</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span> <span class="main">(</span>the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">l'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">≤</span> <span class="free">r'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">≤</span> <span class="free">r</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span> <span class="main">-</span> <span class="free">l'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sr'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r'</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> d <span class="main">=</span> tighten_poly_bounds_def Let_def
  <span class="keyword1"><span class="command">from</span></span> unique_root_lr<span class="main">[</span><span class="operator">OF</span> ur<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">l'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">≤</span> <span class="free">r'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">≤</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span> <span class="main">-</span> <span class="free">l'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sr'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> res sr <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="var">?m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">≤</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> le <span class="main">=</span> gt_rat_sign_change<span class="main">[</span><span class="operator">OF</span> ur<span class="main">,</span><span class="operator">simplified</span><span class="main">,</span><span class="operator">OF</span> p this<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> urD <span class="main">=</span> unique_rootD<span class="main">[</span><span class="operator">OF</span> ur<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span> <span class="var">?x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="var">?m</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> *<span class="main">:</span> False
    <span class="keyword1"><span class="command">with</span></span> res sr <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">=</span> <span class="var">?m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> *<span class="main">[</span><span class="operator">unfolded</span> le<span class="main">]</span> urD <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> *<span class="main">:</span> True 
    <span class="keyword1"><span class="command">with</span></span> res sr <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">=</span> <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">=</span> <span class="var">?m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> *<span class="main">[</span><span class="operator">unfolded</span> le<span class="main">]</span> urD <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">partial_function</span></span> <span class="main">(</span>tailrec<span class="main">)</span> <span class="entity">tighten_poly_bounds_epsilon</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span> rat <span class="main">×</span> rat <span class="main">×</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">tighten_poly_bounds_epsilon</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">sr</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≤</span> <span class="free">x</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">sr</span></span></span><span class="main">)</span> <span class="keyword1">else</span>
    <span class="main">(</span><span class="keyword1">case</span> tighten_poly_bounds <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">sr</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">l'</span><span class="main">,</span><span class="bound">r'</span><span class="main">,</span><span class="bound">sr'</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">tighten_poly_bounds_epsilon</span> <span class="bound">l'</span> <span class="bound">r'</span> <span class="bound">sr'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">partial_function</span></span> <span class="main">(</span>tailrec<span class="main">)</span> <span class="entity">tighten_poly_bounds_for_x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span>
  rat <span class="main">×</span> rat <span class="main">×</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">tighten_poly_bounds_for_x</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">sr</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">&lt;</span> <span class="free">x</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">sr</span></span></span><span class="main">)</span> <span class="keyword1">else</span>
     <span class="main">(</span><span class="keyword1">case</span> tighten_poly_bounds <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">sr</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">l'</span><span class="main">,</span><span class="bound">r'</span><span class="main">,</span><span class="bound">sr'</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">tighten_poly_bounds_for_x</span> <span class="bound">l'</span> <span class="bound">r'</span> <span class="bound">sr'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tighten_poly_bounds_epsilon<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≡</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds_epsilon <span class="free">l</span> <span class="free">r</span> <span class="free">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">,</span><span class="free">sr'</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sr</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">l'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">≤</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">-</span> <span class="free">l'</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sr'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r'</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">delta</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">delta</span> <span class="main">=</span> <span class="free">x</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> delta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">delta</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> delta_def <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dist</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">,</span><span class="bound">sr</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">-</span> <span class="bound">l</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rel</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"inv_image <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> delta_gt <span class="skolem">delta</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="var">?dist</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> SN <span class="main">=</span> SN_inv_image<span class="main">[</span><span class="operator">OF</span> delta_gt_SN<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?dist</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> simps <span class="main">=</span> res<span class="main">[</span><span class="operator">unfolded</span> tighten_poly_bounds_for_x.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">,</span><span class="bound">sr</span><span class="main">)</span><span class="main">.</span> unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">u</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> 
    <span class="main">⟶</span> tighten_poly_bounds_epsilon <span class="bound">l</span> <span class="bound">r</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">,</span><span class="free">sr'</span><span class="main">)</span> 
    <span class="main">⟶</span> <span class="bound">sr</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="bound">r</span><span class="main">)</span>
    <span class="main">⟶</span> <span class="bound">l</span> <span class="main">≤</span> <span class="free">l'</span> <span class="main">∧</span> <span class="free">r'</span> <span class="main">≤</span> <span class="bound">r</span> <span class="main">∧</span> <span class="free">r'</span> <span class="main">-</span> <span class="free">l'</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span> <span class="free">u</span> <span class="main">∧</span> <span class="free">sr'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">sr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SN_induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> SN<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">lr</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">sr</span></span> <span class="keyword2"><span class="keyword">where</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lr</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">sr</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lr</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lr split
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds_epsilon <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free">l'</span><span class="main">,</span> <span class="free">r'</span><span class="main">,</span> <span class="free">sr'</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> sr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sr</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">note</span></span> tur <span class="main">=</span> unique_rootD<span class="main">[</span><span class="operator">OF</span> ur<span class="main">]</span>
      <span class="keyword1"><span class="command">note</span></span> simps <span class="main">=</span> tighten_poly_bounds_epsilon.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">sr</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="free">l'</span> <span class="main">∧</span> <span class="free">r'</span> <span class="main">≤</span> <span class="skolem">r</span> <span class="main">∧</span> <span class="free">r'</span> <span class="main">-</span> <span class="free">l'</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l'</span><span class="main">,</span> <span class="free">r'</span><span class="main">)</span> <span class="free">u</span> <span class="main">∧</span> <span class="free">sr'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">≤</span> <span class="free">x</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> res<span class="main">[</span><span class="operator">unfolded</span> simps<span class="main">]</span> ur tur<span class="main">(</span>4<span class="main">)</span> u sr
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False 
        <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">&gt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tight</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">sr</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="skolem"><span class="skolem">SR</span></span> <span class="keyword2"><span class="keyword">where</span></span> tight<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?tight</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">L</span><span class="main">,</span><span class="skolem">R</span><span class="main">,</span><span class="skolem">SR</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?tight</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> tighten <span class="main">=</span> tighten_poly_bounds<span class="main">[</span><span class="operator">OF</span> tight<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span></span></span></span><span class="operator"><span class="operator"><span class="operator"><span class="operator"><span class="operator"><span class="operator">unfolded</span></span></span></span></span></span> sr<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span></span></span></span> ur p<span class="main">]</span>
        <span class="keyword1"><span class="command">from</span></span> unique_root_sub_interval<span class="main">[</span><span class="operator">OF</span> ur tighten<span class="main"><span class="main"><span class="main">(</span></span></span>1-2<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> p
        <span class="keyword1"><span class="command">have</span></span> ur'<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">L</span><span class="main">,</span><span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">L</span><span class="main">,</span><span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> res<span class="main">[</span><span class="operator">unfolded</span> simps tight<span class="main">]</span> False sr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tighten_poly_bounds_epsilon <span class="skolem">L</span> <span class="skolem">R</span> <span class="skolem">SR</span> <span class="main">=</span> <span class="main">(</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">,</span><span class="free">sr'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">L</span><span class="main">,</span><span class="skolem">R</span><span class="main">,</span><span class="skolem">SR</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> tight split lr<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> _ ur' this<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">≤</span> <span class="free">l'</span> <span class="main">∧</span> <span class="free">r'</span> <span class="main">≤</span> <span class="skolem">R</span> <span class="main">∧</span> <span class="free">r'</span> <span class="main">-</span> <span class="free">l'</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l'</span><span class="main">,</span> <span class="free">r'</span><span class="main">)</span> <span class="free">u</span> <span class="main">∧</span> <span class="free">sr'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> tighten False<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> delta_gt_def delta_def<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> tighten <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> split u<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> ur refl res sr<span class="main">]</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">l'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">≤</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">-</span> <span class="free">l'</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sr'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tighten_poly_bounds_for_x<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≡</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="free">p</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds_for_x <span class="free">l</span> <span class="free">r</span> <span class="free">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">,</span><span class="free">sr'</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sr</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">l'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">≤</span> <span class="free">r'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">≤</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">l'</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sr'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">delta</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">delta</span> <span class="main">=</span> abs <span class="main">(</span><span class="main">(</span><span class="free">u</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_int_poly <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> ru <span class="main">=</span> unique_rootD<span class="main">[</span><span class="operator">OF</span> ur<span class="main">]</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="var">?x</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> u <span class="main">=</span> this<span class="main">[</span><span class="operator">unfolded</span> u<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> poly_cond2_no_rat_root<span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span> ur <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> unique_rootE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> u<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> delta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">delta</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> delta_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dist</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">,</span><span class="bound">sr</span><span class="main">)</span><span class="main">.</span> real_of_rat <span class="main">(</span><span class="bound">r</span> <span class="main">-</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rel</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"inv_image <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> delta_gt <span class="skolem">delta</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="var">?dist</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> SN <span class="main">=</span> SN_inv_image<span class="main">[</span><span class="operator">OF</span> delta_gt_SN<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?dist</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> simps <span class="main">=</span> res<span class="main">[</span><span class="operator">unfolded</span> tighten_poly_bounds_for_x.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">,</span><span class="bound">sr</span><span class="main">)</span><span class="main">.</span> unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">u</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> 
    <span class="main">⟶</span> tighten_poly_bounds_for_x <span class="bound">l</span> <span class="bound">r</span> <span class="bound">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">,</span><span class="free">sr'</span><span class="main">)</span> 
    <span class="main">⟶</span> <span class="bound">sr</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="bound">r</span><span class="main">)</span>
    <span class="main">⟶</span> <span class="bound">l</span> <span class="main">≤</span> <span class="free">l'</span> <span class="main">∧</span> <span class="free">r'</span> <span class="main">≤</span> <span class="bound">r</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="free">l'</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">)</span> <span class="main">∧</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span> <span class="free">u</span> <span class="main">∧</span> <span class="free">sr'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">sr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SN_induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> SN<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">lr</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">sr</span></span> <span class="keyword2"><span class="keyword">where</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lr</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">sr</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lr</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">r</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lr split
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds_for_x <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">sr</span> <span class="main">=</span> <span class="main">(</span><span class="free">l'</span><span class="main">,</span> <span class="free">r'</span><span class="main">,</span> <span class="free">sr'</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> sr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sr</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">note</span></span> tur <span class="main">=</span> unique_rootD<span class="main">[</span><span class="operator">OF</span> ur<span class="main">]</span>
      <span class="keyword1"><span class="command">note</span></span> simps <span class="main">=</span> tighten_poly_bounds_for_x.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="free">l'</span> <span class="main">∧</span> <span class="free">r'</span> <span class="main">≤</span> <span class="skolem">r</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="free">l'</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">)</span> <span class="main">∧</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l'</span><span class="main">,</span> <span class="free">r'</span><span class="main">)</span> <span class="free">u</span> <span class="main">∧</span> <span class="free">sr'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="skolem">l</span> <span class="main">∨</span> <span class="skolem">r</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> res<span class="main">[</span><span class="operator">unfolded</span> simps<span class="main">]</span> ur tur<span class="main">(</span>4<span class="main">)</span> u sr
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False 
        <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≤</span> <span class="var">?x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">≤</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_less_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tight</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">sr</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="skolem"><span class="skolem">SR</span></span> <span class="keyword2"><span class="keyword">where</span></span> tight<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?tight</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">L</span><span class="main">,</span><span class="skolem">R</span><span class="main">,</span><span class="skolem">SR</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?tight</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> tighten <span class="main">=</span> tighten_poly_bounds<span class="main">[</span><span class="operator">OF</span> tight ur p sr<span class="main">]</span>
        <span class="keyword1"><span class="command">from</span></span> unique_root_sub_interval<span class="main">[</span><span class="operator">OF</span> ur tighten<span class="main"><span class="main"><span class="main">(</span></span></span>1-2<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> p
        <span class="keyword1"><span class="command">have</span></span> ur'<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">L</span><span class="main">,</span><span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">L</span><span class="main">,</span><span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> res<span class="main">[</span><span class="operator">unfolded</span> simps tight<span class="main">]</span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tighten_poly_bounds_for_x <span class="skolem">L</span> <span class="skolem">R</span> <span class="skolem">SR</span> <span class="main">=</span> <span class="main">(</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">,</span><span class="free">sr'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?tight</span></span></span><span class="main">,</span> <span class="operator">unfolded</span> tight split lr<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> _ ur' this<span class="main">]</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?DIFF</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span><span class="skolem">R</span> <span class="main">-</span> <span class="skolem">L</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?diff</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> diff0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?DIFF</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tighten<span class="main">(</span>3<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cancel_comm_monoid_add_class.diff_cancel diff_right_mono of_rat_less_eq of_rat_hom.hom_zero<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"delta_gt <span class="skolem">delta</span> <span class="var">?diff</span> <span class="var">?DIFF</span> <span class="main">=</span> <span class="main">(</span>abs <span class="main">(</span><span class="free">u</span> <span class="main">-</span> of_rat <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> real_of_rat <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> delta_gt_def tighten<span class="main">(</span>5<span class="main">)</span> delta_def of_rat_diff<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">-</span> <span class="var">?l</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> of_rat_divide of_rat_mult of_rat_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="free">u</span> <span class="main">-</span> of_rat <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?r</span> <span class="main">-</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x ur <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> unique_rootE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> u<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> delta<span class="main">:</span> <span class="quoted"><span class="quoted">"delta_gt <span class="skolem">delta</span> <span class="var">?diff</span> <span class="var">?DIFF</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">≤</span> <span class="free">l'</span> <span class="main">∧</span> <span class="free">r'</span> <span class="main">≤</span> <span class="skolem">R</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="free">l'</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">)</span> <span class="main">∧</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l'</span><span class="main">,</span> <span class="free">r'</span><span class="main">)</span> <span class="free">u</span> <span class="main">∧</span> <span class="free">sr'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> delta diff0 tighten<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">≤</span> <span class="skolem">r</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> split u<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> ur refl res sr<span class="main">]</span> 
  <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">l'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">≤</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">l'</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">r'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sr'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> *<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> split<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">l'</span> <span class="main">≤</span> of_rat <span class="free">r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">l'</span> <span class="main">≤</span> <span class="free">r'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_rat_less_eq <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l'</span><span class="main">,</span><span class="free">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ur *<span class="main">(</span>1-3<span class="main">)</span> p poly_condD<span class="main">(</span>5<span class="main">)</span> u unique_root_sub_interval<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_alg_precision</span> <span class="main">::</span> <span class="quoted">rat</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">real_alg_precision</span> <span class="main">≡</span> Rat.Fract <span class="main">1</span> <span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_alg_precision<span class="main">:</span> <span class="quoted"><span class="quoted">"real_alg_precision <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">normalize_bounds_1_main</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> real_alg_1 <span class="main">⇒</span> real_alg_1"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">normalize_bounds_1_main</span> <span class="free"><span class="bound"><span class="entity">eps</span></span></span> <span class="free"><span class="bound"><span class="entity">rai</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">rai</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="keyword1">let</span> <span class="main">(</span><span class="bound">l'</span><span class="main">,</span><span class="bound">r'</span><span class="main">,</span><span class="bound">sr'</span><span class="main">)</span> <span class="main">=</span> tighten_poly_bounds_epsilon <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">eps</span></span></span> <span class="bound">l</span> <span class="bound">r</span> <span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="bound">p</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
        <span class="bound">fr</span> <span class="main">=</span> rat_of_int <span class="main">(</span>floor <span class="bound">r'</span><span class="main">)</span><span class="main">;</span>
        <span class="main">(</span><span class="bound">l''</span><span class="main">,</span><span class="bound">r''</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">=</span> tighten_poly_bounds_for_x <span class="bound">p</span> <span class="bound">fr</span> <span class="bound">l'</span> <span class="bound">r'</span> <span class="bound">sr'</span>
    <span class="keyword1">in</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">l''</span><span class="main">,</span><span class="bound">r''</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">normalize_bounds_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> real_alg_1"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">normalize_bounds_1</span> <span class="main">=</span> <span class="main">(</span>normalize_bounds_1_main real_alg_precision<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">l</span> <span class="free">r</span> <span class="main">::</span> <span class="quoted">rat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> real_of_rat <span class="free">l</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> of_rat <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span>ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ipoly <span class="free">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> root_cond_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span> root_cond <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> root_cond_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> the_unique_root_cong<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> root_cond_cong <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unique_root_cong<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span> unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> root_cond_cong <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> normalize_bounds_1_main<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> eps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">eps</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≡</span> normalize_bounds_1_main <span class="free">eps</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">y</span> <span class="main">∧</span> <span class="main">(</span>real_of_1 <span class="free">y</span> <span class="main">=</span> real_of_1 <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> rc <span class="main">=</span> rc<span class="main">[</span><span class="operator">unfolded</span> x<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="skolem"><span class="skolem">sr'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tb<span class="main">:</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds_epsilon <span class="skolem">p</span> <span class="free">eps</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="skolem">p</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">,</span><span class="skolem">sr'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_cases3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rat_of_int <span class="main">(</span>floor <span class="skolem">r'</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l''</span></span> <span class="skolem"><span class="skolem">r''</span></span> <span class="skolem"><span class="skolem">sr''</span></span> <span class="keyword2"><span class="keyword">where</span></span> tbx<span class="main">:</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds_for_x <span class="skolem">p</span> <span class="var">?fr</span> <span class="skolem">l'</span> <span class="skolem">r'</span> <span class="skolem">sr'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l''</span><span class="main">,</span><span class="skolem">r''</span><span class="main">,</span><span class="skolem">sr''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_cases3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> y<span class="main">[</span><span class="operator">unfolded</span> normalize_bounds_1_main_def x<span class="main">]</span> tb tbx
  <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l''</span><span class="main">,</span> <span class="skolem">r''</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> rc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> tighten_poly_bounds_epsilon<span class="main">[</span><span class="operator">OF</span> this tb refl eps<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">l'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">≤</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rc'<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">(</span>the_unique_root <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> eps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">-</span> <span class="skolem">l'</span> <span class="main">≤</span> <span class="free">eps</span>"</span></span> <span class="comment1">(* currently not relevant for lemma *)</span>
    <span class="keyword2"><span class="keyword">and</span></span> sr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sr'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="skolem">p</span> <span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> invariant_1_sub_interval<span class="main">[</span><span class="operator">OF</span> _ rc' bnd<span class="main">]</span> rc
  <span class="keyword1"><span class="command">have</span></span> inv'<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">=</span> real_of_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">≤</span> <span class="skolem">l''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r''</span> <span class="main">≤</span> <span class="skolem">r'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rc'<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l''</span><span class="main">,</span> <span class="skolem">r''</span><span class="main">)</span> <span class="main">(</span>the_unique_root <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tighten_poly_bounds_for_x<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ p2 tbx sr'<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> invariant_1D<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inv'<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> invariant_1_sub_interval<span class="main">[</span><span class="operator">OF</span> inv' rc' bnd<span class="main">]</span> p2 eq
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> y x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> normalize_bounds_1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="main">(</span>normalize_bounds_1 <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>real_of_1 <span class="main">(</span>normalize_bounds_1 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> real_of_1 <span class="free">x</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> xx<span class="main">:</span><span class="main">(</span>fields <span class="skolem">p</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?res</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> norm<span class="main">:</span> <span class="quoted"><span class="quoted">"normalize_bounds_1 <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>normalize_bounds_1_main real_alg_precision <span class="var">?res</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> normalize_bounds_1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xx<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="var">?res</span>"</span></span> <span class="quoted"><span class="quoted">"real_of_1 <span class="var">?res</span> <span class="main">=</span> real_of_1 <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> normalize_bounds_1_main<span class="main">[</span><span class="operator">OF</span> real_alg_precision x<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> x<span class="main">(</span>2-<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> normalize_bounds_1_def xx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> normalize_bound_1_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_real_alg_1 <span class="main">(</span>normalize_bounds_1 <span class="free">rai</span><span class="main">)</span> <span class="main">=</span> poly_real_alg_1 <span class="free">rai</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> normalize_bounds_1_def normalize_bounds_1_main_def Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_alg_2_main</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"root_info <span class="main">⇒</span> real_alg_1 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">real_alg_2_main</span> <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="free"><span class="bound"><span class="entity">rai</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="bound">p</span> <span class="main">=</span> poly_real_alg_1 <span class="free"><span class="bound"><span class="entity">rai</span></span></span>
     <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">if</span> degree <span class="bound">p</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> Rational <span class="main">(</span>Rat.Fract <span class="main">(</span><span class="main">-</span> coeff <span class="bound">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>coeff <span class="bound">p</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
       <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">case</span> normalize_bounds_1 <span class="free"><span class="bound"><span class="entity">rai</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">⇒</span>
       Irrational <span class="main">(</span>root_info.number_root <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="bound">r</span><span class="main">)</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_alg_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">real_alg_2</span> <span class="free"><span class="bound"><span class="entity">rai</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="bound">p</span> <span class="main">=</span> poly_real_alg_1 <span class="free"><span class="bound"><span class="entity">rai</span></span></span>
     <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">if</span> degree <span class="bound">p</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> Rational <span class="main">(</span>Rat.Fract <span class="main">(</span><span class="main">-</span> coeff <span class="bound">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>coeff <span class="bound">p</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
       <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">case</span> normalize_bounds_1 <span class="free"><span class="bound"><span class="entity">rai</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">⇒</span>
       Irrational <span class="main">(</span>root_info.number_root <span class="main">(</span>root_info <span class="bound">p</span><span class="main">)</span> <span class="bound">r</span><span class="main">)</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> degree_1_ipoly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> real_of_rat <span class="main">(</span>Rat.Fract <span class="main">(</span><span class="main">-</span> coeff <span class="free">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> roots1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"map_poly real_of_int <span class="free">p</span>"</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">{</span>roots1 <span class="main">(</span>real_of_int_poly <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> real_of_rat <span class="main">(</span>Rat.Fract <span class="main">(</span><span class="main">-</span> coeff <span class="free">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> Fract_of_int_quotient roots1_def <span class="dynamic"><span class="dynamic">hom_distribs</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> invariant_1_degree_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">rai</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_real_alg_1 <span class="free">rai</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"degree <span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="var">?p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="var">?p</span> <span class="main">(</span>real_of_1 <span class="free">rai</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> deg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_Suc0 representsI represents_degree<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> inv <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_alg_2_main<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">rai</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≡</span> poly_real_alg_1 <span class="free">rai</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ric<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="main">(</span>poly_real_alg_1 <span class="free">rai</span><span class="main">)</span> <span class="main">⟹</span> root_info_cond <span class="free">ri</span> <span class="main">(</span>poly_real_alg_1 <span class="free">rai</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>real_alg_2_main <span class="free">ri</span> <span class="free">rai</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span>real_alg_2_main <span class="free">ri</span> <span class="free">rai</span><span class="main">)</span> <span class="main">=</span> real_of_1 <span class="free">rai</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≡</span> rai_lb <span class="free">rai</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≡</span> rai_ub <span class="free">rai</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>real_alg_2_main <span class="free">ri</span> <span class="free">rai</span><span class="main">)</span> <span class="main">∧</span> real_of_2 <span class="main">(</span>real_alg_2_main <span class="free">ri</span> <span class="free">rai</span><span class="main">)</span> <span class="main">=</span> real_of_1 <span class="free">rai</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> invariant_1D
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> deg<span class="main">:</span> equal
    <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"real_alg_2_main <span class="free">ri</span> <span class="free">rai</span> <span class="main">=</span> Rational <span class="main">(</span>Rat.Fract <span class="main">(</span><span class="main">-</span> coeff <span class="free">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> real_alg_2_main_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> rc <span class="main">=</span> invariant_1D<span class="main">[</span><span class="operator">OF</span> inv<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> degree_1_ipoly<span class="main">[</span><span class="operator">OF</span> deg<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="free">rai</span>"</span></span><span class="main">]</span> rc<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> deg<span class="main">:</span> greater
    <span class="keyword1"><span class="command">with</span></span> inv <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">rai</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rai'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rai'</span> <span class="main">=</span> normalize_bounds_1 <span class="free">rai</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> rai'<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="free">rai</span> <span class="main">=</span> real_of_1 <span class="skolem">rai'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> inv'<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="skolem">rai'</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> rai'_def <span class="keyword1"><span class="command">using</span></span> normalize_bounds_1<span class="main">[</span><span class="operator">OF</span> inv<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rai'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">,</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rai'</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> rai'_def<span class="main">,</span> <span class="operator">of</span> <span class="quoted">poly_real_alg_1</span><span class="main">,</span> <span class="operator">unfolded</span> normalize_bound_1_poly<span class="main">]</span> split
    <span class="keyword1"><span class="command">have</span></span> split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rai'</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> inv'<span class="main">[</span><span class="operator">unfolded</span> split<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> poly_condD<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> ric irr <span class="keyword1"><span class="command">have</span></span> ric<span class="main">:</span> <span class="quoted"><span class="quoted">"root_info_cond <span class="free">ri</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"real_alg_2_main <span class="free">ri</span> <span class="free">rai</span> <span class="main">=</span> <span class="main">(</span>Irrational <span class="main">(</span>root_info.number_root <span class="free">ri</span> <span class="skolem">r'</span><span class="main">)</span> <span class="skolem">rai'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> real_alg_2_main_def Let_def <span class="keyword1"><span class="command">using</span></span> deg split rai'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rai'_def rai'<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> rai' root_info_condD<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ric<span class="main">]</span> 
         inv'<span class="main">[</span><span class="operator">unfolded</span> split<span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> invariant_1_2E invariant_1E<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> inv'
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> split roots_below_the_unique_root<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> deg<span class="main">:</span> less <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this invariant_1_degree_0<span class="main">[</span><span class="operator">OF</span> inv<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> inv <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_alg_2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">rai</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>real_alg_2 <span class="free">rai</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span>real_alg_2 <span class="free">rai</span><span class="main">)</span> <span class="main">=</span> real_of_1 <span class="free">rai</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> degree <span class="main">(</span>poly_real_alg_1 <span class="free">rai</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="free">rai</span> <span class="main">=</span> real_alg_2_main <span class="main">(</span>root_info <span class="main">(</span>poly_real_alg_1 <span class="free">rai</span><span class="main">)</span><span class="main">)</span> <span class="free">rai</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> real_alg_2_def real_alg_2_main_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> real_alg_2_main<span class="main">[</span><span class="operator">OF</span> assms root_info<span class="main">,</span> <span class="operator">folded</span> this<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> deg
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>real_alg_2 <span class="free">rai</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span>real_alg_2 <span class="free">rai</span><span class="main">)</span> <span class="main">=</span> real_of_1 <span class="free">rai</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> invariant_2_realI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">plr</span> <span class="main">::</span> <span class="quoted">real_alg_1</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≡</span> poly_real_alg_1 <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≡</span> rai_lb <span class="free">plr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≡</span> rai_ub <span class="free">plr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="free">plr</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="free">l</span> <span class="main">=</span> sgn <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="free">plr</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>real_alg_2 <span class="free">plr</span><span class="main">)</span> <span class="main">∧</span> real_of_2 <span class="main">(</span>real_alg_2 <span class="free">plr</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> invariant_1_realI<span class="main">[</span><span class="operator">OF</span> x<span class="main">,</span><span class="operator">folded</span> p_def l_def r_def<span class="main">]</span> sgn ur p
    real_alg_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">plr</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* ********************* *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Comparisons›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">compare_rat_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> real_alg_1 <span class="main">⇒</span> order"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">compare_rat_1</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">then</span> Lt <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">then</span> Gt <span class="keyword1">else</span>
      <span class="keyword1">if</span> sgn <span class="main">(</span>ipoly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> sgn<span class="main">(</span>ipoly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="keyword1">then</span> Gt <span class="keyword1">else</span> Lt<span class="main">)</span>"</span></span> 
  
<span class="keyword1"><span class="command">lemma</span></span> compare_rat_1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> rai<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">y</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compare_rat_1 <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> compare <span class="main">(</span>of_rat <span class="free">x</span><span class="main">)</span> <span class="main">(</span>real_of_1 <span class="free">y</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≡</span> poly_real_alg_1 <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≡</span> rai_lb <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≡</span> rai_ub <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> y <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> rai <span class="keyword1"><span class="command">have</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="skolem">l</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="skolem">r</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> xl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="skolem">l</span>"</span></span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">x</span> <span class="main">&lt;</span> of_rat <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_rat_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> rai <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="free">x</span> <span class="main">&lt;</span> the_unique_root <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> invariant_1E<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> xl rai <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compare_real_def comparator_of_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> xr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="skolem">r</span>"</span></span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">x</span> <span class="main">&gt;</span> of_rat <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_rat_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> rai <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="free">x</span> <span class="main">&gt;</span> the_unique_root <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> invariant_1E<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> xr rai <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compare_real_def comparator_of_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">p</span> <span class="main">(</span>real_of_rat <span class="free">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_cond2_no_rat_root<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> rai<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> rai <span class="keyword1"><span class="command">have</span></span> diff<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="free">y</span> <span class="main">≠</span> of_rat <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> invariant_1E<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">&lt;</span> degree <span class="main">(</span>poly_real_alg_1 <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="free">y</span> <span class="bound">x</span> <span class="main">⟹</span> poly_cond <span class="skolem">p</span> <span class="main">⟹</span> <span class="bound">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">P</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> poly_real_alg_1.simps y rai invariant_1_2E invariant_1E <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">OF</span> gt_rat_sign_change<span class="main">]</span> False
    <span class="keyword1"><span class="command">have</span></span> left<span class="main">:</span> <span class="quoted"><span class="quoted">"compare_rat_1 <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> real_of_rat <span class="free">x</span> <span class="main">≤</span> the_unique_root <span class="free">y</span> <span class="keyword1">then</span> Lt <span class="keyword1">else</span> Gt<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>poly_cond2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> compare <span class="main">(</span>real_of_rat <span class="free">x</span><span class="main">)</span> <span class="main">(</span>real_of_1 <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> diff
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compare_real_def comparator_of_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> cf_pos_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> cf_pos <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> cf_pos_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="comment1">(* ********************* *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Negation›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">uminus_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> real_alg_1"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uminus_1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>abs_int_poly <span class="main">(</span>poly_uminus <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> uminus_1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≡</span> uminus_1 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">y</span> <span class="main">∧</span> <span class="main">(</span>real_of_1 <span class="free">y</span> <span class="main">=</span> <span class="main">-</span> real_of_1 <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> plr<span class="main">:</span> <span class="main">(</span>fields <span class="skolem">p</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> x plr <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> invariant_1D<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> plr <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poly_uminus <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"abs_int_poly <span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="var">?mp</span><span class="main">,</span> <span class="main">-</span><span class="skolem">r</span> <span class="main">,</span> <span class="main">-</span><span class="skolem">l</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> y plr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="var">?mp</span><span class="main">,</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">,</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> mpy<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="var">?mp</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> of_rat <span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="main">-</span> of_rat <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> mpy <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">p</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> bnd <span class="keyword1"><span class="command">have</span></span> bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="skolem">l</span> <span class="main">≤</span> <span class="main">-</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">y</span> <span class="main">≤</span> of_rat <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> id bnd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> inv x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_1 <span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> the_unique_root_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>real_of_1 <span class="free">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> inj <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="var">?mp</span><span class="main">,</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">,</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> real_of_1 <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def y x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_minus sgn_minus_rat<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> inj rc <span class="keyword1"><span class="command">have</span></span> ur'<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="var">?mp</span><span class="main">,</span> <span class="main">-</span><span class="skolem">r</span><span class="main">,</span> <span class="main">-</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> unique_rootI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword1"><span class="command">have</span></span> the<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> real_of_1 <span class="free">x</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="var">?mp</span><span class="main">,</span> <span class="main">-</span><span class="skolem">r</span><span class="main">,</span> <span class="main">-</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> the_unique_root_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> xp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">represents</span> <span class="main">(</span>real_of_1 <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def split represents_def x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> mon<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="var">?mp</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> pos_poly_abs_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> poly_uminus_irreducible * <span class="keyword1"><span class="command">have</span></span> mi<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="var">?mp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> mi mon <span class="keyword1"><span class="command">have</span></span> pc'<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond <span class="var">?mp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cf_pos_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> poly_condD<span class="main">[</span><span class="operator">OF</span> pc'<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="var">?mp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> y <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> invariant_1_realI ur' rc<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> pc' inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> uminus_1_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≡</span> uminus_1 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">y</span> <span class="main">∧</span> <span class="main">(</span>real_of_1 <span class="free">y</span> <span class="main">=</span> <span class="main">-</span> real_of_1 <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> uminus_1<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="free">y</span> <span class="main">=</span> <span class="main">-</span> real_of_1 <span class="free">x</span>"</span></span> 
    <span class="quoted"><span class="quoted">"invariant_1 <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> x<span class="main">[</span><span class="operator">unfolded</span> id<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_real_alg_1 <span class="free">y</span> <span class="main">=</span> abs_int_poly <span class="main">(</span>poly_uminus <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> y id uminus_1.simps split Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_real_alg_1 <span class="free">y</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">uminus_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uminus_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> Rational <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">uminus_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> real_alg_2 <span class="main">(</span>uminus_1 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> uminus_2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span>uminus_2 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> uminus <span class="main">(</span>real_of_2 <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>uminus_2 <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms real_alg_2 uminus_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> uminus_1.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>


<span class="keyword1"><span class="command">lift_definition</span></span> uminus_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_3 <span class="main">⇒</span> real_alg_3"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">uminus_2</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uminus_2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> uminus_3<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_3 <span class="main">(</span>uminus_3 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> real_of_3 <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uminus_2<span class="main">)</span>
    
<span class="keyword1"><span class="command">instantiation</span></span> real_alg <span class="main">::</span> <span class="quoted">uminus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">uminus_real_alg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> real_alg"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">uminus_3</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_3<span class="main">)</span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> uminus_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> real_of <span class="main">(</span><span class="main">-</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> uminus_3<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="comment1">(* ********************* *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Inverse›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">inverse_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inverse_1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> real_alg_2 <span class="main">(</span>abs_int_poly <span class="main">(</span>reflect_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">,</span> inverse <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> inverse <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> invariant_1_2_of_rat<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">rai</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"real_of_1 <span class="free">rai</span> <span class="main">≠</span> of_rat <span class="free">x</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> rai<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rai</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">rai</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> rc<span class="main">[</span><span class="operator">unfolded</span> rai<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">p</span> <span class="main">(</span>the_unique_root <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> invariant_1E<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> poly_cond2_no_rat_root<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rai <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> inverse_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rcx<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≡</span> inverse_1 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">y</span> <span class="main">∧</span> <span class="main">(</span>real_of_2 <span class="free">y</span> <span class="main">=</span> inverse <span class="main">(</span>real_of_1 <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> x<span class="main">:</span> <span class="main">(</span>fields <span class="skolem">p</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> x rcx <span class="keyword1"><span class="command">have</span></span> rcx<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> invariant_1_2_poly_cond2<span class="main">[</span><span class="operator">OF</span> rcx<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> pc2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> invariant_1_2_of_rat<span class="main">[</span><span class="operator">OF</span> rcx<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"abs_int_poly <span class="main">(</span>reflect_poly <span class="skolem">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> x0 rcx <span class="keyword1"><span class="command">have</span></span> lr0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x0 rcx <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> real_alg_2 <span class="main">(</span><span class="var">?mp</span><span class="main">,</span> inverse <span class="skolem">r</span><span class="main">,</span> inverse <span class="skolem">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> y x Let_def inverse_1.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> rcx <span class="keyword1"><span class="command">have</span></span> mon<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="var">?mp</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> lead_coeff_abs_int_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="var">?mp</span><span class="main">,</span> inverse <span class="skolem">r</span><span class="main">,</span> inverse <span class="skolem">l</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> mpy<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="var">?mp</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>of_rat <span class="skolem">r</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> inverse <span class="main">(</span>of_rat <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> sgn_real_mono<span class="main">[</span><span class="operator">OF</span> bnd<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> sgn_real_mono<span class="main">[</span><span class="operator">OF</span> bnd<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>of_rat <span class="skolem">r</span><span class="main">)</span> <span class="main">≤</span> sgn <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"sgn <span class="skolem">y</span> <span class="main">≤</span> sgn <span class="main">(</span>of_rat <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> rcx <span class="keyword1"><span class="command">have</span></span> sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>inverse <span class="main">(</span>of_rat <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sgn <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"sgn <span class="skolem">y</span> <span class="main">=</span> sgn <span class="main">(</span>inverse <span class="main">(</span>of_rat <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> sgn_inverse inverse_sgn
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_of_rat_sgn <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_antisym<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> sgn<span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">unfolded</span> real_of_rat_sgn<span class="main">]</span> lr0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>sgn_0_0<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> mpy <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">p</span> <span class="main">(</span>inverse <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ipoly_reflect_poly<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> inverse_le_sgn<span class="main">[</span><span class="operator">OF</span> sgn<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bnd<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> inverse_le_sgn<span class="main">[</span><span class="operator">OF</span> sgn<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bnd<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="skolem">l</span> <span class="main">≤</span> inverse <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">y</span> <span class="main">≤</span> of_rat <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> id bnd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>inverse <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> rcx this x0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">=</span> inverse <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="var">?x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> inj <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="var">?mp</span><span class="main">,</span> inverse <span class="skolem">r</span><span class="main">,</span> inverse <span class="skolem">l</span><span class="main">)</span> <span class="main">(</span>inverse <span class="var">?x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rcx x0 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> invariant_1_2E invariant_1E<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_cond_def of_rat_inverse real_of_rat_sgn inverse_le_iff_sgn ipoly_reflect_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> inj rc <span class="keyword1"><span class="command">have</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="var">?mp</span><span class="main">,</span> inverse <span class="skolem">r</span><span class="main">,</span> inverse <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> unique_rootI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword1"><span class="command">have</span></span> the<span class="main">:</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="var">?mp</span><span class="main">,</span> inverse <span class="skolem">r</span><span class="main">,</span> inverse <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> inverse <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> the_unique_root_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> xp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">represents</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> split represents_def <span class="keyword1"><span class="command">using</span></span> rcx <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> invariant_1E<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> reflect_poly_irreducible<span class="main">[</span><span class="operator">OF</span> _ xp x0<span class="main">]</span> poly_condD rcx
  <span class="keyword1"><span class="command">have</span></span> mi<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="var">?mp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> mi mon <span class="keyword1"><span class="command">have</span></span> un<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond <span class="var">?mp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_cond_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rcx rc ur <span class="keyword1"><span class="command">unfolding</span></span> y
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> invariant_2_realI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x y un<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">inverse_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inverse_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> Rational <span class="main">(</span>inverse <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inverse_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> inverse_1 <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inverse_2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span>inverse_2 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>real_of_2 <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>inverse_2 <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_alg_2 inverse_1 <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> inverse_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_3 <span class="main">⇒</span> real_alg_3"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">inverse_2</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inverse_2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inverse_3<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_3 <span class="main">(</span>inverse_3 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>real_of_3 <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inverse_2<span class="main">)</span>
  

<span class="comment1">(* ********************* *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Floor›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">floor_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">floor_1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span>
    <span class="main">(</span><span class="bound">l'</span><span class="main">,</span><span class="bound">r'</span><span class="main">,</span><span class="bound">sr'</span><span class="main">)</span> <span class="main">=</span> tighten_poly_bounds_epsilon <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="bound">fr</span> <span class="main">=</span> floor <span class="bound">r'</span><span class="main">;</span>
    <span class="bound">fl</span> <span class="main">=</span> floor <span class="bound">l'</span><span class="main">;</span>
    <span class="bound">fr'</span> <span class="main">=</span> rat_of_int <span class="bound">fr</span>
    <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">fr</span> <span class="main">=</span> <span class="bound">fl</span> <span class="keyword1">then</span> <span class="bound">fr</span> <span class="keyword1">else</span>
    <span class="keyword1">let</span> <span class="main">(</span><span class="bound">l''</span><span class="main">,</span><span class="bound">r''</span><span class="main">,</span><span class="bound">sr''</span><span class="main">)</span> <span class="main">=</span> tighten_poly_bounds_for_x <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">fr'</span> <span class="bound">l'</span> <span class="bound">r'</span> <span class="bound">sr'</span>
    <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">fr'</span> <span class="main">&lt;</span> <span class="bound">l''</span> <span class="keyword1">then</span> <span class="bound">fr</span> <span class="keyword1">else</span> <span class="bound">fl</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> floor_1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"floor <span class="main">(</span>real_of_1 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> floor_1 <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">p</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="skolem"><span class="skolem">sr'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tbe<span class="main">:</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds_epsilon <span class="skolem">p</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="skolem">p</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">,</span><span class="skolem">sr'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_cases3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>    
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"floor <span class="skolem">r'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fl</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"floor <span class="skolem">l'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fr'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rat_of_int <span class="var">?fr</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l''</span></span> <span class="skolem"><span class="skolem">r''</span></span> <span class="skolem"><span class="skolem">sr''</span></span> <span class="keyword2"><span class="keyword">where</span></span> tbx<span class="main">:</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds_for_x <span class="skolem">p</span> <span class="var">?fr'</span> <span class="skolem">l'</span> <span class="skolem">r'</span> <span class="skolem">sr'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l''</span><span class="main">,</span><span class="skolem">r''</span><span class="main">,</span><span class="skolem">sr''</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_cases3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>    
  <span class="keyword1"><span class="command">note</span></span> rc <span class="main">=</span> assms<span class="main">[</span><span class="operator">unfolded</span> fields<span class="main">]</span>
  <span class="keyword1"><span class="command">hence</span></span> rc1<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"floor_1 <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="var">?fr</span> <span class="main">=</span> <span class="var">?fl</span> <span class="keyword1">then</span> <span class="var">?fr</span> 
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="var">?fr'</span> <span class="main">&lt;</span> <span class="skolem">l''</span> <span class="keyword1">then</span> <span class="var">?fr</span> <span class="keyword1">else</span> <span class="var">?fl</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fields floor_1.simps tbe Let_def split tbx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fields <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">l'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">≤</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">-</span> <span class="skolem">l'</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> rc'<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">(</span>the_unique_root <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> sr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sr'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="skolem">p</span> <span class="skolem">r'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI tighten_poly_bounds_epsilon<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ tbe refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">insert</span> rc<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> invariant_1E<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted">real_of_rat</span>
  <span class="keyword1"><span class="command">from</span></span> rc'<span class="main">[</span><span class="operator">folded</span> x<span class="main">,</span> <span class="operator">unfolded</span> split<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> ineq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">l'</span> <span class="main">≤</span> <span class="var">?x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">≤</span> <span class="var">?r</span> <span class="skolem">r'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">l'</span> <span class="main">≤</span> <span class="var">?r</span> <span class="skolem">r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> lr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">≤</span> <span class="skolem">r'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_rat_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> flr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fl</span> <span class="main">≤</span> <span class="var">?fr</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> floor_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> lr'<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> invariant_1_sub_interval<span class="main">[</span><span class="operator">OF</span> rc1 rc' bnd<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> rc'<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> id'<span class="main">:</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword1"><span class="command">have</span></span> rc2'<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fields <span class="keyword1"><span class="command">using</span></span> id' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fr</span> <span class="main">≠</span> <span class="var">?fl</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> flr <span class="keyword1"><span class="command">have</span></span> flr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fl</span> <span class="main">≤</span> <span class="var">?fr</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fr'</span> <span class="main">≤</span> <span class="skolem">r'</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">≤</span> <span class="var">?fr'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> flr bnd <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> fl_diff <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?fr</span> <span class="main">=</span> <span class="var">?fl</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> id1<span class="main">:</span> <span class="quoted"><span class="quoted">"floor_1 <span class="free">x</span> <span class="main">=</span> <span class="var">?fr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"floor <span class="main">(</span><span class="var">?r</span> <span class="skolem">l'</span><span class="main">)</span> <span class="main">=</span> floor <span class="main">(</span><span class="var">?r</span> <span class="skolem">r'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"floor <span class="var">?x</span> <span class="main">≤</span> floor <span class="main">(</span><span class="var">?r</span> <span class="skolem">r'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> floor_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ineq<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"floor <span class="main">(</span><span class="var">?r</span> <span class="skolem">l'</span><span class="main">)</span> <span class="main">≤</span> floor <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> floor_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ineq<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"floor <span class="var">?x</span> <span class="main">=</span> floor <span class="main">(</span><span class="var">?r</span> <span class="skolem">r'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> id <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"floor_1 <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="var">?fr'</span> <span class="main">&lt;</span> <span class="skolem">l''</span> <span class="keyword1">then</span> <span class="var">?fr</span> <span class="keyword1">else</span> <span class="var">?fl</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> rc2' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> tighten_poly_bounds_for_x<span class="main">[</span><span class="operator">OF</span> this tbx sr'<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> ineq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">≤</span> <span class="skolem">l''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r''</span> <span class="main">≤</span> <span class="skolem">r'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lr''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l''</span> <span class="main">≤</span> <span class="skolem">r''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rc''<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l''</span><span class="main">,</span><span class="skolem">r''</span><span class="main">)</span> <span class="var">?x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> fr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">l''</span> <span class="main">≤</span> <span class="var">?fr'</span> <span class="main">∧</span> <span class="var">?fr'</span> <span class="main">≤</span> <span class="skolem">r''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> rc''<span class="main">[</span><span class="operator">unfolded</span> split<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> ineq''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">l''</span> <span class="main">≤</span> <span class="var">?x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">≤</span> <span class="var">?r</span> <span class="skolem">r''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fr</span> <span class="main">≠</span> <span class="var">?fl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> fr <span class="main">=</span> fl_diff<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?fr'</span> <span class="main">&lt;</span> <span class="skolem">l''</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> id <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"floor_1 <span class="free">x</span> <span class="main">=</span> <span class="var">?fr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"floor <span class="var">?x</span> <span class="main">≤</span> <span class="var">?fr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> floor_mono<span class="main">[</span><span class="operator">OF</span> ineq<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="var">?fr'</span> <span class="main">&lt;</span> <span class="var">?r</span> <span class="skolem">l''</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_rat_less <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> ineq''<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="var">?fr'</span> <span class="main">≤</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> floor_mono<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fr</span> <span class="main">≤</span> floor <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> id <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"floor_1 <span class="free">x</span> <span class="main">=</span> <span class="var">?fl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l''</span> <span class="main">≤</span> <span class="var">?fr'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> floor_mono<span class="main">[</span><span class="operator">OF</span> ineq<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fl</span> <span class="main">≤</span> floor <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"floor <span class="var">?x</span> <span class="main">≤</span> <span class="var">?fl</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> False fr' <span class="keyword1"><span class="command">have</span></span> fr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r''</span> <span class="main">&lt;</span> <span class="var">?fr'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"floor <span class="skolem">r''</span> <span class="main">&lt;</span> <span class="var">?fr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">with</span></span> floor_mono<span class="main">[</span><span class="operator">OF</span> ineq''<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"floor <span class="var">?x</span> <span class="main">≤</span> <span class="var">?fr</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fr</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> floor <span class="main">(</span><span class="skolem">r'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="var">?fl</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> floor_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> bnd<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ********************* *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Generic Factorization and Bisection Framework›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_1_Collect_ex1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>Collect <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> card_eq_1_iff<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Collect <span class="free">P</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ex1I<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sub_interval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">×</span> rat <span class="main">⇒</span> rat <span class="main">×</span> rat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sub_interval</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l'</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">r'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">in_interval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">×</span> rat <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">in_interval</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>of_rat <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> of_rat <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">converges_to</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> rat <span class="main">×</span> rat<span class="main">)</span> <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">converges_to</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span><span class="main">.</span> in_interval <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> sub_interval <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
   <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound"><span class="bound">eps</span></span> <span class="main">::</span> real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">n</span> <span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∧</span> of_rat <span class="bound">r</span> <span class="main">-</span> of_rat <span class="bound">l</span> <span class="main">≤</span> <span class="bound">eps</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">bnd_update</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">bnd_get</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> rat <span class="main">×</span> rat"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">at_step</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> rat <span class="main">×</span> rat<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">at_step</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="free">bnd_get</span> <span class="main">(</span><span class="main">(</span><span class="free">bnd_update</span> <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">partial_function</span></span> <span class="main">(</span>tailrec<span class="main">)</span> <span class="entity">select_correct_factor_main</span>
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span>int poly <span class="main">×</span> root_info<span class="main">)</span>list <span class="main">⇒</span> <span class="main">(</span>int poly <span class="main">×</span> root_info<span class="main">)</span>list
    <span class="main">⇒</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span>int poly <span class="main">×</span> root_info<span class="main">)</span> <span class="main">×</span> rat <span class="main">×</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">select_correct_factor_main</span> <span class="free"><span class="bound"><span class="entity">bnd</span></span></span> <span class="free"><span class="bound"><span class="entity">todo</span></span></span> <span class="free"><span class="bound"><span class="entity">old</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">todo</span></span></span> <span class="keyword1">of</span> Nil
    <span class="main">⇒</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">(</span>hd <span class="free"><span class="bound"><span class="entity">old</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">bnd'</span> <span class="main">=</span> <span class="free">bnd_update</span> <span class="free"><span class="bound"><span class="entity">bnd</span></span></span> <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">bnd_get</span> <span class="bound">bnd'</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">⇒</span> 
      <span class="free">select_correct_factor_main</span> <span class="bound">bnd'</span> <span class="free"><span class="bound"><span class="entity">old</span></span></span> <span class="main">[]</span> <span class="bound">l</span> <span class="bound">r</span> <span class="main">0</span><span class="main">)</span>
   <span class="main">|</span> Cons <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">ri</span><span class="main">)</span> <span class="bound">todo</span> <span class="main">⇒</span> <span class="keyword1">let</span> <span class="bound">m</span> <span class="main">=</span> root_info.l_r <span class="bound">ri</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">in</span> 
      <span class="keyword1">if</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">select_correct_factor_main</span> <span class="free"><span class="bound"><span class="entity">bnd</span></span></span> <span class="bound">todo</span> <span class="free"><span class="bound"><span class="entity">old</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>
      <span class="keyword1">else</span> <span class="free">select_correct_factor_main</span> <span class="free"><span class="bound"><span class="entity">bnd</span></span></span> <span class="bound">todo</span> <span class="main">(</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">ri</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">old</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">select_correct_factor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span>int poly <span class="main">×</span> root_info<span class="main">)</span>list <span class="main">⇒</span>
    <span class="main">(</span>int poly <span class="main">×</span> root_info<span class="main">)</span> <span class="main">×</span> rat <span class="main">×</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">select_correct_factor</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">polys</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">bnd_get</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">⇒</span>
    select_correct_factor_main <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">polys</span></span></span> <span class="main">[]</span> <span class="bound">l</span> <span class="bound">r</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> select_correct_factor_main<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"converges_to <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> at<span class="main">:</span> <span class="quoted"><span class="quoted">"at_step <span class="free">f</span> <span class="free">i</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"select_correct_factor_main <span class="free">a</span> <span class="free">todo</span> <span class="free">old</span> <span class="free">l</span> <span class="free">r</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">ri_fin</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">l_fin</span><span class="main">,</span><span class="free">r_fin</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bnd_get</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ri<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span> <span class="bound">ri</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">ri</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">todo</span> <span class="main">∪</span> set <span class="free">old</span> <span class="main">⟹</span> root_info_cond <span class="bound">ri</span> <span class="bound">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span> <span class="bound">ri</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">ri</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">todo</span> <span class="main">∪</span> set <span class="free">old</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="free">todo</span> <span class="main">∪</span> fst <span class="main">`</span> set <span class="free">old</span> <span class="main">∧</span> ipoly <span class="bound">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="main">(</span><span class="free">todo</span> <span class="main">@</span> <span class="free">old</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> old<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span> <span class="bound">ri</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">ri</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">old</span> <span class="main">⟹</span> root_info.l_r <span class="bound">ri</span> <span class="free">l</span> <span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> un<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="free">todo</span> <span class="main">∪</span> fst <span class="main">`</span> set <span class="free">old</span> <span class="main">∧</span> ipoly <span class="bound">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> 
    <span class="main">∃!</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="free">todo</span> <span class="main">∪</span> fst <span class="main">`</span> set <span class="free">old</span> <span class="main">∧</span> ipoly <span class="bound">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">ri</span><span class="main">)</span><span class="main">.</span> root_info.l_r <span class="bound">ri</span> <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="free">old</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">l_fin</span><span class="main">,</span><span class="free">r_fin</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">ri_fin</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">todo</span> <span class="main">∪</span> set <span class="free">old</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">l_fin</span><span class="main">,</span><span class="free">r_fin</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">orig</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">orig</span> <span class="main">=</span> set <span class="free">todo</span> <span class="main">∪</span> set <span class="free">old</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> orig<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">todo</span> <span class="main">∪</span> set <span class="free">old</span> <span class="main">⊆</span> <span class="skolem">orig</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orig_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rts</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span> <span class="main">::</span> real<span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span> <span class="bound">ri</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">ri</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">orig</span> <span class="main">∧</span> ipoly <span class="bound">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rts</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rts</span> <span class="main">=</span> <span class="var">?rts</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> abs <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted">real_of_rat</span>
  <span class="keyword1"><span class="command">have</span></span> rts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rts</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">ri</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="bound">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> set <span class="main">(</span><span class="free">todo</span> <span class="main">@</span> <span class="free">old</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orig_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">rts</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rts rts_def
    <span class="keyword1"><span class="command">using</span></span> finite_ipoly_roots<span class="main">[</span><span class="operator">OF</span> q0<span class="main">]</span> finite_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">todo</span> <span class="main">@</span> <span class="free">old</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">hence</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">rts</span> <span class="main">×</span> <span class="skolem">rts</span> <span class="main">-</span> Id<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">diffs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">diffs</span> <span class="main">=</span> insert <span class="main">1</span> <span class="main">{</span>abs <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">rts</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">rts</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span>abs <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">rts</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">rts</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">finite</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ finite_imageI<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> fin<span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?h</span></span></span></span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> diffs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">diffs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">diffs</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> diffs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">eps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">eps</span> <span class="main">=</span> Min <span class="skolem">diffs</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">diffs</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> diffs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Min_gr_iff<span class="main">[</span><span class="operator">OF</span> diffs<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> eps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">eps</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> conv <span class="main">=</span> conv<span class="main">[</span><span class="operator">unfolded</span> converges_to_def<span class="main">]</span> 
  <span class="keyword1"><span class="command">from</span></span> conv eps <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">N</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">L</span><span class="main">,</span><span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">R</span> <span class="main">-</span> <span class="var">?r</span> <span class="skolem">L</span> <span class="main">≤</span> <span class="skolem">eps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pair</span></span> <span class="keyword2"><span class="keyword">where</span></span> pair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pair</span> <span class="main">=</span> <span class="main">(</span><span class="free">todo</span><span class="main">,</span><span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rel</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rel</span> <span class="main">=</span> measures <span class="main">[</span> <span class="main">λ</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="skolem">N</span> <span class="main">-</span> <span class="bound">i</span><span class="main">,</span> <span class="main">λ</span> <span class="main">(</span><span class="bound">t</span> <span class="main">::</span> <span class="main">(</span>int poly <span class="main">×</span> root_info<span class="main">)</span> list<span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> length <span class="bound">t</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="skolem">rel</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> at res bnd ri q0 ex dist old un n pair orig
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">pair</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">todo</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">old</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">pair</span> <span class="skolem">todo</span> <span class="skolem">i</span> <span class="skolem">old</span> <span class="skolem">a</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span>
    <span class="keyword1"><span class="command">note</span></span> at <span class="main">=</span> 1<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> res <span class="main">=</span> 1<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> select_correct_factor_main.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">todo</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">note</span></span> bnd <span class="main">=</span> 1<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> ri <span class="main">=</span> 1<span class="main">(</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> q0 <span class="main">=</span> 1<span class="main">(</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> ex <span class="main">=</span> 1<span class="main">(</span>7<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> dist <span class="main">=</span> 1<span class="main">(</span>8<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> old <span class="main">=</span> 1<span class="main">(</span>9<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> un <span class="main">=</span> 1<span class="main">(</span>10<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> n <span class="main">=</span> 1<span class="main">(</span>11<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> pair <span class="main">=</span> 1<span class="main">(</span>12<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> orig <span class="main">=</span> 1<span class="main">(</span>13<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> at<span class="main">[</span><span class="operator">unfolded</span> at_step_def<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> bnd <span class="keyword1"><span class="command">have</span></span> fi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> conv <span class="keyword1"><span class="command">have</span></span> inx<span class="main">:</span> <span class="quoted"><span class="quoted">"in_interval <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> lxr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">l</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="var">?r</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> order.trans<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_rat_less_eq <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">todo</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">rri</span> <span class="skolem">tod</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">ri</span></span> <span class="keyword2"><span class="keyword">where</span></span> rri<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rri</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">ri</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> todo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">todo</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">ri</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">tod</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">note</span></span> res <span class="main">=</span> res<span class="main">[</span><span class="operator">unfolded</span> todo list.simps split Let_def<span class="main">]</span>
      <span class="keyword1"><span class="command">from</span></span> root_info_condD<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ri<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">ri</span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> todo<span class="main"><span class="main">]</span></span> lr<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> ri'<span class="main">:</span> <span class="quoted"><span class="quoted">"root_info.l_r <span class="skolem">ri</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> q0 <span class="keyword1"><span class="command">have</span></span> s0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> todo <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> finite_ipoly_roots<span class="main">[</span><span class="operator">OF</span> s0<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> fins<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">tod</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">,</span> <span class="skolem">pair</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">rel</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rel_def pair todo <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"root_info.l_r <span class="skolem">ri</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> res <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"select_correct_factor_main <span class="skolem">a</span> <span class="skolem">tod</span> <span class="skolem">old</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span><span class="main">,</span> <span class="free">ri_fin</span><span class="main">)</span><span class="main">,</span> <span class="free">l_fin</span><span class="main">,</span> <span class="free">r_fin</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> ri'<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">unfolded</span> True<span class="main">]</span> fins <span class="keyword1"><span class="command">have</span></span> empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> ex lxr empty <span class="keyword1"><span class="command">have</span></span> ex'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="skolem">tod</span> <span class="main">∪</span> fst <span class="main">`</span> set <span class="skolem">old</span> <span class="main">∧</span> ipoly <span class="bound">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> todo root_cond_def split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span> <span class="free">l_fin</span><span class="main">,</span> <span class="free">r_fin</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">q</span><span class="main">,</span> <span class="free">ri_fin</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">tod</span> <span class="main">∪</span> set <span class="skolem">old</span> <span class="main">∧</span> 
          <span class="free">x</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span> <span class="free">l_fin</span><span class="main">,</span> <span class="free">r_fin</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rel at res bnd ri _ ex' _ _ _ n refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> un<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> todo <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> q0 <span class="keyword1"><span class="command">unfolding</span></span> todo <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> dist old orig<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> todo<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> todo <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> res <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"select_correct_factor_main <span class="skolem">a</span> <span class="skolem">tod</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">ri</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">old</span><span class="main">)</span> <span class="skolem">l</span> <span class="skolem">r</span> 
          <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> root_info.l_r <span class="skolem">ri</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span><span class="main">,</span> <span class="free">ri_fin</span><span class="main">)</span><span class="main">,</span> <span class="free">l_fin</span><span class="main">,</span> <span class="free">r_fin</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> ex <span class="keyword1"><span class="command">have</span></span> ex'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="skolem">tod</span> <span class="main">∪</span> fst <span class="main">`</span> set <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">ri</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">old</span><span class="main">)</span> <span class="main">∧</span> ipoly <span class="bound">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> todo <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> dist <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="main">(</span><span class="skolem">tod</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">ri</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">old</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> todo <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">todo</span> <span class="main">∪</span> set <span class="skolem">old</span> <span class="main">=</span> set <span class="skolem">tod</span> <span class="main">∪</span> set <span class="main">(</span><span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">ri</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">old</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> todo <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rel at res bnd ri _ ex' dist<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> 4 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> un <span class="keyword1"><span class="command">unfolding</span></span> todo <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> old False orig<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q0 todo n<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">note</span></span> res <span class="main">=</span> res<span class="main">[</span><span class="operator">unfolded</span> Nil list.simps Let_def<span class="main">]</span>
      <span class="keyword1"><span class="command">from</span></span> ex<span class="main">[</span><span class="operator">unfolded</span> Nil<span class="main">]</span> lxr <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="skolem">old</span> <span class="main">∧</span> root_cond <span class="main">(</span><span class="skolem">s</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q1</span></span> <span class="skolem"><span class="skolem">ri1</span></span> <span class="skolem"><span class="skolem">old'</span></span> <span class="keyword2"><span class="keyword">where</span></span> old'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">old</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span><span class="skolem">ri1</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">old'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">old</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ri</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"root_info.l_r <span class="skolem">ri1</span> <span class="skolem">l</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> old<span class="main">[</span><span class="operator">unfolded</span> old'<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ri</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> n<span class="main">[</span><span class="operator">unfolded</span> old'<span class="main">]</span> 0 <span class="keyword1"><span class="command">have</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> ri<span class="main">[</span><span class="operator">unfolded</span> old'<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> ri'<span class="main">:</span> <span class="quoted"><span class="quoted">"root_info_cond <span class="skolem">ri1</span> <span class="skolem">q1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> n0 <span class="keyword1"><span class="command">have</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> bnd'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bnd_get</span> <span class="main">(</span><span class="free">bnd_update</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>        
        <span class="keyword1"><span class="command">with</span></span> res False <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"select_correct_factor_main <span class="main">(</span><span class="free">bnd_update</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">old</span> <span class="main">[]</span> <span class="skolem">l'</span> <span class="skolem">r'</span> <span class="main">0</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">(</span><span class="free">q</span><span class="main">,</span> <span class="free">ri_fin</span><span class="main">)</span><span class="main">,</span> <span class="free">l_fin</span><span class="main">,</span> <span class="free">r_fin</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> at'<span class="main">:</span> <span class="quoted"><span class="quoted">"at_step <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">bnd_update</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> at_step_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">bnd_update</span> <span class="main">^^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">bnd_update</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">bnd_update</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> at<span class="main">[</span><span class="operator">unfolded</span> at_step_def<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span><span class="main">]</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> 0<span class="main">[</span><span class="operator">unfolded</span> root_info_condD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> ri' lr<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="keyword2"><span class="keyword">where</span></span> y1<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="skolem">y1</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Collect <span class="main">(</span>root_cond <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> n1<span class="main">[</span><span class="operator">unfolded</span> n old'<span class="main">]</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ri</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∨</span> sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">ri</span><span class="main">)</span><span class="main">.</span> root_info.l_r <span class="bound">ri</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">old'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">ri</span><span class="main">)</span><span class="main">.</span> root_info.l_r <span class="bound">ri</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">old'</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q2</span> <span class="bound">ri2</span> <span class="bound">y2</span><span class="main">.</span> <span class="main">(</span><span class="bound">q2</span><span class="main">,</span><span class="bound">ri2</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">old</span> <span class="main">∧</span> root_cond <span class="main">(</span><span class="bound">q2</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="bound">y2</span> <span class="main">∧</span> <span class="skolem">y1</span> <span class="main">≠</span> <span class="bound">y2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ri</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> root_info_condD<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ri' lr<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> card_gt_1D<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> y1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="skolem">y2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">≠</span> <span class="skolem">y2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> old' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">ri</span><span class="main">)</span><span class="main">.</span> root_info.l_r <span class="bound">ri</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">old'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="skolem"><span class="skolem">ri2</span></span> <span class="keyword2"><span class="keyword">where</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q2</span><span class="main">,</span><span class="skolem">ri2</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">old'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ri2<span class="main">:</span> <span class="quoted"><span class="quoted">"root_info.l_r <span class="skolem">ri2</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> q0 ri <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root_info_cond <span class="skolem">ri2</span> <span class="skolem">q2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> old' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> ri2<span class="main">[</span><span class="operator">unfolded</span> root_info_condD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> this lr<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="skolem">q2</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="skolem">y2</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Collect <span class="main">(</span>root_cond <span class="main">(</span><span class="skolem">q2</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> dist<span class="main">[</span><span class="operator">unfolded</span> old'<span class="main">]</span> split_list<span class="main">[</span><span class="operator">OF</span> mem<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">≠</span> <span class="skolem">q2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> y1 <span class="keyword1"><span class="command">have</span></span> q1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="skolem">todo</span> <span class="main">∪</span> fst <span class="main">`</span> set <span class="skolem">old</span> <span class="main">∧</span> ipoly <span class="skolem">q1</span> <span class="skolem">y1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> old' root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> y2 <span class="keyword1"><span class="command">have</span></span> q2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="skolem">todo</span> <span class="main">∪</span> fst <span class="main">`</span> set <span class="skolem">old</span> <span class="main">∧</span> ipoly <span class="skolem">q2</span> <span class="skolem">y2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> old' root_cond_def <span class="keyword1"><span class="command">using</span></span> mem <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">≠</span> <span class="skolem">y2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">=</span> <span class="skolem">y2</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> q1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q1</span><span class="main">.</span> <span class="bound">q1</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="skolem">todo</span> <span class="main">∪</span> fst <span class="main">`</span> set <span class="skolem">old</span> <span class="main">∧</span> ipoly <span class="bound">q1</span> <span class="skolem">y1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> un<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> q1 q2<span class="main">[</span><span class="operator">folded</span> id<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> <span class="skolem">q2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> diff <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> mem y2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> old' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="skolem"><span class="skolem">ri2</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
          mem2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q2</span><span class="main">,</span><span class="skolem">ri2</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">old</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="skolem">q2</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="skolem">y2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span> <span class="main">≠</span> <span class="skolem">y2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> mem2 orig <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q1</span><span class="main">,</span><span class="skolem">ri1</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">orig</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q2</span><span class="main">,</span><span class="skolem">ri2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">orig</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> old' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> y1 y2 diff <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">y1</span> <span class="main">-</span> <span class="skolem">y2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">diffs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> diffs_def rts_def root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> Min_le<span class="main">[</span><span class="operator">OF</span> diffs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">y1</span> <span class="main">-</span> <span class="skolem">y2</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">eps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> eps <span class="keyword1"><span class="command">have</span></span> eps<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">y1</span> <span class="main">-</span> <span class="skolem">y2</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">eps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> y1 y2 <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="skolem">l</span> <span class="main">≤</span> min <span class="skolem">y1</span> <span class="skolem">y2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> y1 y2 <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="skolem">r</span> <span class="main">≥</span> max <span class="skolem">y1</span> <span class="skolem">y2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> l r eps <span class="keyword1"><span class="command">have</span></span> eps<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="skolem">r</span> <span class="main">-</span> of_rat <span class="skolem">l</span> <span class="main">&gt;</span> <span class="skolem">eps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">N</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">N</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">+</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">l</span> <span class="skolem">r</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="skolem">r</span> <span class="main">-</span> of_rat <span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">eps</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> 0
              <span class="keyword1"><span class="command">with</span></span> N <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span>
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">r'</span> <span class="main">-</span> <span class="var">?r</span> <span class="skolem">l'</span> <span class="main">≤</span> <span class="skolem">eps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> f Suc<span class="main">(</span>2<span class="main">)</span> conv<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span><span class="main">]</span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">l</span> <span class="main">≥</span> <span class="var">?r</span> <span class="skolem">l'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">r</span> <span class="main">≤</span> <span class="var">?r</span> <span class="skolem">r'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_less_eq<span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
          <span class="keyword1"><span class="command">from</span></span> at<span class="main">[</span><span class="operator">unfolded</span> at_step_def i<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> bnd  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> *<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> eps
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">old</span><span class="main">,</span> Suc <span class="skolem">i</span><span class="main">)</span><span class="main">,</span> <span class="skolem">pair</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">rel</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pair rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> dist <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="main">(</span><span class="skolem">old</span> <span class="main">@</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">todo</span> <span class="main">∪</span> set <span class="skolem">old</span> <span class="main">=</span> set <span class="skolem">old</span> <span class="main">∪</span> set <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rel at' res bnd' ri _ _ dist _ _ _ refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> q0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> ex un orig Nil<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> res old' <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="skolem">q1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ri_fin</span> <span class="main">=</span> <span class="skolem">ri1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l_fin</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r_fin</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> n<span class="main">[</span><span class="operator">unfolded</span> True old'<span class="main">]</span> 0 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ri</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?ri</span></span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?ri</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> root_info_condD<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ri' lr<span class="main">]</span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> card_1_Collect_ex1<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> unique<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">from</span></span> ex<span class="main">[</span><span class="operator">unfolded</span> Nil old'<span class="main">]</span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>A<span class="main">)</span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">q1</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
          <span class="main">|</span> <span class="main">(</span>B<span class="main">)</span> <span class="skolem">q</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="skolem">old'</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> A
          <span class="keyword1"><span class="command">with</span></span> lxr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> the_unique_root_eqI<span class="main">[</span><span class="operator">OF</span> unique this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>B <span class="skolem">q</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> lxr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> B<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ri'</span></span> <span class="keyword2"><span class="keyword">where</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">ri'</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">old'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">from</span></span> q0<span class="main">[</span><span class="operator">unfolded</span> old'<span class="main">]</span> mem <span class="keyword1"><span class="command">have</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> finite_ipoly_roots<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> empty <span class="keyword1"><span class="command">have</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> ri<span class="main">[</span><span class="operator">unfolded</span> old'<span class="main">]</span> mem <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root_info_cond <span class="skolem">ri'</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> root_info_condD<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this lr<span class="main">]</span> card <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root_info.l_r <span class="skolem">ri'</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> n<span class="main">[</span><span class="operator">unfolded</span> True old'<span class="main">]</span> 1 split_list<span class="main">[</span><span class="operator">OF</span> mem<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> unique ri' <span class="keyword1"><span class="command">unfolding</span></span> old' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> select_correct_factor<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> 
      conv<span class="main">:</span> <span class="quoted"><span class="quoted">"converges_to <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">bnd_get</span> <span class="main">(</span><span class="main">(</span><span class="free">bnd_update</span> <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="free">init</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"select_correct_factor <span class="free">init</span> <span class="free">polys</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">ri</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ri<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span> <span class="bound">ri</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">ri</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">polys</span> <span class="main">⟹</span> root_info_cond <span class="bound">ri</span> <span class="bound">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span> <span class="bound">ri</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">ri</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">polys</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="free">polys</span> <span class="main">∧</span> ipoly <span class="bound">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">polys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> un<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="free">polys</span> <span class="main">∧</span> ipoly <span class="bound">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> 
    <span class="main">∃!</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="free">polys</span> <span class="main">∧</span> ipoly <span class="bound">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">ri</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">polys</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bnd_get</span> <span class="free">init</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> res<span class="main">[</span><span class="operator">unfolded</span> select_correct_factor_def init split<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"select_correct_factor_main <span class="free">init</span> <span class="free">polys</span> <span class="main">[]</span> <span class="skolem">l'</span> <span class="skolem">r'</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span><span class="main">,</span> <span class="free">ri</span><span class="main">)</span><span class="main">,</span> <span class="free">l</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> at<span class="main">:</span> <span class="quoted"><span class="quoted">"at_step <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">bnd_get</span> <span class="main">(</span><span class="main">(</span><span class="free">bnd_update</span> <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="free">init</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="free">init</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> at_step_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">ri</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">polys</span> <span class="main">∪</span> set <span class="main">[]</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> select_correct_factor_main<span class="main"><span class="main">[</span></span><span class="operator">OF</span> conv at res init ri<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> dist un ex q0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_alg_2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"root_info <span class="main">⇒</span> int poly <span class="main">⇒</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">real_alg_2'</span> <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> degree <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> Rational <span class="main">(</span>Rat.Fract <span class="main">(</span><span class="main">-</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span>
    real_alg_2_main <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="main">(</span><span class="keyword1">case</span> tighten_poly_bounds_for_x <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">of</span>
              <span class="main">(</span><span class="bound">l'</span><span class="main">,</span><span class="bound">r'</span><span class="main">,</span><span class="bound">sr'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="bound">l'</span><span class="main">,</span> <span class="bound">r'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_alg_2'_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"real_alg_2' <span class="free">ri</span> <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="main">=</span>
 <span class="main">(</span><span class="keyword1">if</span> degree <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> Rational <span class="main">(</span>Rat.Fract <span class="main">(</span><span class="main">-</span> coeff <span class="free">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="keyword1">case</span> normalize_bounds_1
        <span class="main">(</span><span class="keyword1">case</span> tighten_poly_bounds_for_x <span class="free">p</span> <span class="main">0</span> <span class="free">l</span> <span class="free">r</span> <span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">l'</span><span class="main">,</span> <span class="bound">r'</span><span class="main">,</span> <span class="bound">sr'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="bound">l'</span><span class="main">,</span> <span class="bound">r'</span><span class="main">)</span><span class="main">)</span> 
     <span class="keyword1">of</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span> <span class="bound">l</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">⇒</span> Irrational <span class="main">(</span>root_info.number_root <span class="free">ri</span> <span class="bound">r</span><span class="main">)</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span> <span class="bound">l</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> real_alg_2'_def real_alg_2_main_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds_for_x <span class="free">p</span> <span class="main">0</span> <span class="free">l</span> <span class="free">r</span> <span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_alg_2''</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"root_info <span class="main">⇒</span> int poly <span class="main">⇒</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">real_alg_2''</span> <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> normalize_bounds_1
        <span class="main">(</span><span class="keyword1">case</span> tighten_poly_bounds_for_x <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">l'</span><span class="main">,</span> <span class="bound">r'</span><span class="main">,</span> <span class="bound">sr'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="bound">l'</span><span class="main">,</span> <span class="bound">r'</span><span class="main">)</span><span class="main">)</span> 
     <span class="keyword1">of</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span> <span class="bound">l</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">⇒</span> Irrational <span class="main">(</span>root_info.number_root <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="bound">r</span><span class="main">)</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span> <span class="bound">l</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> real_alg_2''<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">⟹</span> real_alg_2'' <span class="free">ri</span> <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="main">=</span> real_alg_2' <span class="free">ri</span> <span class="free">p</span> <span class="free">l</span> <span class="free">r</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> real_alg_2'_code real_alg_2''_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">lemma</span></span> poly_cond_degree_0_imp_no_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">::</span> <span class="main">{</span>comm_ring_1<span class="main">,</span>ring_char_0<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pc<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> pc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> poly_zero<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> deg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_alg_2'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pc<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ri<span class="main">:</span> <span class="quoted"><span class="quoted">"root_info_cond <span class="free">ri</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>real_alg_2' <span class="free">ri</span> <span class="free">q</span> <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">∧</span> real_of_2 <span class="main">(</span>real_alg_2' <span class="free">ri</span> <span class="free">q</span> <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∧</span> <span class="main">_</span> <span class="main">=</span> <span class="var">?x</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> deg<span class="main">:</span> less
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> poly_cond_degree_0_imp_no_root<span class="main">[</span><span class="operator">OF</span> pc this<span class="main">]</span> ur <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> deg<span class="main">:</span> equal
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"real_alg_2' <span class="free">ri</span> <span class="free">q</span> <span class="free">l</span> <span class="free">r</span> <span class="main">=</span> Rational <span class="main">(</span>Rat.Fract <span class="main">(</span><span class="main">-</span> coeff <span class="free">q</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>coeff <span class="free">q</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> real_alg_2'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> degree_1_ipoly<span class="main">[</span><span class="operator">OF</span> deg<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> unique_rootD<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ur<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> deg<span class="main">:</span> greater
  <span class="keyword1"><span class="command">with</span></span> pc <span class="keyword1"><span class="command">have</span></span> pc2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rai</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_alg_2' <span class="free">ri</span> <span class="free">q</span> <span class="free">l</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted">real_of_rat</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="skolem"><span class="skolem">sr'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tight<span class="main">:</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds_for_x <span class="free">q</span> <span class="main">0</span> <span class="free">l</span> <span class="free">r</span> <span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="free">q</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">,</span><span class="skolem">sr'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_cases3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rai'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">q</span><span class="main">,</span> <span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> rai'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rai</span> <span class="main">=</span> real_alg_2_main <span class="free">ri</span> <span class="var">?rai'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> real_alg_2'_def <span class="keyword1"><span class="command">using</span></span> deg tight <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> rai<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="var">?rai'</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> tight <span class="main">=</span> tighten_poly_bounds_for_x<span class="main">[</span><span class="operator">OF</span> ur pc2 tight refl<span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span> <span class="free">l</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> tight <span class="keyword1"><span class="command">have</span></span> tight<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span> <span class="var">?x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="skolem">l'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">≤</span> <span class="skolem">r'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">≤</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">r'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> unique_root_sub_interval<span class="main">[</span><span class="operator">OF</span> ur tight<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> tight<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> poly_condD<span class="main">[</span><span class="operator">OF</span> pc<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> ur'<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span> <span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> tight<span class="main">(</span>2-<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="skolem">l'</span> <span class="main">=</span> sgn <span class="skolem">r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rai' <span class="keyword1"><span class="command">using</span></span> real_alg_2_main<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?rai'</span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ri</span></span></span></span><span class="main">]</span> invariant_1_realI<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?rai'</span></span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tight<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sgn pc ri ur'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">select_correct_factor_int_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> int poly <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">select_correct_factor_int_poly</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> 
     <span class="keyword1">let</span> <span class="bound">qs</span> <span class="main">=</span> factors_of_int_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span>
         <span class="bound">polys</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span> root_info <span class="bound">q</span><span class="main">)</span><span class="main">)</span> <span class="bound">qs</span><span class="main">;</span>
         <span class="main">(</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">ri</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> select_correct_factor <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="bound">polys</span>
      <span class="keyword1">in</span> real_alg_2' <span class="bound">ri</span> <span class="bound">q</span> <span class="bound">l</span> <span class="bound">r</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> select_correct_factor_int_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> 
      conv<span class="main">:</span> <span class="quoted"><span class="quoted">"converges_to <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">bnd_get</span> <span class="main">(</span><span class="main">(</span><span class="free">bnd_update</span> <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="free">init</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> rai<span class="main">:</span> <span class="quoted"><span class="quoted">"select_correct_factor_int_poly <span class="free">init</span> <span class="free">p</span> <span class="main">=</span> <span class="free">rai</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">rai</span> <span class="main">∧</span> real_of_2 <span class="free">rai</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> fact<span class="main">:</span> <span class="quoted"><span class="quoted">"factors_of_int_poly <span class="free">p</span> <span class="main">=</span> <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">polys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">polys</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span> root_info <span class="bound">q</span><span class="main">)</span><span class="main">)</span> <span class="skolem">qs</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">ri</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"select_correct_factor <span class="free">init</span> <span class="skolem">polys</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">ri</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"select_correct_factor <span class="free">init</span> <span class="skolem">polys</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> fst<span class="main">:</span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">polys</span> <span class="main">=</span> <span class="skolem">qs</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="skolem">polys</span> <span class="main">=</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> polys_def map_map o_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">note</span></span> fact' <span class="main">=</span> factors_of_int_poly<span class="main">[</span><span class="operator">OF</span> fact<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> rai <span class="main">=</span> rai<span class="main">[</span><span class="operator">unfolded</span> select_correct_factor_int_poly_def Let_def fact<span class="main">,</span> 
    <span class="operator">folded</span> polys_def<span class="main">,</span> <span class="operator">unfolded</span> res split<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> fact' fst <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="skolem">polys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> fact'<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> p<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> x fst 
  <span class="keyword1"><span class="command">have</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> fst <span class="main">`</span> set <span class="skolem">polys</span> <span class="main">∧</span> ipoly <span class="bound">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">ri</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">ri</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">polys</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> ri<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ri</span> <span class="main">=</span> root_info <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="skolem">qs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> polys_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> fact'<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> q<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> root_info<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span><span class="main">]</span> ri <span class="keyword1"><span class="command">have</span></span> ri<span class="main">:</span> <span class="quoted"><span class="quoted">"root_info_cond <span class="skolem">ri</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> ri q0 *
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> polys <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">ri</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">polys</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> select_correct_factor<span class="main"><span class="main">[</span></span><span class="operator">OF</span> conv res polys<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> _ ex dist<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> fst<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ _ fact'<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">insert</span> fact'<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="main"><span class="main">]</span></span> polys<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">ri</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">polys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> polys <span class="main">=</span> polys<span class="main">[</span><span class="operator">OF</span> mem<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> polys<span class="main">(</span>3-4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> ty<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_cond_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> x rai<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> real_alg_2' ur ty polys<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(* ********************* *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Addition›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_0_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ring_char_0<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_0_coeff_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> add_rat_roots_below<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"roots_below <span class="main">(</span>poly_add_rat <span class="free">r</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">+</span> of_rat <span class="free">r</span><span class="main">)</span> <span class="main">`</span> roots_below <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> of_rat <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> add_rat_roots image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> Collect_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">y</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">-</span> real_of_rat <span class="free">r</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> add_rat_root_cond<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span>cf_pos_poly <span class="main">(</span>poly_add_rat <span class="free">m</span> <span class="free">p</span><span class="main">)</span><span class="main">,</span><span class="free">l</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l</span> <span class="main">-</span> <span class="free">m</span><span class="main">,</span> <span class="free">r</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> of_rat <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> root_cond_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_rat_roots <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> add_rat_unique_root<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span>cf_pos_poly <span class="main">(</span>poly_add_rat <span class="free">m</span> <span class="free">p</span><span class="main">)</span><span class="main">,</span> <span class="free">l</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l</span><span class="main">-</span><span class="free">m</span><span class="main">,</span> <span class="free">r</span><span class="main">-</span><span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_rat_root_cond<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">add_rat_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> real_alg_1 <span class="main">⇒</span> real_alg_1"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">add_rat_1</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">let</span> <span class="bound">p</span> <span class="main">=</span> cf_pos_poly <span class="main">(</span>poly_add_rat <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span><span class="main">;</span>
      <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">,</span><span class="bound">sr</span><span class="main">)</span> <span class="main">=</span> tighten_poly_bounds_for_x <span class="bound">p</span> <span class="main">0</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span> <span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="bound">p</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">in</span>
    <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_real_alg_1_add_rat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_real_alg_1 <span class="main">(</span>add_rat_1 <span class="free">r</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> cf_pos_poly <span class="main">(</span>poly_add_rat <span class="free">r</span> <span class="main">(</span>poly_real_alg_1 <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sgn_cf_pos<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>ipoly <span class="main">(</span>cf_pos_poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>linordered_field<span class="main">)</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> cf_pos_poly_main False <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"Polynomial.smult <span class="skolem">d</span> <span class="main">(</span>cf_pos_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> zero_less_mult_pos2<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> False assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> lead_coeff <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cf_pos_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> p' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> lead_coeff <span class="main">(</span>cf_pos_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lead_coeff_smult<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">…</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>cf_pos_poly <span class="free">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> lead_coeff_cf_pos_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> p' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> of_int <span class="skolem">d</span> <span class="main">*</span> ipoly <span class="main">(</span>cf_pos_poly <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> poly_smult of_int_hom.map_poly_hom_smult<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_mult<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> add_rat_1<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r1</span> <span class="main">::</span> <span class="quoted">rat</span> <span class="keyword2"><span class="keyword">assumes</span></span> inv_y<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≡</span> add_rat_1 <span class="free">r1</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">z</span> <span class="main">∧</span> <span class="main">(</span>real_of_1 <span class="free">z</span> <span class="main">=</span> of_rat <span class="free">r1</span> <span class="main">+</span> real_of_1 <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> y_def<span class="main">:</span> <span class="main">(</span>fields <span class="skolem">p2</span> <span class="skolem">l2</span> <span class="skolem">r2</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≡</span> cf_pos_poly <span class="main">(</span>poly_add_rat <span class="free">r1</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">sr</span></span> <span class="keyword2"><span class="keyword">where</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds_for_x <span class="skolem">p</span> <span class="main">0</span> <span class="main">(</span><span class="skolem">l2</span><span class="main">+</span><span class="free">r1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r2</span><span class="main">+</span><span class="free">r1</span><span class="main">)</span> <span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="skolem">p</span> <span class="main">(</span><span class="skolem">r2</span><span class="main">+</span><span class="free">r1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">sr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> lr <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> y_def z_def p_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> inv_y <span class="keyword1"><span class="command">have</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l2</span> <span class="main">+</span> <span class="free">r1</span><span class="main">,</span> <span class="skolem">r2</span> <span class="main">+</span> <span class="free">r1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_def add_rat_root_cond y_def add_rat_unique_root<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> inv_y<span class="main">[</span><span class="operator">unfolded</span> y_def invariant_1_2_def<span class="main">,</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> pc2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> poly_cond2I poly_add_rat_irreducible poly_condI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> lead_coeff_cf_pos_poly<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> invariant_1E<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">note</span></span> main <span class="main">=</span> tighten_poly_bounds_for_x<span class="main">[</span><span class="operator">OF</span> ur pc2 lr refl<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="skolem">l</span> <span class="main">=</span> sgn <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_if <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">linarith</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">from</span></span> invariant_1_2_realI<span class="main">[</span><span class="operator">OF</span> main<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> _ main<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> this pc2<span class="main">]</span> main<span class="main">(</span>1-3<span class="main">)</span> ur
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> z p_def y_def add_rat_root_cond ex1_the_shift<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tighten_poly_bounds_binary</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> int poly <span class="main">⇒</span> <span class="main">(</span>rat <span class="main">×</span> rat <span class="main">×</span> rat<span class="main">)</span> <span class="main">×</span> rat <span class="main">×</span> rat <span class="main">×</span> rat <span class="main">⇒</span> <span class="main">(</span>rat <span class="main">×</span> rat <span class="main">×</span> rat<span class="main">)</span> <span class="main">×</span> rat <span class="main">×</span> rat <span class="main">×</span> rat"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tighten_poly_bounds_binary</span> <span class="free"><span class="bound"><span class="entity">cr1</span></span></span> <span class="free"><span class="bound"><span class="entity">cr2</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">l1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">sr1</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">sr2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
     <span class="main">(</span>tighten_poly_bounds <span class="free"><span class="bound"><span class="entity">cr1</span></span></span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">sr1</span></span></span><span class="main">,</span> tighten_poly_bounds <span class="free"><span class="bound"><span class="entity">cr2</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="free"><span class="bound"><span class="entity">sr2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tighten_poly_bounds_binary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">l1</span><span class="main">,</span><span class="free">r1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p2</span><span class="main">,</span><span class="free">l2</span><span class="main">,</span><span class="free">r2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pt<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="free">p1</span>"</span></span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="free">p2</span>"</span></span> 
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≡</span> the_unique_root <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">l1</span><span class="main">,</span><span class="free">r1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≡</span> the_unique_root <span class="main">(</span><span class="free">p2</span><span class="main">,</span><span class="free">l2</span><span class="main">,</span><span class="free">r2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l1</span> <span class="bound">r1</span> <span class="bound">l2</span> <span class="bound">r2</span> <span class="bound">l</span> <span class="bound">r</span> <span class="bound">sr1</span> <span class="bound">sr2</span><span class="main">.</span> <span class="free">I</span> <span class="bound">l1</span> <span class="main">⟹</span> <span class="free">I</span> <span class="bound">l2</span> <span class="main">⟹</span> root_cond <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="bound">l1</span><span class="main">,</span><span class="bound">r1</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> root_cond <span class="main">(</span><span class="free">p2</span><span class="main">,</span><span class="bound">l2</span><span class="main">,</span><span class="bound">r2</span><span class="main">)</span> <span class="free">y</span> <span class="main">⟹</span>
      <span class="free">bnd</span> <span class="main">(</span><span class="main">(</span><span class="bound">l1</span><span class="main">,</span><span class="bound">r1</span><span class="main">,</span><span class="bound">sr1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">l2</span><span class="main">,</span><span class="bound">r2</span><span class="main">,</span><span class="bound">sr2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">⟹</span> of_rat <span class="bound">l</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> of_rat <span class="bound">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> approx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l1</span> <span class="bound">r1</span> <span class="bound">l2</span> <span class="bound">r2</span> <span class="bound">l1'</span> <span class="bound">r1'</span> <span class="bound">l2'</span> <span class="bound">r2'</span> <span class="bound">l</span> <span class="bound">l'</span> <span class="bound">r</span> <span class="bound">r'</span> <span class="bound">sr1</span> <span class="bound">sr2</span> <span class="bound">sr1'</span> <span class="bound">sr2'</span><span class="main">.</span> 
    <span class="free">I</span> <span class="bound">l1</span> <span class="main">⟹</span> <span class="free">I</span> <span class="bound">l2</span> <span class="main">⟹</span>
    <span class="bound">l1</span> <span class="main">≤</span> <span class="bound">r1</span> <span class="main">⟹</span> <span class="bound">l2</span> <span class="main">≤</span> <span class="bound">r2</span> <span class="main">⟹</span> 
    <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">bnd</span> <span class="main">(</span><span class="main">(</span><span class="bound">l1</span><span class="main">,</span><span class="bound">r1</span><span class="main">,</span><span class="bound">sr1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">l2</span><span class="main">,</span><span class="bound">r2</span><span class="main">,</span><span class="bound">sr2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="bound">l'</span><span class="main">,</span><span class="bound">r'</span><span class="main">)</span> <span class="main">=</span> <span class="free">bnd</span> <span class="main">(</span><span class="main">(</span><span class="bound">l1'</span><span class="main">,</span><span class="bound">r1'</span><span class="main">,</span><span class="bound">sr1'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">l2'</span><span class="main">,</span><span class="bound">r2'</span><span class="main">,</span><span class="bound">sr2'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="bound">l1'</span><span class="main">,</span><span class="bound">r1'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">l1</span><span class="main">,</span><span class="main">(</span><span class="bound">l1</span><span class="main">+</span><span class="bound">r1</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">(</span><span class="bound">l1</span><span class="main">+</span><span class="bound">r1</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span><span class="bound">r1</span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="bound">l2'</span><span class="main">,</span><span class="bound">r2'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">l2</span><span class="main">,</span><span class="main">(</span><span class="bound">l2</span><span class="main">+</span><span class="bound">r2</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">(</span><span class="bound">l2</span><span class="main">+</span><span class="bound">r2</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span><span class="bound">r2</span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="bound">r'</span> <span class="main">-</span> <span class="bound">l'</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="bound">r</span> <span class="main">-</span> <span class="bound">l</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">≤</span> <span class="bound">l'</span> <span class="main">∧</span> <span class="bound">r'</span> <span class="main">≤</span> <span class="bound">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> I_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l</span> <span class="bound">l'</span><span class="main">.</span> <span class="free">I</span> <span class="bound">l</span> <span class="main">⟹</span> <span class="bound">l</span> <span class="main">≤</span> <span class="bound">l'</span> <span class="main">⟹</span> <span class="free">I</span> <span class="bound">l'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="free">l1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="free">l2</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> sr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sr1</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p1</span> <span class="free">r1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sr2</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p2</span> <span class="free">r2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"converges_to <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">bnd</span> <span class="main">(</span><span class="main">(</span>tighten_poly_bounds_binary <span class="free">p1</span> <span class="free">p2</span> <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">l1</span><span class="main">,</span><span class="free">r1</span><span class="main">,</span><span class="free">sr1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">l2</span><span class="main">,</span><span class="free">r2</span><span class="main">,</span><span class="free">sr2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?upd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds_binary <span class="free">p1</span> <span class="free">p2</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">upd</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">upd</span> <span class="main">=</span> <span class="var">?upd</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">init</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">init</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">l1</span><span class="main">,</span> <span class="free">r1</span><span class="main">,</span> <span class="free">sr1</span><span class="main">)</span><span class="main">,</span> <span class="free">l2</span><span class="main">,</span> <span class="free">r2</span><span class="main">,</span> <span class="free">sr2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">bnd</span> <span class="main">(</span><span class="main">(</span><span class="skolem">upd</span> <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">init</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> bnd_init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bnd</span> <span class="skolem">init</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">note</span></span> ur1 <span class="main">=</span> unique_rootD<span class="main">[</span><span class="operator">OF</span> ur<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> ur2 <span class="main">=</span> unique_rootD<span class="main">[</span><span class="operator">OF</span> ur<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> ur1<span class="main">(</span>4<span class="main">)</span> ur2<span class="main">(</span>4<span class="main">)</span> x_def y_def
  <span class="keyword1"><span class="command">have</span></span> rc1<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">l1</span><span class="main">,</span><span class="free">r1</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rc2<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p2</span><span class="main">,</span><span class="free">l2</span><span class="main">,</span><span class="free">r2</span><span class="main">)</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="var">?g</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">L1</span> <span class="skolem">R1</span> <span class="skolem">L2</span> <span class="skolem">R2</span> <span class="skolem">L</span> <span class="skolem">R</span> <span class="skolem">j</span> <span class="skolem">SR1</span> <span class="skolem">SR2</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">upd</span> <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">init</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">L1</span><span class="main">,</span><span class="skolem">R1</span><span class="main">,</span><span class="skolem">SR1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">L2</span><span class="main">,</span><span class="skolem">R2</span><span class="main">,</span><span class="skolem">SR2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">L</span><span class="main">,</span><span class="skolem">R</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="skolem">L1</span> <span class="main">∧</span> <span class="free">I</span> <span class="skolem">L2</span> <span class="main">∧</span> root_cond <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="skolem">L1</span><span class="main">,</span><span class="skolem">R1</span><span class="main">)</span> <span class="free">x</span> <span class="main">∧</span> root_cond <span class="main">(</span><span class="free">p2</span><span class="main">,</span><span class="skolem">L2</span><span class="main">,</span><span class="skolem">R2</span><span class="main">)</span> <span class="free">y</span> <span class="main">∧</span>
      unique_root <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="skolem">L1</span><span class="main">,</span> <span class="skolem">R1</span><span class="main">)</span> <span class="main">∧</span> unique_root <span class="main">(</span><span class="free">p2</span><span class="main">,</span> <span class="skolem">L2</span><span class="main">,</span> <span class="skolem">R2</span><span class="main">)</span> <span class="main">∧</span> in_interval <span class="main">(</span><span class="skolem">L</span><span class="main">,</span><span class="skolem">R</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">j</span> <span class="main">⟶</span> sub_interval <span class="main">(</span><span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">-</span> <span class="skolem">L</span> <span class="main">≤</span> <span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span>snd <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> fst <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="skolem">SR1</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p1</span> <span class="skolem">R1</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">SR2</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p2</span> <span class="skolem">R2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">L1</span></span> <span class="quoted"><span class="skolem">R1</span></span> <span class="quoted"><span class="skolem">L2</span></span> <span class="quoted"><span class="skolem">R2</span></span> <span class="quoted"><span class="skolem">L</span></span> <span class="quoted"><span class="skolem">R</span></span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="skolem">SR1</span></span> <span class="quoted"><span class="skolem">SR2</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> I rc1 rc2 ur bnd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l1</span></span> <span class="quoted"><span class="free">l2</span></span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">r2</span></span> <span class="quoted"><span class="free">sr1</span></span> <span class="quoted"><span class="free">sr2</span></span> <span class="quoted"><span class="skolem">L</span></span> <span class="quoted"><span class="skolem">R</span></span><span class="main">]</span> g_def sr <span class="keyword1"><span class="command">unfolding</span></span> init_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">r2</span></span> <span class="skolem"><span class="skolem">sr1</span></span> <span class="skolem"><span class="skolem">sr2</span></span> <span class="keyword2"><span class="keyword">where</span></span> updi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">upd</span> <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">init</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="skolem">r1</span><span class="main">,</span> <span class="skolem">sr1</span><span class="main">)</span><span class="main">,</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">,</span> <span class="skolem">sr2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">upd</span> <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">init</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> bndi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bnd</span> <span class="main">(</span><span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="skolem">r1</span><span class="main">,</span> <span class="skolem">sr1</span><span class="main">)</span><span class="main">,</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">,</span> <span class="skolem">sr2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> gi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> updi <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">upd</span> <span class="main">^^</span> Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">init</span> <span class="main">=</span> <span class="skolem">upd</span> <span class="main">(</span><span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="skolem">r1</span><span class="main">,</span> <span class="skolem">sr1</span><span class="main">)</span><span class="main">,</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">,</span> <span class="skolem">sr2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> updi <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> upd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">upd</span> <span class="main">(</span><span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="skolem">r1</span><span class="main">,</span> <span class="skolem">sr1</span><span class="main">)</span><span class="main">,</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">,</span> <span class="skolem">sr2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">L1</span><span class="main">,</span> <span class="skolem">R1</span><span class="main">,</span> <span class="skolem">SR1</span><span class="main">)</span><span class="main">,</span> <span class="skolem">L2</span><span class="main">,</span> <span class="skolem">R2</span><span class="main">,</span> <span class="skolem">SR2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> upd updi Suc<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> bndsi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bnd</span> <span class="main">(</span><span class="main">(</span><span class="skolem">L1</span><span class="main">,</span> <span class="skolem">R1</span><span class="main">,</span> <span class="skolem">SR1</span><span class="main">)</span><span class="main">,</span> <span class="skolem">L2</span><span class="main">,</span> <span class="skolem">R2</span><span class="main">,</span> <span class="skolem">SR2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">L</span><span class="main">,</span><span class="skolem">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> updi gi<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="skolem">l1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="skolem">l2</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="skolem">l1</span><span class="main">,</span><span class="skolem">r1</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p2</span><span class="main">,</span><span class="skolem">l2</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span> <span class="free">y</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="skolem">l1</span><span class="main">,</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p2</span><span class="main">,</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> sr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sr1</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p1</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sr2</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p2</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> upd<span class="main">[</span><span class="operator">unfolded</span> upd_def<span class="main">]</span> 
      <span class="keyword1"><span class="command">have</span></span> tight<span class="main">:</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds <span class="free">p1</span> <span class="skolem">l1</span> <span class="skolem">r1</span> <span class="skolem">sr1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">L1</span><span class="main">,</span> <span class="skolem">R1</span><span class="main">,</span> <span class="skolem">SR1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tighten_poly_bounds <span class="free">p2</span> <span class="skolem">l2</span> <span class="skolem">r2</span> <span class="skolem">sr2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">L2</span><span class="main">,</span> <span class="skolem">R2</span><span class="main">,</span> <span class="skolem">SR2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">note</span></span> tight1 <span class="main">=</span> tighten_poly_bounds<span class="main">[</span><span class="operator">OF</span> tight<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span> ur<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span> pt<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span> sr<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">note</span></span> tight2 <span class="main">=</span> tighten_poly_bounds<span class="main">[</span><span class="operator">OF</span> tight<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span> ur<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span> pt<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span> sr<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">from</span></span> tight1 <span class="keyword1"><span class="command">have</span></span> lr1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="main">≤</span> <span class="skolem">r1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> tight2 <span class="keyword1"><span class="command">have</span></span> lr2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">≤</span> <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">note</span></span> ur1 <span class="main">=</span> unique_rootD<span class="main">[</span><span class="operator">OF</span> ur<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">note</span></span> ur2 <span class="main">=</span> unique_rootD<span class="main">[</span><span class="operator">OF</span> ur<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">from</span></span> tight1 I_mono<span class="main">[</span><span class="operator">OF</span> I<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> I1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="skolem">L1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> tight2 I_mono<span class="main">[</span><span class="operator">OF</span> I<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> I2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="skolem">L2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">note</span></span> ur1 <span class="main">=</span> unique_root_sub_interval<span class="main">[</span><span class="operator">OF</span> ur<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> tight1<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">note</span></span> ur2 <span class="main">=</span> unique_root_sub_interval<span class="main">[</span><span class="operator">OF</span> ur<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span> tight2<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">from</span></span> rc<span class="main">(</span>1<span class="main">)</span> ur ur1 <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="skolem">L1</span><span class="main">,</span><span class="skolem">R1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>the_unique_root_eqI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> rc<span class="main">(</span>2<span class="main">)</span> ur ur2 <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p2</span><span class="main">,</span><span class="skolem">L2</span><span class="main">,</span><span class="skolem">R2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>the_unique_root_eqI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> unique_rootD<span class="main">[</span><span class="operator">OF</span> ur1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span><span class="main">]</span> x <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="skolem">L1</span><span class="main">,</span><span class="skolem">R1</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> unique_rootD<span class="main">[</span><span class="operator">OF</span> ur2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span><span class="main">]</span> y <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p2</span><span class="main">,</span><span class="skolem">L2</span><span class="main">,</span><span class="skolem">R2</span><span class="main">)</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> tight<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> half1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">L1</span><span class="main">,</span> <span class="skolem">R1</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="main">(</span><span class="skolem">l1</span> <span class="main">+</span> <span class="skolem">r1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">(</span><span class="skolem">l1</span> <span class="main">+</span> <span class="skolem">r1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">,</span> <span class="skolem">r1</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> tighten_poly_bounds_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> tight<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> half2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">L2</span><span class="main">,</span> <span class="skolem">R2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="skolem">l2</span><span class="main">,</span> <span class="main">(</span><span class="skolem">l2</span> <span class="main">+</span> <span class="skolem">r2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">(</span><span class="skolem">l2</span> <span class="main">+</span> <span class="skolem">r2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> tighten_poly_bounds_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> approx<span class="main">[</span><span class="operator">OF</span> I lr1 lr2 bndi<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> bndsi<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> half1 half2<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">-</span> <span class="skolem">L</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">L</span> <span class="main">∧</span> <span class="skolem">R</span> <span class="main">≤</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sub_interval <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">-</span> <span class="skolem">L</span> <span class="main">≤</span> <span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span>snd <span class="main">(</span><span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> fst <span class="main">(</span><span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> gi Suc<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> bnd<span class="main">[</span><span class="operator">OF</span> I1 I2 x y bndsi<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> I1 I2 x y ur1 ur2 tight1<span class="main">(</span>6<span class="main">)</span> tight2<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> invariants <span class="main">=</span> this
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">L</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> fst <span class="main">(</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> snd <span class="main">(</span><span class="skolem">g</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">r2</span></span> <span class="skolem"><span class="skolem">sr1</span></span> <span class="skolem"><span class="skolem">sr2</span></span> <span class="keyword2"><span class="keyword">where</span></span> updi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">upd</span> <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">init</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="skolem">r1</span><span class="main">,</span> <span class="skolem">sr1</span><span class="main">)</span><span class="main">,</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">,</span> <span class="skolem">sr2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">upd</span> <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">init</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> bnd'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bnd</span> <span class="main">(</span><span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="skolem">r1</span><span class="main">,</span> <span class="skolem">sr1</span><span class="main">)</span><span class="main">,</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">,</span> <span class="skolem">sr2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> gi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def updi bnd' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">L</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">R</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> invariants<span class="main">[</span><span class="operator">OF</span> updi gi<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> id<span class="main"><span class="main">]</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_interval <span class="main">(</span><span class="skolem">L</span> <span class="skolem">i</span><span class="main">,</span> <span class="skolem">R</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">j</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">=</span> Suc <span class="bound">j</span> <span class="main">⟹</span> sub_interval <span class="main">(</span><span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">R</span> <span class="skolem">i</span> <span class="main">-</span> <span class="skolem">L</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span> <span class="bound">j</span> <span class="main">-</span> <span class="skolem">L</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> L_def R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">from</span></span> *<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> *<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> refl<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_interval <span class="main">(</span><span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"sub_interval <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">L</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">i</span> <span class="main">-</span> <span class="skolem">L</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def R_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> upd_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> init_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> g_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> converges_to_def 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> *<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> *<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">eps</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> eps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">eps</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted">real_of_rat</span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?r</span> <span class="main">(</span><span class="skolem">R</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?r</span> <span class="main">(</span><span class="skolem">L</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">diff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">diff</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">r</span> <span class="bound">n</span> <span class="main">-</span> <span class="skolem">l</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">from</span></span> *<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">L</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?r</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">L</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> of_rat_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">L</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">l</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> of_rat_diff r_def l_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">L</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">r</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">l</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> r_def l_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">diff</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">diff</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> diff_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">diff</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span><span class="main">^</span><span class="skolem">i</span> <span class="main">*</span> <span class="skolem">diff</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Suc *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">diff</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span><span class="main">^</span><span class="bound">i</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">diff</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">eps</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≤</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> eps <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False  
      <span class="keyword1"><span class="command">hence</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> eps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">eps</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> exp_tends_to_zero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span> <span class="main">::</span> real"</span></span><span class="main">,</span> <span class="operator">OF</span> _ _ this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">≤</span> inverse <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">eps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> mult_right_mono<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> c
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">eps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">(</span><span class="skolem">R</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="var">?r</span> <span class="main">(</span><span class="skolem">L</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">eps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_def r_def diff_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∧</span> <span class="var">?r</span> <span class="bound">r</span> <span class="main">-</span> <span class="var">?r</span> <span class="bound">l</span> <span class="main">≤</span> <span class="skolem">eps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def R_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">add_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> real_alg_1 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">add_1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
     select_correct_factor_int_poly
       <span class="main">(</span>tighten_poly_bounds_binary <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span>
       <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="main">(</span><span class="bound">l1</span><span class="main">,</span><span class="bound">r1</span><span class="main">,</span><span class="bound">sr1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">l2</span><span class="main">,</span><span class="bound">r2</span><span class="main">,</span><span class="bound">sr2</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">l1</span> <span class="main">+</span> <span class="bound">l2</span><span class="main">,</span> <span class="bound">r1</span> <span class="main">+</span> <span class="bound">r2</span><span class="main">)</span><span class="main">)</span>
       <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">l1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">,</span>sgn <span class="main">(</span>ipoly <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">,</span> sgn <span class="main">(</span>ipoly <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
       <span class="main">(</span>poly_add <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> add_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≡</span> add_1 <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">z</span> <span class="main">∧</span> <span class="main">(</span>real_of_2 <span class="free">z</span> <span class="main">=</span> real_of_1 <span class="free">x</span> <span class="main">+</span> real_of_1 <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> xt<span class="main">:</span> <span class="main">(</span>fields <span class="skolem">p1</span> <span class="skolem">l1</span> <span class="skolem">r1</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> yt<span class="main">:</span> <span class="main">(</span>fields <span class="skolem">p2</span> <span class="skolem">l2</span> <span class="skolem">r2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span> <span class="skolem">l1</span><span class="main">,</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poly_add <span class="skolem">p1</span> <span class="skolem">p2</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> x <span class="main">=</span> x<span class="main">[</span><span class="operator">unfolded</span> xt<span class="main">]</span>
    <span class="keyword1"><span class="command">note</span></span> y <span class="main">=</span> y<span class="main">[</span><span class="operator">unfolded</span> yt<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> ax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="keyword1">represents</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> invariant_1E<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> ay<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="keyword1">represents</span> <span class="var">?y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> invariant_1E<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bnd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">l1</span><span class="main">,</span> <span class="bound">r1</span><span class="main">,</span> <span class="bound">sr1</span> <span class="main">::</span> rat<span class="main">)</span><span class="main">,</span> <span class="bound">l2</span> <span class="main">::</span> rat<span class="main">,</span> <span class="bound">r2</span> <span class="main">::</span> rat<span class="main">,</span> <span class="bound">sr2</span> <span class="main">::</span> rat<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">l1</span> <span class="main">+</span> <span class="bound">l2</span><span class="main">,</span> <span class="bound">r1</span> <span class="main">+</span> <span class="bound">r2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bnd</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bnd</span> <span class="main">=</span> <span class="var">?bnd</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">z</span> <span class="main">∧</span> real_of_2 <span class="free">z</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">+</span> <span class="var">?y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> select_correct_factor_int_poly<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> represents_add<span class="main">[</span><span class="operator">OF</span> ax ay<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="var">?p</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="var">?y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> z<span class="main">[</span><span class="operator">unfolded</span> xt yt<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> sel<span class="main">:</span> <span class="quoted"><span class="quoted">"select_correct_factor_int_poly
          <span class="main">(</span>tighten_poly_bounds_binary <span class="skolem">p1</span> <span class="skolem">p2</span><span class="main">)</span>
          <span class="skolem">bnd</span> 
          <span class="main">(</span><span class="main">(</span><span class="skolem">l1</span><span class="main">,</span><span class="skolem">r1</span><span class="main">,</span>sgn <span class="main">(</span>ipoly <span class="skolem">p1</span> <span class="skolem">r1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">l2</span><span class="main">,</span><span class="skolem">r2</span><span class="main">,</span> sgn <span class="main">(</span>ipoly <span class="skolem">p2</span> <span class="skolem">r2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span>poly_add <span class="skolem">p1</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bnd_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> ur1<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">l1</span><span class="main">,</span><span class="skolem">r1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="skolem">p1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ur2<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span><span class="skolem">l2</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="skolem">p2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"converges_to
        <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">bnd</span> <span class="main">(</span><span class="main">(</span>tighten_poly_bounds_binary <span class="skolem">p1</span> <span class="skolem">p2</span> <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span>
        <span class="main">(</span><span class="main">(</span><span class="skolem">l1</span><span class="main">,</span><span class="skolem">r1</span><span class="main">,</span>sgn <span class="main">(</span>ipoly <span class="skolem">p1</span> <span class="skolem">r1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">l2</span><span class="main">,</span><span class="skolem">r2</span><span class="main">,</span> sgn <span class="main">(</span>ipoly <span class="skolem">p2</span> <span class="skolem">r2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?x</span> <span class="main">+</span> <span class="var">?y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tighten_poly_bounds_binary ur1 ur2<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bnd_def <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> xt yt <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">declare</span></span> add_rat_1.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> add_1.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="comment1">(* ********************* *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Multiplication›</span></span>
  
<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">mult_rat_1_pos</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> real_alg_1 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mult_rat_1_pos</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="main">=</span> real_alg_2 <span class="main">(</span>cf_pos_poly <span class="main">(</span>poly_mult_rat <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">mult_1_pos</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> real_alg_1 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mult_1_pos</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span> <span class="main">=</span>
      select_correct_factor_int_poly 
        <span class="main">(</span>tighten_poly_bounds_binary <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span>
        <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="main">(</span><span class="bound">l1</span><span class="main">,</span><span class="bound">r1</span><span class="main">,</span><span class="bound">sr1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">l2</span><span class="main">,</span><span class="bound">r2</span><span class="main">,</span><span class="bound">sr2</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">l1</span> <span class="main">*</span> <span class="bound">l2</span><span class="main">,</span> <span class="bound">r1</span> <span class="main">*</span> <span class="bound">r2</span><span class="main">)</span><span class="main">)</span>
        <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">l1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">,</span>sgn <span class="main">(</span>ipoly <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">,</span> sgn <span class="main">(</span>ipoly <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">(</span>poly_mult <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mult_rat_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> real_alg_1 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mult_rat_1</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> uminus_2 <span class="main">(</span>mult_rat_1_pos <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Rational <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span>mult_rat_1_pos <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mult_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> real_alg_1 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mult_1</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="main">(</span><span class="bound">p1</span><span class="main">,</span><span class="bound">l1</span><span class="main">,</span><span class="bound">r1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">p2</span><span class="main">,</span><span class="bound">l2</span><span class="main">,</span><span class="bound">r2</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span>
   <span class="keyword1">if</span> <span class="bound">r1</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span>
     <span class="keyword1">if</span> <span class="bound">r2</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> mult_1_pos <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>
     <span class="keyword1">else</span> uminus_2 <span class="main">(</span>mult_1_pos <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>uminus_1 <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>
   <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">r2</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> uminus_2 <span class="main">(</span>mult_1_pos <span class="main">(</span>uminus_1 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>
     <span class="keyword1">else</span> mult_1_pos <span class="main">(</span>uminus_1 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>uminus_1 <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_rat_1_pos<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r1</span> <span class="main">::</span> <span class="quoted">rat</span> <span class="keyword2"><span class="keyword">assumes</span></span> r1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≡</span> mult_rat_1_pos <span class="free">r1</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">z</span> <span class="main">∧</span> <span class="main">(</span>real_of_2 <span class="free">z</span> <span class="main">=</span> of_rat <span class="free">r1</span> <span class="main">*</span> real_of_1 <span class="free">y</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">r2</span></span> <span class="keyword2"><span class="keyword">where</span></span> yt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span><span class="skolem">l2</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">r1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poly_mult_rat <span class="free">r1</span> <span class="skolem">p2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cf_pos_poly <span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> y <span class="main">=</span> y<span class="main">[</span><span class="operator">unfolded</span> yt<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> yD <span class="main">=</span> invariant_1D<span class="main">[</span><span class="operator">OF</span> y<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> yD r1 <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> mp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mp</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> yD<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">p2</span> <span class="var">?y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="skolem">l2</span> <span class="main">≤</span> <span class="var">?y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">≤</span> of_rat <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> rt r1 <span class="keyword1"><span class="command">have</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="var">?mp</span> <span class="main">(</span><span class="var">?x</span> <span class="main">*</span> <span class="var">?y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> ipoly_mult_rat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> r10<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> yD<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">p2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> poly_mult_rat_irreducible<span class="main">[</span><span class="operator">OF</span> this _ r10<span class="main">]</span> yD
  <span class="keyword1"><span class="command">have</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="var">?mp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> mon<span class="main">:</span> <span class="quoted"><span class="quoted">"cf_pos <span class="var">?mp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">l2</span> <span class="main">*</span> <span class="free">r1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">r2</span> <span class="main">*</span> <span class="free">r1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> bnd r1 <span class="keyword1"><span class="command">have</span></span> bnd<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="skolem">l</span> <span class="main">≤</span> <span class="var">?x</span> <span class="main">*</span> <span class="var">?y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">*</span> <span class="var">?y</span> <span class="main">≤</span> of_rat <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lr of_rat_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> rt <span class="keyword1"><span class="command">have</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="var">?mp</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="var">?x</span> <span class="main">*</span> <span class="var">?y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="var">?mp</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex1I<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> rc<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="var">?mp</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> root_cond_def split<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bndz<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> of_rat <span class="skolem">r</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="var">?mp</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>quotient_of <span class="free">r1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quotient_of_div<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r1</span></span><span class="main">]</span> r10 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"quotient_of <span class="free">r1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> rt <span class="keyword1"><span class="command">have</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">p2</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> inverse <span class="var">?x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ipoly_mult_rat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> r10<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> bndz r1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="skolem">l2</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">*</span> inverse <span class="var">?x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">*</span> inverse <span class="var">?x</span> <span class="main">≤</span> of_rat <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lr of_rat_mult
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> rt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span><span class="skolem">l2</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> inverse <span class="var">?x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> invariant_1_root_cond<span class="main">[</span><span class="operator">OF</span> y<span class="main">]</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">*</span> inverse <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">*</span> <span class="var">?y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> r1 <span class="keyword1"><span class="command">have</span></span> sgnr<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="skolem">r</span> <span class="main">=</span> sgn <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lr 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_neg_pos mult_less_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> r1 <span class="keyword1"><span class="command">have</span></span> sgnl<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="skolem">l</span> <span class="main">=</span> sgn <span class="skolem">l2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lr 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_neg_pos mult_less_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> the_unique_root_eqI<span class="main">[</span><span class="operator">OF</span> ur rc<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">*</span> <span class="var">?y</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="var">?mp</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> z<span class="main">[</span><span class="operator">unfolded</span> yt<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">unfolded</span> Let_def lr<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> split<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> real_alg_2 <span class="main">(</span><span class="var">?mp</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> yp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="keyword1">represents</span> <span class="var">?y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> yD <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def split represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> irr mon <span class="keyword1"><span class="command">have</span></span> pc<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond <span class="var">?mp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_cond_def cf_pos_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="var">?mp</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> z <span class="keyword1"><span class="command">using</span></span> yD<span class="main">(</span>2<span class="main">)</span> pc ur 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invariant_1_def ur mp sgnr sgnl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> z <span class="keyword1"><span class="command">using</span></span> real_alg_2<span class="main">[</span><span class="operator">OF</span> rc<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> yt xy <span class="keyword1"><span class="command">unfolding</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_1_pos<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≡</span> mult_1_pos <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pos<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"real_of_1 <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">z</span> <span class="main">∧</span> <span class="main">(</span>real_of_2 <span class="free">z</span> <span class="main">=</span> real_of_1 <span class="free">x</span> <span class="main">*</span> real_of_1 <span class="free">y</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="keyword2"><span class="keyword">where</span></span> xt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">l1</span><span class="main">,</span><span class="skolem">r1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">r2</span></span> <span class="keyword2"><span class="keyword">where</span></span> yt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span><span class="skolem">l2</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span> <span class="skolem">l1</span><span class="main">,</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poly_mult <span class="skolem">p1</span> <span class="skolem">p2</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> x <span class="main">=</span> x<span class="main">[</span><span class="operator">unfolded</span> xt<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> y <span class="main">=</span> y<span class="main">[</span><span class="operator">unfolded</span> yt<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> x y <span class="keyword1"><span class="command">have</span></span> basic<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span> <span class="skolem">l1</span><span class="main">,</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="skolem">p1</span>"</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="skolem">p2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> basic <span class="keyword1"><span class="command">have</span></span> irr1<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">p1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> irr2<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">p2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> ax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="keyword1">represents</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>invariant_1E<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> ay<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="keyword1">represents</span> <span class="var">?y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>invariant_1E<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ax ay pos<span class="main">[</span><span class="operator">unfolded</span> xt yt<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> axy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">represents</span> <span class="main">(</span><span class="var">?x</span> <span class="main">*</span> <span class="var">?y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> represents_mult represents_irr_non_0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> irr2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> representsD<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="var">?p</span> <span class="main">(</span><span class="var">?x</span> <span class="main">*</span> <span class="var">?y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> x pos<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> xt<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">r1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sgn <span class="skolem">r1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="skolem">l1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> l1_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> y pos<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> yt<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">r2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sgn <span class="skolem">r2</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="skolem">l2</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> l2_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bnd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">l1</span><span class="main">,</span> <span class="bound">r1</span><span class="main">,</span> <span class="bound">sr1</span> <span class="main">::</span> rat<span class="main">)</span><span class="main">,</span> <span class="bound">l2</span> <span class="main">::</span> rat<span class="main">,</span> <span class="bound">r2</span> <span class="main">::</span> rat<span class="main">,</span> <span class="bound">sr2</span> <span class="main">::</span> rat<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">l1</span> <span class="main">*</span> <span class="bound">l2</span><span class="main">,</span> <span class="bound">r1</span> <span class="main">*</span> <span class="bound">r2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bnd</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bnd</span> <span class="main">=</span> <span class="var">?bnd</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> sel<span class="main">:</span> <span class="quoted"><span class="quoted">"select_correct_factor_int_poly
        <span class="main">(</span>tighten_poly_bounds_binary <span class="skolem">p1</span> <span class="skolem">p2</span><span class="main">)</span>
        <span class="skolem">bnd</span> 
        <span class="main">(</span><span class="main">(</span><span class="skolem">l1</span><span class="main">,</span><span class="skolem">r1</span><span class="main">,</span>sgn <span class="main">(</span>ipoly <span class="skolem">p1</span> <span class="skolem">r1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">l2</span><span class="main">,</span><span class="skolem">r2</span><span class="main">,</span> sgn <span class="main">(</span>ipoly <span class="skolem">p2</span> <span class="skolem">r2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
        <span class="var">?p</span> <span class="main">=</span> <span class="skolem">z'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="skolem">z'</span> <span class="main">∧</span> real_of_2 <span class="skolem">z'</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">*</span> <span class="var">?y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> select_correct_factor_int_poly<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ sel rt p<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l1</span> <span class="skolem">r1</span> <span class="skolem">l2</span> <span class="skolem">r2</span> <span class="skolem">l1'</span> <span class="skolem">r1'</span> <span class="skolem">l2'</span> <span class="skolem">r2'</span> <span class="skolem">l</span> <span class="skolem">l'</span> <span class="skolem">r</span> <span class="skolem">r'</span> <span class="main">::</span> <span class="quoted">rat</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l1</span><span class="main">+</span><span class="skolem">r1</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l2</span><span class="main">+</span><span class="skolem">r2</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">-</span> <span class="skolem">l1</span>"</span></span> 
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span> <span class="main">=</span> <span class="skolem">r2</span> <span class="main">-</span> <span class="skolem">l2</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="main">+</span> <span class="skolem">d1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">+</span> <span class="skolem">d2</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="main">≤</span> <span class="skolem">r1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">≤</span> <span class="skolem">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l1</span> <span class="main">*</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r1</span> <span class="main">*</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l1'</span> <span class="main">*</span> <span class="skolem">l2'</span><span class="main">,</span> <span class="skolem">r1'</span> <span class="main">*</span> <span class="skolem">r2'</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l1'</span><span class="main">,</span> <span class="skolem">r1'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="skolem">l1</span><span class="main">,</span> <span class="var">?m1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="var">?m1</span><span class="main">,</span> <span class="skolem">r1</span><span class="main">)</span><span class="main">}</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l2'</span><span class="main">,</span> <span class="skolem">r2'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="skolem">l2</span><span class="main">,</span> <span class="var">?m2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="var">?m2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">l1</span> <span class="main">*</span> <span class="skolem">l2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l1</span> <span class="main">+</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">l2</span> <span class="main">+</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> <span class="skolem">l1'</span> <span class="main">*</span> <span class="skolem">l2'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">=</span> <span class="skolem">r1'</span> <span class="main">*</span> <span class="skolem">r2'</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">=</span> <span class="skolem">l1</span> <span class="main">+</span> <span class="skolem">d1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">=</span> <span class="skolem">l2</span> <span class="main">+</span> <span class="skolem">d2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> id'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?m1</span> <span class="main">=</span> <span class="var">?M1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m2</span> <span class="main">=</span> <span class="var">?M2</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> d1_def d2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l1d1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l1d1</span> <span class="main">=</span> <span class="skolem">l1</span> <span class="main">+</span> <span class="skolem">d1</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> le <span class="keyword1"><span class="command">have</span></span> ge0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d1_def d2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">r'</span> <span class="main">-</span> <span class="skolem">l'</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l1'</span> <span class="main">=</span> <span class="skolem">l1</span> <span class="main">∧</span> <span class="skolem">r1'</span> <span class="main">=</span> <span class="var">?M1</span> <span class="main">∧</span> <span class="skolem">l2'</span> <span class="main">=</span> <span class="skolem">l2</span> <span class="main">∧</span> <span class="skolem">r2'</span> <span class="main">=</span> <span class="var">?M2</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l1'</span> <span class="main">=</span> <span class="skolem">l1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1'</span> <span class="main">=</span> <span class="var">?M1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2'</span> <span class="main">=</span> <span class="skolem">l2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2'</span> <span class="main">=</span> <span class="var">?M2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id id2 <span class="keyword1"><span class="command">unfolding</span></span> ring_distribs <span class="keyword1"><span class="command">using</span></span> ge0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> 1 <span class="main">=</span> this
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l1'</span> <span class="main">=</span> <span class="skolem">l1</span> <span class="main">∧</span> <span class="skolem">r1'</span> <span class="main">=</span> <span class="var">?M1</span> <span class="main">∧</span> <span class="skolem">l2'</span> <span class="main">=</span> <span class="var">?M2</span> <span class="main">∧</span> <span class="skolem">r2'</span> <span class="main">=</span> <span class="skolem">r2</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">hence</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l1'</span> <span class="main">=</span> <span class="skolem">l1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1'</span> <span class="main">=</span> <span class="var">?M1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2'</span> <span class="main">=</span> <span class="var">?M2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2'</span> <span class="main">=</span> <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id id2 <span class="keyword1"><span class="command">unfolding</span></span> ring_distribs <span class="keyword1"><span class="command">using</span></span> ge0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> 2 <span class="main">=</span> this
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l1'</span> <span class="main">=</span> <span class="var">?M1</span> <span class="main">∧</span> <span class="skolem">r1'</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">∧</span> <span class="skolem">l2'</span> <span class="main">=</span> <span class="skolem">l2</span> <span class="main">∧</span> <span class="skolem">r2'</span> <span class="main">=</span> <span class="var">?M2</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">hence</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l1'</span> <span class="main">=</span> <span class="var">?M1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1'</span> <span class="main">=</span> <span class="skolem">r1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2'</span> <span class="main">=</span> <span class="skolem">l2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2'</span> <span class="main">=</span> <span class="var">?M2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id id2 <span class="keyword1"><span class="command">unfolding</span></span> ring_distribs <span class="keyword1"><span class="command">using</span></span> ge0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> 3 <span class="main">=</span> this
            <span class="keyword1"><span class="command">from</span></span> 1 2 3 mem <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l1'</span> <span class="main">=</span> <span class="var">?M1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1'</span> <span class="main">=</span> <span class="skolem">r1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2'</span> <span class="main">=</span> <span class="var">?M2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2'</span> <span class="main">=</span> <span class="skolem">r2</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> id' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id id2 <span class="keyword1"><span class="command">unfolding</span></span> ring_distribs <span class="keyword1"><span class="command">using</span></span> ge0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">-</span> <span class="skolem">l'</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> decr <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"converges_to
        <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">bnd</span> <span class="main">(</span><span class="main">(</span>tighten_poly_bounds_binary <span class="skolem">p1</span> <span class="skolem">p2</span> <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span>
        <span class="main">(</span><span class="main">(</span><span class="skolem">l1</span><span class="main">,</span><span class="skolem">r1</span><span class="main">,</span>sgn <span class="main">(</span>ipoly <span class="skolem">p1</span> <span class="skolem">r1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">l2</span><span class="main">,</span><span class="skolem">r2</span><span class="main">,</span> sgn <span class="main">(</span>ipoly <span class="skolem">p2</span> <span class="skolem">r2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?x</span> <span class="main">*</span> <span class="var">?y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> tighten_poly_bounds_binary<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(*)</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> I <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span> <span class="bound"><span class="bound">l</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">l</span></span> <span class="main"><span class="main">&gt;</span></span> <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span>
      basic l1_pos l2_pos<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">L1</span> <span class="skolem">R1</span> <span class="skolem">L2</span> <span class="skolem">R2</span> <span class="skolem">L</span> <span class="skolem">R</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">=</span> <span class="skolem">L1</span> <span class="main">*</span> <span class="skolem">L2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="skolem">R1</span> <span class="main">*</span> <span class="skolem">R2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bnd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">L</span> <span class="main">=</span> <span class="var">?r</span> <span class="skolem">L1</span> <span class="main">*</span> <span class="var">?r</span> <span class="skolem">L2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">R</span> <span class="main">=</span> <span class="var">?r</span> <span class="skolem">R1</span> <span class="main">*</span> <span class="var">?r</span> <span class="skolem">R2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>3-4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">L1</span> <span class="main">≤</span> <span class="var">?x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">≤</span> <span class="var">?r</span> <span class="skolem">R1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">L2</span> <span class="main">≤</span> <span class="var">?y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">≤</span> <span class="var">?r</span> <span class="skolem">R2</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1-2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?r</span> <span class="skolem">L1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?r</span> <span class="skolem">L2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> mult_mono<span class="main">[</span><span class="operator">OF</span> le<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">folded</span> id<span class="main">]</span> lt le <span class="keyword1"><span class="command">have</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">L</span> <span class="main">≤</span> <span class="var">?x</span> <span class="main">*</span> <span class="var">?y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">*</span> <span class="var">?y</span> <span class="main">≤</span> <span class="var">?r</span> <span class="skolem">R</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> le<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">folded</span> id<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> lt le<span class="main"><span class="keyword3">,</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> L R <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">l1</span> <span class="skolem">r1</span> <span class="skolem">l2</span> <span class="skolem">r2</span> <span class="skolem">l1'</span> <span class="skolem">r1'</span> <span class="skolem">l2'</span> <span class="skolem">r2'</span> <span class="skolem">l</span> <span class="skolem">l'</span> <span class="skolem">r</span> <span class="skolem">r'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>5-6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">l1</span> <span class="main">*</span> <span class="skolem">l2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">*</span> <span class="skolem">r2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> <span class="skolem">l1'</span> <span class="main">*</span> <span class="skolem">l2'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">=</span> <span class="skolem">r1'</span> <span class="main">*</span> <span class="skolem">r2'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> bnd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1-4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">l1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">l2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="main">≤</span> <span class="skolem">r1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">≤</span> <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>7-8<span class="main">)</span> le <span class="keyword1"><span class="command">have</span></span> le'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="main">≤</span> <span class="skolem">l1'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1'</span> <span class="main">≤</span> <span class="skolem">r1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">≤</span> <span class="skolem">l2'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2'</span> <span class="main">≤</span> <span class="skolem">r2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r2'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> mult_mono<span class="main">[</span><span class="operator">OF</span> le'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">folded</span> lr<span class="main">]</span> le le' <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">≤</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> le'<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">folded</span> lr<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> le le'<span class="main"><span class="keyword3">,</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">-</span> <span class="skolem">l'</span> <span class="main">≤</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> decr<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ _ _ _ _ 2<span class="main"><span class="main">(</span></span>7-8<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> le le' lr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> l r <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> z'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> z<span class="main">[</span><span class="operator">unfolded</span> xt yt<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">unfolded</span> bnd_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> sel<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> main<span class="main">[</span><span class="operator">unfolded</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> xt yt <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> mult_1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> z<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≡</span> mult_1 <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">z</span> <span class="main">∧</span> <span class="main">(</span>real_of_2 <span class="free">z</span> <span class="main">=</span> real_of_1 <span class="free">x</span> <span class="main">*</span> real_of_1 <span class="free">y</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="keyword2"><span class="keyword">where</span></span> xt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">l1</span><span class="main">,</span><span class="skolem">r1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">r2</span></span> <span class="keyword2"><span class="keyword">where</span></span> yt<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span><span class="skolem">l2</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p1</span><span class="main">,</span> <span class="skolem">l1</span><span class="main">,</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p2</span><span class="main">,</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="var">?xt</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="var">?yt</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mxt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"uminus_1 <span class="var">?xt</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?myt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"uminus_1 <span class="var">?yt</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="var">?mxt</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?my</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="var">?myt</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat"</span></span>
  <span class="keyword1"><span class="command">from</span></span> invariant_1_2_of_rat<span class="main">[</span><span class="operator">OF</span> x<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> invariant_1_2_of_rat<span class="main">[</span><span class="operator">OF</span> y<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> y0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> uminus_1_2<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> mx<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="var">?mxt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?mx</span> <span class="main">=</span> <span class="main">-</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> uminus_1_2<span class="main">[</span><span class="operator">OF</span> y<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> my<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="var">?myt</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?my</span> <span class="main">=</span> <span class="main">-</span> <span class="var">?y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="var">?x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="var">?x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="var">?y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="var">?y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> x0<span class="main">:</span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> y0<span class="main">:</span> True
      <span class="keyword1"><span class="command">with</span></span> x y x0 mult_1_pos<span class="main">[</span><span class="operator">OF</span> x y<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> y0 <span class="keyword1"><span class="command">have</span></span> y0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> x0 <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> uminus_2 <span class="main">(</span>mult_1_pos <span class="var">?xt</span> <span class="var">?myt</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> z xt yt mult_1.simps split id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> x0 y0 mult_1_pos<span class="main">[</span><span class="operator">OF</span> x my<span class="main">]</span> uminus_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"mult_1_pos <span class="var"><span class="var">?xt</span></span> <span class="var"><span class="var">?myt</span></span>"</span></span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> x0 <span class="keyword1"><span class="command">have</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x0</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> y0<span class="main">:</span> True
      <span class="keyword1"><span class="command">with</span></span> x0 x y id <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> uminus_2 <span class="main">(</span>mult_1_pos <span class="var">?mxt</span> <span class="var">?yt</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> x0 y0 mult_1_pos<span class="main">[</span><span class="operator">OF</span> mx y<span class="main">]</span> uminus_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"mult_1_pos <span class="var"><span class="var">?mxt</span></span> <span class="var"><span class="var">?yt</span></span>"</span></span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> y0 <span class="keyword1"><span class="command">have</span></span> y0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> x0 x y <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> mult_1_pos <span class="var">?mxt</span> <span class="var">?myt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> x0 y0 x y mult_1_pos<span class="main">[</span><span class="operator">OF</span> mx my<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  

<span class="keyword1"><span class="command">lemma</span></span> mult_rat_1<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">assumes</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">y</span>"</span></span>  
  <span class="keyword2"><span class="keyword">defines</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≡</span> mult_rat_1 <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">z</span> <span class="main">∧</span> <span class="main">(</span>real_of_2 <span class="free">z</span> <span class="main">=</span> of_rat <span class="free">x</span> <span class="main">*</span> real_of_1 <span class="free">y</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> yt<span class="main">:</span> <span class="main">(</span>fields <span class="skolem">p2</span> <span class="skolem">l2</span> <span class="skolem">r2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p2</span><span class="main">,</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="var">?yt</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?myt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mult_rat_1_pos <span class="main">(</span><span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="var">?yt</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> y <span class="main">=</span> y<span class="main">[</span><span class="operator">unfolded</span> yt<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> z <span class="main">=</span> z<span class="main">[</span><span class="operator">unfolded</span> yt<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>rat"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>linorder_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> x<span class="main">:</span> greater
    <span class="keyword1"><span class="command">with</span></span> z <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> mult_rat_1_pos <span class="free">x</span> <span class="var">?yt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> mult_rat_1_pos<span class="main">[</span><span class="operator">OF</span> x y<span class="main">]</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> yt z <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> less
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> uminus_2 <span class="var">?myt</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> mult_rat_1_pos<span class="main">[</span><span class="operator">OF</span> x y<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="var">?myt</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_2 <span class="var">?myt</span> <span class="main">=</span> <span class="main">-</span> <span class="var">?x</span> <span class="main">*</span> <span class="var">?y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> uminus_2<span class="main">[</span><span class="operator">OF</span> rc<span class="main">]</span> rr <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> z<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> yt<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> z<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">declare</span></span> mult_1.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> mult_rat_1.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="comment1">(* ********************* *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Root›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipoly_root_delta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ipoly_root_delta</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Min <span class="main">(</span>insert <span class="main">1</span> <span class="main">{</span> abs <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> ipoly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> ipoly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_root_delta<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipoly_root_delta <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> card <span class="main">(</span>Collect <span class="main">(</span>root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> ipoly_root_delta <span class="free">p</span> <span class="main">≤</span> real_of_rat <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> real"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="var">?z</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?set</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> abs <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="var">?z</span>  <span class="main">∧</span> ipoly <span class="free">p</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> insert <span class="main">1</span> <span class="var">?set</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> finite_ipoly_roots<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> finR<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?R</span> <span class="main">×</span> <span class="var">?R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?set</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ finite_imageI<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> fin<span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> abs <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> delta<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly_root_delta <span class="free">p</span> <span class="main">=</span> Min <span class="skolem">S</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ipoly_root_delta_def S_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> pos<span class="main">:</span> <span class="quoted"><span class="quoted">"Min <span class="skolem">S</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin ne pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ipoly_root_delta <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> delta <span class="keyword1"><span class="command">using</span></span> pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Collect <span class="main">(</span>root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">l</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> card <span class="var">?S</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> card <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">[</span><span class="operator">unfolded</span> card_le_Suc_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    ST<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> insert <span class="skolem">x</span> <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> card <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">[</span><span class="operator">unfolded</span> card_le_Suc_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">T</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> yT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ST xT yT <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> S_def root_cond_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> fin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Min <span class="skolem">S</span> <span class="main">≤</span> abs <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> pos <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"Min <span class="skolem">S</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">≤</span> abs <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> of_rat <span class="free">r</span> <span class="main">-</span> of_rat <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_rat <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">≤</span> of_rat <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> le <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ipoly_root_delta <span class="free">p</span> <span class="main">≤</span> real_of_rat <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> delta <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sgn_less_eq_1_rat<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">rat</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">a</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> sgn <span class="free">b</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> not_less one_neq_neg_one one_neq_zero order_trans sgn_rat_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sgn_less_eq_1_real<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">a</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> sgn <span class="free">b</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> not_less one_neq_neg_one one_neq_zero order_trans sgn_real_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">compare_1_rat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> rat <span class="main">⇒</span> order"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">compare_1_rat</span> <span class="free"><span class="bound"><span class="entity">rai</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">p</span> <span class="main">=</span> poly_real_alg_1 <span class="free"><span class="bound"><span class="entity">rai</span></span></span> <span class="keyword1">in</span>
    <span class="keyword1">if</span> degree <span class="bound">p</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="keyword1">let</span> <span class="bound">x</span> <span class="main">=</span> Rat.Fract <span class="main">(</span><span class="main">-</span> coeff <span class="bound">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>coeff <span class="bound">p</span> <span class="main">1</span><span class="main">)</span>
     <span class="keyword1">in</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> compare <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> compare_rat_1 <span class="bound">y</span> <span class="free"><span class="bound"><span class="entity">rai</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> compare_real_of_rat<span class="main">:</span> <span class="quoted"><span class="quoted">"compare <span class="main">(</span>real_of_rat <span class="free">x</span><span class="main">)</span> <span class="main">(</span>of_rat <span class="free">y</span><span class="main">)</span> <span class="main">=</span> compare <span class="free">x</span> <span class="free">y</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> compare_rat_def compare_real_def comparator_of_def of_rat_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> compare_1_rat<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compare_1_rat <span class="free">y</span> <span class="free">x</span> <span class="main">=</span> compare <span class="main">(</span>of_rat <span class="free">x</span><span class="main">)</span> <span class="main">(</span>real_of_1 <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>poly_real_alg_1 <span class="free">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> less <span class="keyword1"><span class="command">with</span></span> invariant_1_degree_0<span class="main">[</span><span class="operator">OF</span> rc<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> deg<span class="main">:</span> greater
  <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword1"><span class="command">have</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> deg compare_rat_1<span class="main">[</span><span class="operator">OF</span> rc<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> compare_1_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> deg<span class="main">:</span> equal
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> rc <span class="main">=</span> invariant_1D<span class="main">[</span><span class="operator">OF</span> rc<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span></span></span></span></span><span class="operator"><span class="operator"><span class="operator"><span class="operator"><span class="operator"><span class="operator"><span class="operator">unfolded</span></span></span></span></span></span></span> y<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span></span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> deg <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"compare_1_rat <span class="free">y</span> <span class="free">x</span> <span class="main">=</span> compare <span class="free">x</span> <span class="main">(</span>Rat.Fract <span class="main">(</span><span class="main">-</span> coeff <span class="skolem">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>coeff <span class="skolem">p</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> compare_1_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def y<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> rc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> split<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">p</span> <span class="main">(</span>real_of_1 <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> degree_1_ipoly<span class="main">[</span><span class="operator">OF</span> p<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="free">y</span>"</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> id'<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="free">y</span> <span class="main">=</span> real_of_rat <span class="main">(</span>Rat.Fract <span class="main">(</span><span class="main">-</span> coeff <span class="skolem">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>coeff <span class="skolem">p</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id id' compare_real_of_rat <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">initial_lower_bound</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">initial_lower_bound</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">else</span> of_int <span class="main">(</span>root_rat_floor <span class="free">n</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">initial_upper_bound</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">initial_upper_bound</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span>of_int <span class="main">(</span>root_rat_ceiling <span class="free">n</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">cmpx</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> order"</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span>  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tighten_bound_root</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"rat <span class="main">×</span> rat <span class="main">⇒</span> rat <span class="main">×</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tighten_bound_root</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> 
      <span class="bound">m'</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l'</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">r'</span></span></span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">;</span>
      <span class="bound">m</span> <span class="main">=</span> <span class="bound">m'</span> <span class="main">^</span> <span class="free">n</span>      
      <span class="keyword1">in</span> <span class="keyword1">case</span> <span class="free">cmpx</span> <span class="bound">m</span> <span class="keyword1">of</span> 
         Eq <span class="main">⇒</span> <span class="main">(</span><span class="bound">m'</span><span class="main">,</span><span class="bound">m'</span><span class="main">)</span>
       <span class="main">|</span> Lt <span class="main">⇒</span> <span class="main">(</span><span class="bound">m'</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r'</span></span></span><span class="main">)</span>
       <span class="main">|</span> Gt <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l'</span></span></span><span class="main">,</span><span class="bound">m'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  
<span class="keyword1"><span class="command">lemma</span></span> tighten_bound_root<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="free">il</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"real_of_1 <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  il<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">il</span> <span class="main">≤</span> root <span class="free">n</span> <span class="main">(</span>real_of_1 <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  ir<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="main">(</span>real_of_1 <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> real_of_rat <span class="free">ir</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  rai<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  cmpx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cmpx</span> <span class="main">=</span> compare_1_rat <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"converges_to <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span>tighten_bound_root <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">il</span><span class="main">,</span> <span class="free">ir</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>root <span class="free">n</span> <span class="main">(</span>real_of_1 <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"converges_to <span class="var">?f</span> <span class="var">?x</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> converges_to_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI allI<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span>root <span class="free">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> root_exp_cancel <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟹</span> root <span class="free">n</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n
      <span class="keyword1"><span class="command">using</span></span> real_root_pos_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> root_exp_cancel' <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> il ir <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">il</span> <span class="main">≤</span> of_rat <span class="free">ir</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> ir_il<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">il</span> <span class="main">≤</span> <span class="free">ir</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_interval <span class="main">(</span><span class="var">?f</span> <span class="skolem">i</span><span class="main">)</span> <span class="var">?x</span> <span class="main">∧</span> sub_interval <span class="main">(</span><span class="var">?f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">il</span><span class="main">,</span><span class="free">ir</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> sub_interval <span class="main">(</span><span class="var">?f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">∧</span> snd <span class="main">(</span><span class="var">?f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> fst <span class="main">(</span><span class="var">?f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">^</span><span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> il ir <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tighten_bound_root <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">il</span><span class="main">,</span> <span class="free">ir</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tighten_bound_root <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">il</span><span class="main">,</span> <span class="free">ir</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l'</span> <span class="main">+</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?m'</span> <span class="main">^</span> <span class="free">n</span>"</span></span> 
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="var">?m</span>"</span></span> 
      <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> Suc<span class="main">[</span><span class="operator">unfolded</span> id split snd_conv fst_conv<span class="main">]</span> 
      <span class="keyword1"><span class="command">from</span></span> IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sub_interval <span class="main">(</span><span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">(</span><span class="free">il</span><span class="main">,</span> <span class="free">ir</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> ill'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">il</span> <span class="main">≤</span> <span class="skolem">l'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">≤</span> <span class="free">ir</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> sgn <span class="keyword1"><span class="command">have</span></span> l'0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sgn_1_pos sgn_less_eq_1_rat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> IH <span class="keyword1"><span class="command">have</span></span> lr'x<span class="main">:</span> <span class="quoted"><span class="quoted">"in_interval <span class="main">(</span><span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> lr''<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">l'</span> <span class="main">≤</span> of_rat <span class="skolem">r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> lr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">≤</span> <span class="skolem">r'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_rat_less_eq <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> l'0 <span class="keyword1"><span class="command">have</span></span> r'0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">note</span></span> compare <span class="main">=</span> compare_1_rat<span class="main">[</span><span class="operator">OF</span> rai<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span><span class="main">,</span> <span class="operator">folded</span> cmpx<span class="main">]</span>
      <span class="keyword1"><span class="command">from</span></span> IH <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">-</span> <span class="skolem">l'</span> <span class="main">≤</span> <span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">l'</span> <span class="main">+</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r'</span> <span class="main">-</span> <span class="skolem">l'</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> divide_right_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>  
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> size<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">l'</span> <span class="main">+</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">l'</span> <span class="main">+</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span> <span class="main">+</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> size'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l'</span> <span class="main">+</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">l'</span> <span class="main">≤</span> <span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="main">(</span>real_of_rat <span class="var">?m</span><span class="main">)</span> <span class="main">=</span> root <span class="free">n</span> <span class="main">(</span><span class="main">(</span>real_of_rat <span class="var">?m'</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real_of_rat <span class="var">?m'</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> root_exp_cancel'<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> l'0 lr'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> root<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="main">(</span>of_rat <span class="var">?m</span><span class="main">)</span> <span class="main">=</span> of_rat <span class="var">?m'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">cmpx</span> <span class="var">?m</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Eq
        <span class="keyword1"><span class="command">from</span></span> compare<span class="main">[</span><span class="operator">unfolded</span> Eq<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_1 <span class="free">x</span> <span class="main">=</span> of_rat <span class="var">?m</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> compare_real_def comparator_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"root <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">=</span> root <span class="free">n</span> <span class="main">(</span>of_rat <span class="var">?m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> root <span class="free">n</span>  <span class="main">(</span>real_of_rat <span class="var">?m'</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> n real_root_power <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_rat <span class="var">?m'</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> root_exp_cancel<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> IH sgn<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> l'0 r'0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">=</span> of_rat <span class="var">?m'</span>"</span></span>  <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> x id Eq lr' ill' ir_il <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Lt 
        <span class="keyword1"><span class="command">from</span></span> compare<span class="main">[</span><span class="operator">unfolded</span> Lt<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="var">?m</span> <span class="main">≤</span> real_of_1 <span class="free">x</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> compare_real_def comparator_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> id''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?m'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span>Suc <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span>  
          <span class="keyword1"><span class="command">using</span></span> Lt id <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> real_root_le_mono<span class="main">[</span><span class="operator">OF</span> n' lt<span class="main">]</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="var">?m'</span> <span class="main">≤</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> lr'x lr'' <span class="keyword1"><span class="command">have</span></span> ineq'<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">l'</span> <span class="main">+</span> real_of_rat <span class="skolem">r'</span> <span class="main">≤</span> <span class="var">?x</span> <span class="main">*</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id'' 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> size ineq' lr' ill' lr'x ir_il<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Gt
        <span class="keyword1"><span class="command">from</span></span> compare<span class="main">[</span><span class="operator">unfolded</span> Gt<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="var">?m</span> <span class="main">≥</span> real_of_1 <span class="free">x</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> compare_real_def comparator_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> id''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">,</span><span class="var">?m'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span>Suc <span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span>  
          <span class="keyword1"><span class="command">using</span></span> Gt id <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> real_root_le_mono<span class="main">[</span><span class="operator">OF</span> n' lt<span class="main">]</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">≤</span> of_rat <span class="var">?m'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> lr'x lr'' <span class="keyword1"><span class="command">have</span></span> ineq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">≤</span> real_of_rat <span class="skolem">l'</span> <span class="main">+</span> real_of_rat <span class="skolem">r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id'' 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> size' ineq' lr' ill' lr'x ir_il<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> main <span class="main">=</span> this
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">from</span></span> main<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"in_interval <span class="main">(</span><span class="var">?f</span> <span class="skolem">i</span><span class="main">)</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> main<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sub_interval <span class="main">(</span><span class="var">?f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">eps</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> eps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">eps</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">eps</span> <span class="main">/</span> <span class="main">(</span>max <span class="main">(</span>real_of_rat <span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eps <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword1"><span class="command">from</span></span> exp_tends_to_zero<span class="main">[</span><span class="operator">OF</span> _ _ this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> fi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> main<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">,</span> <span class="operator">unfolded</span> fi<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">-</span> <span class="skolem">l'</span> <span class="main">≤</span> <span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> iril<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ir_il <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_less_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">la</span> <span class="bound">ra</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="bound">la</span><span class="main">,</span> <span class="bound">ra</span><span class="main">)</span> <span class="main">∧</span> real_of_rat <span class="bound">ra</span> <span class="main">-</span> real_of_rat <span class="bound">la</span> <span class="main">≤</span> <span class="skolem">eps</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fi<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">r'</span> <span class="main">-</span> of_rat <span class="skolem">l'</span> <span class="main">=</span> real_of_rat <span class="main">(</span><span class="skolem">r'</span> <span class="main">-</span> <span class="skolem">l'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> real_of_rat <span class="main">(</span><span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">unfolding</span></span> of_rat_less_eq <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>real_of_rat <span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span>real_of_rat <span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_left_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c iril<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">eps</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">eps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eps True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>real_of_rat <span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> real_of_rat <span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_rat <span class="main">(</span><span class="free">ir</span> <span class="main">-</span> <span class="free">il</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">eps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">r'</span> <span class="main">-</span> of_rat <span class="skolem">l'</span> <span class="main">≤</span> <span class="skolem">eps</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">root_pos_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">root_pos_1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
      <span class="main">(</span>select_correct_factor_int_poly 
        <span class="main">(</span>tighten_bound_root <span class="main">(</span>compare_1_rat <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>
        <span class="main">(</span>initial_lower_bound <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span> initial_upper_bound <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>
        <span class="main">(</span>poly_nth_root <span class="free">n</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">root_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_1 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">root_1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Rational <span class="main">0</span>
  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> root_pos_1 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>
  <span class="keyword1">else</span> uminus_2 <span class="main">(</span>root_pos_1 <span class="main">(</span>uminus_1 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> initial_upper_bound<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> of_rat <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>initial_upper_bound <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="free">x</span> <span class="main">≤</span> of_rat <span class="main">(</span>initial_upper_bound <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> d <span class="main">=</span> initial_upper_bound_def
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"initial_upper_bound <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> x xr <span class="keyword1"><span class="command">have</span></span> r0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> not_less of_rat_le_0_iff order_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="free">r</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="main">(</span>of_rat <span class="free">r</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> ceiling <span class="main">(</span>root <span class="free">n</span> <span class="main">(</span>of_rat <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">::</span> rat<span class="main">)</span> <span class="main">≤</span> of_int <span class="main">(</span>ceiling <span class="main">(</span>root <span class="free">n</span> <span class="main">(</span>of_rat <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sgn <span class="var">?r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_rat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="free">x</span> <span class="main">≤</span> root <span class="free">n</span> <span class="main">(</span>of_rat <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> real_root_le_iff<span class="main">[</span><span class="operator">OF</span> n<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> xr<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> of_rat <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="free">x</span> <span class="main">≤</span> of_rat <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> initial_lower_bound<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lx<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="free">l</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>initial_lower_bound <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="main">(</span>initial_lower_bound <span class="free">l</span><span class="main">)</span> <span class="main">≤</span> root <span class="free">n</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> d <span class="main">=</span> initial_lower_bound_def
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"initial_lower_bound <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> l lx <span class="keyword1"><span class="command">have</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> not_less of_rat_le_0_iff order_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="var">?l</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> of_rat <span class="var">?l</span> <span class="main">≤</span> root <span class="free">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="main">1</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l0<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="free">l</span> <span class="main">≥</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l1<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="free">l</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real<span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">unfolding</span></span> True d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="var">?l</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">unfolding</span></span> ll <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="var">?l</span> <span class="main">=</span> of_rat <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ll <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="free">l</span> <span class="main">≤</span> root <span class="free">n</span> <span class="main">(</span>of_rat <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> real_root_increasing<span class="main">[</span><span class="operator">OF</span> _ _ l0 l1<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> n
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> root <span class="free">n</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lx <span class="keyword1"><span class="command">unfolding</span></span> real_root_le_iff<span class="main">[</span><span class="operator">OF</span> n<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sgn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≤</span> of_rat <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> of_int <span class="main">(</span>floor <span class="main">(</span>root <span class="free">n</span> <span class="main">(</span>of_rat <span class="free">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="main">1</span> <span class="main">≤</span> root <span class="free">n</span> <span class="main">(</span>of_rat <span class="free">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> real_root_le_iff<span class="main">[</span><span class="operator">OF</span> n<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> root <span class="free">n</span> <span class="main">(</span>of_rat <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> floor_mono<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="var">?l</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> one_le_floor <span class="keyword1"><span class="command">unfolding</span></span> ll <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="var">?l</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="var">?l</span> <span class="main">≤</span> root <span class="free">n</span> <span class="main">(</span>of_rat <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ll <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> root <span class="free">n</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lx <span class="keyword1"><span class="command">unfolding</span></span> real_root_le_iff<span class="main">[</span><span class="operator">OF</span> n<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="var">?l</span> <span class="main">≤</span> root <span class="free">n</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> sgn <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sgn <span class="var">?l</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="var">?l</span> <span class="main">≤</span> root <span class="free">n</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> root_pos_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pos<span class="main">:</span> <span class="quoted"><span class="quoted">"rai_ub <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≡</span> root_pos_1 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">y</span> <span class="main">∧</span> real_of_2 <span class="free">y</span> <span class="main">=</span> root <span class="free">n</span> <span class="main">(</span>real_of_1 <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>fields <span class="skolem">p</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"initial_lower_bound <span class="skolem">l</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"initial_upper_bound <span class="skolem">r</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> x fields <span class="keyword1"><span class="command">have</span></span> rai<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> invariant_1D<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> pos<span class="main">[</span><span class="operator">unfolded</span> fields<span class="main">]</span> *
  <span class="keyword1"><span class="command">have</span></span> sgnl<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="skolem">l</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sgnl <span class="keyword1"><span class="command">have</span></span> l0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> sgn_1_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> ll0<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> lx<span class="main">:</span> <span class="quoted"><span class="quoted">"of_rat <span class="skolem">l</span> <span class="main">≤</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> ll0 <span class="keyword1"><span class="command">have</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">note</span></span> il <span class="main">=</span> initial_lower_bound<span class="main">[</span><span class="operator">OF</span> l0 lx<span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">≤</span> of_rat <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> iu <span class="main">=</span> initial_upper_bound<span class="main">[</span><span class="operator">OF</span> x0 this<span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poly_nth_root <span class="free">n</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> x0 <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="var">?x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n real_root_pow_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="var">?p</span><span class="main">,</span> <span class="var">?l</span><span class="main">,</span> <span class="var">?r</span><span class="main">)</span> <span class="main">(</span>root <span class="free">n</span> <span class="var">?x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> il iu * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> root_condI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ipoly_nth_root id<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> root<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="var">?p</span> <span class="main">(</span>root <span class="free">n</span> <span class="main">(</span>real_of_1 <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def fields <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_nth_root_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> tbr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> real_of_1 <span class="free">x</span>"</span></span>
            <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span>initial_lower_bound <span class="skolem">l</span><span class="main">)</span> <span class="main">≤</span> root <span class="free">n</span> <span class="main">(</span>real_of_1 <span class="free">x</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="main">(</span>real_of_1 <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> real_of_rat <span class="main">(</span>initial_upper_bound <span class="skolem">r</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> x0 il<span class="main">(</span>2<span class="main">)</span> iu<span class="main">(</span>2<span class="main">)</span> fields <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> select_correct_factor_int_poly<span class="main">[</span><span class="operator">OF</span> tighten_bound_root<span class="main"><span class="main">[</span></span><span class="operator">OF</span> il<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">folded</span> fields<span class="main"><span class="main">]</span></span> tbr x refl n<span class="main"><span class="main">]</span></span> refl root p'<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y fields<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> root_1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≡</span> root_1 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">y</span> <span class="main">∧</span> <span class="main">(</span>real_of_2 <span class="free">y</span> <span class="main">=</span> root <span class="free">n</span> <span class="main">(</span>real_of_1 <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> rai_ub <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> real_of_1 <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="main">(</span>real_of_1 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> y root_1.simps
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> rt <span class="main">=</span> root_pos_1
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"rai_ub <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>rat"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>linorder_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> greater
    <span class="keyword1"><span class="command">with</span></span> rt<span class="main">[</span><span class="operator">OF</span> n x this<span class="main">]</span> n <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> y<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> less
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?um</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"uminus_1"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"root_pos_1"</span></span>
    <span class="keyword1"><span class="command">from</span></span> n less y x0 <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> uminus_2 <span class="main">(</span><span class="var">?rt</span> <span class="main">(</span><span class="var">?um</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> uminus_1<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> umx<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="var">?um</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> umx2<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="main">(</span><span class="var">?um</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> real_of_1 <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> x less <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> rai_ub <span class="main">(</span>uminus_1 <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uminus_1.simps Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> rt<span class="main">[</span><span class="operator">OF</span> n umx this<span class="main">]</span> umx2 <span class="keyword1"><span class="command">have</span></span> rumx<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span><span class="var">?rt</span> <span class="main">(</span><span class="var">?um</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> rumx2<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span><span class="var">?rt</span> <span class="main">(</span><span class="var">?um</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> root <span class="free">n</span> <span class="main">(</span><span class="main">-</span> real_of_1 <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> uminus_2<span class="main">[</span><span class="operator">OF</span> rumx<span class="main">]</span> rumx2 y real_root_minus <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> equal <span class="keyword1"><span class="command">with</span></span> x0 x <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">declare</span></span> root_1.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="comment1">(* ********************** *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Embedding of Rational Numbers›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">of_rat_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> real_alg_1"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">of_rat_1</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">(</span>poly_rat <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> of_rat_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span>of_rat_1 <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"real_of_1 <span class="main">(</span>of_rat_1 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_rat <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> of_rat_1_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> invariant_1_realI unique_rootI poly_condI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">info_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="main">⇒</span> rat <span class="main">+</span> int poly <span class="main">×</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">info_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> Inl <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">info_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Inr <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span> 
    
<span class="keyword1"><span class="command">lemma</span></span> info_2_card<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"info_2 <span class="free">x</span> <span class="main">=</span> Inr <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> poly_cond <span class="free">p</span> <span class="main">∧</span> ipoly <span class="free">p</span> <span class="main">(</span>real_of_2 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> degree <span class="free">p</span> <span class="main">≥</span> <span class="numeral">2</span> 
    <span class="main">∧</span> card <span class="main">(</span>roots_below <span class="free">p</span> <span class="main">(</span>real_of_2 <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="quoted"><span class="quoted">"info_2 <span class="free">x</span> <span class="main">=</span> Inl <span class="free">y</span> <span class="main">⟹</span> real_of_2 <span class="free">x</span> <span class="main">=</span> of_rat <span class="free">y</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Irrational <span class="skolem">m</span> <span class="skolem">rai</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> Irrational <span class="skolem">m</span> <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rai</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∧</span> <span class="skolem">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> Irrational <span class="free">n</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> rc<span class="main">[</span><span class="operator">unfolded</span> x<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
        n<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>roots_below <span class="free">p</span> <span class="main">(</span>real_of_2 <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> irreducible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> n <span class="keyword1"><span class="command">using</span></span> inv x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> invariant_1E<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> real_of_2_Irrational<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>Irrational <span class="free">n</span> <span class="free">rai</span><span class="main">)</span> <span class="main">⟹</span> real_of_2 <span class="main">(</span>Irrational <span class="free">n</span> <span class="free">rai</span><span class="main">)</span> <span class="main">≠</span> of_rat <span class="free">x</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>Irrational <span class="free">n</span> <span class="free">rai</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rat<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span>Irrational <span class="free">n</span> <span class="free">rai</span><span class="main">)</span> <span class="main">=</span> real_of_rat <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real_of_1 <span class="free">rai</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="free">rai</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> invariant_1_2_of_rat<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> rat <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
            
<span class="keyword1"><span class="command">lemma</span></span> info_2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> 
    ix<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> iy<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"info_2 <span class="free">x</span> <span class="main">=</span> info_2 <span class="free">y</span> <span class="main">⟷</span> real_of_2 <span class="free">x</span> <span class="main">=</span> real_of_2 <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> x<span class="main">:</span> <span class="main">(</span>Irrational <span class="skolem">n1</span> <span class="skolem">rai1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> ix <span class="main">=</span> ix<span class="main">[</span><span class="operator">unfolded</span> x<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Rational <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> real_of_2_Irrational<span class="main">[</span><span class="operator">OF</span> ix<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rai1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> y<span class="main">:</span> <span class="main">(</span>Irrational <span class="skolem">n2</span> <span class="skolem">rai2</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">l1</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="keyword2"><span class="keyword">where</span></span> rai1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rai1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">l1</span><span class="main">,</span><span class="skolem">r1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rai1</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">l2</span></span> <span class="skolem"><span class="skolem">r2</span></span> <span class="keyword2"><span class="keyword">where</span></span> rai2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rai2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span><span class="skolem">l2</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rai2</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">l1</span><span class="main">,</span><span class="skolem">r1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ry</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span><span class="skolem">l2</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>info_2 <span class="free">x</span> <span class="main">=</span> info_2 <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p1</span> <span class="main">=</span> <span class="skolem">p2</span> <span class="main">∧</span> <span class="skolem">n1</span> <span class="main">=</span> <span class="skolem">n2</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of_2 <span class="free">x</span> <span class="main">=</span> real_of_2 <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?rx</span> <span class="main">=</span> <span class="var">?ry</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> x y rai1 rai2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ix<span class="main">[</span><span class="operator">unfolded</span> x rai1<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> ix<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span> <span class="skolem">l1</span><span class="main">,</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg1<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p1</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">=</span> card <span class="main">(</span>roots_below <span class="skolem">p1</span> <span class="var">?rx</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> Ix <span class="main">=</span> invariant_1D<span class="main">[</span><span class="operator">OF</span> ix<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> deg1 <span class="keyword1"><span class="command">have</span></span> p1_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> iy<span class="main">[</span><span class="operator">unfolded</span> y rai2<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> iy<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span> <span class="main">=</span> card <span class="main">(</span>roots_below <span class="skolem">p2</span> <span class="var">?ry</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> Iy <span class="main">=</span> invariant_1D<span class="main">[</span><span class="operator">OF</span> iy<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rx</span> <span class="main">=</span> <span class="var">?ry</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> Ix
      <span class="keyword1"><span class="command">have</span></span> algx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="keyword1">represents</span> <span class="var">?rx</span> <span class="main">∧</span> irreducible <span class="skolem">p1</span> <span class="main">∧</span> lead_coeff <span class="skolem">p1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> iy
      <span class="keyword1"><span class="command">have</span></span> algy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="keyword1">represents</span> <span class="var">?rx</span> <span class="main">∧</span> irreducible <span class="skolem">p2</span> <span class="main">∧</span> lead_coeff <span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> represents_def eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> invariant_1E<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> algx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="var">?rx</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> algebraic_altdef_ipoly <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">note</span></span> unique <span class="main">=</span> algebraic_imp_represents_unique<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword1"><span class="command">with</span></span> algx algy <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">=</span> <span class="skolem">p1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> eq id n1 n2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">=</span> <span class="skolem">p2</span> <span class="main">∧</span> <span class="skolem">n1</span> <span class="main">=</span> <span class="skolem">n2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">=</span> <span class="skolem">p2</span> <span class="main">∧</span> <span class="skolem">n1</span> <span class="main">=</span> <span class="skolem">n2</span>"</span></span> 
      <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">=</span> <span class="skolem">p2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span> <span class="main">=</span> <span class="skolem">n2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>roots_below <span class="skolem">p1</span> <span class="var">?rx</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>roots_below <span class="skolem">p1</span> <span class="var">?ry</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n1 n2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rx</span> <span class="main">=</span> <span class="var">?ry</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?rx</span></span></span> <span class="var"><span class="quoted"><span class="var">?ry</span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> less
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"roots_below <span class="skolem">p1</span> <span class="var">?rx</span> <span class="main">=</span> roots_below <span class="skolem">p1</span> <span class="var">?ry</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> card_subset_eq finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ipoly_roots_finite<span class="main"><span class="main">]</span></span> card<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> less <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"roots_below <span class="skolem">p1</span> <span class="var">?rx</span> <span class="main">⊆</span> roots_below <span class="skolem">p1</span> <span class="var">?ry</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> p1_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> id less unique_rootD<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Iy<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> equal
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> greater
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"roots_below <span class="skolem">p1</span> <span class="var">?ry</span> <span class="main">=</span> roots_below <span class="skolem">p1</span> <span class="var">?rx</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> card_subset_eq card<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ipoly_roots_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p1_0<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> greater <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"roots_below <span class="skolem">p1</span> <span class="var">?ry</span> <span class="main">⊆</span> roots_below <span class="skolem">p1</span> <span class="var">?rx</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"roots_below <span class="skolem">p2</span> <span class="var">?ry</span> <span class="main">=</span> roots_below <span class="skolem">p2</span> <span class="var">?rx</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> id greater unique_rootD<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Ix<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> x<span class="main">:</span> <span class="main">(</span>Rational <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Rational <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> y<span class="main">:</span> <span class="main">(</span>Irrational <span class="skolem">n</span> <span class="skolem">rai</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> real_of_2_Irrational<span class="main">[</span><span class="operator">OF</span> iy<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> y<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rai</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> info_2_unique<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span> <span class="main">⟹</span> invariant_2 <span class="free">y</span> <span class="main">⟹</span> 
  real_of_2 <span class="free">x</span> <span class="main">=</span> real_of_2 <span class="free">y</span> <span class="main">⟹</span> info_2 <span class="free">x</span> <span class="main">=</span> info_2 <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> info_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
<span class="keyword1"><span class="command">lemma</span></span> info_2_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span> <span class="main">⟹</span> invariant_2 <span class="free">y</span> <span class="main">⟹</span> info_2 <span class="free">x</span> <span class="main">=</span> info_2 <span class="free">y</span> <span class="main">⟹</span>
  real_of_2 <span class="free">x</span> <span class="main">=</span> real_of_2 <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> info_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">cr1</span> <span class="free">cr2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> rat <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">partial_function</span></span> <span class="main">(</span>tailrec<span class="main">)</span> <span class="entity">compare_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> int poly <span class="main">⇒</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span> rat <span class="main">⇒</span> order"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">compare_1</span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">sr1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="free"><span class="bound"><span class="entity">sr2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="keyword1">then</span> Lt <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="keyword1">then</span> Gt 
    <span class="keyword1">else</span> <span class="keyword1">let</span> 
      <span class="main">(</span><span class="bound">l1'</span><span class="main">,</span><span class="bound">r1'</span><span class="main">,</span><span class="bound">sr1'</span><span class="main">)</span> <span class="main">=</span> tighten_poly_bounds <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">r1</span></span></span> <span class="free"><span class="bound"><span class="entity">sr1</span></span></span><span class="main">;</span>
      <span class="main">(</span><span class="bound">l2'</span><span class="main">,</span><span class="bound">r2'</span><span class="main">,</span><span class="bound">sr2'</span><span class="main">)</span> <span class="main">=</span> tighten_poly_bounds <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">r2</span></span></span> <span class="free"><span class="bound"><span class="entity">sr2</span></span></span>
    <span class="keyword1">in</span> <span class="free">compare_1</span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="bound">l1'</span> <span class="bound">r1'</span> <span class="bound">sr1'</span> <span class="bound">l2'</span> <span class="bound">r2'</span> <span class="bound">sr2'</span><span class="main">)</span>
    "</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> compare_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ur1<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">l1</span><span class="main">,</span><span class="free">r1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ur2<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p2</span><span class="main">,</span><span class="free">l2</span><span class="main">,</span><span class="free">r2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> pc<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="free">p1</span>"</span></span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="free">p2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> diff<span class="main">:</span> <span class="quoted"><span class="quoted">"the_unique_root <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">l1</span><span class="main">,</span><span class="free">r1</span><span class="main">)</span> <span class="main">≠</span> the_unique_root <span class="main">(</span><span class="free">p2</span><span class="main">,</span><span class="free">l2</span><span class="main">,</span><span class="free">r2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sr1</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p1</span> <span class="free">r1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sr2</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p2</span> <span class="free">r2</span><span class="main">)</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compare_1 <span class="free">p1</span> <span class="free">p2</span> <span class="free">l1</span> <span class="free">r1</span> <span class="free">sr1</span> <span class="free">l2</span> <span class="free">r2</span> <span class="free">sr2</span> <span class="main">=</span> compare <span class="main">(</span>the_unique_root <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">l1</span><span class="main">,</span><span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>the_unique_root <span class="main">(</span><span class="free">p2</span><span class="main">,</span><span class="free">l2</span><span class="main">,</span><span class="free">r2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted">real_of_rat</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="free">r1</span> <span class="main">-</span> <span class="free">l1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">r2</span> <span class="main">-</span> <span class="free">l2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">l1</span><span class="main">,</span><span class="free">r1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p2</span><span class="main">,</span><span class="free">l2</span><span class="main">,</span><span class="free">r2</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">delta</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">delta</span> <span class="main">=</span> abs <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> delta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">delta</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> delta_def <span class="keyword1"><span class="command">using</span></span> diff xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rel'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> delta_gt <span class="skolem">delta</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rel</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"inv_image <span class="var">?rel'</span> <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> SN<span class="main">:</span> <span class="quoted"><span class="quoted">"SN <span class="var">?rel</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SN_inv_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta_gt_SN<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> d ur1 ur2 
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> xy<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> xy sr
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">d</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">l1</span></span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">l2</span></span> <span class="quoted"><span class="free">r2</span></span> <span class="quoted"><span class="free">sr1</span></span> <span class="quoted"><span class="free">sr2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> SN_induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> SN<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">d</span> <span class="skolem">l1</span> <span class="skolem">r1</span> <span class="skolem">l2</span> <span class="skolem">r2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> d <span class="main">=</span> 1<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> ur <span class="main">=</span> 1<span class="main">(</span>3-4<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> xy <span class="main">=</span> 1<span class="main">(</span>5-6<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> sr <span class="main">=</span> 1<span class="main">(</span>7-8<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> simps <span class="main">=</span> compare_1.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p1</span></span> <span class="quoted"><span class="free">p2</span></span> <span class="quoted"><span class="skolem">l1</span></span> <span class="quoted"><span class="skolem">r1</span></span> <span class="quoted"><span class="skolem">sr1</span></span> <span class="quoted"><span class="skolem">l2</span></span> <span class="quoted"><span class="skolem">r2</span></span> <span class="quoted"><span class="skolem">sr2</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">note</span></span> urx <span class="main">=</span> unique_rootD<span class="main">[</span><span class="operator">OF</span> ur<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span><span class="main">,</span> <span class="operator">folded</span> xy<span class="main">]</span>
      <span class="keyword1"><span class="command">note</span></span> ury <span class="main">=</span> unique_rootD<span class="main">[</span><span class="operator">OF</span> ur<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span><span class="main">,</span> <span class="operator">folded</span> xy<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">&lt;</span> <span class="skolem">l2</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> Lt"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">r1</span> <span class="main">&lt;</span> <span class="var">?r</span> <span class="skolem">l2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> simps of_rat_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> l <span class="keyword1"><span class="command">using</span></span> lt True urx<span class="main">(</span>2<span class="main">)</span> ury<span class="main">(</span>1<span class="main">)</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compare_real_def comparator_of_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> le <span class="main">=</span> this
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">&lt;</span> <span class="skolem">l1</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> le <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> Gt"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">r2</span> <span class="main">&lt;</span> <span class="var">?r</span> <span class="skolem">l1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> simps of_rat_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> l <span class="keyword1"><span class="command">using</span></span> lt True ury<span class="main">(</span>2<span class="main">)</span> urx<span class="main">(</span>1<span class="main">)</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compare_real_def comparator_of_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l1'</span></span> <span class="skolem"><span class="skolem">r1'</span></span> <span class="skolem"><span class="skolem">sr1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tb1<span class="main">:</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds <span class="free">p1</span> <span class="skolem">l1</span> <span class="skolem">r1</span> <span class="skolem">sr1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l1'</span><span class="main">,</span><span class="skolem">r1'</span><span class="main">,</span><span class="skolem">sr1'</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_cases3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l2'</span></span> <span class="skolem"><span class="skolem">r2'</span></span> <span class="skolem"><span class="skolem">sr2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tb2<span class="main">:</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds <span class="free">p2</span> <span class="skolem">l2</span> <span class="skolem">r2</span> <span class="skolem">sr2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l2'</span><span class="main">,</span><span class="skolem">r2'</span><span class="main">,</span><span class="skolem">sr2'</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> prod_cases3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>            
          <span class="keyword1"><span class="command">from</span></span> False le tb1 tb2 <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> compare_1 <span class="free">p1</span> <span class="free">p2</span> <span class="skolem">l1'</span> <span class="skolem">r1'</span> <span class="skolem">sr1'</span> <span class="skolem">l2'</span> <span class="skolem">r2'</span> <span class="skolem">sr2'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> simps 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> tighten_poly_bounds<span class="main">[</span><span class="operator">OF</span> tb1 ur<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span> pc<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span> sr<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> rc1<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="skolem">l1'</span><span class="main">,</span> <span class="skolem">r1'</span><span class="main">)</span> <span class="main">(</span>the_unique_root <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="skolem">l1</span><span class="main">,</span> <span class="skolem">r1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> bnd1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l1</span> <span class="main">≤</span> <span class="skolem">l1'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l1'</span> <span class="main">≤</span> <span class="skolem">r1'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1'</span> <span class="main">≤</span> <span class="skolem">r1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1'</span> <span class="main">-</span> <span class="skolem">l1'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r1</span> <span class="main">-</span> <span class="skolem">l1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> sr1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sr1'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p1</span> <span class="skolem">r1'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> pc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> unique_root_sub_interval<span class="main">[</span><span class="operator">OF</span> ur<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> rc1 bnd1<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>3<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> xy ur this
          <span class="keyword1"><span class="command">have</span></span> ur1<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="skolem">l1'</span><span class="main">,</span> <span class="skolem">r1'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="skolem">l1'</span><span class="main">,</span> <span class="skolem">r1'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> the_unique_root_eqI<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> tighten_poly_bounds<span class="main">[</span><span class="operator">OF</span> tb2 ur<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span> pc<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span> sr<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> rc2<span class="main">:</span> <span class="quoted"><span class="quoted">"root_cond <span class="main">(</span><span class="free">p2</span><span class="main">,</span> <span class="skolem">l2'</span><span class="main">,</span> <span class="skolem">r2'</span><span class="main">)</span> <span class="main">(</span>the_unique_root <span class="main">(</span><span class="free">p2</span><span class="main">,</span> <span class="skolem">l2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> bnd2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span> <span class="main">≤</span> <span class="skolem">l2'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l2'</span> <span class="main">≤</span> <span class="skolem">r2'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2'</span> <span class="main">≤</span> <span class="skolem">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2'</span> <span class="main">-</span> <span class="skolem">l2'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r2</span> <span class="main">-</span> <span class="skolem">l2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> sr2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sr2'</span> <span class="main">=</span> sgn <span class="main">(</span>ipoly <span class="free">p2</span> <span class="skolem">r2'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> unique_root_sub_interval<span class="main">[</span><span class="operator">OF</span> ur<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span> rc2 bnd2<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>3<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> xy ur pc
          <span class="keyword1"><span class="command">have</span></span> ur2<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p2</span><span class="main">,</span> <span class="skolem">l2'</span><span class="main">,</span> <span class="skolem">r2'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p2</span><span class="main">,</span> <span class="skolem">l2'</span><span class="main">,</span> <span class="skolem">r2'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> d'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">=</span> <span class="skolem">r1'</span> <span class="main">-</span> <span class="skolem">l1'</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">r2'</span> <span class="main">-</span> <span class="skolem">l2'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d'_def d d1 d2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> d'0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bnd1 bnd2 <span class="keyword1"><span class="command">unfolding</span></span> d' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> dd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">-</span> <span class="skolem">d'</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?r</span> <span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="var">?r</span> <span class="skolem">d</span> <span class="main">&lt;</span> abs <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">-</span> <span class="skolem">l1</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">-</span> <span class="skolem">l2</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">using</span></span> bnd1 bnd2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">folded</span> of_rat_less_eq<span class="main"><span class="main"><span class="main">[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span class="operator">where</span></span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span> <span class="quoted"><span class="quoted">real</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main">]</span> lt 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">(</span><span class="skolem">r1</span> <span class="main">-</span> <span class="skolem">l1</span><span class="main">)</span> <span class="main">&lt;</span> abs <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">(</span><span class="skolem">r2</span> <span class="main">-</span> <span class="skolem">l2</span><span class="main">)</span> <span class="main">&lt;</span> abs <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> 
              <span class="keyword2"><span class="keyword">and</span></span> dd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">r1</span> <span class="main">-</span> <span class="var">?r</span> <span class="skolem">l1</span> <span class="main">≤</span> <span class="var">?r</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">r2</span> <span class="main">-</span> <span class="var">?r</span> <span class="skolem">l2</span> <span class="main">≤</span> <span class="var">?r</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_diff<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> le <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">≥</span> <span class="skolem">l2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">hence</span></span> r1l2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">r1</span> <span class="main">≥</span> <span class="var">?r</span> <span class="skolem">l2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_rat_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">≥</span> <span class="skolem">l1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">hence</span></span> r2l1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">r2</span> <span class="main">≥</span> <span class="var">?r</span> <span class="skolem">l1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_rat_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">from</span></span> urx<span class="main">(</span>1-2<span class="main">)</span> dd<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">r1</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">+</span> <span class="var">?r</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">with</span></span> r1l2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">l2</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">+</span> <span class="var">?r</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> True lt ury<span class="main">(</span>2<span class="main">)</span> dd<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">from</span></span> ury<span class="main">(</span>1-2<span class="main">)</span> dd<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">r2</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">+</span> <span class="var">?r</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">with</span></span> r2l1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">l1</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">+</span> <span class="var">?r</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> False lt urx<span class="main">(</span>2<span class="main">)</span> dd<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>              
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">hence</span></span> dd'<span class="main">:</span> <span class="quoted"><span class="quoted">"delta_gt <span class="skolem">delta</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">d'</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">unfolding</span></span> delta_gt_def delta_def <span class="keyword1"><span class="command">using</span></span> dd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> l
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ d' ur1 ur2 x y sr1 sr2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> d'0 dd'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="comment1">(* **************************************************************** *)</span>  

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">real_alg_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="main">⇒</span> real_alg_1"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">real_alg_1</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> of_rat_1 <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">real_alg_1</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">rai</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">rai</span></span></span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> real_alg_1<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="main">(</span>real_alg_1 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> real_of_2 <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_1<span class="main">)</span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">root_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real_alg_2 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">root_2</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> root_1 <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>real_alg_1 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> root_2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span>root_2 <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> root <span class="free">n</span> <span class="main">(</span>real_of_2 <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>root_2 <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> of_rat_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span><span class="main">]</span> root_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_rat_1 <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> assms 1 real_alg_2
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_2_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">i</span> <span class="skolem">rai</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> root_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">rai</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> assms 2 real_alg_2 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> root_2_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">add_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="main">⇒</span> real_alg_2 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">add_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> Rational <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">add_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>add_rat_1 <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">add_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>add_rat_1 <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">add_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> add_1 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> add_2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">y</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>add_2 <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?g1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span>add_2 <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> real_of_2 <span class="free">x</span> <span class="main">+</span> real_of_2 <span class="free">y</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?g2</span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms add_rat_1 add_1
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mult_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="main">⇒</span> real_alg_2 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mult_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> Rational <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">mult_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> mult_rat_1 <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">mult_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> mult_rat_1 <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">mult_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> mult_1 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span>mult_2 <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> real_of_2 <span class="free">x</span> <span class="main">*</span> real_of_2 <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>mult_2 <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_rat_1 mult_1 <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">to_rat_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="main">⇒</span> rat option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">to_rat_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">to_rat_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">rai</span></span></span><span class="main">)</span> <span class="main">=</span> None"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> to_rat_2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"to_rat_2 <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> real_of_2 <span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="keyword1">then</span> Some <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">q</span><span class="main">.</span> real_of_2 <span class="free">x</span> <span class="main">=</span> of_rat <span class="bound">q</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Irrational <span class="skolem">n</span> <span class="skolem">rai</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> real_of_2_Irrational<span class="main">[</span><span class="operator">OF</span> rc<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> this<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Irrational Rats_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span> 
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">equal_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="main">⇒</span> real_alg_2 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">equal_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">equal_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">,</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">equal_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span>Irrational <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">yy</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">equal_2</span> <span class="main">(</span>Irrational <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">xx</span></span></span><span class="main">)</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equal_2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">y</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"equal_2 <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>real_of_2 <span class="free">x</span> <span class="main">=</span> real_of_2 <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> info_2<span class="main">[</span><span class="operator">OF</span> rc<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">compare_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="main">⇒</span> real_alg_2 <span class="main">⇒</span> order"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">compare_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>compare <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">compare_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">then</span> Eq
    <span class="keyword1">else</span> compare_1 <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l'</span></span></span> <span class="free"><span class="bound"><span class="entity">r'</span></span></span> <span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r'</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">compare_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span>Irrational <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">xx</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>compare_rat_1 <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">xx</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">compare_2</span> <span class="main">(</span>Irrational <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">xx</span></span></span><span class="main">)</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>invert_order <span class="main">(</span>compare_rat_1 <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">xx</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> compare_2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compare_2 <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> compare <span class="main">(</span>real_of_2 <span class="free">x</span><span class="main">)</span> <span class="main">(</span>real_of_2 <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Rational <span class="skolem">r</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> xx <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Rational <span class="skolem">q</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> yy <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> xx yy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compare_rat_def compare_real_def comparator_of_def of_rat_less<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Irrational <span class="skolem">n</span> <span class="skolem">yy</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> yy <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> compare_rat_1 rc
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> xx yy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Irrational <span class="skolem">n</span> <span class="skolem">xx</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> xx <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Rational <span class="skolem">q</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> yy <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> compare_rat_1 rc
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> xx yy <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Irrational <span class="skolem">m</span> <span class="skolem">yy</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> yy <span class="main">=</span> this
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> xxx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xx</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> yyy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yy</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">yy</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> rc <span class="main">=</span> rc<span class="main">[</span><span class="operator">unfolded</span> xx xxx yy yyy<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> rc <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> compare_1<span class="main">[</span><span class="operator">OF</span> this _ refl refl<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> equal_2<span class="main">[</span><span class="operator">OF</span> rc<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> xx xxx yy yyy <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sgn_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sgn_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> sgn <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sgn_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">rai</span></span></span><span class="main">)</span> <span class="main">=</span> sgn_1 <span class="free"><span class="bound"><span class="entity">rai</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sgn_2<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span> <span class="main">⟹</span> real_of_rat <span class="main">(</span>sgn_2 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>real_of_2 <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> sgn_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_of_rat_sgn<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">floor_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">floor_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> floor <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">floor_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">rai</span></span></span><span class="main">)</span> <span class="main">=</span> floor_1 <span class="free"><span class="bound"><span class="entity">rai</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> floor_2<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span> <span class="main">⟹</span> floor_2 <span class="free">x</span> <span class="main">=</span> floor <span class="main">(</span>real_of_2 <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> floor_1<span class="main">)</span>
  
<span class="comment1">(* *************** *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions and Algorithms on Type with Invariant›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> of_rat_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> real_alg_3"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">of_rat_2</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_2<span class="main">)</span>


    
<span class="keyword1"><span class="command">lemma</span></span> of_rat_3<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_3 <span class="main">(</span>of_rat_3 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_rat <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_2<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> root_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real_alg_3 <span class="main">⇒</span> real_alg_3"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">root_2</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> root_2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> root_3<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_3 <span class="main">(</span>root_3 <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> root <span class="free">n</span> <span class="main">(</span>real_of_3 <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> root_2<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> equal_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_3 <span class="main">⇒</span> real_alg_3 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">equal_2</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equal_3<span class="main">:</span> <span class="quoted"><span class="quoted">"equal_3 <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>real_of_3 <span class="free">x</span> <span class="main">=</span> real_of_3 <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>  

<span class="keyword1"><span class="command">lift_definition</span></span> compare_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_3 <span class="main">⇒</span> real_alg_3 <span class="main">⇒</span> order"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">compare_2</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> compare_3<span class="main">:</span> <span class="quoted"><span class="quoted">"compare_3 <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>compare <span class="main">(</span>real_of_3 <span class="free">x</span><span class="main">)</span> <span class="main">(</span>real_of_3 <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compare_2<span class="main">)</span>  
    
<span class="keyword1"><span class="command">lift_definition</span></span> add_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_3 <span class="main">⇒</span> real_alg_3 <span class="main">⇒</span> real_alg_3"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">add_2</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> add_3<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_3 <span class="main">(</span>add_3 <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> real_of_3 <span class="free">x</span> <span class="main">+</span> real_of_3 <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_2<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> mult_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_3 <span class="main">⇒</span> real_alg_3 <span class="main">⇒</span> real_alg_3"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">mult_2</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_3<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_3 <span class="main">(</span>mult_3 <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> real_of_3 <span class="free">x</span> <span class="main">*</span> real_of_3 <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_2<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> sgn_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_3 <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">sgn_2</span> <span class="keyword1"><span class="command">.</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> sgn_3<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span>sgn_3 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>real_of_3 <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_2<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> to_rat_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_3 <span class="main">⇒</span> rat option"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">to_rat_2</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> to_rat_3<span class="main">:</span> <span class="quoted"><span class="quoted">"to_rat_3 <span class="free">x</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> real_of_3 <span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="keyword1">then</span> Some <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">q</span><span class="main">.</span> real_of_3 <span class="free">x</span> <span class="main">=</span> of_rat <span class="bound">q</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_rat_2<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> floor_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_3 <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">floor_2</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> floor_3<span class="main">:</span> <span class="quoted"><span class="quoted">"floor_3 <span class="free">x</span> <span class="main">=</span> floor <span class="main">(</span>real_of_3 <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> floor_2<span class="main">)</span>

<span class="comment1">(* *************** *)</span>
<span class="comment1">(* info *)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> info_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_3 <span class="main">⇒</span> rat <span class="main">+</span> int poly <span class="main">×</span> nat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">info_2</span> <span class="keyword1"><span class="command">.</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> info_3_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_3 <span class="free">x</span> <span class="main">=</span> real_of_3 <span class="free">y</span> <span class="main">⟹</span> info_3 <span class="free">x</span> <span class="main">=</span> info_3 <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> info_2_unique<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> info_real_alg <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> rat <span class="main">+</span> int poly <span class="main">×</span> nat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">info_3</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> info_3_fun<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> info_real_alg<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"info_real_alg <span class="free">x</span> <span class="main">=</span> Inr <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p</span> <span class="keyword1">represents</span> <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> card <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> real_of <span class="free">x</span> <span class="main">∧</span> ipoly <span class="free">p</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> irreducible <span class="free">p</span>"</span></span> 
  <span class="quoted"><span class="quoted">"info_real_alg <span class="free">x</span> <span class="main">=</span> Inl <span class="free">q</span> <span class="main">⟹</span> real_of <span class="free">x</span> <span class="main">=</span> of_rat <span class="free">q</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">p</span> <span class="skolem">n</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> info <span class="main">=</span> info_2_card<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> irr<span class="main">:</span> <span class="main">(</span>Irrational <span class="skolem">m</span> <span class="skolem">rai</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> info<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> irr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">rai</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_cond_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> 1 info<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="comment1">(* add *)</span>
<span class="keyword1"><span class="command">instantiation</span></span> real_alg <span class="main">::</span> <span class="quoted">plus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">plus_real_alg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> real_alg"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">add_3</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_3<span class="main">)</span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> plus_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>real_of <span class="free">y</span><span class="main">)</span> <span class="main">=</span> real_of <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> add_3<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="comment1">(* minus *)</span>
<span class="keyword1"><span class="command">instantiation</span></span> real_alg <span class="main">::</span> <span class="quoted">minus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">minus_real_alg</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> real_alg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">minus_real_alg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> minus_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>real_of <span class="free">y</span><span class="main">)</span> <span class="main">=</span> real_of <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> minus_real_alg_def minus_real_def uminus_real_alg plus_real_alg  <span class="keyword1"><span class="command">..</span></span>  

<span class="comment1">(* of_rat *)</span>
<span class="keyword1"><span class="command">lift_definition</span></span> of_rat_real_alg <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">⇒</span> real_alg"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">of_rat_3</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> of_rat_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">x</span> <span class="main">=</span> real_of <span class="main">(</span>of_rat_real_alg <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> of_rat_3<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="comment1">(* zero *)</span>
<span class="keyword1"><span class="command">instantiation</span></span> real_alg <span class="main">::</span> <span class="quoted">zero</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">zero_real_alg</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero_real_alg</span> <span class="main">≡</span> of_rat_real_alg <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zero_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> real_of <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zero_real_alg_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_real_alg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="comment1">(* one *)</span>
<span class="keyword1"><span class="command">instantiation</span></span> real_alg <span class="main">::</span> <span class="quoted">one</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">one_real_alg</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_real_alg</span> <span class="main">≡</span> of_rat_real_alg <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> one_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> real_of <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> one_real_alg_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_real_alg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="comment1">(* times *)</span>
<span class="keyword1"><span class="command">instantiation</span></span> real_alg <span class="main">::</span> <span class="quoted">times</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">times_real_alg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> real_alg"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">mult_3</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_3<span class="main">)</span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> times_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real_of <span class="free">y</span><span class="main">)</span> <span class="main">=</span> real_of <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> mult_3<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="comment1">(* inverse *)</span>
<span class="keyword1"><span class="command">instantiation</span></span> real_alg <span class="main">::</span> <span class="quoted">inverse</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inverse_real_alg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> real_alg"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">inverse_3</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_3<span class="main">)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">divide_real_alg</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> real_alg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">divide_real_alg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> inverse <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="comment1">(* TODO: better to use poly_div *)</span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inverse_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> real_of <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> inverse_3<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> divide_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>real_of <span class="free">y</span><span class="main">)</span> <span class="main">=</span> real_of <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> divide_real_alg_def times_real_alg<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> divide_real_def inverse_real_alg <span class="keyword1"><span class="command">..</span></span>

<span class="comment1">(* group *)</span>
<span class="keyword1"><span class="command">instance</span></span> real_alg <span class="main">::</span> <span class="quoted">ab_group_add</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> add_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> zero_real_alg_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> add_3 of_rat_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> add_3 of_rat_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> add_3 uminus_3 of_rat_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> minus_real_alg_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* field *)</span>
<span class="keyword1"><span class="command">instance</span></span> real_alg <span class="main">::</span> <span class="quoted">field</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mult_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mult_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> one_real_alg_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mult_3 of_rat_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mult_3 add_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> zero_real_alg_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> of_rat_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> mult_3 inverse_3 of_rat_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> divide_real_alg_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> inverse_3 of_rat_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* numeral *)</span>
<span class="keyword1"><span class="command">instance</span></span> real_alg <span class="main">::</span> <span class="quoted">numeral</span> <span class="keyword1"><span class="command">..</span></span>  

<span class="comment1">(* root *)</span>
<span class="keyword1"><span class="command">lift_definition</span></span> root_real_alg <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real_alg <span class="main">⇒</span> real_alg"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">root_3</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> root_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> root_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="free">n</span> <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> real_of <span class="main">(</span>root_real_alg <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> root_3<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="comment1">(* sgn *)</span>
<span class="keyword1"><span class="command">lift_definition</span></span> sgn_real_alg_rat <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">sgn_3</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> sgn_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> to_rat_of_rat<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sgn_real_alg_rat<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span>sgn_real_alg_rat <span class="free">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_3<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> real_alg <span class="main">::</span> <span class="quoted">sgn</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">sgn_real_alg</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> real_alg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sgn_real_alg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> of_rat_real_alg <span class="main">(</span>sgn_real_alg_rat <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sgn_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> real_of <span class="main">(</span>sgn <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sgn_real_alg_def of_rat_real_alg<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_3<span class="main">)</span>

<span class="comment1">(* equal *)</span>
<span class="keyword1"><span class="command">instantiation</span></span> real_alg <span class="main">::</span> <span class="quoted">equal</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">equal_real_alg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">equal_3</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equal_3<span class="main">)</span>
<span class="keyword1"><span class="command">instance</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">real_alg</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"equal_class.equal <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equal_3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equal_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"HOL.equal <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">(</span>real_of <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> equal_real_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(* comparisons *)</span>
<span class="keyword1"><span class="command">instantiation</span></span> real_alg <span class="main">::</span> <span class="quoted">ord</span> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_real_alg</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">less_real_alg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span>real_of <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> real_of <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_eq_real_alg</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_real_alg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span>real_of <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> real_of <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>    

<span class="keyword1"><span class="command">lemma</span></span> less_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"less <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">(</span>real_of <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> less_real_alg_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">lemma</span></span> less_eq_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"less_eq <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">(</span>real_of <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> less_eq_real_alg_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> real_alg <span class="main">::</span> <span class="quoted">compare_order</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">compare_real_alg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> order"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">compare_3</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compare_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> compare_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"compare <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">(</span>real_of <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>compare <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compare_3<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> compare_real_alg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"le_of_comp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> compare <span class="main">(</span>real_of <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>real_of <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(≤)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compare_real_def comparator_of_def le_of_comp_def less_eq_real_alg_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt_of_comp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> compare <span class="main">(</span>real_of <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>real_of <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(&lt;)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compare_real_def comparator_of_def lt_of_comp_def less_real_alg_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"comparator <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> compare <span class="main">(</span>real_of <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>real_of <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> comparator_def 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted">real_of</span>
    <span class="keyword1"><span class="command">note</span></span> rc <span class="main">=</span> comparator_compare<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">real</span><span class="main">,</span> <span class="operator">unfolded</span> comparator_def<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> rc <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invert_order <span class="main">(</span>compare <span class="main">(</span><span class="var">?r</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> compare <span class="main">(</span><span class="var">?r</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> rc <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compare <span class="main">(</span><span class="var">?r</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> Lt <span class="main">⟹</span> compare <span class="main">(</span><span class="var">?r</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> Lt <span class="main">⟹</span> compare <span class="main">(</span><span class="var">?r</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> Lt"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"compare <span class="main">(</span><span class="var">?r</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> Eq"</span></span>
    <span class="keyword1"><span class="command">with</span></span> rc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?r</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> real_of_inj <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> less_eq_real_alg_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>less_eq <span class="main">::</span> real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">=</span> le_of_comp compare"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>less <span class="main">::</span> real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">=</span> lt_of_comp compare"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_defs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ord_defs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> real_alg <span class="main">::</span> <span class="quoted">abs</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">abs_real_alg</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> real_alg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">abs_real_alg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> real_of <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> uminus <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> abs_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> real_of <span class="main">(</span>abs <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> abs_real_alg_def abs_real_def if_distrib
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uminus_real_alg<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sgn_real_alg_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">0</span> <span class="main">&lt;</span> real_of <span class="free">x</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of <span class="main">(</span>sgn <span class="free">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_real_alg<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real_of <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sgn_real_def if_distrib 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_real_alg_def 
    zero_real_alg_def one_real_alg_def of_rat_real_alg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> equal_real_alg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
    equal_real_def uminus_real_alg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">x</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> equal_real_alg<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> equal_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_of_of_int<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="main">(</span>rat_of_int <span class="free">z</span><span class="main">)</span> <span class="main">=</span> real_of <span class="main">(</span>of_int <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> nat <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> int <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> z
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_real_alg plus_real_alg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> one_real_alg <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> nat <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="main">-</span> int <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> z
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_real_alg plus_real_alg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> one_real_alg uminus_real_alg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
      minus_real_alg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> real_alg <span class="main">::</span> <span class="quoted">linordered_field</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> less_eq_real_alg_def plus_real_alg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> abs_real_alg_def less_real_alg_def zero_real_alg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> less_real_alg_def times_real_alg<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sgn_real_alg_sound<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">instantiation</span></span> real_alg <span class="main">::</span> <span class="quoted">floor_ceiling</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">floor_real_alg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">floor_3</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> floor_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> floor_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"floor <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> floor <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> floor_3<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real_alg</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">&lt;</span> of_int <span class="main">(</span><span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> floor_real_alg<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> floor_correct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real_of <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> less_eq_real_alg_def less_real_alg_def
    real_of_of_int<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> of_int <span class="main">(</span><span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">≤</span> of_int <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_alg_of_real</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real_alg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">real_alg_of_real</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> real_of <span class="bound">y</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> real_of <span class="bound">y</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> real_alg_of_real_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"real_alg_of_real <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> real_of_inj <span class="keyword1"><span class="command">unfolding</span></span> real_alg_of_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lift_definition</span></span> to_rat_real_alg_main <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> rat option"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">to_rat_3</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_rat_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> to_rat_real_alg_main<span class="main">:</span> <span class="quoted"><span class="quoted">"to_rat_real_alg_main <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> real_of <span class="free">x</span> <span class="main">∈</span> <span class="main">ℚ</span> <span class="keyword1">then</span> 
  Some <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">q</span><span class="main">.</span> real_of <span class="free">x</span> <span class="main">=</span> of_rat <span class="bound">q</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> to_rat_3<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">to_rat_real_alg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">to_rat_real_alg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> to_rat_real_alg_main <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> Some <span class="bound">q</span> <span class="main">⇒</span> <span class="bound">q</span> <span class="main">|</span> None <span class="main">⇒</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_rat_real_alg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_rat_real_alg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> to_rat_real_alg_main <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> Some <span class="bound">q</span> <span class="main">⇒</span> True <span class="main">|</span> None <span class="main">⇒</span> False<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_rat_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"is_rat <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>is_rat_real_alg <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_rat_real_alg_def is_rat to_rat_real_alg_main <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> to_rat_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"to_rat <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>to_rat_real_alg <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> to_rat to_rat_real_alg_def to_rat_real_alg_main <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Real Algebraic Numbers as Implementation for Real Numbers›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> real_alg_code_eqns <span class="main">=</span>  
  one_real_alg
  zero_real_alg
  uminus_real_alg
  root_real_alg
  minus_real_alg
  plus_real_alg
  times_real_alg
  inverse_real_alg
  divide_real_alg
  equal_real_alg
  less_real_alg
  less_eq_real_alg
  compare_real_alg
  sgn_real_alg
  abs_real_alg
  floor_real_alg
  is_rat_real_alg
  to_rat_real_alg

<span class="keyword1"><span class="command">code_datatype</span></span> <span class="quoted">real_of</span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">drop</span><span class="main"><span class="main">:</span></span>
  <span class="quoted"><span class="quoted">"plus <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted"><span class="quoted">"uminus <span class="main">::</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted"><span class="quoted">"minus <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted"><span class="quoted">"times <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted"><span class="quoted">"inverse <span class="main">::</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted"><span class="quoted">"divide <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted"><span class="quoted">"floor <span class="main">::</span> real <span class="main">⇒</span> int"</span></span>
  <span class="quoted"><span class="quoted">"HOL.equal <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span>
  <span class="quoted"><span class="quoted">"compare <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> order"</span></span>
  <span class="quoted"><span class="quoted">"less_eq <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span>
  <span class="quoted"><span class="quoted">"less <span class="main">::</span> real <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> real"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">::</span> real"</span></span>
  <span class="quoted"><span class="quoted">"sgn <span class="main">::</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted"><span class="quoted">"abs <span class="main">::</span> real <span class="main">⇒</span> real"</span></span>
  <span class="quoted">root</span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> real_alg_code_eqns <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">equation</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> Ratreal_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Ratreal <span class="main">=</span> real_of <span class="main">∘</span> of_rat_real_alg"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff of_rat_2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> real_of_post<span class="main">[</span><span class="operator">code_post</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"real_of <span class="main">(</span>Real_Alg_Quotient <span class="main">(</span>Real_Alg_Invariant <span class="main">(</span>Rational <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> of_rat <span class="free">x</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_3 <span class="main">(</span>Real_Alg_Invariant <span class="main">(</span>Rational <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> real_of_rat <span class="skolem">x</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Real_Alg_Invariant_inverse real_of_3.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Real_Roots">
<div class="head">
<h1>Theory Real_Roots</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Real Roots›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory contains an algorithm to determine the set of real roots of a 
  rational polynomial. It further contains an algorithm which tries to determine the
  real roots of real-valued polynomial, which incorporates Yun-factorization and 
  closed formulas for polynomials of degree 2.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Real_Roots
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Real_Algebraic_Numbers.html">Real_Algebraic_Numbers</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> UnivPoly.coeff
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Module.smult

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Division of integers, rounding to the upper value.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">div_ceiling</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">div_ceiling</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">q</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">q</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="bound">q</span> <span class="keyword1">else</span> <span class="bound">q</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">root_bound</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> rat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">root_bound</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> 
     <span class="bound">n</span> <span class="main">=</span> degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span>
     <span class="bound">m</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> div_ceiling <span class="main">(</span>max_list_non_empty <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> abs <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span>abs <span class="main">(</span>lead_coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>
     <span class="comment1">― ‹round to the next higher number <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>2^n›</span></span>, so that bisection will›</span>
     <span class="comment1">― ‹stay on integers for as long as possible›</span>
   <span class="keyword1">in</span> of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>log_ceiling <span class="numeral">2</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">partial_function</span></span> <span class="main">(</span>tailrec<span class="main">)</span> <span class="entity">roots_of_2_main</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> root_info <span class="main">⇒</span> <span class="main">(</span>rat <span class="main">⇒</span> rat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>rat <span class="main">×</span> rat<span class="main">)</span>list <span class="main">⇒</span> real_alg_2 list <span class="main">⇒</span> real_alg_2 list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">roots_of_2_main</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="free"><span class="bound"><span class="entity">cr</span></span></span> <span class="free"><span class="bound"><span class="entity">lrs</span></span></span> <span class="free"><span class="bound"><span class="entity">rais</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">lrs</span></span></span> <span class="keyword1">of</span> Nil <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">rais</span></span></span>
  <span class="main">|</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">#</span> <span class="bound">lrs</span> <span class="main">⇒</span> <span class="keyword1">let</span> <span class="bound">c</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">cr</span></span></span> <span class="bound">l</span> <span class="bound">r</span> <span class="keyword1">in</span> 
    <span class="keyword1">if</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">roots_of_2_main</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="free"><span class="bound"><span class="entity">cr</span></span></span> <span class="bound">lrs</span> <span class="free"><span class="bound"><span class="entity">rais</span></span></span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">roots_of_2_main</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="free"><span class="bound"><span class="entity">cr</span></span></span> <span class="bound">lrs</span> <span class="main">(</span>real_alg_2'' <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">l</span> <span class="bound">r</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">rais</span></span></span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">(</span><span class="bound">l</span> <span class="main">+</span> <span class="bound">r</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">in</span> <span class="free">roots_of_2_main</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="free"><span class="bound"><span class="entity">cr</span></span></span> <span class="main">(</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">m</span><span class="main">)</span> <span class="main">#</span> <span class="bound">lrs</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">rais</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">roots_of_2_irr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> real_alg_2 list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">roots_of_2_irr</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> degree <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">1</span>
    <span class="keyword1">then</span> <span class="main">[</span>Rational <span class="main">(</span>Rat.Fract <span class="main">(</span><span class="main">-</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">]</span> <span class="keyword1">else</span> 
    <span class="keyword1">let</span> <span class="bound">ri</span> <span class="main">=</span> root_info <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span>
        <span class="bound">cr</span> <span class="main">=</span> root_info.l_r <span class="bound">ri</span><span class="main">;</span>
        <span class="bound">B</span> <span class="main">=</span> root_bound <span class="free"><span class="bound"><span class="entity">p</span></span></span>
      <span class="keyword1">in</span> <span class="main">(</span>roots_of_2_main <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">ri</span> <span class="bound">cr</span> <span class="main">[</span><span class="main">(</span><span class="main">-</span><span class="bound">B</span><span class="main">,</span><span class="bound">B</span><span class="main">)</span><span class="main">]</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> root_imp_deg_nonzero<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> degree0_coeffs<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> cauchy_root_bound<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> real_normed_field"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> max_list_non_empty <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> norm <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> degree <span class="free">p</span><span class="main">]</span><span class="main">)</span> 
    <span class="main">/</span> norm <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> <span class="main">_</span> <span class="main">+</span> <span class="var">?max</span> <span class="main">/</span> <span class="var">?nlc</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ml</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ml</span> <span class="main">=</span> <span class="var">?max</span> <span class="main">/</span> <span class="var">?nlc</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> lc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lc</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> nlc<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="var">?lc</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> root_imp_deg_nonzero<span class="main">[</span><span class="operator">OF</span> p x<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> degree <span class="free">p</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> norm <span class="main">(</span><span class="var">?p</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="var">?max</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max_list_non_empty<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> max0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?max</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> nlc <span class="keyword1"><span class="command">have</span></span> ml0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ml</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ml_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> easy<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ml_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"norm <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> easy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> nx<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">hence</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> xn0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> norm <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> x<span class="main">[</span><span class="operator">unfolded</span> poly_altdef<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="var">?n</span> <span class="main">*</span> <span class="var">?lc</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span> <span class="main">*</span> <span class="var">?lc</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="var">?n</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="var">?p</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> poly_altdef <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>    
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="var">?n</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="var">?p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span> <span class="main">*</span> <span class="var">?lc</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="var">?n</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="var">?p</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.remove<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?n</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="var">?n</span> <span class="main">*</span> <span class="var">?lc</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="var">?n</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="var">?p</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> lc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="var">?n</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="var">?n</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="var">?p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> <span class="var">?lc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted">norm</span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span> <span class="main">=</span> norm <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="var">?n</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="var">?p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> <span class="var">?lc</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> norm_power <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="var">?n</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="var">?p</span> <span class="bound">i</span><span class="main">)</span> <span class="main">/</span> <span class="var">?lc</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="var">?n</span><span class="main">.</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="var">?p</span> <span class="bound">i</span> <span class="main">/</span> <span class="var">?lc</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_divide_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="var">?n</span><span class="main">.</span> norm <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span><span class="var">?p</span> <span class="bound">i</span> <span class="main">/</span> <span class="var">?lc</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> norm_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="var">?n</span><span class="main">.</span> norm <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> norm <span class="main">(</span><span class="var">?p</span> <span class="bound">i</span> <span class="main">/</span> <span class="var">?lc</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> norm_mult norm_power <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="var">?n</span><span class="main">.</span> norm <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="skolem">ml</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_mono<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="var">?n</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">hence</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">x</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">*</span> norm <span class="main">(</span><span class="var">?p</span> <span class="skolem">i</span> <span class="main">/</span> <span class="var">?lc</span><span class="main">)</span> <span class="main">≤</span> norm <span class="free">x</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">*</span> <span class="skolem">ml</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mult_left_mono<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> norm <span class="free">x</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="var">?p</span> <span class="skolem">i</span> <span class="main">/</span> <span class="var">?lc</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">ml</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> norm_divide ml_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> divide_right_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> max_list_non_empty<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> nlc i<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">ml</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="var">?n</span><span class="main">.</span> norm <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> sum_distrib_right<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="var">?n</span><span class="main">.</span> norm <span class="free">x</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>norm <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>norm <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> geometric_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> nx<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span> <span class="main">≤</span> <span class="skolem">ml</span> <span class="main">*</span> <span class="main">(</span>norm <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>norm <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>        
    <span class="keyword1"><span class="command">from</span></span> mult_left_mono<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"norm <span class="free">x</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>norm <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">ml</span> <span class="main">*</span> <span class="main">(</span>norm <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ml</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>norm <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> norm <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> nx False x0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>norm <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">ml</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>norm <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> norm <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> mult_right_le_imp_le<span class="main">[</span><span class="operator">OF</span> this xn0<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">ml</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>norm <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">ml</span> <span class="main">-</span> <span class="skolem">ml</span> <span class="main">/</span> <span class="main">(</span>norm <span class="free">x</span> <span class="main">^</span> <span class="var">?n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">ml</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ml0 xn0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ml_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
      
<span class="keyword1"><span class="command">lemma</span></span> div_le_div_ceiling<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">div</span> <span class="free">y</span> <span class="main">≤</span> div_ceiling <span class="free">x</span> <span class="free">y</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> div_ceiling_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">lemma</span></span> div_ceiling<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> floor_ceiling<span class="main">)</span> <span class="main">/</span> of_int <span class="free">q</span> <span class="main">≤</span> of_int <span class="main">(</span>div_ceiling <span class="free">x</span> <span class="free">q</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> xqk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"div_ceiling <span class="free">x</span> <span class="free">q</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> div_ceiling_def Let_def <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">unfolding</span></span> xqk <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">div</span> <span class="free">q</span> <span class="main">*</span> <span class="free">q</span> <span class="main">=</span> <span class="free">x</span>"</span></span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"div_ceiling <span class="free">x</span> <span class="free">q</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">div</span> <span class="free">q</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> div_ceiling_def Let_def <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> floor_divide_of_int_eq le_less add1_zle_eq floor_less_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> max_list_non_empty_map<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> max <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>max <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> max_list_non_empty <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>max_list_non_empty <span class="free">xs</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> max_list_non_empty.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hom<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> root_bound<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"root_bound <span class="free">p</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> norm <span class="free">x</span> <span class="main">≤</span> of_rat <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted">real_of_rat</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted">real_of_int</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_int_poly <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">n</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?list</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> abs <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">]</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?list'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="var">?i</span> <span class="main">(</span>abs <span class="main">(</span><span class="main">(</span>coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">]</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> max_list_non_empty <span class="var">?list</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m_up</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m_up</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> div_ceiling <span class="skolem">m</span> <span class="main">(</span>abs <span class="var">?lc</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> rat_of_int <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>log_ceiling <span class="numeral">2</span> <span class="skolem">m_up</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> deg <span class="keyword1"><span class="command">have</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> p0 <span class="keyword1"><span class="command">have</span></span> alc0<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="var">?lc</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> deg <span class="keyword1"><span class="command">have</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>coeff <span class="free">p</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?list</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> max_list_non_empty<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">folded</span> m_def<span class="main">]</span>    
  <span class="keyword1"><span class="command">have</span></span> m0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"div_ceiling <span class="skolem">m</span> <span class="main">(</span>abs <span class="var">?lc</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ div_le_div_ceiling<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">m</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"abs <span class="var"><span class="var"><span class="var">?lc</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span>
    pos_imp_zdiv_nonneg_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> p0 m0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> mup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m_up</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_up_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m_up</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>log_ceiling <span class="numeral">2</span> <span class="skolem">m_up</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  mup log_ceiling_sound<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> Cmup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">≥</span> of_int <span class="skolem">m_up</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">with</span></span> mup <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> root_bound_def Let_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> of_rat <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def m_up_def n_def m_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> dc <span class="main">=</span> div_le_div_ceiling<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="quoted">"abs <span class="var">?lc</span>"</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">with</span></span> C <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">hence</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="var">?p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> root_imp_deg_nonzero<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span> p0 <span class="keyword1"><span class="command">have</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> cauchy_root_bound<span class="main">[</span><span class="operator">OF</span> rt<span class="main">]</span> p0
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> max_list_non_empty <span class="var">?list'</span> <span class="main">/</span> <span class="var">?i</span> <span class="main">(</span>abs <span class="var">?lc</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?list'</span> <span class="main">=</span> map <span class="var">?i</span> <span class="var">?list</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max_list_non_empty <span class="main">…</span> <span class="main">=</span> <span class="var">?i</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max_list_non_empty_map<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> mem<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">/</span> <span class="var">?i</span> <span class="main">(</span>abs <span class="var">?lc</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?i</span> <span class="skolem">m_up</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> m_up_def <span class="keyword1"><span class="command">using</span></span> div_ceiling<span class="main">[</span><span class="operator">OF</span> alc0<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="var">?r</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cmup <span class="keyword1"><span class="command">using</span></span> of_rat_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">x</span> <span class="main">≤</span> <span class="var">?r</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">x</span> <span class="main">≤</span> <span class="var">?r</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pairwise_disjoint</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pairwise_disjoint</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pairwise_disjoint</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">.</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="free">pairwise_disjoint</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> roots_of_2_irr<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> pc<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">`</span> set <span class="main">(</span>roots_of_2_irr <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?one</span></span></span><span class="main">)</span>
    <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="main">(</span>roots_of_2_irr <span class="free">p</span><span class="main">)</span><span class="main">)</span> invariant_2"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?two</span></span></span><span class="main">)</span>
    <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map real_of_2 <span class="main">(</span>roots_of_2_irr <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?three</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> d <span class="main">=</span> roots_of_2_irr_def
  <span class="keyword1"><span class="command">from</span></span> poly_condD<span class="main">[</span><span class="operator">OF</span> pc<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> mon<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?norm</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_alg_2'"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?one</span> <span class="main">∧</span> <span class="var">?two</span> <span class="main">∧</span> <span class="var">?three</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"roots_of_2_irr <span class="free">p</span> <span class="main">=</span> <span class="main">[</span>Rational <span class="main">(</span>Rat.Fract <span class="main">(</span><span class="main">-</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span><span class="skolem">d</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d d_def c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> degree1_coeffs<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">c</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> real_of_int <span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>real_of_int <span class="skolem">c</span> <span class="main">/</span> real_of_int <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rr <span class="keyword1"><span class="command">using</span></span> d * <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">using</span></span> of_rat_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"Rat.Fract <span class="main"><span class="main">(</span></span><span class="main"><span class="main">-</span></span> <span class="skolem"><span class="skolem">c</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">d</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Fract_of_int_quotient <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted">real_of_rat</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>roots_of_2_irr <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ri</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ri</span> <span class="main">=</span> root_info <span class="free">p</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cr</span> <span class="main">=</span> root_info.l_r <span class="skolem">ri</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bnds</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bnds</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">-</span>root_bound <span class="free">p</span><span class="main">,</span> root_bound <span class="free">p</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">empty</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">empty</span> <span class="main">=</span> <span class="main">(</span>Nil <span class="main">::</span> real_alg_2 list<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> empty<span class="main">:</span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="skolem">empty</span><span class="main">)</span> invariant_2 <span class="main">∧</span> distinct <span class="main">(</span>map real_of_2 <span class="skolem">empty</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> empty_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> mon <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> root_info<span class="main">[</span><span class="operator">OF</span> irr deg<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> ri<span class="main">:</span> <span class="quoted"><span class="quoted">"root_info_cond <span class="skolem">ri</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ri_def <span class="keyword1"><span class="command">.</span></span>    
    <span class="keyword1"><span class="command">from</span></span> False 
    <span class="keyword1"><span class="command">have</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"roots_of_2_irr <span class="free">p</span> <span class="main">=</span> roots_of_2_main <span class="free">p</span> <span class="skolem">ri</span> <span class="skolem">cr</span> <span class="skolem">bnds</span> <span class="skolem">empty</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> d ri_def cr_def Let_def bnds_def empty_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> root_bound <span class="main">=</span> root_bound<span class="main">[</span><span class="operator">OF</span> refl deg<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> root_bound<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> bnds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">bnds</span> <span class="main">⟹</span> <span class="bound">l</span> <span class="main">≤</span> <span class="bound">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bnds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?r</span> <span class="main">(</span><span class="main">-</span> root_bound <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="var">?r</span> <span class="main">(</span>root_bound <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> root_bound<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> rts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> 
      <span class="main">=</span> real_of_2 <span class="main">`</span> set <span class="skolem">empty</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">bnds</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> empty_def bnds_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> root_cond_def<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rts</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rts</span> <span class="skolem">lr</span> <span class="main">=</span> Collect <span class="main">(</span>root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">lr</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">lr</span> 
    <span class="keyword1"><span class="command">have</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"pairwise_disjoint <span class="main">(</span>real_of_2 <span class="main">`</span> set <span class="skolem">empty</span> <span class="main">#</span> map <span class="skolem">rts</span> <span class="skolem">bnds</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> empty_def bnds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> deg False <span class="keyword1"><span class="command">have</span></span> deg1<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">delta</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">delta</span> <span class="main">=</span> ipoly_root_delta <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> delta <span class="main">=</span> ipoly_root_delta<span class="main">[</span><span class="operator">OF</span> p<span class="main">,</span> <span class="operator">folded</span> delta_def<span class="main">]</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rel'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rel'</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> delta_gt <span class="skolem">delta</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span><span class="main">^-1</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">mm</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mm</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">bnds</span><span class="main">.</span> mset <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">.</span> <span class="var">?r</span> <span class="bound">r</span> <span class="main">-</span> <span class="var">?r</span> <span class="bound">l</span><span class="main">)</span> <span class="bound">bnds</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rel</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rel</span> <span class="main">=</span> inv_image <span class="main">(</span>mult1 <span class="skolem">rel'</span><span class="main">)</span> <span class="skolem">mm</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="skolem">rel</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rel_def rel'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_inv_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_mult1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> SN_imp_wf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta_gt_SN<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?main</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"roots_of_2_main <span class="free">p</span> <span class="skolem">ri</span> <span class="skolem">cr</span>"</span></span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">`</span> set <span class="main">(</span><span class="var">?main</span> <span class="skolem">bnds</span> <span class="skolem">empty</span><span class="main">)</span> <span class="main">=</span>
      real_of_2 <span class="main">`</span> set <span class="skolem">empty</span> <span class="main">∪</span>
      <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="bound">l</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">bnds</span><span class="main">}</span> <span class="main">∧</span>
      Ball <span class="main">(</span>set <span class="main">(</span><span class="var">?main</span> <span class="skolem">bnds</span> <span class="skolem">empty</span><span class="main">)</span><span class="main">)</span> invariant_2 <span class="main">∧</span> distinct <span class="main">(</span>map real_of_2 <span class="main">(</span><span class="var">?main</span> <span class="skolem">bnds</span> <span class="skolem">empty</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?one'</span> <span class="main">∧</span> <span class="var">?two'</span> <span class="main">∧</span> <span class="var">?three'</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> empty bnds disj
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">bnds</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">empty</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">lrss</span> <span class="skolem">rais</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> rais <span class="main">=</span> 1<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span>
      <span class="keyword1"><span class="command">note</span></span> lrs <span class="main">=</span> 1<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> disj <span class="main">=</span> 1<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span>
      <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> roots_of_2_main.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">ri</span></span> <span class="quoted"><span class="skolem">cr</span></span> <span class="quoted"><span class="skolem">lrss</span></span> <span class="quoted"><span class="skolem">rais</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">lrss</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword1"><span class="command">with</span></span> rais <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> simp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">lr</span> <span class="skolem">lrs</span><span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> lr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">lr</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">lr'</span>
          <span class="keyword3"><span class="command">assume</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l'</span> <span class="bound">r'</span><span class="main">.</span> <span class="main">(</span><span class="bound">l'</span><span class="main">,</span><span class="bound">r'</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">lr'</span> <span class="main">⟹</span> 
            <span class="bound">l'</span> <span class="main">≤</span> <span class="bound">r'</span> <span class="main">∧</span> delta_gt <span class="skolem">delta</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">r</span> <span class="main">-</span> <span class="var">?r</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">(</span><span class="var">?r</span> <span class="bound">r'</span> <span class="main">-</span> <span class="var">?r</span> <span class="bound">l'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mm</span> <span class="main">(</span><span class="skolem">lr'</span> <span class="main">@</span> <span class="skolem">lrs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">mm</span> <span class="skolem">lrs</span> <span class="main">+</span> <span class="skolem">mm</span> <span class="skolem">lr'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mm_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mm</span> <span class="skolem">lrss</span> <span class="main">=</span> <span class="skolem">mm</span> <span class="skolem">lrs</span> <span class="main">+</span> <span class="main">{#</span> <span class="var">?r</span> <span class="skolem">r</span> <span class="main">-</span> <span class="var">?r</span> <span class="skolem">l</span> <span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Cons lr' rel_def mm_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">mm</span> <span class="main">(</span><span class="skolem">lr'</span> <span class="main">@</span> <span class="skolem">lrs</span><span class="main">)</span><span class="main">,</span> <span class="skolem">mm</span> <span class="skolem">lrss</span><span class="main">)</span> <span class="main">∈</span> mult1 <span class="skolem">rel'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l r mult1_def
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> split<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> exI conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> add_mset_add_single<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈#</span> <span class="skolem">mm</span> <span class="skolem">lr'</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="var">?r</span> <span class="skolem">r'</span> <span class="main">-</span> <span class="var">?r</span> <span class="skolem">l'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">lr'</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> mm_def in_multiset_in_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> lt<span class="main">[</span><span class="operator">OF</span> lr'<span class="main">]</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="var">?r</span> <span class="skolem">r</span> <span class="main">-</span> <span class="var">?r</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">rel'</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> d rel'_def 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_rat_less_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lr'</span> <span class="main">@</span> <span class="skolem">lrs</span><span class="main">,</span> <span class="skolem">lrss</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">rel</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> rel <span class="main">=</span> this
        <span class="keyword1"><span class="command">from</span></span> rel<span class="main">[</span><span class="operator">of</span> <span class="quoted">Nil</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> easy_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">lrs</span><span class="main">,</span><span class="skolem">lrss</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">rel</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">cr</span> <span class="skolem">l</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> simp Cons lr' <span class="keyword1"><span class="command">have</span></span> simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?main</span> <span class="skolem">lrss</span> <span class="skolem">rais</span> <span class="main">=</span> 
          <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="var">?main</span> <span class="skolem">lrs</span> <span class="skolem">rais</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> 
             <span class="var">?main</span> <span class="skolem">lrs</span> <span class="main">(</span>real_alg_2' <span class="skolem">ri</span> <span class="free">p</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="main">#</span> <span class="skolem">rais</span><span class="main">)</span>
               <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="keyword1">in</span> <span class="var">?main</span> <span class="main">(</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span> <span class="bound">m</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">lrs</span><span class="main">)</span> <span class="skolem">rais</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> c_def simp Cons lr' <span class="keyword1"><span class="command">using</span></span> real_alg_2''<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">note</span></span> lrs <span class="main">=</span> lrs<span class="main">[</span><span class="operator">unfolded</span> Cons lr'<span class="main">]</span>        
        <span class="keyword1"><span class="command">from</span></span> lrs <span class="keyword1"><span class="command">have</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> root_info_condD<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ri lr<span class="main">,</span> <span class="operator">folded</span> cr_def<span class="main">]</span> 
        <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rt</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">lrs</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="bound">l</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> set <span class="bound">lrs</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> rts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rt</span> <span class="skolem">lrss</span> <span class="main">=</span> <span class="var">?rt</span> <span class="skolem">lrs</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rt1</span> <span class="main">=</span> <span class="var">?rt2</span> <span class="main">∪</span> <span class="var">?rt3</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> Cons lr' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True          
          <span class="keyword1"><span class="command">with</span></span> simp <span class="keyword1"><span class="command">have</span></span> simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?main</span> <span class="skolem">lrss</span> <span class="skolem">rais</span> <span class="main">=</span> <span class="var">?main</span> <span class="skolem">lrs</span> <span class="skolem">rais</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> disj <span class="keyword1"><span class="command">have</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"pairwise_disjoint <span class="main">(</span>real_of_2 <span class="main">`</span> set <span class="skolem">rais</span> <span class="main">#</span> map <span class="skolem">rts</span> <span class="skolem">lrs</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> finite_ipoly_roots<span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span> True<span class="main">[</span><span class="operator">unfolded</span> c<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rt3</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> split <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> rts <span class="keyword1"><span class="command">have</span></span> rts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rt1</span> <span class="main">=</span> <span class="var">?rt2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> simp rts 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main"><span class="main">[</span></span><span class="operator">OF</span> easy_rel rais lrs disj<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rai</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_alg_2' <span class="skolem">ri</span> <span class="free">p</span> <span class="skolem">l</span> <span class="skolem">r</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> True simp <span class="keyword1"><span class="command">have</span></span> simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?main</span> <span class="skolem">lrss</span> <span class="skolem">rais</span> <span class="main">=</span> <span class="var">?main</span> <span class="skolem">lrs</span> <span class="main">(</span><span class="var">?rai</span> <span class="main">#</span> <span class="skolem">rais</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> card_1_Collect_ex1<span class="main">[</span><span class="operator">OF</span> c<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> True<span class="main"><span class="main">]</span></span><span class="main">]</span> 
            <span class="keyword1"><span class="command">have</span></span> ur<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">.</span></span>            
            <span class="keyword1"><span class="command">from</span></span> real_alg_2'<span class="main">[</span><span class="operator">OF</span> ur pc ri<span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> rai<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="var">?rai</span>"</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="var">?rai</span> <span class="main">=</span> the_unique_root <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> rais <span class="keyword1"><span class="command">have</span></span> rais<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?rai</span> <span class="main">#</span> <span class="skolem">rais</span><span class="main">)</span> <span class="main">⟹</span> invariant_2 <span class="bound">x</span>"</span></span> 
              <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map real_of_2 <span class="skolem">rais</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> rt3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rt3</span> <span class="main">=</span> <span class="main">{</span>real_of_2 <span class="var">?rai</span><span class="main">}</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> rc1 ur rai <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> the_unique_root_eqI theI'<span class="main">)</span>            
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">`</span> set <span class="main">(</span>roots_of_2_main <span class="free">p</span> <span class="skolem">ri</span> <span class="skolem">cr</span> <span class="skolem">lrs</span> <span class="main">(</span><span class="var">?rai</span> <span class="main">#</span> <span class="skolem">rais</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              real_of_2 <span class="main">`</span> set <span class="main">(</span><span class="var">?rai</span> <span class="main">#</span> <span class="skolem">rais</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?rt2</span> <span class="main">∧</span>
              Ball <span class="main">(</span>set <span class="main">(</span>roots_of_2_main <span class="free">p</span> <span class="skolem">ri</span> <span class="skolem">cr</span> <span class="skolem">lrs</span> <span class="main">(</span><span class="var">?rai</span> <span class="main">#</span> <span class="skolem">rais</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> invariant_2 <span class="main">∧</span>
              distinct <span class="main">(</span>map real_of_2 <span class="main">(</span>roots_of_2_main <span class="free">p</span> <span class="skolem">ri</span> <span class="skolem">cr</span> <span class="skolem">lrs</span> <span class="main">(</span><span class="var">?rai</span> <span class="main">#</span> <span class="skolem">rais</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?one</span> <span class="main">∧</span> <span class="var">?two</span> <span class="main">∧</span> <span class="var">?three</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main"><span class="main">[</span></span><span class="operator">OF</span> easy_rel<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?rai</span></span> <span class="main"><span class="main">#</span></span> <span class="skolem"><span class="skolem">rais</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> conjI lrs<span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="main">(</span>real_alg_2' <span class="skolem">ri</span> <span class="free">p</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="main">#</span> <span class="skolem">rais</span><span class="main">)</span><span class="main">)</span> invariant_2"</span></span> <span class="keyword1"><span class="command">using</span></span> rais <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span>real_alg_2' <span class="skolem">ri</span> <span class="free">p</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>map real_of_2 <span class="skolem">rais</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> disj rt3 <span class="keyword1"><span class="command">unfolding</span></span> Cons lr' rts_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map real_of_2 <span class="main">(</span>real_alg_2' <span class="skolem">ri</span> <span class="free">p</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="main">#</span> <span class="skolem">rais</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pairwise_disjoint <span class="main">(</span>real_of_2 <span class="main">`</span> set <span class="main">(</span>real_alg_2' <span class="skolem">ri</span> <span class="free">p</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="main">#</span> <span class="skolem">rais</span><span class="main">)</span> <span class="main">#</span> map <span class="skolem">rts</span> <span class="skolem">lrs</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> disj rt3 <span class="keyword1"><span class="command">unfolding</span></span> Cons lr' rts_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?one</span></span></span> <span class="var"><span class="quoted"><span class="var">?two</span></span></span> <span class="var"><span class="quoted"><span class="var">?three</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> simp rts rt3 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ conjI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?two</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?three</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> <span class="quoted"><span class="quoted">‹<span class="var">?one</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?m</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l</span><span class="main">+</span><span class="skolem">r</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lrs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="var">?m</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="var">?m</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">lrs</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> False <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?main</span> <span class="skolem">lrss</span> <span class="skolem">rais</span> <span class="main">=</span> <span class="var">?main</span> <span class="var">?lrs</span> <span class="skolem">rais</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> simp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> False <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> delta<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> c<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> delta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">delta</span> <span class="main">≤</span> <span class="var">?r</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> lrs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?lrs</span> <span class="main">⟹</span> <span class="bound">l</span> <span class="main">≤</span> <span class="bound">r</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> lr lrs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="var">?m</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Rats_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> poly_cond_degree_gt_1<span class="main">[</span><span class="operator">OF</span> pc deg1<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="var">?m</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> disj1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="var">?m</span> <span class="main">∉</span> <span class="skolem">rts</span> <span class="skolem">lr</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">lr</span> <span class="keyword1"><span class="command">unfolding</span></span> rts_def root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> disj2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rts</span> <span class="main">(</span><span class="var">?m</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">rts</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span> <span class="var">?m</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> disj1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="var">?m</span><span class="main">)</span>"</span></span><span class="main">]</span> disj1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?m</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span><span class="main">]</span> 
              <span class="keyword1"><span class="command">unfolding</span></span> rts_def root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> disj3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rts</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="var">?m</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">rts</span> <span class="main">(</span><span class="var">?m</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">rts</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> rts_def root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> disj4<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">`</span> set <span class="skolem">rais</span> <span class="main">∩</span> <span class="skolem">rts</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> disj <span class="keyword1"><span class="command">unfolding</span></span> Cons lr' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"pairwise_disjoint <span class="main">(</span>real_of_2 <span class="main">`</span> set <span class="skolem">rais</span> <span class="main">#</span> map <span class="skolem">rts</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="var">?m</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">l</span><span class="main">,</span> <span class="var">?m</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">lrs</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> disj disj2 disj3 disj4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Cons lr'<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?lrs</span><span class="main">,</span><span class="skolem">lrss</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">rel</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rel<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l'</span> <span class="skolem">r'</span>
              <span class="keyword3"><span class="command">assume</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">(</span><span class="var">?m</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="var">?m</span><span class="main">)</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command">from</span></span> mem lr <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">≤</span> <span class="skolem">r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> mem <span class="keyword1"><span class="command">have</span></span> diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">r'</span> <span class="main">-</span> <span class="var">?r</span> <span class="skolem">l'</span> <span class="main">=</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">r</span> <span class="main">-</span> <span class="var">?r</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
               <span class="main">(</span><span class="operator">metis</span> eq_diff_eq minus_diff_eq mult_2_right of_rat_add of_rat_diff<span class="main"><span class="keyword3">,</span></span>
                <span class="operator">metis</span> of_rat_add of_rat_mult of_rat_numeral_eq<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"delta_gt <span class="skolem">delta</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">r</span> <span class="main">-</span> <span class="var">?r</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">(</span><span class="var">?r</span> <span class="skolem">r'</span> <span class="main">-</span> <span class="var">?r</span> <span class="skolem">l'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> diff
                delta_gt_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delta<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> lr<span class="main"><span class="keyword3">,</span></span> 
                <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> of_rat_diff of_rat_less_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> IH<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">rais</span></span><span class="main">,</span> <span class="operator">OF</span> rais lrs disj<span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">`</span> set <span class="main">(</span><span class="var">?main</span> <span class="var">?lrs</span> <span class="skolem">rais</span><span class="main">)</span> <span class="main">=</span>
              real_of_2 <span class="main">`</span> set <span class="skolem">rais</span> <span class="main">∪</span> <span class="var">?rt</span> <span class="var">?lrs</span> <span class="main">∧</span>
              Ball <span class="main">(</span>set <span class="main">(</span><span class="var">?main</span> <span class="var">?lrs</span> <span class="skolem">rais</span><span class="main">)</span><span class="main">)</span> invariant_2 <span class="main">∧</span> distinct <span class="main">(</span>map real_of_2 <span class="main">(</span><span class="var">?main</span> <span class="var">?lrs</span> <span class="skolem">rais</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?one</span> <span class="main">∧</span> <span class="var">?two</span>"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?one</span></span></span> <span class="var"><span class="quoted"><span class="var">?two</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command">have</span></span> cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">c</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∪</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">∪</span> <span class="bound">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rt</span> <span class="var">?lrs</span> <span class="main">=</span> <span class="var">?rt</span> <span class="skolem">lrs</span> <span class="main">∪</span> <span class="var">?rt</span> <span class="main">[</span><span class="main">(</span><span class="var">?m</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="var">?m</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rts simp <span class="quoted"><span class="quoted">‹<span class="var">?one</span>›</span></span> id
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cong<span class="main"><span class="main">]</span></span> conjI<span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="var">?m</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∨</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="var">?m</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> root_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"Collect <span class="main">(</span>root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="var">?m</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∨</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="var">?m</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rt</span> <span class="main">[</span><span class="main">(</span><span class="var">?m</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">l</span><span class="main">,</span><span class="var">?m</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> Collect <span class="main">(</span>root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id list.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?main</span> <span class="var">?lrs</span> <span class="skolem">rais</span><span class="main">)</span><span class="main">.</span> invariant_2 <span class="bound">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?two</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map real_of_2 <span class="main">(</span><span class="var">?main</span> <span class="var">?lrs</span> <span class="skolem">rais</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?two</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> idd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?one'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cond<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?two'</span></span></span> <span class="var"><span class="quoted"><span class="var">?three'</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">res</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">res</span> <span class="main">=</span> roots_of_2_main <span class="free">p</span> <span class="skolem">ri</span> <span class="skolem">cr</span> <span class="skolem">bnds</span> <span class="skolem">empty</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">empty</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> empty_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> idd<span class="main">[</span><span class="operator">folded</span> res_def<span class="main">]</span> e <span class="keyword1"><span class="command">have</span></span> idd<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">`</span> set <span class="skolem">res</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l</span> <span class="bound">r</span><span class="main">.</span> root_cond <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="bound">l</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">bnds</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rr <span class="keyword1"><span class="command">unfolding</span></span> rts id e norm_def <span class="keyword1"><span class="command">using</span></span> cond 
      <span class="keyword1"><span class="command">unfolding</span></span> res_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> image_empty e idd<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?one</span></span></span> <span class="var"><span class="quoted"><span class="var">?two</span></span></span> <span class="var"><span class="quoted"><span class="var">?three</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">roots_of_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> real_alg_2 list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">roots_of_2</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> concat <span class="main">(</span>map roots_of_2_irr 
     <span class="main">(</span>factors_of_int_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> roots_of_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> real_of_2 <span class="main">`</span> set <span class="main">(</span>roots_of_2 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="main">(</span>roots_of_2 <span class="free">p</span><span class="main">)</span><span class="main">)</span> invariant_2"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map real_of_2 <span class="main">(</span>roots_of_2 <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"roots_of_2 <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> d <span class="main">=</span> roots_of_2_def
  <span class="keyword1"><span class="command">note</span></span> frp1 <span class="main">=</span> factors_of_int_poly
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">r</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="var">?rr</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>factors_of_int_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span>roots_of_2_irr <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> frp1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> refl s<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_cond <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_cond_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> roots_of_2_irr<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> q
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="var">?rr</span><span class="main">)</span> invariant_2"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>  
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">`</span> set <span class="var">?rr</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> real_of_2 <span class="main">`</span> set <span class="main">(</span>roots_of_2_irr <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> 
      <span class="main">(</span>set <span class="main">(</span>factors_of_int_poly <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?rrr</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> d set_concat set_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?rrr</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
          s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>factors_of_int_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span>roots_of_2_irr <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> real_of_2 <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> frp1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> refl s<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> s0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pt<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_cond_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> roots_of_2_irr<span class="main">[</span><span class="operator">OF</span> pt<span class="main">]</span> q <span class="keyword1"><span class="command">have</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">s</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> frp1<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> refl p<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> rt s <span class="keyword1"><span class="command">have</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
        <span class="keyword3"><span class="command">assume</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> rt frp1<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> refl p<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>factors_of_int_poly <span class="free">p</span><span class="main">)</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">s</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> frp1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> refl s<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> s0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ty<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_cond_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> roots_of_2_irr<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ty<span class="main">]</span> rt <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
          q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span>roots_of_2_irr <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> real_of_2 <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?rrr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">using</span></span> q s <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">`</span> set <span class="var">?rr</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map real_of_2 <span class="main">(</span>roots_of_2 <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> factors_of_int_poly_const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots_of_2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> p<span class="main">:</span> False
    <span class="keyword1"><span class="command">note</span></span> frp1 <span class="main">=</span> frp1<span class="main">[</span><span class="operator">OF</span> refl<span class="main">]</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"factors_of_int_poly <span class="free">p</span>"</span></span> 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span>map roots_of_2_irr <span class="var">?fp</span><span class="main">)</span>"</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots_of_2_def distinct_conv_nth length_map
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI notI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="var">?cc</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="var">?cc</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"map real_of_2 <span class="var">?cc</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> map real_of_2 <span class="var">?cc</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>       
      <span class="keyword1"><span class="command">from</span></span> ij id <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span><span class="var">?cc</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> real_of_2 <span class="main">(</span><span class="var">?cc</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> nth_concat_diff<span class="main">[</span><span class="operator">OF</span> ij<span class="main">,</span> <span class="operator">unfolded</span> length_map<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j1</span></span> <span class="skolem"><span class="skolem">k1</span></span> <span class="skolem"><span class="skolem">j2</span></span> <span class="skolem"><span class="skolem">k2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j1</span><span class="main">,</span><span class="skolem">k1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">j2</span><span class="main">,</span><span class="skolem">k2</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">j1</span> <span class="main">&lt;</span> length <span class="var">?fp</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j2</span> <span class="main">&lt;</span> length <span class="var">?fp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">&lt;</span> length <span class="main">(</span>map roots_of_2_irr <span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">&lt;</span> length <span class="main">(</span>map roots_of_2_irr <span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> map roots_of_2_irr <span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span> <span class="main">!</span> <span class="skolem">k1</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> map roots_of_2_irr <span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span> <span class="main">!</span> <span class="skolem">k2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">&lt;</span> length <span class="main">(</span>roots_of_2_irr <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">&lt;</span> length <span class="main">(</span>roots_of_2_irr <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> roots_of_2_irr <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">k1</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> roots_of_2_irr <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">k2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span> <span class="main">∈</span> set <span class="var">?fp</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span> <span class="main">∈</span> set <span class="var">?fp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> frp1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> mem<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> frp1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> mem<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> pc1<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pc10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> pc2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_cond <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_cond_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j1</span> <span class="main">=</span> <span class="skolem">j2</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">≠</span> <span class="skolem">k2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> **<span class="main">[</span><span class="operator">unfolded</span> True<span class="main">]</span> id *
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map real_of_2 <span class="main">(</span>roots_of_2_irr <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">k1</span> <span class="main">=</span> real_of_2 <span class="main">(</span><span class="var">?cc</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> 
          <span class="quoted"><span class="quoted">"map real_of_2 <span class="main">(</span>roots_of_2_irr <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">k1</span> <span class="main">=</span> real_of_2 <span class="main">(</span><span class="var">?cc</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> distinct <span class="main">(</span>map real_of_2 <span class="main">(</span>roots_of_2_irr <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> distinct_conv_nth <span class="keyword1"><span class="command">using</span></span> * ** True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> roots_of_2_irr<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> pc2<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> neq<span class="main">:</span> False
        <span class="keyword1"><span class="command">with</span></span> frp1<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> * <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span> <span class="main">≠</span> <span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> distinct_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span><span class="var">?cc</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> 
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="var">?x</span>"</span></span> 
        <span class="keyword1"><span class="command">from</span></span> ** <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> real_of_2 <span class="main">`</span> set <span class="main">(</span>roots_of_2_irr <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> roots_of_2_irr<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> pc1<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> ** id <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> real_of_2 <span class="main">`</span> set <span class="main">(</span>roots_of_2_irr <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_eqI nth_mem<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> roots_of_2_irr<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> pc2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x1 mem <span class="keyword1"><span class="command">unfolding</span></span> roots_of_2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> frp1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> p<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> frp1<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> p this<span class="main">]</span> x1 x2 neq mem <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>      

<span class="keyword1"><span class="command">lift_definition</span></span> roots_of_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> real_alg_3 list"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">roots_of_2</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> roots_of_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> roots_of_3<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> real_of_3 <span class="main">`</span> set <span class="main">(</span>roots_of_3 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map real_of_3 <span class="main">(</span>roots_of_3 <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> real_of_3 <span class="main">`</span> set <span class="main">(</span>roots_of_3 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> roots_of_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map real_of_3 <span class="main">(</span>roots_of_3 <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> roots_of_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> roots_of_real_alg <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> real_alg list"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">roots_of_3</span> <span class="keyword1"><span class="command">.</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> roots_of_real_alg<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> real_of <span class="main">`</span> set <span class="main">(</span>roots_of_real_alg <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
  <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map real_of <span class="main">(</span>roots_of_real_alg <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> real_of <span class="main">`</span> set <span class="main">(</span>roots_of_real_alg <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> roots_of_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map real_of <span class="main">(</span>roots_of_real_alg <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>      
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> roots_of_3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹It follows an implementation for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> roots_of_3<span class="antiquote"><span class="antiquote">}</span></span></span></span>, 
  since the current definition does not provide a code equation.›</span></span>
<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">typedef</span></span> real_alg_2_list <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">xs</span><span class="main">.</span> Ball <span class="main">(</span>set <span class="bound">xs</span><span class="main">)</span> invariant_2<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">Nil</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_real_alg_2_list

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lift_definition</span></span> roots_of_2_list <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> real_alg_2_list"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">roots_of_2</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> roots_of_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lift_definition</span></span> real_alg_2_list_nil <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2_list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">xs</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">xs</span> <span class="keyword1">of</span> Nil <span class="main">⇒</span> True <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">real_alg_2_list_hd_intern</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 list <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">real_alg_2_list_hd_intern</span> <span class="main">(</span>Cons <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">real_alg_2_list_hd_intern</span> Nil <span class="main">=</span> of_rat_2 <span class="main">0</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lift_definition</span></span> real_alg_2_list_hd <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2_list <span class="main">⇒</span> real_alg_3"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">real_alg_2_list_hd_intern</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> of_rat_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lift_definition</span></span> real_alg_2_list_tl <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2_list <span class="main">⇒</span> real_alg_2_list"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">tl</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lift_definition</span></span> real_alg_2_list_length <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2_list <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">length</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> real_alg_2_list_length<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> real_alg_2_list_nil <span class="free">xs</span> <span class="main">⟹</span> real_alg_2_list_length <span class="main">(</span>real_alg_2_list_tl <span class="free">xs</span><span class="main">)</span> <span class="main">&lt;</span> real_alg_2_list_length <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">function</span></span> <span class="entity">real_alg_2_list_convert</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2_list <span class="main">⇒</span> real_alg_3 list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">real_alg_2_list_convert</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> real_alg_2_list_nil <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> real_alg_2_list_hd <span class="free"><span class="bound"><span class="entity">xs</span></span></span> 
    <span class="main">#</span> <span class="free">real_alg_2_list_convert</span> <span class="main">(</span>real_alg_2_list_tl <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure real_alg_2_list_length"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">roots_of_3_impl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> real_alg_3 list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">roots_of_3_impl</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> real_alg_2_list_convert <span class="main">(</span>roots_of_2_list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lift_definition</span></span> real_alg_2_list_convert_id <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2_list <span class="main">⇒</span> real_alg_3 list"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">id</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_all_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> real_alg_2_list_convert<span class="main">:</span> <span class="quoted"><span class="quoted">"real_alg_2_list_convert <span class="free">xs</span> <span class="main">=</span> real_alg_2_list_convert_id <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_measure<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">real_alg_2_list_length</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"real_alg_2_list_nil <span class="skolem">xs</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real_alg_2_list_convert <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">=</span> real_alg_2_list_convert_id <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real_alg_2_list_convert <span class="skolem">xs</span> <span class="main">=</span> real_alg_2_list_hd <span class="skolem">xs</span> <span class="main">#</span> real_alg_2_list_convert <span class="main">(</span>real_alg_2_list_tl <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_alg_2_list_convert <span class="main">(</span>real_alg_2_list_tl <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> real_alg_2_list_convert_id <span class="main">(</span>real_alg_2_list_tl <span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> False<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_alg_2_list_hd <span class="skolem">xs</span> <span class="main">#</span> <span class="main">…</span> <span class="main">=</span> real_alg_2_list_convert_id <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer'</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> roots_of_3_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"roots_of_3 <span class="free">p</span> <span class="main">=</span> roots_of_3_impl <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> roots_of_3_impl_def real_alg_2_list_convert
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_roots_of_int_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> real list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">real_roots_of_int_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> map real_of <span class="main">(</span>roots_of_real_alg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_roots_of_rat_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat poly <span class="main">⇒</span> real list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">real_roots_of_rat_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> map real_of <span class="main">(</span>roots_of_real_alg <span class="main">(</span>snd <span class="main">(</span>rat_to_int_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">rpoly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat poly <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0 <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rpoly</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> poly <span class="main">(</span>map_poly of_rat <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_roots_of_int_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> set <span class="main">(</span>real_roots_of_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
  <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>real_roots_of_int_poly <span class="free">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> real_roots_of_int_poly_def <span class="keyword1"><span class="command">using</span></span> roots_of_real_alg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> real_roots_of_rat_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> set <span class="main">(</span>real_roots_of_rat_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> rpoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
  <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>real_roots_of_rat_poly <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> cq<span class="main">:</span> <span class="quoted"><span class="quoted">"rat_to_int_poly <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> rat_to_int_poly<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span>of_int <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_int_poly <span class="skolem">q</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> rpoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="skolem">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> pq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c of_rat_of_int_poly <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>real_roots_of_rat_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> real_roots_of_rat_poly_def cq snd_conv 
    <span class="keyword1"><span class="command">using</span></span> roots_of_real_alg<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">with</span></span> pq c <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>real_roots_of_rat_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> rpoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">unfolding</span></span> real_roots_of_rat_poly_def cq snd_conv <span class="keyword1"><span class="command">using</span></span> roots_of_real_alg<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> q<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The upcoming functions no longer demand an integer or rational polynomial as input.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">roots_of_real_main</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">roots_of_real_main</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> degree <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">in</span> 
    <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">[</span>roots1 <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">]</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> rroots2 <span class="free"><span class="bound"><span class="entity">p</span></span></span>
    <span class="keyword1">else</span> <span class="main">(</span>real_roots_of_rat_poly <span class="main">(</span>map_poly to_rat <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">roots_of_real_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real list option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">roots_of_real_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">pis</span><span class="main">)</span> <span class="main">=</span> yun_factorization gcd <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">in</span>
    <span class="keyword1">if</span> <span class="main">(</span><span class="bound">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> set <span class="bound">pis</span><span class="main">.</span> degree <span class="bound">p</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>coeffs <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> 
    Some <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span>roots_of_real_main <span class="keyword1">o</span> fst<span class="main">)</span> <span class="bound">pis</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> None"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> roots_of_real_main<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">∨</span> set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℚ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>roots_of_real_main <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> d <span class="main">=</span> roots_of_real_main_def Let_def
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> roots0<span class="main">[</span><span class="operator">OF</span> p True<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> 0 <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">{</span>roots1 <span class="free">p</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> roots1<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> 1 <span class="main">=</span> this
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> set <span class="main">(</span>rroots2 <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> rroots2<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> 2 <span class="main">=</span> this
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly to_rat <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> 0 1 2 <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> set <span class="main">(</span>real_roots_of_rat_poly <span class="var">?q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> deg 0 1 2 <span class="keyword1"><span class="command">have</span></span> rat<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℚ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> map_poly <span class="main">(</span>of_rat <span class="keyword1">o</span> to_rat<span class="main">)</span> <span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_poly_idI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> rat<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real_of_rat_poly <span class="var">?q</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> to_rat<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>real_of_rat_poly <span class="var">?q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> real_roots_of_rat_poly<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> q<span class="main">,</span> <span class="operator">folded</span> id l<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> roots_of_real_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"roots_of_real_poly <span class="free">p</span> <span class="main">=</span> Some <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">pis</span></span> <span class="keyword2"><span class="keyword">where</span></span> yun<span class="main">:</span> <span class="quoted"><span class="quoted">"yun_factorization gcd <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">pis</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> rt<span class="main">[</span><span class="operator">unfolded</span> roots_of_real_poly_def yun split Let_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">pis</span> <span class="main">⟹</span> degree <span class="bound">p</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>coeffs <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span>roots_of_real_main <span class="main">∘</span> fst<span class="main">)</span> <span class="skolem">pis</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> yun <span class="main">=</span> square_free_factorizationD<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> yun_factorization<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span><span class="operator"><span class="operator"><span class="operator">OF</span></span></span> yun<span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> yun<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="skolem">c</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">pis</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">pis</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> fst <span class="main">`</span> set <span class="skolem">pis</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> poly_prod_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">pis</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>roots_of_real_main <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> roots_of_real_main<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> yun<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="main"><span class="main">]</span></span> pis<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> main <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> set <span class="main">(</span>roots_of_real_main <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> set <span class="skolem">pis</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xs o_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> main <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Complex_Roots_Real_Poly">
<div class="head">
<h1>Theory Complex_Roots_Real_Poly</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Complex Roots of Real Valued Polynomials›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We provide conversion functions between polynomials over the real and the complex numbers,
  and prove that the complex roots of real-valued polynomial always come in conjugate pairs.
  We further show that also the order of the complex conjugate roots is identical.

  As a consequence, we derive that every real-valued polynomial can be factored into real factors of 
  degree at most 2, and we prove that every polynomial over the reals with odd degree has a real
  root.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Complex_Roots_Real_Poly
<span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Fundamental_Theorem_Algebra.html">HOL-Computational_Algebra.Fundamental_Theorem_Algebra</a>"</span>
  <a href="../Polynomial_Factorization/Order_Polynomial.html">Polynomial_Factorization.Order_Polynomial</a>
  <a href="../Polynomial_Factorization/Explicit_Roots.html">Polynomial_Factorization.Explicit_Roots</a>
  <a href="../Polynomial_Interpolation/Ring_Hom_Poly.html">Polynomial_Interpolation.Ring_Hom_Poly</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> of_real_poly_hom<span class="main">:</span> map_poly_idom_hom <span class="quoted">complex_of_real</span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_poly_real_coeff<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="free">x</span> <span class="main">∈</span> range <span class="main">(</span>coeff <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> range_coeff<span class="main">]</span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> complex_conjugate_root<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> real<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span>cnj <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cnj <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_poly_real_coeff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> real<span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>coeff <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> cnj_coeff <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="var">?c</span> <span class="main">=</span> poly <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> monom <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_as_sum_of_monoms <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span>degree <span class="free">p</span> <span class="main">.</span> coeff <span class="free">p</span> <span class="bound">x</span> <span class="main">*</span> cnj <span class="main">(</span><span class="free">c</span> <span class="main">^</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_sum poly_monom complex_cnj_power <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span>degree <span class="free">p</span> <span class="main">.</span> cnj <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span> <span class="main">^</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> complex_cnj_mult cnj_coeff <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cnj <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span>degree <span class="free">p</span> <span class="main">.</span> coeff <span class="free">p</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span> <span class="main">^</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cnj_sum <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span>degree <span class="free">p</span> <span class="main">.</span> coeff <span class="free">p</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">c</span> <span class="main">^</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> 
    poly <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span>degree <span class="free">p</span><span class="main">.</span> monom <span class="main">(</span>coeff <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poly_sum poly_monom <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_as_sum_of_monoms rt <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> coeffs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemma</span></span> map_poly_Re_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">real</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly Re <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> poly <span class="free">p</span> <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly <span class="main">(</span>of_real <span class="keyword1">o</span> Re<span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_poly_idI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> coeffs<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> id<span class="main">,</span> <span class="operator">of</span> <span class="quoted">poly</span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_poly_Re_coeffs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"coeffs <span class="main">(</span>map_poly Re <span class="free">p</span><span class="main">)</span> <span class="main">=</span> map Re <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coeffs_map_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">∈</span> range <span class="main">(</span>coeff <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coeffs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> range_coeff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="main">(</span>lead_coeff <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> of_real_Re<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_poly_Re_0<span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly Re <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> map_poly_Re_coeffs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">lemma</span></span> real_poly_add<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">q</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span> <span class="main">=</span> coeffs <span class="free">p</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">qq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qq</span> <span class="main">=</span> coeffs <span class="free">q</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> coeffs_plus_eq_plus_coeffs pp_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> qq_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">pp</span></span> <span class="quoted"><span class="skolem">qq</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> plus_coeffs.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cCons_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_poly_sum<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> set <span class="main">(</span>coeffs <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span>sum <span class="free">f</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">S</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">+</span> sum <span class="free">f</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_poly_add<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ insert<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> real_poly_smult<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span>real_algebra_1<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span>smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeffs_smult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> real_poly_pCons<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span>pCons <span class="free">c</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cCons_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> real_poly_mult<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span>real_algebra_1<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">q</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> mult_pCons_left
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> real_poly_add real_poly_smult real_poly_pCons pCons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> q<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">insert</span> pCons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cCons_def if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> real_poly_power<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span>real_algebra_1<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> real_poly_mult<span class="main">[</span><span class="operator">OF</span> p this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">lemma</span></span> real_poly_prod<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> <span class="main">{</span>idom<span class="main">,</span>real_algebra_1<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> set <span class="main">(</span>coeffs <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span>prod <span class="free">f</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">S</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"prod <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> prod <span class="free">f</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_poly_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ insert<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> real_poly_uminus<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> coeffs_uminus <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> real_poly_minus<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">q</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> diff_conv_add_uminus
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> real_poly_uminus real_poly_add<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> real_field poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">q</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> real_poly_div<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span><span class="free">q</span> <span class="keyword1">div</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> real_poly_mod<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span><span class="free">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> pCons<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="skolem">q</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> res <span class="main">=</span> pCons
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> res pCons<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> pCons <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">div</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> coeff <span class="main">(</span>pCons <span class="skolem">a</span> <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">/</span> coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>pCons <span class="skolem">a</span> <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_poly_real_coeff<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> IH a<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> real_poly_pCons<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_poly_real_coeff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> c <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> False
    <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"pCons <span class="skolem">a</span> <span class="skolem">q</span> <span class="keyword1">div</span> <span class="free">p</span> <span class="main">=</span> pCons <span class="skolem">c</span> <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">div</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"pCons <span class="skolem">a</span> <span class="skolem">q</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> pCons <span class="skolem">a</span> <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span> <span class="main">-</span> smult <span class="skolem">c</span> <span class="free">p</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> c_def div_pCons_eq mod_pCons_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> r s <span class="keyword1"><span class="command">using</span></span> a p c IH <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI real_poly_pCons real_poly_minus real_poly_smult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_poly_factor<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> real_field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
   <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">q</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">div</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"coeffs <span class="free">q</span> <span class="main">=</span> coeffs <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span> <span class="keyword1">div</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_poly_div<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> complex_conjugate_order<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> real<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span>cnj <span class="free">c</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> order <span class="free">c</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>0 <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="skolem">p</span> <span class="main">≤</span> degree <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_degree<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 0<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span> <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> order <span class="main">=</span> order<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cnj <span class="free">c</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> rt1 <span class="main">=</span> this
      <span class="keyword1"><span class="command">from</span></span> complex_conjugate_root<span class="main">[</span><span class="operator">OF</span> Suc<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> True<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> rt2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="var">?c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">≠</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Reals_cnj_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fac1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="main">-</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fac2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="main">-</span><span class="var">?c</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fac</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?fac1</span> <span class="main">*</span> <span class="var">?fac2</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> rt1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fac1</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_eq_0_iff_dvd <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> dvd_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="var">?fac1</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> rt2<span class="main">[</span><span class="operator">unfolded</span> p poly_mult<span class="main">]</span> neq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="var">?c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fac2</span> <span class="keyword1">dvd</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_eq_0_iff_dvd <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> dvd_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="var">?fac2</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="var">?fac</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p q <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fac1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fac2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fac</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fac</span> <span class="main">=</span> <span class="main">[:</span> <span class="var">?c</span> <span class="main">*</span> <span class="free">c</span><span class="main">,</span> <span class="main">-</span> <span class="main">(</span><span class="var">?c</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> cfac<span class="main">:</span> <span class="quoted"><span class="quoted">"coeffs <span class="var">?fac</span> <span class="main">=</span> <span class="main">[</span> <span class="var">?c</span> <span class="main">*</span> <span class="free">c</span><span class="main">,</span> <span class="main">-</span> <span class="main">(</span><span class="var">?c</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span> <span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> cfac<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="var">?fac</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cfac <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Reals_cnj_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> degree <span class="var">?fac</span> <span class="main">+</span> degree <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_mult_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> nz<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="var">?fac</span> <span class="main">=</span> degree <span class="var">?fac1</span> <span class="main">+</span> degree <span class="var">?fac2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_mult_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> nz<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">+</span> degree <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> real_poly_factor<span class="main">[</span><span class="operator">OF</span> Suc<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> p<span class="main"><span class="main">]</span></span> cfac<span class="main">]</span> nz  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="skolem">r</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> deg this <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="var">?c</span> <span class="skolem">r</span> <span class="main">=</span> order <span class="free">c</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">cc</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">cc</span> <span class="skolem">p</span> <span class="main">=</span> order <span class="skolem">cc</span> <span class="var">?fac</span> <span class="main">+</span> order <span class="skolem">cc</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_mult<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">cc</span> <span class="var">?fac</span> <span class="main">=</span> order <span class="skolem">cc</span> <span class="var">?fac1</span> <span class="main">+</span> order <span class="skolem">cc</span> <span class="var">?fac2</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> nz<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">cc</span> <span class="var">?fac1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">cc</span> <span class="main">=</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> order_linear' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">cc</span> <span class="var">?fac2</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">cc</span> <span class="main">=</span> <span class="var">?c</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> order_linear' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">cc</span> <span class="skolem">p</span> <span class="main">=</span> 
            <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">cc</span> <span class="main">=</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">cc</span> <span class="main">=</span> cnj <span class="free">c</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> order <span class="skolem">cc</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> order <span class="main">=</span> this
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> order IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> rt1 <span class="main">=</span> this
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="var">?c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> complex_conjugate_root<span class="main">[</span><span class="operator">OF</span> Suc<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> this<span class="main">]</span> rt1
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">hence</span></span> rt2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="var">?c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> rt1 rt2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> order_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_poly_of_real_Re<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly of_real <span class="main">(</span>map_poly Re <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_poly_idI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_poly_Re_of_real<span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly Re <span class="main">(</span>map_poly of_real <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_poly_idI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_poly_Re_mult<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">q</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly Re <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> map_poly Re <span class="free">p</span> <span class="main">*</span> map_poly Re <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly Re"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly complex_of_real"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">(</span><span class="var">?c</span> <span class="main">(</span><span class="var">?r</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="var">?c</span> <span class="main">(</span><span class="var">?r</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> map_poly_of_real_Re<span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span> map_poly_of_real_Re<span class="main">[</span><span class="operator">OF</span> q<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">(</span><span class="var">?r</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="var">?c</span> <span class="main">(</span><span class="var">?r</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="var">?c</span> <span class="main">(</span><span class="var">?r</span> <span class="free">p</span> <span class="main">*</span> <span class="var">?r</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">…</span> <span class="main">=</span> <span class="var">?r</span> <span class="free">p</span> <span class="main">*</span> <span class="var">?r</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> map_poly_Re_of_real <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> map_poly_Re_power<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly Re <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>map_poly Re <span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly Re"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">(</span><span class="free">p</span><span class="main">^</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">p</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?r</span> <span class="free">p</span> <span class="main">*</span> <span class="var">?r</span> <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_poly_Re_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p real_poly_power<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?r</span> <span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> real_degree_2_factorization_exists_complex<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pR<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">qs</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> prod_list <span class="bound">qs</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="bound">qs</span><span class="main">.</span> set <span class="main">(</span>coeffs <span class="bound">q</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span> <span class="main">∧</span> degree <span class="bound">q</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pR
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> pR<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="skolem">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pR
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">p</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> less<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> degp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> constant <span class="main">(</span>poly <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> constant_degree<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> fundamental_theorem_of_algebra<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">dvd</span> <span class="skolem">p</span> <span class="main">∧</span> set <span class="main">(</span>coeffs <span class="bound">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">≤</span> degree <span class="bound">f</span> <span class="main">∧</span> degree <span class="bound">f</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> dvd <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[:</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">:]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="var">?x</span> <span class="main">-</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> complex_conjugate_root<span class="main">[</span><span class="operator">OF</span> pR x<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="var">?x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Reals_cnj_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> dvd <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span> <span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> xx<span class="main">[</span><span class="operator">unfolded</span> this<span class="main">]</span> diff <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="var">?x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="main">-</span><span class="var">?x</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">[:</span> <span class="main">-</span><span class="var">?x</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="main">*</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">[:</span> <span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span> <span class="main">-</span><span class="var">?x</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p r <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span> <span class="main">-</span><span class="var">?x</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="main">=</span> <span class="main">[:</span> <span class="var">?a</span><span class="main">,</span> <span class="var">?b</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="var">?a</span><span class="main">,</span> <span class="var">?b</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Reals_cnj_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Reals_cnj_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[:</span></span></span><span class="var"><span class="var"><span class="var">?a</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="var"><span class="var"><span class="var">?b</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">:]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fR<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="skolem">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> degf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> degree <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">f</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> dvd <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> degp <span class="keyword1"><span class="command">have</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> f0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> real_poly_factor<span class="main">[</span><span class="operator">OF</span> pR<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> p<span class="main"><span class="main">]</span></span> fR f0<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> rR<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="skolem">r</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> degree <span class="skolem">f</span> <span class="main">+</span> degree <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_mult_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> f0 r0<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> degf less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> degr<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
      <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this refl rR<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> prod_list <span class="skolem">qs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">q</span><span class="main">∈</span>set <span class="skolem">qs</span><span class="main">.</span> set <span class="main">(</span>coeffs <span class="bound">q</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span> <span class="main">∧</span> degree <span class="bound">q</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> prod_list <span class="main">(</span><span class="skolem">f</span> <span class="main">#</span> <span class="skolem">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> IH<span class="main">(</span>2<span class="main">)</span> fR degf <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span> <span class="main"><span class="main"><span class="main">#</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">qs</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_degree_2_factorization_exists<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">qs</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> prod_list <span class="bound">qs</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="bound">qs</span><span class="main">.</span> degree <span class="bound">q</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly complex_of_real"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly Re"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?cp</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="var">?p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> real_degree_2_factorization_exists_complex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> prod_list <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    qs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="skolem">qs</span> <span class="main">⟹</span> set <span class="main">(</span>coeffs <span class="bound">q</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span> <span class="main">∧</span> degree <span class="bound">q</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="var">?rp</span> <span class="main">(</span>prod_list <span class="skolem">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> p<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?rp</span></span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_poly_idI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> qs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">rs</span><span class="main">.</span> prod_list <span class="skolem">qs</span> <span class="main">=</span> <span class="var">?cp</span> <span class="main">(</span>prod_list <span class="bound">rs</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="bound">rs</span><span class="main">.</span> degree <span class="bound">r</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">qs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">Nil</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">q</span> <span class="skolem">qs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="keyword2"><span class="keyword">where</span></span> qs<span class="main">:</span> <span class="quoted"><span class="quoted">"prod_list <span class="skolem">qs</span> <span class="main">=</span> <span class="var">?cp</span> <span class="main">(</span>prod_list <span class="skolem">rs</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">q</span><span class="main">∈</span>set <span class="skolem">rs</span> <span class="main">⟹</span> degree <span class="bound">q</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="skolem">q</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="var">?rp</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="var">?cp</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_poly_idI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> q<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> dr<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dq <span class="keyword1"><span class="command">unfolding</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_map_poly<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">r</span></span></span> <span class="main"><span class="main"><span class="main">#</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">rs</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> prod_list.Cons qs q<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> dr rs<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="keyword2"><span class="keyword">where</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"prod_list <span class="skolem">qs</span> <span class="main">=</span> <span class="var">?cp</span> <span class="main">(</span>prod_list <span class="skolem">rs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="skolem">rs</span><span class="main">.</span> degree <span class="bound">r</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p id
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ deg<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_poly_idI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
    
  
<span class="keyword1"><span class="command">lemma</span></span> odd_degree_imp_real_root<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> real_degree_2_factorization_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qs</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> prod_list <span class="skolem">qs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="skolem">qs</span> <span class="main">⟹</span> degree <span class="bound">q</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms qs <span class="keyword1"><span class="command">unfolding</span></span> id
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">qs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">q</span> <span class="skolem">qs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> dq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> roots1<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> dq <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> degree <span class="skolem">q</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> prod_list <span class="skolem">qs</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"prod_list <span class="skolem">qs</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> degree_mult_eq<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>prod_list <span class="main">(</span><span class="skolem">q</span> <span class="main">#</span> <span class="skolem">qs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> degree <span class="skolem">q</span> <span class="main">+</span> degree <span class="main">(</span>prod_list <span class="skolem">qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> this<span class="main">]</span> deg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>degree <span class="main">(</span>prod_list <span class="skolem">qs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this Cons<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>prod_list <span class="skolem">qs</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Compare_Complex">
<div class="head">
<h1>Theory Compare_Complex</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Compare Instance for Complex Numbers›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define some code equations for complex numbers, provide a comparator for complex
  numbers, and register complex numbers for the container framework.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Compare_Complex
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../../HOL/HOL/Complex.html">HOL.Complex</a>
  <a href="../Polynomial_Interpolation/Missing_Unsorted.html">Polynomial_Interpolation.Missing_Unsorted</a>
  <a href="../Deriving/Compare_Real.html">Deriving.Compare_Real</a>
  <a href="../Containers/Set_Impl.html">Containers.Set_Impl</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">drop</span><span class="main"><span class="main">:</span></span> <span class="quoted">Gcd_fin</span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">drop</span><span class="main"><span class="main">:</span></span> <span class="quoted">Lcm_fin</span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gcds</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>semiring_gcd list <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">code_abbrev</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gcds</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> gcd_list <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"gcds <span class="free">xs</span> <span class="main">=</span> fold gcd <span class="free">xs</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gcd_fin.set_eq_fold<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lcms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>semiring_gcd list <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">code_abbrev</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lcms</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> lcm_list <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"lcms <span class="free">xs</span> <span class="main">=</span> fold lcm <span class="free">xs</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lcm_fin.set_eq_fold<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> in_reals_code <span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">ℝ</span> <span class="main">⟷</span> Im <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> complex_is_Real_iff<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_norm_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_norm_1</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_norm_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_norm_1 <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>norm <span class="free">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_norm_1_def norm_complex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_norm_le_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_norm_le_1</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_norm_le_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_norm_le_1 <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>norm <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_norm_le_1_def norm_complex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instantiation</span></span> complex <span class="main">::</span> <span class="quoted">finite_UNIV</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"finite_UNIV <span class="main">=</span> <span class="keyword1">Phantom</span><span class="main">(</span>complex<span class="main">)</span> False"</span></span>
<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> finite_UNIV_complex_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_UNIV_char_0<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> complex <span class="main">::</span> <span class="quoted">compare</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">compare_complex</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex <span class="main">⇒</span> order"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">compare_complex</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> compare <span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> Im <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span> Im <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">unfold</span> compare_complex_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"compare <span class="main">::</span> <span class="main">(</span>real <span class="main">×</span> real<span class="main">)</span> comparator"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> comparator <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> comparator_compare<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invert_order <span class="main">(</span><span class="var">?c</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">,</span> Im <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Re <span class="skolem">y</span><span class="main">,</span> Im <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?c</span> <span class="main">(</span>Re <span class="skolem">y</span><span class="main">,</span> Im <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">,</span> Im <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">,</span> Im <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Re <span class="skolem">y</span><span class="main">,</span> Im <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> Lt"</span></span>
      <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">(</span>Re <span class="skolem">y</span><span class="main">,</span> Im <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>Re <span class="skolem">z</span><span class="main">,</span> Im <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> Lt"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">,</span> Im <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Re <span class="skolem">z</span><span class="main">,</span> Im <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> Lt"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> trans<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">,</span> Im <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Re <span class="skolem">y</span><span class="main">,</span> Im <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> Eq"</span></span>
    <span class="keyword1"><span class="command">from</span></span> weak_eq<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> complex_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>eq<span class="main">)</span> ceq <span class="quoted">complex</span> <span class="quoted">real</span>
<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>compare<span class="main">)</span> ccompare <span class="quoted">complex</span>
<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>compare<span class="main">)</span> ccompare <span class="quoted">real</span>
<span class="keyword1"><span class="command">derive</span></span> <span class="main">(</span>dlist<span class="main">)</span> set_impl <span class="quoted">complex</span> <span class="quoted">real</span>
 
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Interval_Arithmetic">
<div class="head">
<h1>Theory Interval_Arithmetic</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      Sebastiaan Joosten 
                 René Thiemann
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Interval Arithmetic›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We provide basic interval arithmetic operations for real and complex intervals.
  As application we prove that complex polynomial evaluation is continuous w.r.t.
  interval arithmetic. To be more precise, if an interval sequence converges to some 
  element $x$, then the interval polynomial evaluation of $f$ tends to $f(x)$.›</span></span>
  
<span class="keyword1"><span class="command">theory</span></span> Interval_Arithmetic
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Algebraic_Numbers_Prelim.html">Algebraic_Numbers_Prelim</a> <span class="comment1">(* for ipoly *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Intervals›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> interval <span class="main">=</span> Interval <span class="main">(</span><span class="free"><span class="entity">lower</span></span><span class="main">:</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">upper</span></span><span class="main">:</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">)</span>

<span class="keyword1"><span class="command">hide_const</span></span><span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> lower upper

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">to_interval</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">to_interval</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> Interval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">of_int_interval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> ring_1 interval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">of_int_interval</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> to_interval <span class="main">(</span>of_int <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span> 


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Syntactic Class Instantiations›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> interval <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"zero"</span></span><span class="main">)</span> <span class="quoted">zero</span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">zero_interval</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≡</span> Interval <span class="main">0</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> interval <span class="main">::</span> <span class="main">(</span><span class="quoted">one</span><span class="main">)</span> <span class="quoted">one</span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> Interval <span class="main">1</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> interval <span class="main">::</span> <span class="main">(</span><span class="quoted">plus</span><span class="main">)</span> <span class="quoted">plus</span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">plus_interval</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Interval <span class="free"><span class="bound"><span class="entity">lx</span></span></span> <span class="free"><span class="bound"><span class="entity">ux</span></span></span> <span class="main">+</span> Interval <span class="free"><span class="bound"><span class="entity">ly</span></span></span> <span class="free"><span class="bound"><span class="entity">uy</span></span></span> <span class="main">=</span> Interval <span class="main">(</span><span class="free"><span class="bound"><span class="entity">lx</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">ly</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ux</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">uy</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> interval <span class="main">::</span> <span class="main">(</span><span class="quoted">uminus</span><span class="main">)</span> <span class="quoted">uminus</span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">uminus_interval</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> Interval <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> Interval <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> interval <span class="main">::</span> <span class="main">(</span><span class="quoted">minus</span><span class="main">)</span> <span class="quoted">minus</span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">minus_interval</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Interval <span class="free"><span class="bound"><span class="entity">lx</span></span></span> <span class="free"><span class="bound"><span class="entity">ux</span></span></span> <span class="main">-</span> Interval <span class="free"><span class="bound"><span class="entity">ly</span></span></span> <span class="free"><span class="bound"><span class="entity">uy</span></span></span> <span class="main">=</span> Interval <span class="main">(</span><span class="free"><span class="bound"><span class="entity">lx</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">uy</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ux</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">ly</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> interval <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>ord<span class="main">,</span>times<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">times</span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">times_interval</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"Interval <span class="free"><span class="bound"><span class="entity">lx</span></span></span> <span class="free"><span class="bound"><span class="entity">ux</span></span></span> <span class="main">*</span> Interval <span class="free"><span class="bound"><span class="entity">ly</span></span></span> <span class="free"><span class="bound"><span class="entity">uy</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="bound">x1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">lx</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">ly</span></span></span><span class="main">;</span> <span class="bound">x2</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">lx</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">uy</span></span></span><span class="main">;</span> <span class="bound">x3</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ux</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">ly</span></span></span><span class="main">;</span> <span class="bound">x4</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ux</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">uy</span></span></span>
      <span class="keyword1">in</span> Interval <span class="main">(</span>min <span class="bound">x1</span> <span class="main">(</span>min <span class="bound">x2</span> <span class="main">(</span>min <span class="bound">x3</span> <span class="bound">x4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>max <span class="bound">x1</span> <span class="main">(</span>max <span class="bound">x2</span> <span class="main">(</span>max <span class="bound">x3</span> <span class="bound">x4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> interval <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>ord<span class="main">,</span>times<span class="main">,</span>inverse<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted"><span class="quoted">"inverse"</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">inverse_interval</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>Interval <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">=</span> Interval <span class="main">(</span>inverse <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">(</span>inverse <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">divide_interval</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> interval <span class="main">⇒</span> <span class="main">_</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">divide_interval</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>  <span class="main">*</span> <span class="main">(</span>inverse <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Class Instantiations›</span></span>

<span class="keyword1"><span class="command">instance</span></span> interval <span class="main">::</span> <span class="main">(</span><span class="quoted">semigroup_add</span><span class="main">)</span> <span class="quoted">semigroup_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> interval"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> interval <span class="main">::</span> <span class="main">(</span><span class="quoted">monoid_add</span><span class="main">)</span> <span class="quoted">monoid_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> interval"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_interval_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_interval_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> interval <span class="main">::</span> <span class="main">(</span><span class="quoted">ab_semigroup_add</span><span class="main">)</span> <span class="quoted">ab_semigroup_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> interval"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> interval <span class="main">::</span> <span class="main">(</span><span class="quoted">comm_monoid_add</span><span class="main">)</span> <span class="quoted">comm_monoid_add</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Intervals do not form an additive group, but satisfy some properties.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> interval_uminus_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">0</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> group_add interval<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_interval_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> interval_diff_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> cancel_comm_monoid_add interval"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_interval_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Without type invariant, intervals do not form a multiplicative monoid,
 but satisfy some properties.›</span></span>

<span class="keyword1"><span class="command">instance</span></span> interval <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>linorder<span class="main">,</span>mult_zero<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted">mult_zero</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> interval"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_interval_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Membership›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">in_interval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> order <span class="main">⇒</span> <span class="tfree">'a</span> interval <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1"><span class="free">∈<span class="hidden">⇩</span><sub>i</sub></span></span> Interval <span class="free"><span class="bound"><span class="entity">lx</span></span></span> <span class="free"><span class="bound"><span class="entity">ux</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">lx</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">ux</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> in_interval_to_interval<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> to_interval <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> to_interval_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> plus_in_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ordered_comm_monoid_add"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">Y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">X</span> <span class="main">+</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">X</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">Y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>add_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> uminus_in_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ordered_ab_group_add"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">X</span> <span class="main">⟹</span> <span class="main">-</span><span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">-</span><span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">X</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> minus_in_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> ordered_ab_group_add"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">Y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">X</span> <span class="main">-</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">X</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">Y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>diff_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> times_in_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> linordered_ring"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">X</span> <span class="main">*</span> <span class="free">Y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X1</span></span> <span class="skolem"><span class="skolem">X2</span></span> <span class="keyword2"><span class="keyword">where</span></span> X<span class="main">:</span><span class="quoted"><span class="quoted">"Interval <span class="skolem">X1</span> <span class="skolem">X2</span> <span class="main">=</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">X</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y1</span></span> <span class="skolem"><span class="skolem">Y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> Y<span class="main">:</span><span class="quoted"><span class="quoted">"Interval <span class="skolem">Y1</span> <span class="skolem">Y2</span> <span class="main">=</span> <span class="free">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">Y</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms X Y <span class="keyword1"><span class="command">have</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X1</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="skolem">X2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y1</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="skolem">Y2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">∨</span> <span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y2</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">∨</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">∨</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y2</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y1</span> <span class="main">≥</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">∨</span> <span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y2</span> <span class="main">≥</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">∨</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y1</span> <span class="main">≥</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">∨</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y2</span> <span class="main">≥</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span><span class="tfree">'a</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> x0<span class="main">:</span> less
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> y0<span class="main">:</span> True
      <span class="keyword1"><span class="command">from</span></span> y0 x0 assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">X1</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono_neg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x0 y0 assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X1</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono_neg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y1</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">X2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y2</span> <span class="main">≤</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_left_mono_neg<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms y0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_right_mono_neg<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y2</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y1</span> <span class="main">≤</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms y0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_right_mono_neg<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> y0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> x0 y0 assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y2</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="skolem">Y2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> y0 x0 assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono_neg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y2</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">X2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> X2<span class="main">:</span> True
        <span class="keyword1"><span class="command">from</span></span> assms y0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms X2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_left_mono_neg<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y1</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> X2<span class="main">:</span> False
        <span class="keyword1"><span class="command">from</span></span> assms y0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms X2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y2</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> equal
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>mult_sign_intros<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> x0<span class="main">:</span> greater
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> y0<span class="main">:</span> True
      <span class="keyword1"><span class="command">from</span></span> x0 y0 assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y1</span> <span class="main">≤</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> y0 x0 assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X2</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono_neg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Y2<span class="main">:</span> True
        <span class="keyword1"><span class="command">from</span></span> x0 assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="skolem">Y2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms Y2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_right_mono_neg<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y2</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Y2<span class="main">:</span> False
        <span class="keyword1"><span class="command">from</span></span> x0 assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="skolem">Y2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms Y2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_right_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y2</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> y0<span class="main">:</span> False
      <span class="keyword1"><span class="command">from</span></span> x0 y0 assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> y0 x0 assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y2</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">X1</span> <span class="main">≤</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y2</span> <span class="main">≤</span> <span class="skolem">X1</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_left_mono_neg<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms y0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_right_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y2</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y1</span> <span class="main">≤</span> <span class="skolem">X1</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms y0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_right_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span><span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> min<span class="main">:</span><span class="quoted"><span class="quoted">"min <span class="main">(</span><span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y1</span><span class="main">)</span> <span class="main">(</span>min <span class="main">(</span><span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y2</span><span class="main">)</span> <span class="main">(</span>min <span class="main">(</span><span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> max<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> max <span class="main">(</span><span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y1</span><span class="main">)</span> <span class="main">(</span>max <span class="main">(</span><span class="skolem">X1</span> <span class="main">*</span> <span class="skolem">Y2</span><span class="main">)</span> <span class="main">(</span>max <span class="main">(</span><span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">X2</span> <span class="main">*</span> <span class="skolem">Y2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>min_le_iff_disj le_max_iff_disj<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> min max X Y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Convergence›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">interval_tendsto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> topological_space interval<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="keyword1"><span class="free">⇢<span class="hidden">⇩</span><sub>i</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>interval.upper <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">⇢</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>interval.lower <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">⇢</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> interval_tendstoI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>interval.upper <span class="main">∘</span> <span class="free">X</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>interval.lower <span class="main">∘</span> <span class="free">X</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>interval_tendsto_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> const_interval_tendsto<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> to_interval <span class="free">a</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def to_interval_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> interval_tendsto_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def zero_interval_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> plus_interval_tendsto<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> topological_monoid_add"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">X</span> <span class="bound">i</span> <span class="main">+</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="skolem">i</span> <span class="main">+</span> <span class="free">Y</span> <span class="skolem">i</span> <span class="main">=</span> Interval <span class="main">(</span>interval.lower <span class="main">(</span><span class="free">X</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> interval.lower <span class="main">(</span><span class="free">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>interval.upper <span class="main">(</span><span class="free">X</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> interval.upper <span class="main">(</span><span class="free">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> * interval_tendsto_def o_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> uminus_interval_tendsto<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> topological_group_add"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">-</span> <span class="free">X</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">-</span><span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">X</span> <span class="skolem">i</span> <span class="main">=</span> Interval <span class="main">(</span><span class="main">-</span> interval.upper <span class="main">(</span><span class="free">X</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> interval.lower <span class="main">(</span><span class="free">X</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> o_def * interval_tendsto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> minus_interval_tendsto<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> topological_group_add"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">X</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">Y</span> <span class="skolem">i</span> <span class="main">=</span> Interval <span class="main">(</span>interval.lower <span class="main">(</span><span class="free">X</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> interval.upper <span class="main">(</span><span class="free">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>interval.upper <span class="main">(</span><span class="free">X</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> interval.lower <span class="main">(</span><span class="free">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> o_def * interval_tendsto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> times_interval_tendsto<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>linorder_topology<span class="main">,</span> real_normed_algebra<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">X</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>interval.lower <span class="main">(</span><span class="free">X</span> <span class="skolem">i</span> <span class="main">*</span> <span class="free">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">let</span> <span class="bound">lx</span> <span class="main">=</span> <span class="main">(</span>interval.lower <span class="main">(</span><span class="free">X</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="bound">ux</span> <span class="main">=</span> <span class="main">(</span>interval.upper <span class="main">(</span><span class="free">X</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
        <span class="bound">ly</span> <span class="main">=</span> <span class="main">(</span>interval.lower <span class="main">(</span><span class="free">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="bound">uy</span> <span class="main">=</span> <span class="main">(</span>interval.upper <span class="main">(</span><span class="free">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
        <span class="bound">x1</span> <span class="main">=</span> <span class="bound">lx</span> <span class="main">*</span> <span class="bound">ly</span><span class="main">;</span> <span class="bound">x2</span> <span class="main">=</span> <span class="bound">lx</span> <span class="main">*</span> <span class="bound">uy</span><span class="main">;</span> <span class="bound">x3</span> <span class="main">=</span> <span class="bound">ux</span> <span class="main">*</span> <span class="bound">ly</span><span class="main">;</span> <span class="bound">x4</span> <span class="main">=</span> <span class="bound">ux</span> <span class="main">*</span> <span class="bound">uy</span> <span class="keyword1">in</span> 
      <span class="main">(</span>min <span class="bound">x1</span> <span class="main">(</span>min <span class="bound">x2</span> <span class="main">(</span>min <span class="bound">x3</span> <span class="bound">x4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>interval.upper <span class="main">(</span><span class="free">X</span> <span class="skolem">i</span> <span class="main">*</span> <span class="free">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">let</span> <span class="bound">lx</span> <span class="main">=</span> <span class="main">(</span>interval.lower <span class="main">(</span><span class="free">X</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="bound">ux</span> <span class="main">=</span> <span class="main">(</span>interval.upper <span class="main">(</span><span class="free">X</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
        <span class="bound">ly</span> <span class="main">=</span> <span class="main">(</span>interval.lower <span class="main">(</span><span class="free">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="bound">uy</span> <span class="main">=</span> <span class="main">(</span>interval.upper <span class="main">(</span><span class="free">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
      <span class="bound">x1</span> <span class="main">=</span> <span class="bound">lx</span> <span class="main">*</span> <span class="bound">ly</span><span class="main">;</span> <span class="bound">x2</span> <span class="main">=</span> <span class="bound">lx</span> <span class="main">*</span> <span class="bound">uy</span><span class="main">;</span> <span class="bound">x3</span> <span class="main">=</span> <span class="bound">ux</span> <span class="main">*</span> <span class="bound">ly</span><span class="main">;</span> <span class="bound">x4</span> <span class="main">=</span> <span class="bound">ux</span> <span class="main">*</span> <span class="bound">uy</span> <span class="keyword1">in</span> 
      <span class="main">(</span>max <span class="bound">x1</span> <span class="main">(</span>max <span class="bound">x2</span> <span class="main">(</span>max <span class="bound">x3</span> <span class="bound">x4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>interval.lower <span class="main">(</span><span class="free">X</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> min <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>min <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>min <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> interval_tendsto_def * Let_def o_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_min <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>interval.upper <span class="main">(</span><span class="free">X</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> max <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>max <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>max <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> interval_tendsto_def * Let_def o_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_max <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> interval_tendsto_def o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> interval_tendsto_neq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="free">b</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">f</span> <span class="bound">n</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> interval_tendsto_def<span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> cvg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>interval.lower <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>interval.upper <span class="keyword1">o</span> <span class="free">f</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> LIMSEQ_D<span class="main">[</span><span class="operator">OF</span> cvg<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> d<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">n1</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="main">(</span>interval.lower <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="var">?d</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> LIMSEQ_D<span class="main">[</span><span class="operator">OF</span> cvg<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> d<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    n2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">n2</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="main">(</span>interval.upper <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="var">?d</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> max <span class="skolem">n1</span> <span class="skolem">n2</span>"</span></span>  
  <span class="keyword1"><span class="command">from</span></span> n1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> n2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bnd<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">(</span>interval.lower <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="var">?d</span>"</span></span> 
    <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">(</span>interval.upper <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="var">?d</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> bnd<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span><span class="operator">argo</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Complex Intervals›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> complex_interval <span class="main">=</span> Complex_Interval <span class="main">(</span><span class="free"><span class="entity">Re_interval</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"real interval"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">Im_interval</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"real interval"</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">in_complex_interval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex_interval <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">∈<span class="hidden">⇩</span><sub>c</sub></span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1"><span class="free">∈<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> Complex_Interval <span class="bound">r</span> <span class="bound">i</span> <span class="main">⇒</span> Re <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="bound">r</span> <span class="main">∧</span> Im <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
      
<span class="keyword1"><span class="command">instantiation</span></span> complex_interval <span class="main">::</span> <span class="quoted">comm_monoid_add</span> <span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≡</span> Complex_Interval <span class="main">0</span> <span class="main">0</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">plus_complex_interval</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_interval <span class="main">⇒</span> complex_interval <span class="main">⇒</span> complex_interval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"Complex_Interval <span class="free"><span class="bound"><span class="entity">rx</span></span></span> <span class="free"><span class="bound"><span class="entity">ix</span></span></span> <span class="main">+</span> Complex_Interval <span class="free"><span class="bound"><span class="entity">ry</span></span></span> <span class="free"><span class="bound"><span class="entity">iy</span></span></span> <span class="main">=</span> Complex_Interval <span class="main">(</span><span class="free"><span class="bound"><span class="entity">rx</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">ry</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ix</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">iy</span></span></span><span class="main">)</span>"</span></span> 

  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted">complex_interval</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> zero_complex_interval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> plus_complex_interval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">Y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">X</span> <span class="main">+</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> in_complex_interval_def <span class="keyword1"><span class="command">using</span></span> plus_in_interval <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">X</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">Y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">of_int_complex_interval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> complex_interval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">of_int_complex_interval</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Complex_Interval <span class="main">(</span>of_int_interval <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">0</span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> of_int_complex_interval_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"of_int_complex_interval <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_int_complex_interval_def zero_complex_interval_def to_interval_def zero_interval_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> of_int_complex_interval<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="free">i</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>c</sub></span> of_int_complex_interval <span class="free">i</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> in_complex_interval_def of_int_complex_interval_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_complex_interval_def zero_interval_def<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> complex_interval <span class="main">::</span> <span class="quoted">mult_zero</span> <span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">times_complex_interval</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"Complex_Interval <span class="free"><span class="bound"><span class="entity">rx</span></span></span> <span class="free"><span class="bound"><span class="entity">ix</span></span></span> <span class="main">*</span> Complex_Interval <span class="free"><span class="bound"><span class="entity">ry</span></span></span> <span class="free"><span class="bound"><span class="entity">iy</span></span></span> <span class="main">=</span>
     Complex_Interval <span class="main">(</span><span class="free"><span class="bound"><span class="entity">rx</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">ry</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">ix</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">iy</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">rx</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">iy</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">ix</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">ry</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">complex_interval</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_complex_interval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> complex_interval <span class="main">::</span> <span class="quoted">minus</span> <span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">minus_complex_interval</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"Complex_Interval <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">-</span> Complex_Interval <span class="free"><span class="bound"><span class="entity">R'</span></span></span> <span class="free"><span class="bound"><span class="entity">I'</span></span></span> <span class="main">=</span> Complex_Interval <span class="main">(</span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">R'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">I'</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">instance</span></span><span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> times_complex_interval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">Y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">X</span> <span class="main">*</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> in_complex_interval_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">X</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">Y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> times_in_interval minus_in_interval plus_in_interval<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ipoly_complex_interval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> complex_interval <span class="main">⇒</span> complex_interval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ipoly_complex_interval</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> fold_coeffs <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> of_int_complex_interval <span class="bound">a</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">0</span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> ipoly_complex_interval_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ipoly_complex_interval <span class="main">0</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ipoly_complex_interval_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_complex_interval_pCons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ipoly_complex_interval <span class="main">(</span>pCons <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> of_int_complex_interval <span class="free">a</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span>ipoly_complex_interval <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ipoly_complex_interval_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_complex_interval<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">X</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>c</sub></span> ipoly_complex_interval <span class="free">p</span> <span class="free">X</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> coeffs <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"in_complex_interval <span class="main">0</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"in_complex_interval <span class="var">?Z</span> <span class="var">?z</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> in_complex_interval_def zero_complex_interval_def zero_interval_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="var">?Z</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="var">?z</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"in_complex_interval <span class="skolem">Z</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Z_def z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> x <span class="main">=</span> times_complex_interval<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> poly_map_poly_code ipoly_complex_interval_def fold_coeffs_def 
      xs_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> Z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> z_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> 0
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">Z</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> plus_complex_interval of_int_complex_interval x<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">complex_interval_tendsto</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1"><span class="free">⇢<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>Re_interval <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> Re <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>Im_interval <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> Im <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> complex_interval_tendstoI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Re_interval <span class="main">∘</span> <span class="free">C</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> Re <span class="free">c</span> <span class="main">⟹</span> <span class="main">(</span>Im_interval <span class="main">∘</span> <span class="free">C</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> Im <span class="free">c</span> <span class="main">⟹</span> <span class="free">C</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_interval_tendsto_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> of_int_complex_interval_tendsto<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> of_int_complex_interval <span class="free">n</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span> of_int <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def of_int_complex_interval_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>const_interval_tendsto interval_tendsto_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Im_interval_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"Im_interval <span class="main">(</span><span class="free">A</span> <span class="main">+</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> Im_interval <span class="free">A</span> <span class="main">+</span> Im_interval <span class="free">B</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">B</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Re_interval_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"Re_interval <span class="main">(</span><span class="free">A</span> <span class="main">+</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> Re_interval <span class="free">A</span> <span class="main">+</span> Re_interval <span class="free">B</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">B</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Im_interval_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"Im_interval <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> Im_interval <span class="free">A</span> <span class="main">-</span> Im_interval <span class="free">B</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">B</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Re_interval_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"Re_interval <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> Re_interval <span class="free">A</span> <span class="main">-</span> Re_interval <span class="free">B</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">B</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> Re_interval_times<span class="main">:</span> <span class="quoted"><span class="quoted">"Re_interval <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> Re_interval <span class="free">A</span> <span class="main">*</span> Re_interval <span class="free">B</span> <span class="main">-</span> Im_interval <span class="free">A</span> <span class="main">*</span> Im_interval <span class="free">B</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">B</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Im_interval_times<span class="main">:</span> <span class="quoted"><span class="quoted">"Im_interval <span class="main">(</span><span class="free">A</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> Re_interval <span class="free">A</span> <span class="main">*</span> Im_interval <span class="free">B</span> <span class="main">+</span> Im_interval <span class="free">A</span> <span class="main">*</span> Re_interval <span class="free">B</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">B</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> plus_complex_interval_tendsto<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">B</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span> <span class="main">+</span> <span class="free">B</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> complex_interval_tendsto_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> plus_interval_tendsto <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def Re_interval_plus Im_interval_plus<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> minus_complex_interval_tendsto<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">B</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">B</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">a</span> <span class="main">-</span> <span class="free">b</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> complex_interval_tendsto_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> minus_interval_tendsto <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def Re_interval_minus Im_interval_minus<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> times_complex_interval_tendsto<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">B</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">B</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> complex_interval_tendsto_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> minus_interval_tendsto times_interval_tendsto plus_interval_tendsto 
    <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def Re_interval_times Im_interval_times<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ipoly_complex_interval_tendsto<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> ipoly_complex_interval <span class="free">p</span> <span class="main">(</span><span class="free">C</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span> ipoly <span class="free">p</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def zero_complex_interval_def zero_interval_def complex_interval_tendsto_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ipoly_complex_interval_pCons of_int_hom.map_poly_pCons_hom poly_pCons<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> plus_complex_interval_tendsto times_complex_interval_tendsto assms pCons of_int_complex_interval_tendsto<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> complex_interval_tendsto_neq<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">a</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="free">b</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">f</span> <span class="bound">n</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> complex_interval_tendsto_def o_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> cvg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Re_interval <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> Re <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Im_interval <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> Im <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span> <span class="main">≠</span> Re <span class="free">b</span> <span class="main">∨</span> Im <span class="free">a</span> <span class="main">≠</span> Im <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex.expand <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">a</span> <span class="main">≠</span> Re <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> interval_tendsto_neq<span class="main">[</span><span class="operator">OF</span> cvg<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> in_complex_interval_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> complex_interval.case_eq_if<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">a</span> <span class="main">≠</span> Im <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> interval_tendsto_neq<span class="main">[</span><span class="operator">OF</span> cvg<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> in_complex_interval_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> complex_interval.case_eq_if<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Complex_Algebraic_Numbers">
<div class="head">
<h1>Theory Complex_Algebraic_Numbers</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      Sebastiaan Joosten 
                 René Thiemann
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Complex Algebraic Numbers›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Since currently there is no immediate analog of Sturm's theorem for the complex numbers,
  we implement complex algebraic numbers via their real and imaginary part.
  
  The major algorithm in this theory is a factorization algorithm which factors a rational
  polynomial over the complex numbers. 

  This algorithm is then combined with explicit root algorithms to try to factor arbitrary  
  complex polymials.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Complex_Algebraic_Numbers
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Real_Roots.html">Real_Roots</a>
  <a href="Complex_Roots_Real_Poly.html">Complex_Roots_Real_Poly</a>
  <a href="Compare_Complex.html">Compare_Complex</a>
  <a href="../Jordan_Normal_Form/Char_Poly.html">Jordan_Normal_Form.Char_Poly</a>  
  <a href="../Berlekamp_Zassenhaus/Code_Abort_Gcd.html">Berlekamp_Zassenhaus.Code_Abort_Gcd</a>
  <a href="Interval_Arithmetic.html">Interval_Arithmetic</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Complex Roots›</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> UnivPoly.coeff
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Module.smult
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> Coset.order

  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">complex_of_int_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> complex poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">complex_of_int_poly</span> <span class="main">≡</span> map_poly of_int"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">complex_of_rat_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat poly <span class="main">⇒</span> complex poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">complex_of_rat_poly</span> <span class="main">≡</span> map_poly of_rat"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_complex_to_real<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="main">(</span>complex_of_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
  <span class="main">=</span> <span class="main">(</span>poly <span class="main">(</span>real_of_int_poly <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"of_int <span class="main">=</span> complex_of_real <span class="keyword1">o</span> real_of_int"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> cr<span class="main">:</span> semiring_hom <span class="quoted">complex_of_real</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> represents_cnj<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="main">(</span>cnj <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>complex_of_int_poly <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>complex_of_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cnj <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> complex_conjugate_root<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ rt<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> coeffs_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_2i</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_2i</span> <span class="main">≡</span> <span class="main">[:</span> <span class="numeral">4</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> represents_2i<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_2i <span class="keyword1">represents</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> represents_def poly_2i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">root_poly_Re</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">root_poly_Re</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> cf_pos_poly <span class="main">(</span>poly_mult_rat <span class="main">(</span>inverse <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>poly_add <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> root_poly_Re_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"root_poly_Re <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">fs</span> <span class="main">=</span> coeffs <span class="main">(</span>poly_add <span class="free">p</span> <span class="free">p</span><span class="main">)</span><span class="main">;</span> <span class="bound">k</span> <span class="main">=</span> length <span class="bound">fs</span> 
     <span class="keyword1">in</span> cf_pos_poly <span class="main">(</span>poly_of_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">fi</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="bound">fi</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>zip <span class="bound">fs</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">k</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"quotient_of <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_poly_Re_def poly_mult_rat_def poly_mult_rat_main_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">root_poly_Im</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> int poly list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">root_poly_Im</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">fs</span> <span class="main">=</span> factors_of_int_poly 
    <span class="main">(</span>poly_add <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>poly_uminus <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">in</span> remdups <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">f</span> <span class="main">∈</span> set <span class="bound">fs</span><span class="main">.</span> coeff <span class="bound">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">[</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> 
      <span class="main">[</span> cf_pos_poly <span class="main">(</span>poly_div <span class="bound">f</span> poly_2i<span class="main">)</span> <span class="main">.</span> f <span class="main">←</span> <span class="bound">fs</span><span class="main">,</span> coeff <span class="bound">f</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span><span class="main">]</span><span class="main">)</span>"</span></span>
                          
<span class="keyword1"><span class="command">lemma</span></span> represents_root_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>root_poly_Re <span class="free">p</span><span class="main">)</span> <span class="keyword1">represents</span> <span class="main">(</span>Re <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span>root_poly_Im <span class="free">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span> <span class="keyword1">represents</span> <span class="main">(</span>Im <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Rep</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"root_poly_Re <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Imp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"root_poly_Im <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> ap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> represents_cnj<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> apc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">represents</span> <span class="main">(</span>cnj <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> represents_mult_rat<span class="main">[</span><span class="operator">OF</span> _ represents_add<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ap apc<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse <span class="numeral">2</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Rep</span> <span class="keyword1">represents</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> cnj <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_poly_Re_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> cnj <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_real <span class="main">(</span>Re <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_add_cnj<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> Rep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Rep</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="var">?Rep</span> <span class="main">(</span>complex_of_real <span class="main">(</span>Re <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> rt<span class="main">[</span><span class="operator">unfolded</span> poly_complex_to_real<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="var">?Rep</span> <span class="main">(</span>Re <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> Rep <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Rep</span> <span class="keyword1">represents</span> <span class="main">(</span>Re <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poly_add <span class="free">p</span> <span class="main">(</span>poly_uminus <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> represents_add<span class="main">[</span><span class="operator">OF</span> ap<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"poly_uminus <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> cnj <span class="free">x</span>"</span></span><span class="main">]</span> represents_uminus<span class="main">[</span><span class="operator">OF</span> apc<span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> apq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="keyword1">represents</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> cnj <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> factors_int_poly_represents<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pi</span></span> <span class="keyword2"><span class="keyword">where</span></span> pi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pi</span> <span class="main">∈</span> set <span class="main">(</span>factors_of_int_poly <span class="var">?q</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> appi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pi</span> <span class="keyword1">represents</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> cnj <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> irr_pi<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">pi</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> cnj <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_real <span class="main">(</span>Im <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_split imaginary_unit.ctr legacy_Complex_simps<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> represents_2i <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_2i <span class="keyword1">represents</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">qi</span> <span class="main">∈</span> set <span class="var">?Imp</span><span class="main">.</span> <span class="bound">qi</span> <span class="keyword1">represents</span> <span class="main">(</span>inverse <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> cnj <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> cnj <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly poly_2i <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly_2i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> represents_div<span class="main">[</span><span class="operator">OF</span> appi 12 this<span class="main">]</span>
      represents_irr_non_0<span class="main">[</span><span class="operator">OF</span> irr_pi appi False<span class="main">,</span> <span class="operator">unfolded</span> poly_0_coeff_0<span class="main">]</span> pi
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_poly_Im_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"cf_pos_poly <span class="main">(</span>poly_div <span class="skolem">pi</span> poly_2i<span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> appi<span class="main">[</span><span class="operator">unfolded</span> True represents_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">pi</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">pi</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> pi <span class="keyword1"><span class="command">have</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">∈</span> set <span class="var">?Imp</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> root_poly_Im_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">represents</span> <span class="main">(</span>complex_of_real <span class="main">(</span>Im <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id2 represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> mem <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qi</span></span> <span class="keyword2"><span class="keyword">where</span></span> qi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">qi</span> <span class="main">∈</span> set <span class="var">?Imp</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qi</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">qi</span> <span class="main">(</span>complex_of_real <span class="main">(</span>Im <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> id represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> qi rt<span class="main">[</span><span class="operator">unfolded</span> poly_complex_to_real<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">qi</span> <span class="main">∈</span> set <span class="var">?Imp</span><span class="main">.</span> <span class="bound">qi</span> <span class="keyword1">represents</span> <span class="main">(</span>Im <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Determine complex roots of a polynomial, 
   intended for polynomials of degree 3 or higher,
   for lower degree polynomials use <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> roots1<span class="antiquote"><span class="antiquote">}</span></span></span></span> or <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> croots2<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> eq

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">remdups_gen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">remdups_gen</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">remdups_gen</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">then</span> 
     <span class="free">remdups_gen</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free">remdups_gen</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

  
<span class="keyword1"><span class="command">lemma</span></span> real_of_3_remdups_equal_3<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_3 <span class="main">`</span> set <span class="main">(</span>remdups_gen equal_3 <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> real_of_3 <span class="main">`</span> set <span class="free">xs</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> equal_3<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> distinct_remdups_equal_3<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map real_of_3 <span class="main">(</span>remdups_gen equal_3 <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> equal_3<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> real_of_3_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_3 <span class="free">x</span> <span class="main">=</span> real_of <span class="main">(</span>Real_Alg_Quotient <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">real_parts_3</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> roots_of_3 <span class="main">(</span>root_poly_Re <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span> 
  
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pos_imaginary_parts_3</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> 
  remdups_gen equal_3 <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> sgn_3 <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>concat <span class="main">(</span>map roots_of_3 <span class="main">(</span>root_poly_Im <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> real_parts_3<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">∈</span> real_of_3 <span class="main">`</span> set <span class="main">(</span>real_parts_3 <span class="free">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> real_parts_3_def <span class="keyword1"><span class="command">using</span></span> represents_root_poly<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    roots_of_3<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">lemma</span></span> distinct_real_parts_3<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map real_of_3 <span class="main">(</span>real_parts_3 <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> real_parts_3_def <span class="keyword1"><span class="command">using</span></span> roots_of_3<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pos_imaginary_parts_3<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">x</span> <span class="main">∈</span> real_of_3 <span class="main">`</span> set <span class="main">(</span>pos_imaginary_parts_3 <span class="free">p</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> represents_root_poly<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span>root_poly_Im <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">represents</span> Im <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> roots_of_3<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">x</span> <span class="main">∈</span> real_of_3 <span class="main">`</span> set <span class="main">(</span>roots_of_3 <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q
    <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i3</span></span> <span class="keyword2"><span class="keyword">where</span></span> i3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i3</span> <span class="main">∈</span> set <span class="main">(</span>roots_of_3 <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="free">x</span> <span class="main">=</span> real_of_3 <span class="skolem">i3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Im <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>Im <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn_3 <span class="skolem">i3</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_rat_eq_1_iff sgn_3<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pos_imaginary_parts_3_def real_of_3_remdups_equal_3 id
    <span class="keyword1"><span class="command">using</span></span> sgn i3 q<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> distinct_pos_imaginary_parts_3<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map real_of_3 <span class="main">(</span>pos_imaginary_parts_3 <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> pos_imaginary_parts_3_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> distinct_remdups_equal_3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> remdups_gen_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>remdups_gen <span class="free">eq</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">xs</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> positive_pos_imaginary_parts_3<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>pos_imaginary_parts_3 <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> real_of_3 <span class="free">x</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> subsetD<span class="main">[</span><span class="operator">OF</span> remdups_gen_subset assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> pos_imaginary_parts_3_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn_3 <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sgn_3<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_1_pos<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pair_to_complex</span> <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">ri</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">⇒</span> Complex <span class="main">(</span>real_of_3 <span class="bound">r</span><span class="main">)</span> <span class="main">(</span>real_of_3 <span class="bound">i</span><span class="main">)</span>"</span></span> 
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_itvl_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="main">⇒</span> real interval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">get_itvl_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Interval <span class="main">(</span>of_rat <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">(</span>of_rat <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">get_itvl_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">rr</span> <span class="main">=</span> of_rat <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">in</span> Interval <span class="bound">rr</span> <span class="bound">rr</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> get_bounds_2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> get_itvl_2 <span class="free">x</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Irrational <span class="skolem">n</span> <span class="skolem">plr</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> plr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">plr</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">plr</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms Irrational plr <span class="keyword1"><span class="command">have</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_2 <span class="free">x</span> <span class="main">=</span> real_of_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> invariant_1D<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> inv1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plr Irrational<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> get_itvl_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_3 <span class="main">⇒</span> real interval"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">get_itvl_2</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> get_itvl_3<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_3 <span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> get_itvl_3 <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> get_bounds_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tighten_bounds_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_2 <span class="main">⇒</span> real_alg_2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tighten_bounds_2</span> <span class="main">(</span>Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> tighten_poly_bounds <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">of</span> <span class="main">(</span><span class="bound">l'</span><span class="main">,</span><span class="bound">r'</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">⇒</span> Irrational <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="bound">l'</span><span class="main">,</span><span class="bound">r'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">tighten_bounds_2</span> <span class="main">(</span>Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> Rational <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> tighten_bounds_2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span>tighten_bounds_2 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> real_of_2 <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>tighten_bounds_2 <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="quoted"><span class="quoted">"get_itvl_2 <span class="free">x</span> <span class="main">=</span> Interval <span class="free">l</span> <span class="free">r</span> <span class="main">⟹</span>
   get_itvl_2 <span class="main">(</span>tighten_bounds_2 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Interval <span class="free">l'</span> <span class="free">r'</span> <span class="main">⟹</span> <span class="free">r'</span> <span class="main">-</span> <span class="free">l'</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="main">-</span><span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Irrational <span class="skolem">n</span> <span class="skolem">plr</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span>tighten_bounds_2 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> real_of_2 <span class="free">x</span> <span class="main">∧</span>
       invariant_2 <span class="main">(</span>tighten_bounds_2 <span class="free">x</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span>get_itvl_2 <span class="free">x</span> <span class="main">=</span> Interval <span class="free">l</span> <span class="free">r</span> <span class="main">⟶</span>
        get_itvl_2 <span class="main">(</span>tighten_bounds_2 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Interval <span class="free">l'</span> <span class="free">r'</span> <span class="main">⟶</span> <span class="free">r'</span> <span class="main">-</span> <span class="free">l'</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> plr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">plr</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">plr</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tighten_poly_bounds <span class="skolem">p</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="main">(</span>sgn <span class="main">(</span>ipoly <span class="skolem">p</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="skolem"><span class="skolem">sr'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?tb</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">,</span><span class="skolem">sr'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?tb</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"tighten_bounds_2 <span class="free">x</span> <span class="main">=</span> Irrational <span class="skolem">n</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">l'</span><span class="main">,</span><span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Irrational plr
      <span class="keyword1"><span class="command">using</span></span> tb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> inv<span class="main">[</span><span class="operator">unfolded</span> Irrational plr<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1_2 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> real_of_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∧</span> ipoly <span class="skolem">p</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> rof<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_2 <span class="free">x</span> <span class="main">=</span> real_of_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"real_of_2 <span class="main">(</span>tighten_bounds_2 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> real_of_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Irrational plr id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> inv <span class="keyword1"><span class="command">have</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> root_cond <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"poly_cond2 <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> tb' <span class="main">=</span> tighten_poly_bounds<span class="main">[</span><span class="operator">OF</span> tb rc refl<span class="main">]</span>    
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> real_of_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tb' inv1
      <span class="keyword1"><span class="command">using</span></span> invariant_1_sub_interval<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">from</span></span> inv1 tb' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"invariant_1 <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">l'</span><span class="main">,</span> <span class="skolem">r'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> invariant_1_sub_interval<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> inv2<span class="main">:</span> <span class="quoted"><span class="quoted">"invariant_2 <span class="main">(</span>tighten_bounds_2 <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> inv eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rof eq <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">unfolding</span></span> Irrational plr 
      <span class="keyword1"><span class="command">using</span></span> tb'<span class="main">(</span>1-4<span class="main">)</span> arg_cong<span class="main">[</span><span class="operator">OF</span> tb'<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted">real_of_rat</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> tighten_bounds_3 <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg_3 <span class="main">⇒</span> real_alg_3"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">tighten_bounds_2</span>
  <span class="keyword1"><span class="command">using</span></span> tighten_bounds_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">lemma</span></span> tighten_bounds_3<span class="main">:</span>  
  <span class="quoted"><span class="quoted">"real_of_3 <span class="main">(</span>tighten_bounds_3 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> real_of_3 <span class="free">x</span>"</span></span>  
  <span class="quoted"><span class="quoted">"get_itvl_3 <span class="free">x</span> <span class="main">=</span> Interval <span class="free">l</span> <span class="free">r</span> <span class="main">⟹</span>
   get_itvl_3 <span class="main">(</span>tighten_bounds_3 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Interval <span class="free">l'</span> <span class="free">r'</span> <span class="main">⟹</span> <span class="free">r'</span> <span class="main">-</span> <span class="free">l'</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="main">-</span><span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> tighten_bounds_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    
<span class="keyword1"><span class="command">partial_function</span></span> <span class="main">(</span>tailrec<span class="main">)</span> <span class="entity">filter_list_length</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">filter_list_length</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ys</span> <span class="main">=</span> filter <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> 
     <span class="keyword1">in</span> <span class="keyword1">if</span> length <span class="bound">ys</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="bound">ys</span> <span class="keyword1">else</span>
     <span class="free">filter_list_length</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> filter_list_length<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="bound">x</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map <span class="free">g</span> <span class="main">(</span>filter_list_length <span class="free">f</span> <span class="free">p</span> <span class="free">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> map <span class="free">g</span> <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> choice<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="skolem">i</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> max_list <span class="main">(</span>map <span class="skolem">i</span> <span class="free">xs</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound"><span class="bound">i</span></span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">.</span> <span class="main">¬</span> <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> max_list<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"map <span class="skolem">i</span> <span class="free">xs</span>"</span></span><span class="main">,</span> <span class="operator">folded</span> m_def<span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-2<span class="main">)</span> m
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">m</span> <span class="skolem">xs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> filter <span class="free">p</span> <span class="skolem">xs</span>"</span></span>       
    <span class="keyword1"><span class="command">have</span></span> xs_ys<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="skolem">xs</span> <span class="main">=</span> filter <span class="free">P</span> <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ys_def filter_filter
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filter_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> less<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="free">P</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">ys</span> <span class="main">=</span> filter <span class="free">P</span> <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">unfolding</span></span> o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> id3<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="main">(</span>map <span class="free">f</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> map <span class="free">f</span> <span class="main">(</span>filter <span class="free">P</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> filter_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>      
    <span class="keyword1"><span class="command">hence</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="free">g</span> <span class="main">(</span>filter <span class="free">P</span> <span class="main">(</span>map <span class="free">f</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> map <span class="free">g</span> <span class="main">(</span>filter <span class="free">P</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys</span> <span class="main">=</span> <span class="free">n</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"filter_list_length <span class="free">f</span> <span class="free">p</span> <span class="free">n</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ys_def 
        filter_list_length.simps<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">]</span> Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">unfolding</span></span> id xs_ys <span class="keyword1"><span class="command">using</span></span> less<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> filter_id_conv length_filter_less less_le xs_ys<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> Pp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">xs</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">p</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> xs_ys False<span class="main">[</span><span class="operator">folded</span> less<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter_True mem_Collect_eq set_filter ys_def<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> m0 <span class="main">=</span> this
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> mM<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> Suc <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"filter_list_length <span class="free">f</span> <span class="free">p</span> <span class="free">n</span> <span class="skolem">xs</span> <span class="main">=</span> filter_list_length <span class="free">f</span> <span class="free">p</span> <span class="free">n</span> <span class="main">(</span>map <span class="free">f</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> ys_def filter_list_length.simps<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">]</span> Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id xs_ys id2<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> less<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> m<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="free">f</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ys_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y P <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> x<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mM <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">unfolding</span></span> ij y funpow_Suc_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">≤</span> <span class="skolem">M</span><span class="main">.</span> <span class="main">¬</span> <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">y</span>"</span></span> 
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y P <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> x<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y funpow_Suc_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="free">P</span> <span class="main">(</span>map <span class="free">f</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id3 length_map <span class="keyword1"><span class="command">using</span></span> xs_ys less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">complex_roots_of_int_poly3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> complex list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">complex_roots_of_int_poly3</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span> 
    <span class="bound">rrts</span> <span class="main">=</span> real_roots_of_int_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span>
    <span class="bound">nr</span> <span class="main">=</span> length <span class="bound">rrts</span><span class="main">;</span> 
    <span class="bound">crts</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">r</span><span class="main">.</span> Complex <span class="bound">r</span> <span class="main">0</span><span class="main">)</span> <span class="bound">rrts</span>
    <span class="keyword1">in</span> 
    <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">nr</span> <span class="keyword1">then</span> <span class="bound">crts</span> 
    <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">nr_crts</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">-</span> <span class="bound">nr</span> <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">nr_crts</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> 
    <span class="keyword1">let</span> <span class="bound">pp</span> <span class="main">=</span> real_of_int_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">div</span> <span class="main">(</span>prod_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="bound">rrts</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
        <span class="bound">cpp</span> <span class="main">=</span> map_poly <span class="main">(</span><span class="main">λ</span> <span class="bound">r</span><span class="main">.</span> Complex <span class="bound">r</span> <span class="main">0</span><span class="main">)</span> <span class="bound">pp</span>
      <span class="keyword1">in</span> <span class="bound">crts</span> <span class="main">@</span> croots2 <span class="bound">cpp</span> <span class="keyword1">else</span>
    <span class="keyword1">let</span>
        <span class="bound">nr_pos_crts</span> <span class="main">=</span> <span class="bound">nr_crts</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">;</span>
        <span class="bound">rxs</span> <span class="main">=</span> real_parts_3 <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span>
        <span class="bound">ixs</span> <span class="main">=</span> pos_imaginary_parts_3 <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span>
        <span class="bound">rts</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="bound">rx</span><span class="main">,</span> <span class="bound">ix</span><span class="main">)</span><span class="main">.</span> rx <span class="main">&lt;-</span> <span class="bound">rxs</span><span class="main">,</span> ix <span class="main">&lt;-</span> <span class="bound">ixs</span><span class="main">]</span><span class="main">;</span>
        <span class="bound">crts'</span> <span class="main">=</span> map pair_to_complex 
           <span class="main">(</span>filter_list_length <span class="main">(</span>map_prod tighten_bounds_3 tighten_bounds_3<span class="main">)</span> 
              <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>c</sub></span> ipoly_complex_interval <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>Complex_Interval <span class="main">(</span>get_itvl_3 <span class="bound">r</span><span class="main">)</span> <span class="main">(</span>get_itvl_3 <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">nr_pos_crts</span> <span class="bound">rts</span><span class="main">)</span>
    <span class="keyword1">in</span> <span class="bound">crts</span> <span class="main">@</span> <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="bound">x</span><span class="main">,</span> cnj <span class="bound">x</span><span class="main">]</span><span class="main">)</span> <span class="bound">crts'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">complex_roots_of_int_poly_all</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> complex list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">complex_roots_of_int_poly_all</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> degree <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">in</span> 
    <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">≥</span> <span class="numeral">3</span> <span class="keyword1">then</span> complex_roots_of_int_poly3 <span class="free"><span class="bound"><span class="entity">p</span></span></span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">[</span>roots1 <span class="main">(</span>map_poly of_int <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">]</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> croots2 <span class="main">(</span>map_poly of_int <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> in_real_itvl_get_bounds_tighten<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_3 <span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> get_itvl_3 <span class="main">(</span><span class="main">(</span>tighten_bounds_3 <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> get_itvl_3<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tighten_bounds_3 <span class="main">^^</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>tighten_bounds_3 <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>tighten_bounds_3 <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_apply funpow_Suc_right<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id tighten_bounds_3<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> sandwitch_real<span class="main">:</span>
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">l</span> <span class="free">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
 <span class="keyword2"><span class="keyword">assumes</span></span> la<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">⇢</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ra<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⇢</span> <span class="free">a</span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> lm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">l</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">m</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">m</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">r</span> <span class="bound">i</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">⇢</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_I<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">from</span></span> LIMSEQ_D<span class="main">[</span><span class="operator">OF</span> la e<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="keyword2"><span class="keyword">where</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">n1</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">l</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> LIMSEQ_D<span class="main">[</span><span class="operator">OF</span> ra e<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="keyword2"><span class="keyword">where</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">n2</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">r</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">no</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">no</span><span class="main">.</span> norm <span class="main">(</span><span class="free">m</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"max <span class="skolem"><span class="skolem">n1</span></span> <span class="skolem"><span class="skolem">n2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>  
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"max <span class="skolem">n1</span> <span class="skolem">n2</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>     
    <span class="keyword1"><span class="command">with</span></span> n1 n2 <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">l</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">r</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> lm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> mr<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">m</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span><span class="free">l</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">+</span> norm <span class="main">(</span><span class="free">r</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">m</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_of_tighten_bounds_many<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_3 <span class="main">(</span><span class="main">(</span>tighten_bounds_3 <span class="main">^^</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> real_of_3 <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> tighten_bounds_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lower_3</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lower_3</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> interval.lower <span class="main">(</span>get_itvl_3 <span class="main">(</span><span class="main">(</span>tighten_bounds_3 <span class="main">^^</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">upper_3</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">upper_3</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> interval.upper <span class="main">(</span>get_itvl_3 <span class="main">(</span><span class="main">(</span>tighten_bounds_3 <span class="main">^^</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> interval_size_3<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_3 <span class="free">x</span> <span class="free">i</span> <span class="main">-</span> lower_3 <span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span>upper_3 <span class="free">x</span> <span class="main">0</span> <span class="main">-</span> lower_3 <span class="free">x</span> <span class="main">0</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">^</span><span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"upper_3 <span class="free">x</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> lower_3 <span class="free">x</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>upper_3 <span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> lower_3 <span class="free">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> upper_3_def lower_3_def <span class="keyword1"><span class="command">using</span></span> tighten_bounds_3 get_itvl_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> interval_size_3_tendsto_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>upper_3 <span class="free">x</span> <span class="bound">i</span> <span class="main">-</span> lower_3 <span class="free">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> interval_size_3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> LIMSEQ_divide_realpow_zero<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dist_tendsto_0_imp_tendsto<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">a</span><span class="main">¦</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">⇢</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> LIM_zero_cancel tendsto_rabs_zero_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> upper_3_tendsto<span class="main">:</span> <span class="quoted"><span class="quoted">"upper_3 <span class="free">x</span> <span class="main">⇢</span> real_of_3 <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> dist_tendsto_0_imp_tendsto<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sandwitch_real<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"get_itvl_3 <span class="main">(</span><span class="main">(</span>tighten_bounds_3 <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Interval <span class="skolem">l</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> interval.collapse<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> get_itvl_3<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tighten_bounds_3 <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">x</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span>upper_3 <span class="free">x</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">-</span> real_of_3 <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span>upper_3 <span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> lower_3 <span class="free">x</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> upper_3_def lower_3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> interval_size_3_tendsto_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lower_3_tendsto<span class="main">:</span> <span class="quoted"><span class="quoted">"lower_3 <span class="free">x</span> <span class="main">⇢</span> real_of_3 <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> dist_tendsto_0_imp_tendsto<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sandwitch_real<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"get_itvl_3 <span class="main">(</span><span class="main">(</span>tighten_bounds_3 <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Interval <span class="skolem">l</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> interval.collapse<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> get_itvl_3<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tighten_bounds_3 <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">x</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>lower_3 <span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> real_of_3 <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span>upper_3 <span class="free">x</span> <span class="skolem">i</span> <span class="main">-</span> lower_3 <span class="free">x</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> upper_3_def lower_3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> interval_size_3_tendsto_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tends_to_tight_bounds_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> get_itvl_3 <span class="main">(</span><span class="main">(</span>tighten_bounds_3 <span class="main">^^</span> <span class="bound">x</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>i</sub></span> real_of_3 <span class="free">y</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> lower_3_tendsto<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> upper_3_tendsto<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> lower_3_def upper_3_def
    interval_tendsto_def o_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">lemma</span></span> complex_roots_of_int_poly3<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"square_free <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>complex_roots_of_int_poly3 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
    <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>complex_roots_of_int_poly3 <span class="free">p</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> map_poly_inj_idom_hom <span class="quoted">of_real</span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> real_of_int_poly <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly complex_of_real <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="main">=</span> real_roots_of_int_poly <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rrts</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rrts</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> Complex <span class="bound">r</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">rr</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> d <span class="main">=</span> complex_roots_of_int_poly3_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">,</span> <span class="operator">unfolded</span> Let_def<span class="main">,</span> <span class="operator">folded</span> rr_def<span class="main">,</span> <span class="operator">folded</span> rrts_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">rr</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rr_def
    <span class="keyword1"><span class="command">using</span></span> real_roots_of_int_poly<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> rrts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">rrts</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℝ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rrts_def set_map rr q_def
    complex_of_real_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Reals_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">rr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rr_def <span class="keyword1"><span class="command">using</span></span> real_roots_of_int_poly<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> dist <span class="keyword1"><span class="command">have</span></span> dist1<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">rrts</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rrts_def distinct_map inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> lrr<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">rr</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>real_of_int_poly <span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rr_def <span class="keyword1"><span class="command">using</span></span> real_roots_of_int_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main">]</span> p distinct_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> cr<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">rr</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℝ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lrr q_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">≤</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>map_poly complex_of_real <span class="skolem">q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℝ</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≤</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_inj_on_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">of_real</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> poly_roots_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> q<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≥</span> <span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_inj_on_le<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">Re</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ _ poly_roots_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> q0<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Reals_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">have</span></span> conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="var">?q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conv <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∧</span> distinct <span class="main">(</span>complex_roots_of_int_poly3 <span class="free">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> length <span class="skolem">rr</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> oFalse <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">-</span> length <span class="skolem">rr</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>degree <span class="free">p</span> <span class="main">-</span> length <span class="skolem">rr</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> 
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cpxI</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cpxI</span> <span class="main">=</span> pos_imaginary_parts_3 <span class="free">p</span>"</span></span> 
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cpxR</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cpxR</span> <span class="main">=</span> real_parts_3 <span class="free">p</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rts</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="bound">rx</span><span class="main">,</span><span class="bound">ix</span><span class="main">)</span><span class="main">.</span> rx <span class="main">&lt;-</span> <span class="skolem">cpxR</span><span class="main">,</span> ix <span class="main">&lt;-</span> <span class="skolem">cpxI</span><span class="main">]</span>"</span></span> 
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cpx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cpx</span> <span class="main">=</span> map pair_to_complex <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span> <span class="bound">c</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="main">(</span>pair_to_complex <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
         <span class="var">?rts</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?LL</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">cpx</span> <span class="main">@</span> map cnj <span class="skolem">cpx</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?LL'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="bound">x</span><span class="main">,</span>cnj <span class="bound">x</span><span class="main">]</span><span class="main">)</span> <span class="skolem">cpx</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ll</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">rrts</span> <span class="main">@</span> <span class="var">?LL</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ll'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">rrts</span> <span class="main">@</span> <span class="var">?LL'</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> cpx<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">cpx</span> <span class="main">⊆</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cpx_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ccpx<span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">`</span> set <span class="skolem">cpx</span> <span class="main">⊆</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cpx <span class="keyword1"><span class="command">unfolding</span></span> r 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> complex_conjugate_root<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Reals_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?ll</span> <span class="main">⊆</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rrts cpx ccpx <span class="keyword1"><span class="command">unfolding</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">complex</span>
        <span class="keyword3"><span class="command">assume</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> 
          <span class="keyword3"><span class="command">assume</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> gt<span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rx</span> <span class="main">=</span> Re <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Complex <span class="skolem">rx</span> <span class="main">(</span>Im <span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rx_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> rt x <span class="keyword1"><span class="command">have</span></span> rt'<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="var">?x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> real_parts_3<span class="main">[</span><span class="operator">OF</span> p rt<span class="main">,</span> <span class="operator">folded</span> rx_def<span class="main">]</span> pos_imaginary_parts_3<span class="main">[</span><span class="operator">OF</span> p rt gt<span class="main">]</span> rt'
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> set <span class="skolem">cpx</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cpx_def cpxI_def cpxR_def 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pair_to_complex_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">cpx</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> gt <span class="main">=</span> this
        <span class="keyword1"><span class="command">have</span></span> cases<span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Im <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> Im <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> rt <span class="keyword1"><span class="command">have</span></span> rt'<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="free">p</span> <span class="main">(</span>cnj <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conv 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> complex_conjugate_root<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?q</span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Reals_def<span class="main">)</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> gt<span class="main">[</span><span class="operator">OF</span> rt this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="var">?ll</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>cnj <span class="skolem">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> gt<span class="main">[</span><span class="operator">OF</span> rt' this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>cnj <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?ll</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_append set_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="var">?ll</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> complex_is_Real_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> rt rrts <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="var">?ll</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="var">?ll</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?ll</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map real_of_3 <span class="skolem">cpxR</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map real_of_3 <span class="skolem">cpxI</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> dist2<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="var">?rr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cpxR_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> distinct_real_parts_3<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> dist3<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="var">?pi</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cpxI_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> distinct_pos_imaginary_parts_3<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> idd<span class="main">:</span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span>map <span class="main">(</span>map pair_to_complex<span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">rx</span><span class="main">.</span> map <span class="main">(</span>Pair <span class="bound">rx</span><span class="main">)</span> <span class="skolem">cpxI</span><span class="main">)</span> <span class="skolem">cpxR</span><span class="main">)</span><span class="main">)</span>
        <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> Complex <span class="main">(</span>real_of_3 <span class="bound">r</span><span class="main">)</span> <span class="main">(</span>real_of_3 <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">cpxI</span><span class="main">)</span> <span class="skolem">cpxR</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> pair_to_complex_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> dist4<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">cpx</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cpx_def 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> distinct_map_filter<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> map_concat idd<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> distinct_conv_nth<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span> 
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> nth_concat_diff<span class="main">[</span><span class="operator">OF</span> 1<span class="main">,</span> <span class="operator">unfolded</span> length_map<span class="main">]</span> dist2<span class="main">[</span><span class="operator">unfolded</span> distinct_conv_nth<span class="main">]</span>
         dist3<span class="main">[</span><span class="operator">unfolded</span> distinct_conv_nth<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> dist5<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map cnj <span class="skolem">cpx</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist4 <span class="keyword1"><span class="command">unfolding</span></span> distinct_map <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">complex</span>
        <span class="keyword1"><span class="command">have</span></span> rrts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">rrts</span> <span class="main">⟹</span> Im <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rrts_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> cpx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">cpx</span> <span class="main">⟹</span> Im <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cpx_def cpxI_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pair_to_complex_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> positive_pos_imaginary_parts_3<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> cpx'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cnj <span class="main">`</span> set <span class="skolem">cpx</span> <span class="main">⟹</span> sgn <span class="main">(</span>Im <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cpx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> set <span class="skolem">rrts</span> <span class="main">∩</span> set <span class="skolem">cpx</span> <span class="main">∪</span> set <span class="skolem">rrts</span> <span class="main">∩</span> cnj <span class="main">`</span> set <span class="skolem">cpx</span> <span class="main">∪</span> set <span class="skolem">cpx</span> <span class="main">∩</span> cnj <span class="main">`</span> set <span class="skolem">cpx</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> rrts cpx<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> cpx' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> dist6 <span class="main">=</span> this
      <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="var">?ll</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> distinct_append <span class="keyword1"><span class="command">using</span></span> dist6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist1 dist4 dist5<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"complex_of_int_poly <span class="free">p</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> pp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> p square_free_of_int_poly<span class="main">[</span><span class="operator">OF</span> sf<span class="main">]</span> square_free_rsquarefree
      <span class="keyword1"><span class="command">have</span></span> rsf<span class="main">:</span><span class="quoted"><span class="quoted">"rsquarefree <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> dist lr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?ll</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct_card<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> rsf <span class="keyword1"><span class="command">unfolding</span></span> rsquarefree_card_degree<span class="main">[</span><span class="operator">OF</span> pp<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> deg_len<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> length <span class="var">?ll</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">c</span><span class="main">.</span>  ipoly <span class="free">p</span> <span class="main">(</span>pair_to_complex <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?itvl</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">r</span> <span class="bound">i</span><span class="main">.</span> ipoly_complex_interval <span class="free">p</span> <span class="main">(</span>Complex_Interval <span class="main">(</span>get_itvl_3 <span class="bound">r</span><span class="main">)</span> <span class="main">(</span>get_itvl_3 <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?itv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="var">?itvl</span> <span class="bound">r</span> <span class="bound">i</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">(</span><span class="var">?itvl</span> <span class="bound">r</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tb</span></span></span> <span class="main">=</span> <span class="quoted">tighten_bounds_3</span>  
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_prod <span class="var">?tb</span> <span class="var">?tb</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> filter<span class="main">:</span> <span class="quoted"><span class="quoted">"map pair_to_complex <span class="main">(</span>filter_list_length <span class="var">?f</span> <span class="var">?p</span> <span class="var">?nr</span> <span class="var">?rts</span><span class="main">)</span> <span class="main">=</span> map pair_to_complex <span class="main">(</span>filter <span class="var">?P</span> <span class="var">?rts</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> filter_list_length<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="var">?P</span> <span class="var">?rts</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">cpx</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> cpx_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?nr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> deg_len <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rrts_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="var">?P</span> <span class="var">?rts</span><span class="main">)</span> <span class="main">=</span> <span class="var">?nr</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">x</span>"</span></span> 
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> xri<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?f</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="var">?tb</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">r</span><span class="main">,</span> <span class="main">(</span><span class="var">?tb</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xri
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> px<span class="main">:</span> <span class="quoted"><span class="quoted">"pair_to_complex <span class="skolem">x</span> <span class="main">=</span> Complex <span class="main">(</span>real_of_3 <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>real_of_3 <span class="skolem">i</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> xri pair_to_complex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">(</span><span class="main">(</span><span class="var">?f</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> id split 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ipoly_complex_interval<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"pair_to_complex <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span>"</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> x<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> px<span class="main"><span class="keyword3">,</span></span>
            <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_complex_interval_def in_real_itvl_get_bounds_tighten<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="var">?rts</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"pair_to_complex <span class="skolem">x</span>"</span></span> 
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> xri<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?f</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="var">?tb</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">r</span><span class="main">,</span> <span class="main">(</span><span class="var">?tb</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">unfolding</span></span> xri
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> px<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">=</span> Complex <span class="main">(</span>real_of_3 <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>real_of_3 <span class="skolem">i</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> xri pair_to_complex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> cvg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?itv</span> <span class="main">(</span><span class="main">(</span><span class="var">?f</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span> ipoly <span class="free">p</span> <span class="var">?x</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> id split px
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ipoly_complex_interval_tendsto<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">ia</span><span class="main">.</span> Complex_Interval <span class="main">(</span>get_itvl_3 <span class="main">(</span><span class="main">(</span><span class="var">?tb</span> <span class="main">^^</span> <span class="bound">ia</span><span class="main">)</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>get_itvl_3 <span class="main">(</span><span class="main">(</span><span class="var">?tb</span> <span class="main">^^</span> <span class="bound">ia</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⇢<span class="hidden">⇩</span><sub>c</sub></span>
            Complex <span class="main">(</span>real_of_3 <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>real_of_3 <span class="skolem">i</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> complex_interval_tendsto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tends_to_tight_bounds_3 o_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> complex_interval_tendsto_neq<span class="main">[</span><span class="operator">OF</span> this x<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="var">?p</span> <span class="main">(</span><span class="main">(</span><span class="var">?f</span> <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pair_to_complex <span class="main">(</span><span class="var">?f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> pair_to_complex <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pair_to_complex_def tighten_bounds_3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?P</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pair_to_complex_def tighten_bounds_3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"complex_roots_of_int_poly3 <span class="free">p</span> <span class="main">=</span> <span class="var">?ll'</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> d filter cpx_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> cpxI_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> cpxR_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> False oFalse
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?ll'</span> <span class="main">=</span> <span class="main">(</span>distinct <span class="skolem">rrts</span> <span class="main">∧</span> distinct <span class="var">?LL'</span> <span class="main">∧</span> set <span class="skolem">rrts</span> <span class="main">∩</span> set <span class="var">?LL'</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> distinct_append <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?LL'</span> <span class="main">=</span> set <span class="var">?LL</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?LL'</span> <span class="main">=</span> distinct <span class="var">?LL</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">cpx</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?ll'</span> <span class="main">=</span> distinct <span class="var">?ll</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> distinct_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> dist <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?ll'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> lr l <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly of_real <span class="main">::</span> real poly <span class="main">⇒</span> complex poly"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span> <span class="main">=</span> complex_of_int_poly <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pp</span> <span class="main">=</span> map_poly of_real <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def pp_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rts</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">rr</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rts</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rts</span> <span class="main">=</span> prod_list <span class="var">?rts</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?cr</span> <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">rts</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="skolem">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">-</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> lrr
        <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> length <span class="skolem">rr</span> <span class="main">⟷</span> False"</span></span> 
        <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">-</span> length <span class="skolem">rr</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">⟷</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> of_real <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> set <span class="main">(</span>croots2 <span class="var">?c2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> d rts_def id if_False if_True set_append rrts Reals_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> complex_of_real_def q_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> dist
      <span class="keyword1"><span class="command">have</span></span> len_rr<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">rr</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rr<span class="main">[</span><span class="operator">unfolded</span> pq<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_card<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> rr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> set <span class="skolem">rr</span> <span class="main">⟹</span> poly <span class="skolem">q</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rr <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> dist <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">div</span> prod_list <span class="var">?rts</span> <span class="main">*</span> prod_list <span class="var">?rts</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">rr</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">r</span> <span class="skolem">rr</span> <span class="skolem">q</span><span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> dist <span class="main">=</span> Cons<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">div</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">r</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">r</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> dvd_mult_div_cancel<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">r</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="var">?p</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">←</span><span class="skolem">rr</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">←</span><span class="skolem">rr</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Cons.hyps<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">rr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="skolem">rr</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> dist Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="var">?p</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="main">1</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?p</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">r</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="var">?p</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">←</span><span class="skolem">rr</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">←</span><span class="skolem">rr</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">r</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="var">?p</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">←</span><span class="skolem">rr</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">←</span><span class="skolem">r</span> <span class="main">#</span> <span class="skolem">rr</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> mult.assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">←</span><span class="skolem">rr</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">←</span><span class="skolem">r</span> <span class="main">#</span> <span class="skolem">rr</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> poly_div_mult_right<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> q_div<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">rts</span> <span class="main">*</span> <span class="skolem">rts</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rts_def <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> q_div q0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">rts</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rts</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> degree_mult_eq<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">=</span> degree <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">rts</span><span class="main">)</span> <span class="main">+</span> degree <span class="skolem">rts</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> q_div <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">rts</span> <span class="main">=</span> length <span class="skolem">rr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rts_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_linear_factors<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> len_rr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> deg2<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="var">?c2</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">note</span></span> croots2 <span class="main">=</span> croots2<span class="main">[</span><span class="operator">OF</span> deg2<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">=</span> <span class="var">?cr</span> <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">rts</span> <span class="main">*</span> <span class="skolem">rts</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q_div <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?cr</span> <span class="skolem">rts</span> <span class="main">*</span> <span class="var">?c2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> q_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">=</span> <span class="var">?cr</span> <span class="skolem">rts</span> <span class="main">*</span> <span class="var">?c2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> croots2 l
      <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> of_real <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?c2</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> r<span class="main">[</span><span class="operator">unfolded</span> q_prod<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="var">?cr</span> <span class="skolem">rts</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?c2</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cr</span> <span class="skolem">rts</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">←</span><span class="skolem">rr</span><span class="main">.</span> <span class="var">?cr</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rts_def o_def of_real_poly_hom.hom_prod_list<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">…</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> of_real <span class="main">`</span> set <span class="skolem">rr</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> poly_prod_list_zero_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">rr</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rr q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> lr<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> sf <span class="keyword1"><span class="command">have</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"square_free <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> square_free_of_int_poly<span class="main">)</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword1"><span class="command">interpret</span></span> field_hom_0' <span class="quoted">complex_of_real</span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">from</span></span> sf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"square_free <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> square_free_map_poly <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> sf <span class="main">=</span> this
        <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"complex_roots_of_int_poly3 <span class="free">p</span> <span class="main">=</span> <span class="skolem">rrts</span> <span class="main">@</span> croots2 <span class="var">?c2</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> d rts_def id if_False if_True set_append rrts q_def complex_of_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> dist2<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>croots2 <span class="var">?c2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> croots2_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>croots2 <span class="var">?c2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">rrts</span>"</span></span> 
          <span class="keyword1"><span class="command">from</span></span> x<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> croots2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="var">?c2</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> x<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="var">?cr</span> <span class="skolem">rts</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> rrts_def rts_def complex_of_real_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_prod_list_zero_iff o_def<span class="main">)</span> 
          <span class="keyword1"><span class="command">from</span></span> square_free_multD<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> sf<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> q_prod<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span><span class="main">]</span>
            x1 x2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> poly_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> dist3 <span class="main">=</span> this
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>complex_roots_of_int_poly3 <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l distinct_append
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI dist1 dist2<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> dist3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">≤</span> degree <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_roots_degree<span class="main"><span class="main">[</span></span><span class="operator">OF</span> q<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℝ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True cr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">≤</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℝ</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℝ</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_seteq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ le<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> poly_roots_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> q<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> True rrts dist1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> r d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>complex_roots_of_int_poly3 <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> complex_roots_of_int_poly_all<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≥</span> <span class="numeral">3</span> <span class="main">⟹</span> square_free <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> set <span class="main">(</span>complex_roots_of_int_poly_all <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> set <span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>complex_roots_of_int_poly_all <span class="free">p</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> d <span class="main">=</span> complex_roots_of_int_poly_all_def Let_def
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> set <span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>distinct <span class="main">(</span>complex_roots_of_int_poly_all <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> True complex_roots_of_int_poly3<span class="main">[</span><span class="operator">OF</span> p<span class="main">]</span> sf <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly <span class="main">(</span>of_int <span class="main">::</span> int <span class="main">⇒</span> complex<span class="main">)</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="var">?p</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_map_poly<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">[</span>roots1 <span class="var">?p</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="var">?p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> deg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> roots1<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> l roots1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> croots2 <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="var">?p</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> deg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> croots2<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> croots2_def Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹degree <span class="free">p</span> <span class="main">≠</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹degree <span class="free">p</span> <span class="main">≠</span> <span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span>degree <span class="free">p</span> <span class="main">≥</span> <span class="numeral">3</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> True<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="var">?p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> deg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> roots0<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> set <span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>complex_roots_of_int_poly_all <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹It now comes the preferred function to compute complex roots of a integer polynomial.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">complex_roots_of_int_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> complex list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">complex_roots_of_int_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> degree <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≥</span> <span class="numeral">3</span> <span class="keyword1">then</span> factors_of_int_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">else</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">]</span><span class="main">)</span>
    <span class="keyword1">in</span> concat <span class="main">(</span>map complex_roots_of_int_poly_all <span class="bound">ps</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">complex_roots_of_rat_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat poly <span class="main">⇒</span> complex list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">complex_roots_of_rat_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> complex_roots_of_int_poly <span class="main">(</span>snd <span class="main">(</span>rat_to_int_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
 
  
<span class="keyword1"><span class="command">lemma</span></span> complex_roots_of_int_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> set <span class="main">(</span>complex_roots_of_int_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>complex_roots_of_int_poly <span class="free">p</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>distinct <span class="main">(</span>complex_roots_of_int_poly <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"complex_roots_of_int_poly <span class="free">p</span> <span class="main">=</span> complex_roots_of_int_poly_all <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> complex_roots_of_int_poly_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> complex_roots_of_int_poly_all<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main">]</span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span>factors_of_int_poly <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> factors_of_int_poly<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> refl this<span class="main">]</span> irreducible_imp_square_free<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"square_free <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> complex_roots_of_int_poly_all<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> sf 0<span class="main">]</span> complex_roots_of_int_poly_all<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> sf<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>complex_roots_of_int_poly_all <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="skolem">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
        <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>complex_roots_of_int_poly_all <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> all <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> set <span class="main">(</span>complex_roots_of_int_poly_all <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> set <span class="main">(</span>factors_of_int_poly <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> complex_roots_of_int_poly_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> set <span class="main">(</span>factors_of_int_poly <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> all <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> set <span class="main">(</span>factors_of_int_poly <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>    
    <span class="keyword1"><span class="command">have</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l factors_of_int_poly<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> refl<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> lr<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"complex_roots_of_int_poly <span class="free">p</span> <span class="main">=</span> 
          concat <span class="main">(</span>map complex_roots_of_int_poly_all <span class="main">(</span>factors_of_int_poly <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> complex_roots_of_int_poly_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>complex_roots_of_int_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id distinct_conv_nth
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span> <span class="skolem">j</span><span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"factors_of_int_poly <span class="free">p</span>"</span></span> 
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"complex_roots_of_int_poly_all"</span></span> 
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span>map <span class="var">?rr</span> <span class="main">(</span>factors_of_int_poly <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">from</span></span> nth_concat_diff<span class="main">[</span><span class="operator">OF</span> 1<span class="main">,</span> <span class="operator">unfolded</span> length_map<span class="main">]</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j1</span></span> <span class="skolem"><span class="skolem">k1</span></span> <span class="skolem"><span class="skolem">j2</span></span> <span class="skolem"><span class="skolem">k2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
          *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j1</span><span class="main">,</span><span class="skolem">k1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">j2</span><span class="main">,</span><span class="skolem">k2</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">j1</span> <span class="main">&lt;</span> length <span class="var">?fp</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j2</span> <span class="main">&lt;</span> length <span class="var">?fp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="var">?rr</span> <span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">&lt;</span> length <span class="main">(</span>map <span class="var">?rr</span> <span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> map <span class="var">?rr</span> <span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span> <span class="main">!</span> <span class="skolem">k1</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> map <span class="var">?rr</span> <span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span> <span class="main">!</span> <span class="skolem">k2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="var">?rr</span> <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="var">?rr</span> <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?rr</span> <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">k1</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">=</span> <span class="var">?rr</span> <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">k2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span> <span class="main">∈</span> set <span class="var">?fp</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span> <span class="main">∈</span> set <span class="var">?fp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="var">?cc</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j1</span> <span class="main">=</span> <span class="skolem">j2</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">≠</span> <span class="skolem">k2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> all<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> mem<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> **<span class="main">(</span>1-2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> **<span class="main">(</span>3-4<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> True
            distinct_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹degree <span class="free">p</span> <span class="main">≥</span> <span class="numeral">3</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">note</span></span> fip <span class="main">=</span> factors_of_int_poly<span class="main">(</span>2-3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> refl this<span class="main">]</span>       
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> **<span class="main">(</span>3-4<span class="main">)</span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="var">?rr</span> <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">k2</span>"</span></span> 
            <span class="keyword3"><span class="command">assume</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rr</span> <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">k1</span> <span class="main">=</span> <span class="var">?rr</span> <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">k2</span>"</span></span> 
            <span class="keyword1"><span class="command">from</span></span> ** <span class="keyword1"><span class="command">have</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?rr</span> <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def id<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> ** <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?rr</span> <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
            <span class="keyword1"><span class="command">from</span></span> all<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> mem<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> x1 <span class="keyword1"><span class="command">have</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> all<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> mem<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> x2 <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="main">(</span><span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> False factors_of_int_poly<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> refl<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j1</span> <span class="main">≠</span> <span class="var">?fp</span> <span class="main">!</span> <span class="skolem">j2</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> distinct_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>complex_of_int_poly <span class="free">p</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> fip<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mem<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x2<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> fip<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> mem x1 x2 neq
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>complex_roots_of_int_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> complex_roots_of_rat_poly<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> set <span class="main">(</span>complex_roots_of_rat_poly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> rpoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>complex_roots_of_rat_poly <span class="free">p</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> cq<span class="main">:</span> <span class="quoted"><span class="quoted">"rat_to_int_poly <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> rat_to_int_poly<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="main">(</span>of_int <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_int_poly <span class="skolem">q</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>complex_roots_of_rat_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> complex_roots_of_rat_poly_def
    <span class="keyword1"><span class="command">using</span></span> complex_roots_of_int_poly<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">with</span></span> pq c <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> rpoly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> complex<span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="skolem">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> pq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c of_rat_of_int_poly <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> complex_roots_of_rat_poly_def cq snd_conv id
    complex_roots_of_int_poly<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> q<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">roots_of_complex_main</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">roots_of_complex_main</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> degree <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">in</span> 
    <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">[</span>roots1 <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">]</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> croots2 <span class="free"><span class="bound"><span class="entity">p</span></span></span>
    <span class="keyword1">else</span> <span class="main">(</span>complex_roots_of_rat_poly <span class="main">(</span>map_poly to_rat <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">roots_of_complex_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex list option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">roots_of_complex_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">pis</span><span class="main">)</span> <span class="main">=</span> yun_factorization gcd <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">in</span>
    <span class="keyword1">if</span> <span class="main">(</span><span class="bound">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> set <span class="bound">pis</span><span class="main">.</span> degree <span class="bound">p</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>coeffs <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> 
    Some <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span>roots_of_complex_main <span class="keyword1">o</span> fst<span class="main">)</span> <span class="bound">pis</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> None"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> roots_of_complex_main<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">∨</span> set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℚ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>roots_of_complex_main <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>roots_of_complex_main <span class="free">p</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> d <span class="main">=</span> roots_of_complex_main_def Let_def
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">∧</span> distinct <span class="main">(</span>roots_of_complex_main <span class="free">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> roots0<span class="main">[</span><span class="operator">OF</span> p True<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> 0 <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">[</span>roots1 <span class="free">p</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> roots1<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> 1 <span class="main">=</span> this
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> croots2 <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> croots2<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> croots2_def Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> 2 <span class="main">=</span> this
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly to_rat <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> 0 1 2 <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> complex_roots_of_rat_poly <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> deg 0 1 2 <span class="keyword1"><span class="command">have</span></span> rat<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℚ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> map_poly <span class="main">(</span>of_rat <span class="keyword1">o</span> to_rat<span class="main">)</span> <span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_poly_idI<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> rat<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> complex_of_rat_poly <span class="var">?q</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> to_rat<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>complex_of_rat_poly <span class="var">?q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> complex_roots_of_rat_poly<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?q</span></span></span></span></span><span class="main">,</span> <span class="operator">folded</span> id l<span class="main">]</span> q
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> roots_of_complex_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"roots_of_complex_poly <span class="free">p</span> <span class="main">=</span> Some <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">pis</span></span> <span class="keyword2"><span class="keyword">where</span></span> yun<span class="main">:</span> <span class="quoted"><span class="quoted">"yun_factorization gcd <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">pis</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> rt<span class="main">[</span><span class="operator">unfolded</span> roots_of_complex_poly_def yun split Let_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">∈</span> set <span class="skolem">pis</span> <span class="main">⟹</span> degree <span class="bound">p</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>coeffs <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span>roots_of_complex_main <span class="main">∘</span> fst<span class="main">)</span> <span class="skolem">pis</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> yun <span class="main">=</span> square_free_factorizationD<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> yun_factorization<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span><span class="operator"><span class="operator"><span class="operator">OF</span></span></span> yun<span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> yun<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="skolem">c</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">pis</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">pis</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> fst <span class="main">`</span> set <span class="skolem">pis</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> poly_prod_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">pis</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>roots_of_complex_main <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> roots_of_complex_main<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> yun<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="main"><span class="main">]</span></span> pis<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> main <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> set <span class="main">(</span>roots_of_complex_main <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> set <span class="skolem">pis</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xs o_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> main <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Factorization of Complex Polynomials›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">factorize_complex_main</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> <span class="main">(</span>complex <span class="main">×</span> <span class="main">(</span>complex <span class="main">×</span> nat<span class="main">)</span> list<span class="main">)</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">factorize_complex_main</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">pis</span><span class="main">)</span> <span class="main">=</span> yun_factorization gcd <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">in</span>
    <span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> set <span class="bound">pis</span><span class="main">.</span> degree <span class="bound">p</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>coeffs <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span> 
    Some <span class="main">(</span><span class="bound">c</span><span class="main">,</span> concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>roots_of_complex_main <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="bound">pis</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> None"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">factorize_complex_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> <span class="main">(</span>complex <span class="main">×</span> <span class="main">(</span>complex poly <span class="main">×</span> nat<span class="main">)</span> list<span class="main">)</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">factorize_complex_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> map_option 
    <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">ris</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> map <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="bound">r</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">,</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">ris</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>factorize_complex_main <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> factorize_complex_main<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"factorize_complex_main <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">xis</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="free">c</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="free">xis</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">pis</span></span> <span class="keyword2"><span class="keyword">where</span></span> yun<span class="main">:</span> <span class="quoted"><span class="quoted">"yun_factorization gcd <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">pis</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> rt<span class="main">[</span><span class="operator">unfolded</span> factorize_complex_main_def yun split Let_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> pis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">pis</span> <span class="main">⟹</span> degree <span class="bound">p</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>coeffs <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> xis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xis</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>roots_of_complex_main <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">pis</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> yun <span class="main">=</span> yun_factorization<span class="main">[</span><span class="operator">OF</span> yun<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">unfolded</span></span> d<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> yun <span class="main">=</span> square_free_factorizationD<span class="main">[</span><span class="operator">OF</span> yun<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span><span class="main">]</span> yun<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> snd_conv<span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">pis</span><span class="main">.</span> <span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span>concat
    <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>roots_of_complex_main <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="bound">pis</span><span class="main">)</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> yun<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="free">c</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">pis</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">pis</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="skolem">pis</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.distinct_set_conv_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> yun<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?exp</span> <span class="skolem">pis</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pis yun<span class="main">(</span>2<span class="main">,</span>6<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">pis</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">pi</span> <span class="skolem">pis</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> pi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pi</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rts</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"roots_of_complex_main <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> Cons <span class="main">=</span> Cons<span class="main">[</span><span class="operator">unfolded</span> pi<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="skolem">pis</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?exp</span> <span class="skolem">pis</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>2-4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2-4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i</span></span></span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>coeffs <span class="skolem">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"square_free <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"monic <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="main">(</span><span class="skolem">pi</span> <span class="main">#</span> <span class="skolem">pis</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> Suc <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="skolem">pis</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> pi <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="skolem">pis</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?exp</span> <span class="skolem">pis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="main">(</span><span class="skolem">pi</span> <span class="main">#</span> <span class="skolem">pis</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> Suc <span class="skolem">i</span> <span class="main">*</span> <span class="var">?exp</span> <span class="skolem">pis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?exp</span> <span class="main">(</span><span class="skolem">pi</span> <span class="main">#</span> <span class="skolem">pis</span><span class="main">)</span> <span class="main">=</span> <span class="var">?exp</span> <span class="main">[</span><span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">]</span> <span class="main">*</span> <span class="var">?exp</span> <span class="skolem">pis</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pi <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?exp</span> <span class="main">[</span><span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="var">?rts</span><span class="main">)</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span> <span class="bound">x</span> <span class="main">←</span> <span class="var">?rts</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">^</span>Suc <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> prod_list_power <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">prod_list</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span> <span class="bound">x</span> <span class="main">←</span> <span class="var">?rts</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> fundamental_theorem_algebra_factorized<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">,</span> <span class="operator">unfolded</span> <span class="quoted"><span class="quoted">‹monic <span class="skolem">p</span>›</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="keyword2"><span class="keyword">where</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">←</span><span class="skolem">as</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span>set <span class="skolem">as</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> prod.distinct_set_conv_list<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> distinct <span class="skolem">as</span>"</span></span> 
        <span class="keyword1"><span class="command">from</span></span> not_distinct_decomp<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as1</span></span> <span class="skolem"><span class="skolem">as2</span></span> <span class="skolem"><span class="skolem">as3</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> <span class="skolem">as1</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">as2</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">as3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">←</span><span class="skolem">as1</span> <span class="main">@</span> <span class="skolem">as2</span> <span class="main">@</span> <span class="skolem">as3</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">←</span><span class="skolem">as</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">←</span><span class="main">(</span><span class="main">[</span><span class="skolem">a</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> q_def a map_append prod_list.append <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹square_free <span class="skolem">p</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> square_free_def<span class="main">,</span> <span class="operator">THEN</span> conjunct2<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span><span class="main">]</span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">as</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> as poly_prod_list 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="skolem">as</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> set <span class="var">?rts</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> roots_of_complex_main<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> p deg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span>set <span class="var">?rts</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">←</span><span class="var">?rts</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.distinct_set_conv_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> roots_of_complex_main<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> deg p<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> id2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?exp</span> <span class="main">(</span><span class="skolem">pi</span> <span class="main">#</span> <span class="skolem">pis</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> Suc <span class="skolem">i</span> <span class="main">*</span> <span class="var">?exp</span> <span class="skolem">pis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id id2 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?exp</span> <span class="skolem">pis</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="free">xis</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xis <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p xis <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_factorize_complex_main<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"factorize_complex_main <span class="free">p</span> <span class="main">=</span> Some <span class="free">fctrs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="main">(</span>snd <span class="free">fctrs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> solvable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>snd <span class="main">(</span>yun_factorization gcd <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> degree <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">∨</span> 
                                 <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>coeffs <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">ℚ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> factorize_complex_main_def case_prod_unfold 
                       Let_def map_concat o_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sqf<span class="main">:</span> <span class="quoted"><span class="quoted">"square_free_factorization <span class="free">p</span> 
               <span class="main">(</span>fst <span class="main">(</span>yun_factorization gcd <span class="free">p</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>yun_factorization gcd <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> yun_factorization<span class="main">)</span> <span class="operator">simp</span>
    
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span>snd <span class="free">fctrs</span><span class="main">)</span> <span class="main">=</span> 
        concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>roots_of_complex_main <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>yun_factorization gcd <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> factorize_complex_main_def case_prod_unfold 
                           Let_def map_concat o_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">…</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> distinct_concat<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> distinct_map<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> square_free_factorizationD<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> sqf<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>snd <span class="main">(</span>yun_factorization gcd <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>roots_of_complex_main <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>set <span class="main">(</span>snd <span class="main">(</span>yun_factorization gcd <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a1</span> <span class="skolem">b1</span> <span class="skolem">a2</span> <span class="skolem">b2</span><span class="main">)</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a1</span><span class="main">,</span> <span class="skolem">b1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">a2</span><span class="main">,</span> <span class="skolem">b2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> square_free_factorizationD<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> sqf<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main">]</span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">a1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">a2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> square_free_factorizationD<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> sqf 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> neq<span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a1</span> <span class="skolem">a2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> solvable 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">z</span><span class="main">.</span> poly <span class="skolem">a1</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span>roots_of_complex_main <span class="skolem">a1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> roots_of_complex_main<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>roots_of_complex_main <span class="skolem">a1</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>roots_of_complex_main <span class="skolem">a2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> set_remdups <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> solvable 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> poly <span class="skolem">a2</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> roots_of_complex_main<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">z</span><span class="main">.</span> poly <span class="skolem">a1</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> poly <span class="skolem">a2</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">with</span></span> coprime_imp_no_common_roots <span class="quoted"><span class="quoted">‹coprime <span class="skolem">a1</span> <span class="skolem">a2</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">z</span><span class="main">.</span> poly <span class="skolem">a1</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> fundamental_theorem_of_algebra constant_degree
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">a1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹degree <span class="skolem">a1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">ys</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> fb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span>yun_factorization gcd <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> roots_of_complex_main <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> square_free_factorizationD<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> sqf fb<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> solvable<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> fb<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">f</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">(</span>set <span class="main">(</span>coeffs <span class="skolem">f</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℚ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ys 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> roots_of_complex_main<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 0 f<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">ys</span> <span class="skolem">zs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a1</span><span class="main">,</span> <span class="skolem">b1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span>yun_factorization gcd <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a2</span><span class="main">,</span> <span class="skolem">b2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>snd <span class="main">(</span>yun_factorization gcd <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> roots_of_complex_main <span class="skolem">a1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">=</span> roots_of_complex_main <span class="skolem">a2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a1</span><span class="main">,</span><span class="skolem">b1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">a2</span><span class="main">,</span><span class="skolem">b2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ab<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> square_free_factorizationD<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> sqf<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> square_free_factorizationD<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> sqf ab<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> neq<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a1</span> <span class="skolem">a2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ys</span> <span class="main">=</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> poly <span class="skolem">a1</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">zs</span> <span class="main">=</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> poly <span class="skolem">a2</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> solvable ab<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> ab<span class="main"><span class="keyword3">,</span></span>
          <span class="operator">rule</span> roots_of_complex_main<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">with</span></span> coprime_imp_no_common_roots <span class="quoted"><span class="quoted">‹coprime <span class="skolem">a1</span> <span class="skolem">a2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> factorize_complex_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> fp<span class="main">:</span> <span class="quoted"><span class="quoted">"factorize_complex_poly <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">qis</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="free">c</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="free">qis</span><span class="main">.</span> <span class="bound">q</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qis</span> <span class="main">⟹</span> irreducible <span class="free">q</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> monic <span class="free">q</span> <span class="main">∧</span> degree <span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> fp<span class="main">[</span><span class="operator">unfolded</span> factorize_complex_poly_def<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pis</span></span> <span class="keyword2"><span class="keyword">where</span></span> fp<span class="main">:</span> <span class="quoted"><span class="quoted">"factorize_complex_main <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="skolem">pis</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> qis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">qis</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="bound">r</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">,</span> Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">pis</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> factorize_complex_main<span class="main">[</span><span class="operator">OF</span> fp<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="free">c</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="skolem">pis</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="free">c</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="free">qis</span><span class="main">.</span> <span class="bound">q</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p qis
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span> <span class="bound"><span class="bound"><span class="bound">p</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> smult <span class="free"><span class="free"><span class="free">c</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span>prod_list <span class="bound"><span class="bound"><span class="bound">p</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">i</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qis</span> <span class="main">⟹</span> irreducible <span class="free">q</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> monic <span class="free">q</span> <span class="main">∧</span> degree <span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> linear_irreducible_field<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> qis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Real_Factorization">
<div class="head">
<h1>Theory Real_Factorization</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Real Factorization›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory contains an algorithm to completely factorize real polynomials with rational
  coefficients. It internally does a complex polynomial factorization, and then combines 
  all non-real roots with their conjugates.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Real_Factorization
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Complex_Algebraic_Numbers.html">Complex_Algebraic_Numbers</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">delete_cnj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span>complex <span class="main">×</span> nat<span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span>complex <span class="main">×</span> nat<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">delete_cnj</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">yjs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> <span class="keyword1">if</span> Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">yjs</span></span></span> <span class="keyword1">else</span> <span class="keyword1">if</span> Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">then</span>
    <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">yjs</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">delete_cnj</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">yjs</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free">delete_cnj</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">yjs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">delete_cnj</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> delete_cnj_length<span class="main">[</span><span class="operator">termination_simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>delete_cnj <span class="free">x</span> <span class="free">i</span> <span class="free">yjs</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">yjs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">yjs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> delete_cnj.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">complex_roots_to_real_factorization</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>complex <span class="main">×</span> nat<span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span>real poly <span class="main">×</span> nat<span class="main">)</span>list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">complex_roots_to_real_factorization</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">complex_roots_to_real_factorization</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="main">ℝ</span> <span class="keyword1">then</span> 
    <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">,</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free">complex_roots_to_real_factorization</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">else</span> 
    <span class="keyword1">let</span> <span class="bound">xx</span> <span class="main">=</span> cnj <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span> <span class="bound">ys</span> <span class="main">=</span> delete_cnj <span class="bound">xx</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">;</span> <span class="bound">p</span> <span class="main">=</span> map_poly Re <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="bound">xx</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span>
    <span class="keyword1">in</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free">complex_roots_to_real_factorization</span> <span class="bound">ys</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">factorize_real_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> <span class="main">(</span>real <span class="main">×</span> <span class="main">(</span>real poly <span class="main">×</span> nat<span class="main">)</span> list<span class="main">)</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">factorize_real_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> map_option 
    <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">ris</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>Re <span class="bound">c</span><span class="main">,</span> complex_roots_to_real_factorization <span class="bound">ris</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">(</span>factorize_complex_main <span class="main">(</span>map_poly of_real <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> monic_imp_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"monic <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> semiring_1 poly"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> delete_cnj<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> 
  <span class="quoted"><span class="quoted">"order <span class="free">x</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="free">xis</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">≥</span> <span class="free">si</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">si</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="free">xis</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">si</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span>delete_cnj <span class="free">x</span> <span class="free">si</span> <span class="free">xis</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">si</span></span> <span class="quoted"><span class="free">xis</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> delete_cnj.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">si</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="main">1</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="main">1</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> order_divides <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> power_le_dvd<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">si</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> divides_degree<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">i</span> <span class="skolem">y</span> <span class="skolem">j</span> <span class="skolem">yjs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 1<span class="main">(</span>1-2<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yj</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">y</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span>Suc <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yjs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="skolem">yjs</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monic <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">yjs</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monic_prod_list_pow<span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monic <span class="main">(</span><span class="var">?yj</span> <span class="main">*</span> <span class="var">?yjs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> monic_imp_nonzero<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> yy0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?yj</span> <span class="main">*</span> <span class="var">?yjs</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">yjs</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?yj</span> <span class="main">*</span> <span class="var">?yjs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>3-<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> order <span class="skolem">x</span> <span class="main">(</span><span class="var">?yj</span> <span class="main">*</span> <span class="var">?yjs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ord<span class="main">[</span><span class="operator">unfolded</span> order_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> yy0<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> order <span class="skolem">x</span> <span class="var">?yj</span> <span class="main">+</span> order <span class="skolem">x</span> <span class="var">?yjs</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> order_linear_power'<span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">then</span> Suc <span class="skolem">j</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> order <span class="skolem">x</span> <span class="var">?yjs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> ord False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> order <span class="skolem">x</span> <span class="var">?yjs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> False this i<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> del<span class="main">:</span> <span class="quoted"><span class="quoted">"delete_cnj <span class="skolem">x</span> <span class="skolem">i</span> <span class="main">(</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">yjs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">j</span><span class="main">)</span> <span class="main">#</span> delete_cnj <span class="skolem">x</span> <span class="skolem">i</span> <span class="skolem">yjs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>    
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> del id IH
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> xy <span class="main">=</span> this
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">≥</span> <span class="skolem">i</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> ord <span class="keyword1"><span class="command">have</span></span> ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> Suc <span class="skolem">j</span> <span class="main">≤</span> order <span class="skolem">x</span> <span class="var">?yjs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xi</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">^</span> Suc <span class="skolem">j</span> <span class="main">*</span> <span class="var">?x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> power_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> xi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?xi</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">^</span> Suc <span class="skolem">j</span> <span class="main">*</span> <span class="var">?x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> Suc <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> Suc <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> IH<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> ord this<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">from</span></span> xy False <span class="keyword1"><span class="command">have</span></span> del<span class="main">:</span> <span class="quoted"><span class="quoted">"delete_cnj <span class="skolem">x</span> <span class="skolem">i</span> <span class="main">(</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">yjs</span><span class="main">)</span> <span class="main">=</span> delete_cnj <span class="skolem">x</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> Suc <span class="skolem">j</span><span class="main">)</span> <span class="skolem">yjs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> del id <span class="keyword1"><span class="command">unfolding</span></span> IH xi <span class="keyword1"><span class="command">unfolding</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">∨</span> <span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> xy i <span class="keyword1"><span class="command">have</span></span> del<span class="main">:</span> <span class="quoted"><span class="quoted">"delete_cnj <span class="skolem">x</span> <span class="skolem">i</span> <span class="main">(</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">yjs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">yjs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id del <span class="keyword1"><span class="command">unfolding</span></span> xy i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> xy i <span class="keyword1"><span class="command">have</span></span> del<span class="main">:</span> <span class="quoted"><span class="quoted">"delete_cnj <span class="skolem">x</span> <span class="skolem">i</span> <span class="main">(</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">yjs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">yjs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> ij <span class="keyword1"><span class="command">have</span></span> idd<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id del <span class="keyword1"><span class="command">unfolding</span></span> xy idd power_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> factorize_real_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> fp<span class="main">:</span> <span class="quoted"><span class="quoted">"factorize_real_poly <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">qis</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="free">c</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="free">qis</span><span class="main">.</span> <span class="bound">q</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qis</span> <span class="main">⟹</span> irreducible <span class="free">q</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> monic <span class="free">q</span> <span class="main">∧</span> degree <span class="free">q</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> map_poly_inj_idom_hom <span class="quoted">of_real</span><span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">=</span> smult <span class="free">c</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="free">qis</span><span class="main">.</span> <span class="bound">q</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qis</span> <span class="main">⟶</span> irreducible <span class="free">q</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> monic <span class="free">q</span> <span class="main">∧</span> degree <span class="free">q</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"factorize_real_poly <span class="free">p</span> <span class="main">=</span> Some <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> True
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> factorize_real_poly_def factorize_complex_main_def yun_factorization_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> fp <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">qis</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> p0 <span class="main">=</span> this
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted">complex_of_real</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly Re"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?cp</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> fp<span class="main">[</span><span class="operator">unfolded</span> factorize_real_poly_def<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">xis</span></span> <span class="keyword2"><span class="keyword">where</span></span> fp<span class="main">:</span> <span class="quoted"><span class="quoted">"factorize_complex_main <span class="var">?p</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">xis</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> Re <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">qis</span> <span class="main">=</span> complex_roots_to_real_factorization <span class="skolem">xis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> factorize_complex_main<span class="main">[</span><span class="operator">OF</span> fp<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> smult <span class="skolem">d</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="skolem">xis</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span> 
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> smult <span class="skolem">d</span> <span class="var">?q</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> coeff <span class="bound">p</span> <span class="main">(</span>degree <span class="bound">p</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="var">?p</span> <span class="main">(</span>degree <span class="var">?p</span><span class="main">)</span> <span class="main">=</span> coeff <span class="main">(</span>smult <span class="skolem">d</span> <span class="var">?q</span><span class="main">)</span> <span class="main">(</span>degree <span class="main">(</span>smult <span class="skolem">d</span> <span class="var">?q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="var">?p</span> <span class="main">(</span>degree <span class="var">?p</span><span class="main">)</span> <span class="main">=</span> <span class="var">?c</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>smult <span class="skolem">d</span> <span class="var">?q</span><span class="main">)</span> <span class="main">(</span>degree <span class="main">(</span>smult <span class="skolem">d</span> <span class="var">?q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> coeff <span class="var">?q</span> <span class="main">(</span>degree <span class="var">?q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monic <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monic_prod_list_pow<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="var">?c</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted">Re</span><span class="main">,</span> <span class="operator">folded</span> c<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="var">?p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span>smult <span class="skolem">d</span> <span class="var">?q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> d p0 <span class="keyword1"><span class="command">have</span></span> d0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="skolem">d</span> <span class="var">?q</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">d</span><span class="main">:]</span> <span class="main">*</span> <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> real_poly_factor<span class="main">[</span><span class="operator">OF</span> q'<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> this<span class="main"><span class="main">]</span></span><span class="main">]</span> d0 d
    <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="var">?q</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="var">?rp</span> <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_poly_idI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?rp</span> <span class="main">(</span>smult <span class="skolem">d</span> <span class="var">?q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">=</span> <span class="var">?cp</span> <span class="main">(</span><span class="var">?rp</span> <span class="var">?q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_poly_of_real_Re<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> q<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="var">?c</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d c <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span><span class="var">?c</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="var">?cp</span> <span class="main">(</span><span class="var">?rp</span> <span class="var">?q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?cp</span> <span class="main">(</span>smult <span class="free">c</span> <span class="main">(</span><span class="var">?rp</span> <span class="var">?q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rp</span> <span class="main">…</span> <span class="main">=</span> smult <span class="free">c</span> <span class="main">(</span><span class="var">?rp</span> <span class="var">?q</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_map_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_poly_idI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="free">c</span> <span class="main">(</span><span class="var">?rp</span> <span class="var">?q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fact</span></span></span> <span class="main">=</span> <span class="quoted">complex_roots_to_real_factorization</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rp</span> <span class="var">?q</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="free">qis</span><span class="main">.</span> <span class="bound">q</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">(</span><span class="free">q</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qis</span> <span class="main">⟶</span> irreducible <span class="free">q</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> monic <span class="free">q</span> <span class="main">∧</span> degree <span class="free">q</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">unfolding</span></span> qis
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xis</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> complex_roots_to_real_factorization.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">i</span> <span class="skolem">xis</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 2<span class="main">(</span>1-2<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> prems <span class="main">=</span> 2<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xis</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="skolem">xis</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">xis</span><span class="main">)</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?xi</span> <span class="main">*</span> <span class="var">?xis</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> xi<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="var">?xi</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_poly_power<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> True<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> xis<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="var">?xis</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_poly_factor<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prems<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> id<span class="main"><span class="main">]</span></span> xi<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> linear_power_nonzero<span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> True xis<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rp</span> <span class="main">(</span><span class="var">?xi</span> <span class="main">*</span> <span class="var">?xis</span><span class="main">)</span> <span class="main">=</span> <span class="var">?rp</span> <span class="var">?xi</span> <span class="main">*</span> <span class="var">?rp</span> <span class="var">?xis</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_poly_Re_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> xi xis<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rp</span> <span class="var">?xi</span> <span class="main">=</span> <span class="main">(</span><span class="var">?rp</span> <span class="main">[:</span> <span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">1</span> <span class="main">:]</span><span class="main">)</span><span class="main">^</span>Suc <span class="skolem">i</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_poly_Re_power<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> True<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rp</span> <span class="main">[:</span> <span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">1</span> <span class="main">:]</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rp</span> <span class="var">?xis</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">←</span> <span class="var">?fact</span> <span class="skolem">xis</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> Re <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">←</span> <span class="var">?fact</span> <span class="skolem">xis</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∏</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">←</span> <span class="var">?fact</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">xis</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> idd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rp</span> <span class="main">(</span><span class="var">?xi</span> <span class="main">*</span> <span class="var">?xis</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">←</span> <span class="var">?fact</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">xis</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id idd
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">q</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?fact</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">xis</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?fact</span> <span class="skolem">xis</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span> Re <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">=</span> Suc <span class="skolem">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">q</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> monic <span class="free">q</span> <span class="main">∧</span> degree <span class="free">q</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?fact</span> <span class="skolem">xis</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> IH <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span> Re <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">=</span> Suc <span class="skolem">i</span>"</span></span>
            <span class="keyword1"><span class="command">with</span></span> linear_irreducible_field<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> Re <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xi</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xi</span> <span class="main">=</span> <span class="main">[:</span>Re <span class="skolem">x</span> <span class="main">*</span> Re <span class="skolem">x</span> <span class="main">+</span> Im <span class="skolem">x</span> <span class="main">*</span> Im <span class="skolem">x</span><span class="main">,</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xx</span></span> <span class="keyword2"><span class="keyword">where</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">=</span> cnj <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> xi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xi</span> <span class="main">=</span> <span class="var">?rp</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">xx</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xx xi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> cpxi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?cp</span> <span class="skolem">xi</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">xx</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xi_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xx legacy_Complex_simps<span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yis</span></span> <span class="keyword2"><span class="keyword">where</span></span> yis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yis</span> <span class="main">=</span> delete_cnj <span class="skolem">xx</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">xis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> fact<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fact</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">xis</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">xi</span><span class="main">,</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">#</span> <span class="var">?fact</span> <span class="skolem">yis</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> xi_def xx yis <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> False xx yis xi<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">xi</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> irreducible_connect_field<span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> irreducible<span class="hidden">⇩</span><sub>d</sub>I<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">xi</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span> 
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">&lt;</span> degree <span class="skolem">xi</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xi</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> dq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> dxi<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">xi</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xi</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> qp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">xi</span> <span class="main">=</span> degree <span class="skolem">q</span> <span class="main">+</span> degree <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> qp
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_mult_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> dq <span class="keyword1"><span class="command">have</span></span> dp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dxi <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted">complex</span>
            <span class="keyword3"><span class="command">assume</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="var">?cp</span> <span class="skolem">xi</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="var">?cp</span> <span class="skolem">q</span> <span class="main">*</span> <span class="var">?cp</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qp <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="main">(</span><span class="var">?cp</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="main">(</span><span class="var">?cp</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> roots1 <span class="main">(</span><span class="var">?cp</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">c</span> <span class="main">=</span> roots1 <span class="main">(</span><span class="var">?cp</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> roots1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?cp</span> <span class="skolem">q</span>"</span></span><span class="main">]</span> roots1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?cp</span> <span class="skolem">p</span>"</span></span><span class="main">]</span> dp dq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="var">?cp</span> <span class="skolem">xi</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> cpxi <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> xi'<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">xi</span>"</span></span> <span class="quoted"><span class="quoted">"monic <span class="skolem">xi</span>"</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">xi</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> xi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xxi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="skolem">xx</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yis</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="skolem">yis</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?cp</span> <span class="skolem">xi</span><span class="main">)</span><span class="main">^</span>Suc <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> yi<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="var">?yi</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_poly_power<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xi<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> mon<span class="main">:</span> <span class="quoted"><span class="quoted">"monic <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">xis</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> monic_prod_list_pow<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> monic_imp_nonzero<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> xixis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?xi</span> <span class="main">*</span> <span class="var">?xis</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> xxx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xx <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> legacy_Complex_simps Reals_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> prems<span class="main">[</span><span class="operator">unfolded</span> id<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> prems<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span><span class="var">?xi</span> <span class="main">*</span> <span class="var">?xis</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">from</span></span> id <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> Suc <span class="skolem">i</span> <span class="keyword1">dvd</span> <span class="var">?xi</span> <span class="main">*</span> <span class="var">?xis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> xixis this<span class="main">[</span><span class="operator">unfolded</span> order_divides<span class="main">]</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="main">(</span><span class="var">?xi</span> <span class="main">*</span> <span class="var">?xis</span><span class="main">)</span> <span class="main">≥</span> Suc <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> complex_conjugate_order<span class="main">[</span><span class="operator">OF</span> prems xixis<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">,</span> <span class="operator">folded</span> xx<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">xx</span> <span class="main">(</span><span class="var">?xi</span> <span class="main">*</span> <span class="var">?xis</span><span class="main">)</span> <span class="main">≥</span> Suc <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">xx</span> <span class="var">?xi</span> <span class="main">+</span> order <span class="skolem">xx</span> <span class="var">?xis</span> <span class="main">≥</span> Suc <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> order_mult<span class="main">[</span><span class="operator">OF</span> xixis<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">xx</span> <span class="var">?xi</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> order_linear_power' <span class="keyword1"><span class="command">using</span></span> xxx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">xx</span> <span class="var">?xis</span> <span class="main">≥</span> Suc <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> yis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?xis</span> <span class="main">=</span> <span class="var">?xxi</span> <span class="main">*</span> <span class="var">?yis</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> yis 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> delete_cnj<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xi</span> <span class="main">*</span> <span class="var">?xis</span> <span class="main">=</span> <span class="main">(</span><span class="var">?xi</span> <span class="main">*</span> <span class="var">?xxi</span><span class="main">)</span> <span class="main">*</span> <span class="var">?yis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xi</span> <span class="main">*</span> <span class="var">?xxi</span> <span class="main">=</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">xx</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">^</span>Suc <span class="skolem">i</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power_mult_distrib<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">xx</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="var">?cp</span> <span class="skolem">xi</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cpxi <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> idd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?xi</span> <span class="main">*</span> <span class="var">?xis</span> <span class="main">=</span> <span class="main">(</span><span class="var">?cp</span> <span class="skolem">xi</span><span class="main">)</span><span class="main">^</span>Suc <span class="skolem">i</span> <span class="main">*</span> <span class="var">?yis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> prems<span class="main">[</span><span class="operator">unfolded</span> idd<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="main">(</span><span class="main">(</span><span class="var">?cp</span> <span class="skolem">xi</span><span class="main">)</span><span class="main">^</span>Suc <span class="skolem">i</span> <span class="main">*</span> <span class="var">?yis</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">have</span></span> yis<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coeffs <span class="var">?yis</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_poly_factor<span class="main"><span class="main">[</span></span><span class="operator">OF</span> R yi<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xi_def<span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> IH<span class="main">[</span><span class="operator">OF</span> yis<span class="main">]</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rp</span> <span class="main">(</span><span class="var">?xi</span> <span class="main">*</span> <span class="var">?xis</span><span class="main">)</span> <span class="main">=</span> <span class="var">?rp</span> <span class="var">?yi</span> <span class="main">*</span> <span class="var">?rp</span> <span class="var">?yis</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> idd
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_poly_Re_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> yi yis<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rp</span> <span class="var">?yi</span> <span class="main">=</span> <span class="skolem">xi</span><span class="main">^</span>Suc <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_poly_Re_of_real<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rp</span> <span class="var">?yis</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">←</span> <span class="var">?fact</span> <span class="skolem">yis</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xi</span> <span class="main">^</span> Suc <span class="skolem">i</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">←</span> <span class="var">?fact</span> <span class="skolem">yis</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∏</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">←</span> <span class="var">?fact</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">xis</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fact <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> idd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rp</span> <span class="main">(</span><span class="var">?xi</span> <span class="main">*</span> <span class="var">?xis</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">←</span> <span class="var">?fact</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">i</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">xis</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id idd fact <span class="keyword1"><span class="command">using</span></span> IH xi' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> smult <span class="free">c</span> <span class="main">(</span><span class="main">∏</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">←</span><span class="free">qis</span><span class="main">.</span> <span class="bound">q</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">j</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qis</span> <span class="main">⟹</span> irreducible <span class="free">q</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> monic <span class="free">q</span> <span class="main">∧</span> degree <span class="free">q</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Show_Real_Alg">
<div class="head">
<h1>Theory Show_Real_Alg</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Show for Real Algebraic Numbers -- Interface›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We just demand that there is some function from real algebraic numbers to string and register this
  as show-function and use it to implement \textit{show-real}.
  
  Implementations for real algebraic numbers are available in one of the theories \textit{Show-Real-Precise}
  and \textit{Show-Real-Approx}.›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Show_Real_Alg
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Real_Algebraic_Numbers.html">Real_Algebraic_Numbers</a>
  <a href="../Show/Show_Real.html">Show.Show_Real</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">consts</span></span> show_real_alg <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> string"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">showsp_real_alg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg showsp"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">showsp_real_alg</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span>show_real_alg <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> show_law_real_alg <span class="main">[</span><span class="operator">show_law_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"show_law showsp_real_alg <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> show_lawI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> showsp_real_alg_def <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> showsp_real_alg_append <span class="main">[</span><span class="operator">show_law_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"showsp_real_alg <span class="free">p</span> <span class="free">r</span> <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> showsp_real_alg <span class="free">p</span> <span class="free">r</span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> show_lawD <span class="dynamic"><span class="dynamic">show_law_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">local_setup</span></span> <span class="quoted">‹
  <span class="entity">Show_Generator.register_foreign_showsp</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">real_alg</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"showsp_real_alg"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> show_law_real_alg<span class="antiquote">}</span></span></span>
›</span>

<span class="keyword1"><span class="command">derive</span></span> <span class="quoted">"show"</span> <span class="quoted">real_alg</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now define <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> show_real<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">overloading</span></span> show_real <span class="main">≡</span> <span class="quoted">show_real</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"show_real <span class="main">≡</span> show_real_alg <span class="keyword1">o</span> real_alg_of_real"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Show_Real_Approx">
<div class="head">
<h1>Theory Show_Real_Approx</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Show for Real (Algebraic) Numbers -- Approximate Representation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We implement the show-function for real (algebraic) numbers by calculating the
  number precisely for three digits after the comma.›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Show_Real_Approx
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Show_Real_Alg.html">Show_Real_Alg</a>
  <a href="../Show/Show_Instances.html">Show.Show_Instances</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">overloading</span></span> show_real_alg <span class="main">≡</span> <span class="quoted">show_real_alg</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> show_real_alg<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"show_real_alg <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> 
  <span class="bound">x1000'</span> <span class="main">=</span> floor <span class="main">(</span><span class="numeral">1000</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">;</span>
  <span class="main">(</span><span class="bound">x1000</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x1000'</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">-</span><span class="bound">x1000'</span><span class="main">,</span> <span class="inner_quoted">''-''</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="bound">x1000'</span><span class="main">,</span> <span class="inner_quoted">''''</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  <span class="main">(</span><span class="bound">bef</span><span class="main">,</span><span class="bound">aft</span><span class="main">)</span> <span class="main">=</span> divmod_int <span class="bound">x1000</span> <span class="numeral">1000</span><span class="main">;</span>
  <span class="bound">a'</span> <span class="main">=</span> show <span class="bound">aft</span><span class="main">;</span>
  <span class="bound">a</span> <span class="main">=</span> replicate <span class="main">(</span><span class="numeral">3</span><span class="main">-</span>length <span class="bound">a'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">CHR</span> <span class="inner_quoted">''0''</span><span class="main">)</span> <span class="main">@</span> <span class="bound">a'</span>
  <span class="keyword1">in</span> 
  <span class="inner_quoted">'' ~''</span> <span class="main">@</span> <span class="bound">s</span> <span class="main">@</span> show <span class="bound">bef</span> <span class="main">@</span> <span class="inner_quoted">''.''</span> <span class="main">@</span> <span class="bound">a</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Show_Real_Precise">
<div class="head">
<h1>Theory Show_Real_Precise</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Show for Real (Algebraic) Numbers -- Unique Representation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We implement the show-function for real (algebraic) numbers by printing them
  uniquely via their monic irreducible polynomial with a special cases for polynomials 
  of degree at most 2.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Show_Real_Precise
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Show_Real_Alg.html">Show_Real_Alg</a>
  <a href="../Show/Show_Instances.html">Show.Show_Instances</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">datatype</span></span> real_alg_show_info <span class="main">=</span> Rat_Info <span class="quoted">rat</span> <span class="main">|</span> Sqrt_Info <span class="quoted">rat</span> <span class="quoted">rat</span> <span class="main">|</span> Real_Alg_Info <span class="quoted"><span class="quoted">"int poly"</span></span> <span class="quoted">nat</span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">convert_info</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat <span class="main">+</span> int poly <span class="main">×</span> nat <span class="main">⇒</span> real_alg_show_info"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">convert_info</span> <span class="main">(</span>Inl <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> Rat_Info <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">convert_info</span> <span class="main">(</span>Inr <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> degree <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">a</span> <span class="main">=</span> coeff <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="numeral">2</span><span class="main">;</span> <span class="bound">b</span> <span class="main">=</span> coeff <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">1</span><span class="main">;</span> <span class="bound">c</span> <span class="main">=</span> coeff <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span><span class="main">;</span>
      <span class="bound">b2a</span> <span class="main">=</span> Rat.Fract <span class="main">(</span><span class="main">-</span><span class="bound">b</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">a</span><span class="main">)</span><span class="main">;</span> 
      <span class="bound">below</span> <span class="main">=</span> Rat.Fract <span class="main">(</span><span class="bound">b</span><span class="main">*</span><span class="bound">b</span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">c</span><span class="main">)</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">a</span><span class="main">)</span>
     <span class="keyword1">in</span> Sqrt_Info <span class="bound">b2a</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">-</span><span class="bound">below</span> <span class="keyword1">else</span> <span class="bound">below</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">else</span> Real_Alg_Info <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">real_alg_show_info</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> real_alg_show_info"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">real_alg_show_info</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> convert_info <span class="main">(</span>info_real_alg <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove that the extracted information for showing an algebraic real number is correct.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> real_alg_show_info<span class="main">:</span> <span class="quoted"><span class="quoted">"real_alg_show_info <span class="free">x</span> <span class="main">=</span> Rat_Info <span class="free">r</span> <span class="main">⟹</span> real_of <span class="free">x</span> <span class="main">=</span> of_rat <span class="free">r</span>"</span></span> 
  <span class="quoted"><span class="quoted">"real_alg_show_info <span class="free">x</span> <span class="main">=</span> Sqrt_Info <span class="free">r</span> <span class="free">sq</span> <span class="main">⟹</span> real_of <span class="free">x</span> <span class="main">=</span> of_rat <span class="free">r</span> <span class="main">+</span> sqrt <span class="main">(</span>of_rat <span class="free">sq</span><span class="main">)</span>"</span></span> 
  <span class="quoted"><span class="quoted">"real_alg_show_info <span class="free">x</span> <span class="main">=</span> Real_Alg_Info <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">p</span> <span class="keyword1">represents</span> <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> real_of <span class="free">x</span> <span class="main">∧</span> ipoly <span class="free">p</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟹</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">full</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">note</span></span> d <span class="main">=</span> real_alg_show_info_def
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"info_real_alg <span class="free">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Inl <span class="skolem">q</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> info_real_alg<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Inr <span class="skolem">qm</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"info_real_alg <span class="free">x</span> <span class="main">=</span> Inr <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">qm</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> info_real_alg<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> id<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> ap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">represents</span> <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> real_of <span class="free">x</span> <span class="main">∧</span> ipoly <span class="skolem">p</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> irr<span class="main">:</span> <span class="quoted"><span class="quoted">"irreducible <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> id' <span class="main">=</span> real_alg_show_info_def id convert_info.simps Fract_of_int_quotient Let_def
    <span class="keyword1"><span class="command">have</span></span> last<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟹</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id' <span class="keyword1"><span class="command">using</span></span> ap n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>    
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"real_alg_show_info <span class="free">x</span> <span class="main">=</span> Sqrt_Info <span class="free">r</span> <span class="free">sq</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> id'<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> degree2_coeffs<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> coeffs<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">a</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">b</span>"</span></span>     
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_int <span class="skolem">c</span>"</span></span> 
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="var">?a</span>"</span></span> 
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="var">?b</span>"</span></span> 
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="var">?c</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">B</span> <span class="main">*</span> <span class="skolem">B</span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">A</span> <span class="main">*</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="skolem">A</span> <span class="main">*</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_int_poly <span class="skolem">p</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?disc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">B</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">C</span> <span class="main">/</span> <span class="skolem">A</span>"</span></span> 
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="var">?disc</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> p<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"map_poly real_of_int"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">have</span></span> rp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="main">[:</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">A</span> <span class="main">:]</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def B_def C_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> *<span class="main">[</span><span class="operator">unfolded</span> id' deg<span class="main">,</span> <span class="operator">unfolded</span> coeffs of_int_minus of_int_minus of_int_mult of_int_diff<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> 
      <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_rat <span class="free">r</span> <span class="main">=</span> <span class="skolem">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sq<span class="main">:</span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>of_rat <span class="free">sq</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">-</span> sqrt <span class="var">?sq</span> <span class="keyword1">else</span> sqrt <span class="var">?sq</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A_def B_def C_def R_def real_sqrt_minus <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">note</span></span> sq
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sq</span> <span class="main">=</span> <span class="skolem">D</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> D_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> sq<span class="main">:</span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>of_rat <span class="free">sq</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">-</span> sqrt <span class="skolem">D</span> <span class="keyword1">else</span> sqrt <span class="skolem">D</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> rp <span class="keyword1"><span class="command">have</span></span> coeffs'<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="var">?p</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"coeff <span class="var">?p</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"coeff <span class="var">?p</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> rp A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>real_of_int_poly <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">note</span></span> roots <span class="main">=</span> rroots2<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">unfolded</span> rroots2_def Let_def coeffs'<span class="main">,</span> <span class="operator">folded</span> D_def R_def<span class="main">]</span>
      <span class="keyword1"><span class="command">from</span></span> ap<span class="main">[</span><span class="operator">unfolded</span> represents_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> root<span class="main">:</span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">p</span> <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> root roots <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">D</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">note</span></span> roots <span class="main">=</span> roots<span class="main">[</span><span class="operator">unfolded</span> this if_False<span class="main">,</span> <span class="operator">folded</span> R_def<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of <span class="free">x</span> <span class="main">=</span> of_rat <span class="free">r</span> <span class="main">+</span> sqrt <span class="main">(</span>of_rat <span class="free">sq</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> roots root <span class="keyword1"><span class="command">unfolding</span></span> sq r True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> D <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> roots False <span class="keyword1"><span class="command">have</span></span> roots<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> ipoly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">R</span> <span class="main">+</span> sqrt <span class="skolem">D</span><span class="main">,</span> <span class="skolem">R</span> <span class="main">-</span> sqrt <span class="skolem">D</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Roots</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> real_of <span class="free">x</span> <span class="main">∧</span> ipoly <span class="skolem">p</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of <span class="free">x</span> <span class="main">∈</span> <span class="var">?Roots</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> root <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> root roots <span class="keyword1"><span class="command">have</span></span> choice<span class="main">:</span> <span class="quoted"><span class="quoted">"real_of <span class="free">x</span> <span class="main">=</span> <span class="skolem">R</span> <span class="main">+</span> sqrt <span class="skolem">D</span> <span class="main">∨</span> real_of <span class="free">x</span> <span class="main">=</span> <span class="skolem">R</span> <span class="main">-</span> sqrt <span class="skolem">D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> small<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">-</span> sqrt <span class="skolem">D</span> <span class="main">∈</span> <span class="var">?Roots</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> roots D <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span> 
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">from</span></span> card_1_singletonE<span class="main">[</span><span class="operator">OF</span> n<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> this<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Roots</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> x small <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sq r id <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">from</span></span> x <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Roots</span> <span class="main">=</span> insert <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span>real_of <span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> False<span class="main">[</span><span class="operator">unfolded</span> n<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">Z</span></span> <span class="keyword2"><span class="keyword">where</span></span> Z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span>real_of <span class="free">x</span><span class="main">}</span> <span class="main">=</span> insert <span class="skolem">z</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">-</span> <span class="main">{</span>real_of <span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> Y<span class="main">[</span><span class="operator">unfolded</span> Z<span class="main">]</span> Z <span class="keyword1"><span class="command">have</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>real_of <span class="free">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span> <span class="main">⊆</span> <span class="var">?Roots</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> real_of <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> roots choice D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of <span class="free">x</span> <span class="main">=</span> <span class="skolem">R</span> <span class="main">+</span> sqrt <span class="skolem">D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sq r id <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> last <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> id Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">show_rai_info</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> real_alg_show_info <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">show_rai_info</span> <span class="free"><span class="bound"><span class="entity">fl</span></span></span> <span class="main">(</span>Rat_Info <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> show <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">show_rai_info</span> <span class="free"><span class="bound"><span class="entity">fl</span></span></span> <span class="main">(</span>Sqrt_Info <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">sq</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">sqrt</span> <span class="main">=</span> <span class="inner_quoted">''sqrt(''</span> <span class="main">@</span> show <span class="main">(</span>abs <span class="free"><span class="bound"><span class="entity">sq</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="inner_quoted">'')''</span>
      <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">sq</span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="inner_quoted">'' -''</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span> <span class="main">@</span> <span class="bound">sqrt</span> 
                  <span class="keyword1">else</span> <span class="main">(</span><span class="inner_quoted">''(''</span> <span class="main">@</span> show <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">@</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">sq</span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="inner_quoted">''-''</span> <span class="keyword1">else</span> <span class="inner_quoted">''+''</span><span class="main">)</span> <span class="main">@</span> <span class="bound">sqrt</span> <span class="main">@</span> <span class="inner_quoted">'')''</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">show_rai_info</span> <span class="free"><span class="bound"><span class="entity">fl</span></span></span> <span class="main">(</span>Real_Alg_Info <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="inner_quoted">''(root #''</span> <span class="main">@</span> show <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">@</span> <span class="inner_quoted">'' of ''</span> <span class="main">@</span> show <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">@</span> <span class="inner_quoted">'', in (''</span> <span class="main">@</span> show <span class="free"><span class="bound"><span class="entity">fl</span></span></span> <span class="main">@</span> <span class="inner_quoted">'',''</span> <span class="main">@</span> show <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fl</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">@</span> <span class="inner_quoted">''))''</span>"</span></span> 
  
<span class="keyword1"><span class="command">overloading</span></span> show_real_alg <span class="main">≡</span> <span class="quoted">show_real_alg</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> show_real_alg<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"show_real_alg <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> show_rai_info <span class="main">(</span>floor <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>real_alg_show_info <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span> 
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Algebraic_Number_Tests">
<div class="head">
<h1>Theory Algebraic_Number_Tests</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
                 Akihisa Yamada
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Algebraic Number Tests›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We provide a sequence of examples which demonstrate what can be done with 
  the implementation of algebraic numbers.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Algebraic_Number_Tests
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../Jordan_Normal_Form/Char_Poly.html">Jordan_Normal_Form.Char_Poly</a>
  <a href="../Jordan_Normal_Form/Determinant_Impl.html">Jordan_Normal_Form.Determinant_Impl</a>
  <a href="../Show/Show_Complex.html">Show.Show_Complex</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Nat.html">HOL-Library.Code_Target_Nat</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Int.html">HOL-Library.Code_Target_Int</a>"</span>
  <a href="../Berlekamp_Zassenhaus/Factorize_Rat_Poly.html">Berlekamp_Zassenhaus.Factorize_Rat_Poly</a> 
  <a href="Real_Factorization.html">Real_Factorization</a>
  <a href="Show_Real_Precise.html">Show_Real_Precise</a>  
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Stand-Alone Examples›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">show_lines</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> shows_lines <span class="free"><span class="bound"><span class="entity">x</span></span></span> Nil"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">show_factorization</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>semiring_1<span class="main">,</span>show<span class="main">}</span> <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> poly <span class="main">×</span> nat<span class="main">)</span>list<span class="main">)</span> <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">show_factorization</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="main">[]</span><span class="main">)</span> <span class="main">=</span> show <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">show_factorization</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">show_factorization</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="inner_quoted">'' * (''</span> <span class="main">@</span> show <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">@</span> <span class="inner_quoted">'')''</span> <span class="main">@</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="inner_quoted">''^''</span> <span class="main">@</span> show <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">show_sf_factorization</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>semiring_1<span class="main">,</span>show<span class="main">}</span> <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> poly <span class="main">×</span> nat<span class="main">)</span>list<span class="main">)</span> <span class="main">⇒</span> string"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">show_sf_factorization</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> show_factorization <span class="main">(</span>map_prod id <span class="main">(</span>map <span class="main">(</span>map_prod id Suc<span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>
     "</span></span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Determine the roots over the rational, real, and complex numbers.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">testpoly</span> <span class="main">=</span> <span class="main">[:</span><span class="numeral">5</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="numeral">7</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">7</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="numeral">5</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="numeral">7</span><span class="main">/</span><span class="numeral">2</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">:]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">test</span> <span class="main">=</span> show_lines <span class="main">(</span>   real_roots_of_rat_poly testpoly<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"show_lines <span class="main">(</span>        roots_of_rat_poly testpoly<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"show_lines <span class="main">(</span>   real_roots_of_rat_poly testpoly<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"show_lines <span class="main">(</span>complex_roots_of_rat_poly testpoly<span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Factorize polynomials over the rational, real, and complex numbers.›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"show_sf_factorization <span class="main">(</span>factorize_rat_poly testpoly<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"show_factorization <span class="main">(</span>the <span class="main">(</span>factorize_real_poly testpoly<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"show_factorization <span class="main">(</span>the <span class="main">(</span>factorize_complex_poly testpoly<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If the input is not a rational polynomial, factorization can fail.›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"factorize_real_poly <span class="main">[:</span>sqrt <span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹fails\\›</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"factorize_real_poly <span class="main">[:</span>sqrt <span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹does not fail, reveals internal representation\\›</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"show <span class="main">(</span>factorize_real_poly <span class="main">[:</span>sqrt <span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹does not fail, pretty printed›</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A sequence of calculations.›</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"show <span class="main">(</span><span class="main">-</span> sqrt <span class="numeral">2</span> <span class="main">-</span> sqrt <span class="numeral">3</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"root <span class="numeral">3</span> <span class="numeral">4</span> <span class="main">&gt;</span> sqrt <span class="main">(</span>root <span class="numeral">4</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="main">⌊</span><span class="main">1</span><span class="main">/</span><span class="numeral">10</span> <span class="main">*</span> root <span class="numeral">3</span> <span class="numeral">7</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"csqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">∉</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"show <span class="main">(</span>csqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"show <span class="main">(</span>csqrt <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Example Application: Compute Norms of Eigenvalues›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For complexity analysis of some matrix $A$ it is important to compute the spectral
  radius of a matrix, i.e., the maximal norm of all complex eigenvalues, 
  since the spectral radius determines
  the growth rates of matrix-powers $A^n$, cf.~\cite{JNF-AFP} for a formalized statement
  of this fact.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eigenvalues</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rat mat <span class="main">⇒</span> complex list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eigenvalues</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> complex_roots_of_rat_poly <span class="main">(</span>char_poly <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">testmat</span> <span class="main">=</span> mat_of_rows_list <span class="numeral">3</span> <span class="main">[</span>
  <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">,</span>
  <span class="main">[</span><span class="main">1</span><span class="main">/</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">7</span><span class="main">,</span><span class="numeral">9</span><span class="main">]</span><span class="main">,</span>
  <span class="main">[</span><span class="numeral">7</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">5</span> <span class="main">::</span> rat<span class="main">]</span>
  <span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">spectral_radius_test</span> <span class="main">=</span> show <span class="main">(</span>Max <span class="main">(</span>set <span class="main">[</span> norm <span class="bound">ev</span><span class="main">.</span> ev <span class="main">←</span> eigenvalues testmat<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"char_poly testmat"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="main">[</span>code<span class="main">]</span> <span class="quoted">spectral_radius_test</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Algebraic_Numbers_External_Code">
<div class="head">
<h1>Theory Algebraic_Numbers_External_Code</h1>
</div>
<pre class="source"><span class="comment1">(*  
    Author:      René Thiemann 
    License:     BSD
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Explicit Constants for External Code›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Algebraic_Numbers_External_Code
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Algebraic_Number_Tests.html">Algebraic_Number_Tests</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define constants for most operations on real- and complex- algebraic numbers, so that
  they are easily accessible in target languages. In particular, we use target languages 
  integers, pairs of integers, strings, and integer lists, resp., 
  in order to represent the Isabelle types <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">int</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>/<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">nat</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">rat</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">string</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"int poly"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, resp.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">decompose_rat</span> <span class="main">=</span> map_prod integer_of_int integer_of_int <span class="keyword1">o</span> quotient_of"</span></span> 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Operations on Real Algebraic Numbers›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero_ra</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real_alg<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_ra</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real_alg<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">of_integer_ra</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="keyword1">o</span> int_of_integer <span class="main">::</span> integer <span class="main">⇒</span> real_alg<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">of_rational_ra</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">num</span><span class="main">,</span> <span class="bound">denom</span><span class="main">)</span><span class="main">.</span> of_rat_real_alg <span class="main">(</span>Rat.Fract <span class="main">(</span>int_of_integer <span class="bound">num</span><span class="main">)</span> <span class="main">(</span>int_of_integer <span class="bound">denom</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">::</span> integer <span class="main">×</span> integer <span class="main">⇒</span> real_alg<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">plus_ra</span> <span class="main">=</span> <span class="main">(</span><span class="main">(+)</span> <span class="main">::</span> real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> real_alg<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">minus_ra</span> <span class="main">=</span> <span class="main">(</span><span class="main">(-)</span> <span class="main">::</span> real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> real_alg<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">uminus_ra</span> <span class="main">=</span> <span class="main">(</span>uminus <span class="main">::</span> real_alg <span class="main">⇒</span> real_alg<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">times_ra</span> <span class="main">=</span> <span class="main">(</span><span class="main">(*)</span> <span class="main">::</span> real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> real_alg<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">divide_ra</span> <span class="main">=</span> <span class="main">(</span><span class="main">(/)</span> <span class="main">::</span> real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> real_alg<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">inverse_ra</span> <span class="main">=</span> <span class="main">(</span>inverse <span class="main">::</span> real_alg <span class="main">⇒</span> real_alg<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">abs_ra</span> <span class="main">=</span> <span class="main">(</span>abs <span class="main">::</span> real_alg <span class="main">⇒</span> real_alg<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">floor_ra</span> <span class="main">=</span> <span class="main">(</span>integer_of_int <span class="keyword1">o</span> floor <span class="main">::</span> real_alg <span class="main">⇒</span> integer<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ceiling_ra</span> <span class="main">=</span> <span class="main">(</span>integer_of_int <span class="keyword1">o</span> ceiling <span class="main">::</span> real_alg <span class="main">⇒</span> integer<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">minimum_ra</span> <span class="main">=</span> <span class="main">(</span>min <span class="main">::</span> real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> real_alg<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">maximum_ra</span> <span class="main">=</span> <span class="main">(</span>max <span class="main">::</span> real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> real_alg<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">equals_ra</span> <span class="main">=</span> <span class="main">(</span><span class="main">(=)</span> <span class="main">::</span> real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> bool<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_ra</span> <span class="main">=</span> <span class="main">(</span><span class="main">(&lt;)</span> <span class="main">::</span> real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> bool<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_equal_ra</span> <span class="main">=</span> <span class="main">(</span><span class="main">(≤)</span> <span class="main">::</span> real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> bool<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">compare_ra</span> <span class="main">=</span> <span class="main">(</span>compare <span class="main">::</span> real_alg <span class="main">⇒</span> real_alg <span class="main">⇒</span> order<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">roots_of_poly_ra</span> <span class="main">=</span> <span class="main">(</span>roots_of_real_alg <span class="keyword1">o</span> poly_of_list <span class="keyword1">o</span> map int_of_integer <span class="main">::</span> integer list <span class="main">⇒</span> real_alg list<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">root_ra</span> <span class="main">=</span> <span class="main">(</span>root_real_alg <span class="keyword1">o</span> nat_of_integer <span class="main">::</span> integer <span class="main">⇒</span> real_alg <span class="main">⇒</span> real_alg<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">show_ra</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>String.implode <span class="keyword1">o</span> show<span class="main">)</span> <span class="main">::</span> real_alg <span class="main">⇒</span> String.literal<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_rational_ra</span> <span class="main">=</span> <span class="main">(</span>is_rat_real_alg <span class="main">::</span> real_alg <span class="main">⇒</span> bool<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">to_rational_ra</span> <span class="main">=</span> <span class="main">(</span>decompose_rat <span class="keyword1">o</span> to_rat_real_alg <span class="main">::</span> real_alg <span class="main">⇒</span> integer <span class="main">×</span> integer<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">sign_ra</span> <span class="main">=</span> <span class="main">(</span>fst <span class="keyword1">o</span> to_rational_ra <span class="keyword1">o</span> sgn <span class="main">::</span> real_alg <span class="main">⇒</span> integer<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">decompose_ra</span> <span class="main">=</span> <span class="main">(</span>map_sum decompose_rat <span class="main">(</span>map_prod <span class="main">(</span>map integer_of_int <span class="keyword1">o</span> coeffs<span class="main">)</span> integer_of_nat<span class="main">)</span> <span class="keyword1">o</span> info_real_alg
  <span class="main">::</span> real_alg <span class="main">⇒</span> integer <span class="main">×</span> integer <span class="main">+</span> integer list <span class="main">×</span> integer<span class="main">)</span>"</span></span> 


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Operations on Complex Algebraic Numbers›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero_ca</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_ca</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">imag_unit_ca</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">of_integer_ca</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="keyword1">o</span> int_of_integer <span class="main">::</span> integer <span class="main">⇒</span> complex<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">of_rational_ca</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">num</span><span class="main">,</span> <span class="bound">denom</span><span class="main">)</span><span class="main">.</span> of_rat <span class="main">(</span>Rat.Fract <span class="main">(</span>int_of_integer <span class="bound">num</span><span class="main">)</span> <span class="main">(</span>int_of_integer <span class="bound">denom</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">::</span> integer <span class="main">×</span> integer <span class="main">⇒</span> complex<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">of_real_imag_ca</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">real</span><span class="main">,</span> <span class="bound">imag</span><span class="main">)</span><span class="main">.</span> Complex <span class="main">(</span>real_of <span class="bound">real</span><span class="main">)</span> <span class="main">(</span>real_of <span class="bound">imag</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> real_alg <span class="main">×</span> real_alg <span class="main">⇒</span> complex<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">plus_ca</span> <span class="main">=</span> <span class="main">(</span><span class="main">(+)</span> <span class="main">::</span> complex <span class="main">⇒</span> complex <span class="main">⇒</span> complex<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">minus_ca</span> <span class="main">=</span> <span class="main">(</span><span class="main">(-)</span> <span class="main">::</span> complex <span class="main">⇒</span> complex <span class="main">⇒</span> complex<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">uminus_ca</span> <span class="main">=</span> <span class="main">(</span>uminus <span class="main">::</span> complex <span class="main">⇒</span> complex<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">times_ca</span> <span class="main">=</span> <span class="main">(</span><span class="main">(*)</span> <span class="main">::</span> complex <span class="main">⇒</span> complex <span class="main">⇒</span> complex<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">divide_ca</span> <span class="main">=</span> <span class="main">(</span><span class="main">(/)</span> <span class="main">::</span> complex <span class="main">⇒</span> complex <span class="main">⇒</span> complex<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">inverse_ca</span> <span class="main">=</span> <span class="main">(</span>inverse <span class="main">::</span> complex <span class="main">⇒</span> complex<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">equals_ca</span> <span class="main">=</span> <span class="main">(</span><span class="main">(=)</span> <span class="main">::</span> complex <span class="main">⇒</span> complex <span class="main">⇒</span> bool<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">roots_of_poly_ca</span> <span class="main">=</span> <span class="main">(</span>complex_roots_of_int_poly <span class="keyword1">o</span> poly_of_list <span class="keyword1">o</span> map int_of_integer <span class="main">::</span> integer list <span class="main">⇒</span> complex list<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">csqrt_ca</span> <span class="main">=</span> <span class="main">(</span>csqrt <span class="main">::</span> complex <span class="main">⇒</span> complex<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">show_ca</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>String.implode <span class="keyword1">o</span> show<span class="main">)</span> <span class="main">::</span> complex <span class="main">⇒</span> String.literal<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">real_of_ca</span> <span class="main">=</span> <span class="main">(</span>real_alg_of_real <span class="keyword1">o</span> Re <span class="main">::</span> complex <span class="main">⇒</span> real_alg<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">imag_of_ca</span> <span class="main">=</span> <span class="main">(</span>real_alg_of_real <span class="keyword1">o</span> Im <span class="main">::</span> complex <span class="main">⇒</span> real_alg<span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Export Constants in Haskell›</span></span>

<span class="keyword1"><span class="command">export_code</span></span> 
  <span class="comment1">(* preliminary operations *)</span>
  <span class="quoted"><span class="quoted">order.Eq</span></span> <span class="quoted"><span class="quoted">order.Lt</span></span> <span class="quoted"><span class="quoted">order.Gt</span></span> <span class="comment1">― ‹for comparison›</span>
  <span class="quoted"><span class="quoted">Inl</span></span> <span class="quoted"><span class="quoted">Inr</span></span> <span class="comment1">― ‹make disjoint sums available for decomposition information›</span>

  <span class="comment1">(* real algebraic operations *)</span>
  <span class="quoted"><span class="quoted">zero_ra</span></span>
  <span class="quoted"><span class="quoted">one_ra</span></span>
  <span class="quoted"><span class="quoted">of_integer_ra</span></span>
  <span class="quoted"><span class="quoted">of_rational_ra</span></span>
  <span class="quoted"><span class="quoted">plus_ra</span></span>
  <span class="quoted"><span class="quoted">minus_ra</span></span>
  <span class="quoted"><span class="quoted">uminus_ra</span></span>
  <span class="quoted"><span class="quoted">times_ra</span></span>
  <span class="quoted"><span class="quoted">divide_ra</span></span>
  <span class="quoted"><span class="quoted">inverse_ra</span></span>
  <span class="quoted"><span class="quoted">abs_ra</span></span>
  <span class="quoted"><span class="quoted">floor_ra</span></span>
  <span class="quoted"><span class="quoted">ceiling_ra</span></span>
  <span class="quoted"><span class="quoted">minimum_ra</span></span>
  <span class="quoted"><span class="quoted">maximum_ra</span></span>
  <span class="quoted"><span class="quoted">equals_ra</span></span>
  <span class="quoted"><span class="quoted">less_ra</span></span>
  <span class="quoted"><span class="quoted">less_equal_ra</span></span>
  <span class="quoted"><span class="quoted">compare_ra</span></span>  
  <span class="quoted"><span class="quoted">roots_of_poly_ra</span></span>
  <span class="quoted"><span class="quoted">root_ra</span></span>
  <span class="quoted"><span class="quoted">show_ra</span></span>
  <span class="quoted"><span class="quoted">is_rational_ra</span></span>
  <span class="quoted"><span class="quoted">to_rational_ra</span></span>
  <span class="quoted"><span class="quoted">sign_ra</span></span>
  <span class="quoted"><span class="quoted">decompose_ra</span></span>

  <span class="comment1">(* complex algebraic operations *)</span>
  <span class="quoted"><span class="quoted">zero_ca</span></span>
  <span class="quoted"><span class="quoted">one_ca</span></span>
  <span class="quoted"><span class="quoted">imag_unit_ca</span></span>
  <span class="quoted"><span class="quoted">of_integer_ca</span></span>
  <span class="quoted"><span class="quoted">of_rational_ca</span></span>
  <span class="quoted"><span class="quoted">of_real_imag_ca</span></span>
  <span class="quoted"><span class="quoted">plus_ca</span></span>
  <span class="quoted"><span class="quoted">minus_ca</span></span>
  <span class="quoted"><span class="quoted">uminus_ca</span></span>
  <span class="quoted"><span class="quoted">times_ca</span></span>
  <span class="quoted"><span class="quoted">divide_ca</span></span>
  <span class="quoted"><span class="quoted">inverse_ca</span></span>
  <span class="quoted"><span class="quoted">equals_ca</span></span>
  <span class="quoted"><span class="quoted">roots_of_poly_ca</span></span>
  <span class="quoted"><span class="quoted">csqrt_ca</span></span>
  <span class="quoted"><span class="quoted">show_ca</span></span>
  <span class="quoted"><span class="quoted">real_of_ca</span></span>
  <span class="quoted"><span class="quoted">imag_of_ca</span></span>
  
<span class="keyword2"><span class="keyword">in</span></span> Haskell <span class="keyword2"><span class="keyword">module_name</span></span> Algebraic_Numbers <span class="comment1">(* file ‹~/Code/Algebraic_Numbers› *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>