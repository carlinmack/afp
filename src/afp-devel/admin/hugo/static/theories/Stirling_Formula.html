<div id="Stirling_Formula">
<div class="head">
<h1>Theory Stirling_Formula</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Stirling_Formula.thy
  Author:  Manuel Eberl

  A proof of Stirling's formula, i.e. an asymptotic approximation of
  the Gamma function and the factorial.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Stirling's Formula›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Stirling_Formula
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Analysis/Analysis.html">HOL-Analysis.Analysis</a>"</span>
  <span class="quoted">"<a href="../Landau_Symbols/Landau_More.html">Landau_Symbols.Landau_More</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  First, we define the $S_n^*$ from Jameson's article:
›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">S'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">S'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>of_nat <span class="bound">r</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, the trapezium (also called $T$ in Jameson's article):
›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Now we define The difference $\Delta(x)$:
›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> T <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> ln <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> ln <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> S'_telescope_trapezium<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"S' <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> T <span class="main">(</span>of_nat <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> T <span class="main">(</span>of_nat <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span>Suc <span class="skolem">m</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">r</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>Suc <span class="bound">r</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_def sum.distrib <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span>Suc <span class="skolem">m</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">r</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>Suc <span class="bound">r</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?a</span> <span class="main">+</span> <span class="var">?S</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.lessThan_Suc_shift<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>Suc <span class="bound">r</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="var">?S</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span>real <span class="skolem">m</span> <span class="main">+</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">+</span> <span class="var">?b</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">+</span> <span class="var">?S</span> <span class="main">+</span> <span class="main">(</span><span class="var">?S</span> <span class="main">+</span> <span class="var">?b</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="var">?S</span> <span class="main">+</span> <span class="var">?a</span> <span class="main">+</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="var">?S</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">r</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> sum_distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">r</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">=</span>Suc <span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.atLeast_Suc_lessThan_Suc_shift<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">+</span> <span class="var">?a</span> <span class="main">+</span> <span class="var">?b</span> <span class="main">=</span> S' <span class="free">n</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S'_def Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> stirling_trapezium<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"D <span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">..</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> y_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"D <span class="free">x</span> <span class="main">=</span> T <span class="free">x</span> <span class="main">-</span> ln <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_div<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"D <span class="free">x</span> <span class="main">=</span> T <span class="free">x</span> <span class="main">-</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> geometric_sums sums_mult<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">^</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y_def <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">^</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> geometric_sums sums_mult<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">^</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y_def <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">^</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> sums_diff<span class="main">[</span><span class="operator">OF</span> * **<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> sum1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">^</span> Suc <span class="bound">n</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">^</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> T <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> sums_diff<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> ln_series'<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span>ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> ln <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_div<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> y_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">y</span><span class="main">^</span><span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> sum2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">y</span><span class="main">^</span>Suc <span class="bound">n</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span>Suc <span class="bound">n</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sums_Suc_iff<span class="main">)</span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> T <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sums_le <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ sum2 sum1<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span><span class="main">^</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even <span class="skolem">n</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">/</span> <span class="skolem">B</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">/</span> <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">^</span> Suc <span class="skolem">n</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span> <span class="skolem">B</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> y <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"D <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> even <span class="bound">n</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> sums_diff<span class="main">[</span><span class="operator">OF</span> sum1 sum2<span class="main">]</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">^</span> Suc <span class="bound">n</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">^</span> Suc <span class="bound">n</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">^</span> Suc <span class="bound">n</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> 
                   <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">^</span> Suc <span class="bound">n</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">n</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">^</span> Suc <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> sum3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">n</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">^</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> D <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D<span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="skolem">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_mult geometric_deriv_sums<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="skolem">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">4</span><span class="main">*</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y_def <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="skolem">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_mult geometric_deriv_sums<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="skolem">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> power_mult_distrib <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> even <span class="bound">n</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="main">*</span> real <span class="bound">n</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> sums_diff<span class="main">[</span><span class="operator">OF</span> * **<span class="main">]</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">^</span><span class="main">(</span>Suc <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">d</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">^</span> Suc <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">d</span> <span class="bound">n</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">^</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sums_Suc_iff<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sums_mult<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">3</span>"</span></span><span class="main">]</span> x
    <span class="keyword1"><span class="command">have</span></span> sum4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">d</span> <span class="bound">n</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">^</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"D <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sums_le <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ sum3 sum4<span class="main"><span class="main">]</span></span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> odd <span class="bound">n</span> <span class="main">∨</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="numeral">4</span><span class="main">/</span><span class="numeral">3</span> <span class="keyword1">else</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">n</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">^</span> Suc <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">d</span> <span class="skolem">n</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">^</span> Suc <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">c'</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def c'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">d</span> <span class="skolem">n</span> <span class="main">/</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c'_def d_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">d</span> <span class="skolem">n</span> <span class="main">/</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> y<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹D <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following functions correspond to the $p_n(x)$ from the article.
  The special case $n = 0$ would not, strictly speaking, be necessary, but 
  it allows some theorems to work even without the precondition $n \neq 0$:
›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> D <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can write the Digamma function in terms of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">S'</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:
›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> S'_LIMSEQ_Digamma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> S' <span class="bound">n</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> Digamma <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">x</span> <span class="main">+</span> real <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> S' <span class="bound">n</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> S' <span class="skolem">n</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
            <span class="main">-</span><span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> inverse <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">.</span> inverse <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S'_def c_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">.</span> inverse <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">.</span> inverse <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lessThan_atLeast0 <span class="keyword1"><span class="command">using</span></span> n 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sum.atLeast_Suc_lessThan<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> real <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> S' <span class="skolem">n</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_tendsto_divide_at_top tendsto_const filterlim_tendsto_pos_mult_at_top
          filterlim_tendsto_add_at_top filterlim_real_sequentially <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> S' <span class="bound">n</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Lim_transform_eventually<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> tendsto_minus<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> S' <span class="bound">n</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">c</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Digamma_LIMSEQ<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">⇢</span> Digamma <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> S' <span class="bound">n</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> Digamma <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform <span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Moreover, we can give an expansion of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">S'</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">p</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> as variation terms.
›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> S'_approx<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"S' <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> ln <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="free">x</span> <span class="main">+</span> p <span class="free">n</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_def S'_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"S' <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> T <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> S'_telescope_trapezium<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> D <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> ln <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">r</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> p <span class="free">n</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.distrib add_ac p_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> ln <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">r</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ln <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_lessThan_telescope<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define the limit of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">p</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (simply called $p(x)$ in Jameson's article):
›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> D <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> D_summable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> D <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> real <span class="bound">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> telescope_summable' real_tendsto_divide_at_top tendsto_const 
             filterlim_tendsto_pos_mult_at_top filterlim_pow_at_top
             filterlim_tendsto_add_at_top filterlim_real_sequentially <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> D <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> summable_comparison_test<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ *<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>D <span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> real <span class="skolem">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> stirling_trapezium<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real <span class="skolem">n</span> <span class="main">+</span> <span class="free">x</span>"</span></span><span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> p_LIMSEQ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> p <span class="bound">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">⇢</span> P <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_transform_eventually<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> D_summable<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> D <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> P <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> D <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> P <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sums_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> D <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> p <span class="bound">n</span> <span class="free">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This gives us an expansion of the Digamma function:
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Digamma_approx<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Digamma <span class="free">x</span> <span class="main">=</span> ln <span class="free">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">-</span> P <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>inverse <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> ln <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">-</span> p <span class="bound">n</span> <span class="free">x</span> <span class="main">=</span>
          ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> S' <span class="bound">n</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>nat"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> S' <span class="skolem">n</span> <span class="free">x</span> <span class="main">=</span> ln <span class="main">(</span><span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> ln <span class="free">x</span> <span class="main">-</span> p <span class="skolem">n</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms n <span class="keyword1"><span class="command">unfolding</span></span> S'_approx <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_div<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">n</span> <span class="main">/</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">/</span> real <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>inverse <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">/</span> real <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> ln <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">-</span> p <span class="skolem">n</span> <span class="free">x</span> <span class="main">=</span> 
                    ln <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> S' <span class="skolem">n</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>inverse <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> ln <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">-</span> p <span class="bound">n</span> <span class="free">x</span><span class="main">)</span> 
                   <span class="main">⇢</span> ln <span class="main">(</span>inverse <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> ln <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">-</span> P <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> p_LIMSEQ x real_tendsto_divide_at_top 
          filterlim_real_sequentially <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>inverse <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">x</span> <span class="main">/</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> ln <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">-</span> p <span class="bound">n</span> <span class="free">x</span><span class="main">)</span> 
             <span class="main">⇢</span> ln <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">-</span> P <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> S' <span class="bound">n</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> ln <span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">-</span> P <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Lim_transform_eventually<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> S' <span class="bound">n</span> <span class="free">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> Digamma <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> S'_LIMSEQ_Digamma<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Digamma <span class="free">x</span> <span class="main">=</span> ln <span class="free">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">-</span> P <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_unique <span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we derive some bounds on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"P"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:
›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> p_ge_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> p <span class="free">n</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> stirling_trapezium<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real <span class="skolem">n</span> <span class="main">+</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">n</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_nonneg<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> P_ge_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> P <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_lowerbound<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p_LIMSEQ<span class="main"><span class="main">]</span></span><span class="main">)</span> 
     <span class="main">(</span><span class="operator">insert</span> p_ge_0<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> p_upper_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"p <span class="free">n</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"p <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> D <span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="main">(</span>real <span class="bound">r</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">r</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stirling_trapezium<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real <span class="skolem">r</span> <span class="main">+</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">r</span><span class="main">]</span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_lessThan_telescope'<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> P_upper_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"P <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_upperbound<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> p <span class="bound">n</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> p_upper_bound<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> p <span class="bound">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">⇢</span> P <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms p_LIMSEQ<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now use this approximation of the Digamma function to approximate
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ln_Gamma</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (since the former is the derivative of the latter). 
  We therefore define the function $g$ from Jameson's article, which measures 
  the difference between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ln_Gamma</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and its approximation:
›</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> ln_Gamma <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> DERIV_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span>g <span class="keyword1">has_field_derivative</span> <span class="main">-</span>P <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> Digamma_approx<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> isCont_P<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"isCont P <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> DERIV_D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>D <span class="keyword1">has_field_derivative</span> <span class="skolem">D'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">unfolding</span></span> D_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> D'_def T_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> that<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main"><span class="keyword3">,</span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> this <span class="main">[</span><span class="operator">THEN</span> DERIV_chain2<span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>P <span class="keyword1">has_field_derivative</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">D'</span> <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> has_field_derivative_series'<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"convex <span class="main">{</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">&lt;..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> D <span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> <span class="skolem">D'</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">y</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">&lt;..}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms D_summable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> D <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"uniformly_convergent_on <span class="main">{</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">&lt;..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">D'</span> <span class="main">(</span>real <span class="bound">i</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Weierstrass_m_test'<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">real</span>
      <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">&lt;..}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">D'</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> real <span class="skolem">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D'_def add_ac<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> y assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono divide_left_mono power_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> inverse <span class="main">(</span><span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">D'</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span><span class="main">(</span>real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span><span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> summable_Suc_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> summable_mult inverse_power_summable<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interior_open<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_isCont<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> P_continuous_on <span class="main">[</span><span class="operator">THEN</span> continuous_on_subset<span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> P"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_at_imp_continuous_on ballI isCont_P<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> P_integrable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"P <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span>real <span class="bound">n</span><span class="main">}</span> <span class="keyword1">then</span> P <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"P <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dominated_convergence<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"P <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_continuous_real P_continuous_on<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">n</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span>real <span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integrable_eq<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">n</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integrable_on_superset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">f</span> <span class="skolem">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> of_real <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">12</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> a P_ge_0 P_upper_bound <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> of_real <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">12</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">a</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_integral_inverse_power_to_inf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> a
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_on_cmult_left<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> P <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">..}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">x</span><span class="main">)</span> at_top"</span></span>
        <span class="keyword1"><span class="command">using</span></span> filterlim_real_sequentially <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="skolem">x</span> <span class="main">=</span> P <span class="skolem">x</span><span class="main">)</span> at_top"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> P <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_eventually<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">c</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> integral <span class="main">{</span><span class="main">1</span><span class="main">..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>P <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> g <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now give bounds on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">g</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:
›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> g_bounds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"g <span class="free">x</span> <span class="main">∈</span> <span class="main">{</span>c<span class="main">..</span>c <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> int_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="free">x</span><span class="main">..}</span> P <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Henstock_Kurzweil_Integration.integral_nonneg P_integrable<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_ge_0<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> int_upper_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="free">x</span><span class="main">..}</span> P <span class="main">≤</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_le<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>P <span class="keyword1">has_integral</span> integral <span class="main">{</span><span class="free">x</span><span class="main">..}</span> P<span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">..}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_integral P_integrable<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> x has_integral_mult_right<span class="main">[</span><span class="operator">OF</span> has_integral_inverse_power_to_inf<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">12</span>"</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> P_upper_bound x<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

  <span class="keyword1"><span class="command">note</span></span> DERIV_g <span class="main">[</span><span class="operator">THEN</span> DERIV_chain2<span class="main">,</span> <span class="operator">derivative_intros</span><span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> int1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>P <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span>g <span class="free">x</span> <span class="main">-</span> g <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fundamental_theorem_of_calculus<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
             <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> int2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>P <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_integral</span> integral <span class="main">{</span><span class="free">x</span><span class="main">..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>P <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_integral integrable_neg P_integrable<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> has_integral_Un<span class="main">[</span><span class="operator">OF</span> int1 int2<span class="main">]</span> x
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> P <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_integral</span> g <span class="free">x</span> <span class="main">-</span> g <span class="main">1</span> <span class="main">-</span> integral <span class="main">{</span><span class="free">x</span><span class="main">..}</span> P<span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">x</span><span class="main">..}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">x</span><span class="main">..}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>P <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_integral</span> g <span class="free">x</span> <span class="main">-</span> g <span class="main">1</span> <span class="main">-</span> integral <span class="main">{</span><span class="free">x</span><span class="main">..}</span> P<span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>P <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_integral</span> integral <span class="main">{</span><span class="main">1</span><span class="main">..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>P <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_integral integrable_neg P_integrable<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"g <span class="free">x</span> <span class="main">-</span> g <span class="main">1</span> <span class="main">-</span> integral <span class="main">{</span><span class="free">x</span><span class="main">..}</span> P <span class="main">=</span> integral <span class="main">{</span><span class="main">1</span><span class="main">..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>P <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"g <span class="free">x</span> <span class="main">=</span> c <span class="main">+</span> integral <span class="main">{</span><span class="free">x</span><span class="main">..}</span> P"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> int_upper_bound int_nonneg <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"g <span class="free">x</span> <span class="main">∈</span> <span class="main">{</span>c<span class="main">..</span>c <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Finally, we have bounds on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ln_Gamma</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Gamma</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">fact</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> ln_Gamma_bounds_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> ln_Gamma <span class="free">x</span> <span class="main">≥</span> c <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">x</span> <span class="main">-</span> <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟹</span> ln_Gamma <span class="free">x</span> <span class="main">≤</span> c <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">x</span> <span class="main">-</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> g_bounds<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> Gamma_bounds_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Gamma <span class="free">x</span> <span class="main">≥</span> exp c <span class="main">*</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="free">x</span>"</span></span>
          <span class="quoted"><span class="quoted">"Gamma <span class="free">x</span> <span class="main">≤</span> exp c <span class="main">*</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="free">x</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span>ln_Gamma <span class="free">x</span><span class="main">)</span> <span class="main">≥</span> exp <span class="main">(</span>c <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">x</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> exp_le_cancel_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ln_Gamma_bounds_aux<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="free">x</span> <span class="main">≥</span> exp c <span class="main">*</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gamma_real_pos_exp exp_add exp_diff powr_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> exp_le_cancel_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span>ln_Gamma <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> exp <span class="main">(</span>c <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">x</span> <span class="main">-</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> exp_le_cancel_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ln_Gamma_bounds_aux<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="free">x</span> <span class="main">≤</span> exp c <span class="main">*</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="free">x</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gamma_real_pos_exp exp_add exp_diff powr_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> exp_le_cancel_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> Gamma_asymp_equiv_aux<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"Gamma <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp c <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_sandwich<span class="main">)</span>
  <span class="keyword1"><span class="command">include</span></span> asymp_equiv_notation
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp c <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">x</span> <span class="main">≤</span> Gamma <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
       <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp c <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">x</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> Gamma <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">eventually_elim</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> Gamma_bounds_aux <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> exp <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> exp <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> real_tendsto_divide_at_top filterlim_tendsto_pos_mult_at_top<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_ident<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equivI'<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp c <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">x</span> <span class="main">*</span> <span class="main">1</span><span class="main">)</span> <span class="main">∼</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp c <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">x</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equiv_mult asymp_equiv_refl<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asymp_equiv_sym<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp c <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">x</span><span class="main">)</span> <span class="main">∼</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp c <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">x</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> exp_1_powr_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="keyword1">powr</span> <span class="free">x</span> <span class="main">=</span> exp <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> fact_asymp_equiv_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fact <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp c <span class="main">*</span> sqrt <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">x</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> real <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">include</span></span> asymp_equiv_notation
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fact <span class="main">∼</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Gamma <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gamma_fact<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Gamma <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> real <span class="bound">n</span> <span class="main">*</span> Gamma <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> Gamma_plus1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"real <span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
                        <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac of_nat_in_nonpos_Ints_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Gamma <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∼</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> exp c <span class="main">*</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_compose'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Gamma_asymp_equiv_aux<span class="main"><span class="main">]</span></span> filterlim_real_sequentially<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span>exp c <span class="main">*</span> real <span class="bound">n</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               exp c <span class="main">*</span> sqrt <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> real <span class="bound">n</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span>exp c <span class="main">*</span> real <span class="skolem">n</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            exp c <span class="main">*</span> sqrt <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> real <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_diff<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_divide powr_half_sqrt <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asymp_equiv_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We still need to determine the constant term <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">c</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, which we do using Wallis' 
  product formula: $$\prod_{n=1}^\infty \frac{4n^2}{4n^2-1} = \frac{\pi}{2}$$
›</span></span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> powr_mult_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> powr_powr <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_numeral<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> exp_mult_2<span class="main">:</span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> exp <span class="free">y</span> <span class="main">*</span> exp <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> exp_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> exp_c<span class="main">:</span> <span class="quoted"><span class="quoted">"exp c <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">include</span></span> asymp_equiv_notation
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∏</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">4</span><span class="main">*</span>real <span class="bound">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">4</span><span class="main">*</span>real <span class="bound">k</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> p_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> p_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.nat_ivl_Suc'<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">16</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> fact <span class="bound">n</span> <span class="main">^</span> <span class="numeral">4</span> <span class="main">/</span> <span class="main">(</span>fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>real <span class="bound">k</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>real <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>real <span class="bound">k</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>real <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_dividef prod.distrib add_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">=</span>Suc <span class="main">1</span><span class="main">..</span>Suc <span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.atLeast_Suc_atMost_Suc_shift<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.nat_ivl_Suc'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">…</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">∏</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> power2_eq_square <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.distrib prod_dividef<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">∏</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span><span class="main">)</span><span class="main">^</span><span class="numeral">4</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span>real <span class="bound">k</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square eval_nat_numeral<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">16</span><span class="main">^</span><span class="skolem">n</span> <span class="main">*</span> fact <span class="skolem">n</span><span class="main">^</span><span class="numeral">4</span> <span class="main">/</span> <span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>real <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.distrib prod_dividef fact_prod
            prod_power_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> prod_constant<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>real <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>real <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fact <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> prod.nat_ivl_Suc'<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="skolem">n</span> <span class="main">=</span> <span class="numeral">16</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> fact <span class="skolem">n</span> <span class="main">^</span> <span class="numeral">4</span> <span class="main">/</span> <span class="main">(</span>fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∼</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">16</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> fact <span class="bound">n</span> <span class="main">^</span> <span class="numeral">4</span> <span class="main">/</span> <span class="main">(</span>fact <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">16</span><span class="main">^</span><span class="bound">n</span> <span class="main">*</span> <span class="main">(</span>exp c <span class="main">*</span> sqrt <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> real <span class="bound">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">4</span> <span class="main">/</span>
                       <span class="main">(</span>exp c <span class="main">*</span> sqrt <span class="main">(</span>real <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">n</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> real <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span>
                       <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> real <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∼</span> <span class="var">?f</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> asymp_equiv_mult asymp_equiv_divide asymp_equiv_refl mult_nat_left_at_top
              fact_asymp_equiv_aux asymp_equiv_power asymp_equiv_compose'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fact_asymp_equiv_aux<span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">…</span> <span class="bound">n</span> <span class="main">=</span> exp c <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">16</span><span class="main">^</span><span class="skolem">n</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">^</span><span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">4</span><span class="main">^</span><span class="skolem">n</span> <span class="main">::</span> real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">n</span> <span class="main">=</span> exp c <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib <span class="dynamic"><span class="dynamic">divide_simps</span></span> powr_mult real_sqrt_power_even<span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square eval_nat_numeral powr_mult_2 
                    exp_mult_2 powr_realpow<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> exp c <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">/</span><span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">4</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">/</span> real <span class="bound">x</span><span class="main">)</span> <span class="main">∼</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> asymp_equiv_add_right<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">⇢</span> exp c <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equivD_const<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> asymp_equiv_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">⇢</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wallis<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp c <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">=</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> pi <span class="main">=</span> exp c <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span>exp c <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> exp c"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"exp c <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"c <span class="main">=</span> ln <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> exp_c <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>exp c<span class="main">)</span> <span class="main">=</span> c"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_sqrt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This gives us the final bounds:
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Gamma_bounds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Gamma <span class="free">x</span> <span class="main">≥</span> sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">/</span><span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">x</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span><span class="main">)</span>
          <span class="quoted"><span class="quoted">"Gamma <span class="free">x</span> <span class="main">≤</span> sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">/</span><span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">x</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp c <span class="main">*</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="free">x</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">/</span><span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_diff<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_c real_sqrt_divide powr_divide powr_half_sqrt <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Gamma_bounds_aux<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ln_Gamma_bounds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ln_Gamma <span class="free">x</span> <span class="main">≥</span> ln <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">/</span><span class="free">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> ln <span class="free">x</span> <span class="main">-</span> <span class="free">x</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span><span class="main">)</span>
          <span class="quoted"><span class="quoted">"ln_Gamma <span class="free">x</span> <span class="main">≤</span> ln <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">/</span><span class="free">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> ln <span class="free">x</span> <span class="main">-</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span><span class="free">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ln_Gamma_bounds_aux<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c <span class="dynamic"><span class="dynamic">field_simps</span></span> ln_div<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp c <span class="main">*</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="free">x</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">/</span><span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_diff<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_c real_sqrt_divide powr_divide powr_half_sqrt <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> fact_bounds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>fact <span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≥</span> sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span><span class="main">)</span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span>fact <span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≤</span> sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms Gamma_plus1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real <span class="free">n</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">*</span> Gamma <span class="main">(</span>real <span class="free">n</span><span class="main">)</span> <span class="main">=</span> Gamma <span class="main">(</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_in_nonpos_Ints_iff add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="main">(</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fact <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Gamma_fact <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"fact <span class="free">n</span> <span class="main">=</span> real <span class="free">n</span> <span class="main">*</span> Gamma <span class="main">(</span>real <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>pi<span class="main">/</span><span class="free">n</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="free">n</span> <span class="main">/</span> <span class="free">n</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">…</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">/</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> real_sqrt_divide<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">/</span>real <span class="free">n</span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span>real <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">note</span></span> *
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> Gamma_bounds<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> n<span class="main">]</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">/</span> real <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> real <span class="free">n</span> <span class="main">*</span> 
                  exp <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> real <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span>real <span class="free">n</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">/</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">n</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">12</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="free">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> real <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_realpow<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> **
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">n</span> <span class="main">=</span> <span class="free">n</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">/</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ** <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> real <span class="free">n</span> <span class="main">*</span> Gamma <span class="main">(</span>real <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono Gamma_bounds<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="free">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> real <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_realpow<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ln_fact_bounds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ln <span class="main">(</span>fact <span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≥</span> ln <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="free">n</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> ln <span class="free">n</span> <span class="main">-</span> <span class="free">n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span><span class="main">)</span>
          <span class="quoted"><span class="quoted">"ln <span class="main">(</span>fact <span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≤</span> ln <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="free">n</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> ln <span class="free">n</span> <span class="main">-</span> <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span>real <span class="free">n</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>fact <span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≥</span> ln <span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span>real <span class="free">n</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>real <span class="free">n</span><span class="main">/</span>exp <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fact_bounds<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span>real <span class="free">n</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>real <span class="free">n</span><span class="main">/</span>exp <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> ln <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="free">n</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> ln <span class="free">n</span> <span class="main">-</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_mult ln_div ln_realpow ln_sqrt <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>fact <span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≤</span> ln <span class="main">(</span>sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span>real <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="free">n</span><span class="main">/</span>exp <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> exp <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span>real <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fact_bounds<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ln <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="free">n</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> ln <span class="free">n</span> <span class="main">-</span> <span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">12</span><span class="main">*</span>real <span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_mult ln_div ln_realpow ln_sqrt <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Gamma_asymp_equiv<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"Gamma <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">/</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> Gamma_asymp_equiv_aux
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp c <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">x</span> <span class="main">=</span> 
               sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">/</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"exp c <span class="main">*</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="skolem">x</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">/</span><span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_diff<span class="main">)</span> 
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_c powr_half_sqrt powr_divide <span class="dynamic"><span class="dynamic">field_simps</span></span> real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> fact_asymp_equiv<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"fact <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sqrt <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">*</span><span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> fact_asymp_equiv_aux
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> exp c <span class="main">*</span> sqrt <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_c real_sqrt_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">(</span><span class="bound">n</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_realpow<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Gamma_Asymptotics">
<div class="head">
<h1>Theory Gamma_Asymptotics</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Gamma_Asymptotics.thy
  Author:  Manuel Eberl

  The complete asymptotics of the real and complex logarithmic Gamma functions.
  Also of the real Polygamma functions (could be extended to the complex ones fairly easily
  if needed).
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Complete asymptotics of the logarithmic Gamma function›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Gamma_Asymptotics
<span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="../../HOL/HOL-Complex_Analysis/Complex_Analysis.html">HOL-Complex_Analysis.Complex_Analysis</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Real_Asymp/Real_Asymp.html">HOL-Real_Asymp.Real_Asymp</a>"</span>
  <a href="../Bernoulli/Bernoulli_FPS.html">Bernoulli.Bernoulli_FPS</a> 
  <a href="../Bernoulli/Periodic_Bernpoly.html">Bernoulli.Periodic_Bernpoly</a> 
  <a href="Stirling_Formula.html">Stirling_Formula</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary Facts›</span></span>
  
<span class="comment1">(* TODO Move *)</span>
<span class="keyword1"><span class="command">lemma</span></span> arg_of_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> arg <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> arg <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> pi"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_unique<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_sgn_def scaleR_conv_of_real<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> arg_conv_arctan<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"arg <span class="free">z</span> <span class="main">=</span> arctan <span class="main">(</span>Im <span class="free">z</span> <span class="main">/</span> Re <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> arg_unique<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free">z</span> <span class="main">=</span> cis <span class="main">(</span>arctan <span class="main">(</span>Im <span class="free">z</span> <span class="main">/</span> Re <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> complex_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>cis <span class="main">(</span>arctan <span class="main">(</span>Im <span class="free">z</span> <span class="main">/</span> Re <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>Im <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span>Re <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cos_arctan power_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> Re <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> norm <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> Re <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> sqrt <span class="main">…</span> <span class="main">=</span> Re <span class="free">z</span> <span class="main">/</span> norm <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>sgn <span class="free">z</span><span class="main">)</span> <span class="main">=</span> Re <span class="main">(</span>cis <span class="main">(</span>arctan <span class="main">(</span>Im <span class="free">z</span> <span class="main">/</span> Re <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>cis <span class="main">(</span>arctan <span class="main">(</span>Im <span class="free">z</span> <span class="main">/</span> Re <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Im <span class="free">z</span> <span class="main">/</span> <span class="main">(</span>Re <span class="free">z</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>Im <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span>Re <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_arctan <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> Im <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> Re <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> norm <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> Re <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">z</span> <span class="main">/</span> <span class="main">(</span>Re <span class="free">z</span> <span class="main">*</span> sqrt <span class="main">…</span><span class="main">)</span> <span class="main">=</span> Im <span class="free">z</span> <span class="main">/</span> norm <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>sgn <span class="free">z</span><span class="main">)</span> <span class="main">=</span> Im <span class="main">(</span>cis <span class="main">(</span>arctan <span class="main">(</span>Im <span class="free">z</span> <span class="main">/</span> Re <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"arctan <span class="main">(</span>Im <span class="free">z</span> <span class="main">/</span> Re <span class="free">z</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span>pi"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ arctan_lbound<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arctan <span class="main">(</span>Im <span class="free">z</span> <span class="main">/</span> Re <span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arctan_ubound<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> pi"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"arctan <span class="main">(</span>Im <span class="free">z</span> <span class="main">/</span> Re <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> pi"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mult_indicator_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> semiring_1"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> indicator <span class="free">A</span> <span class="free">x</span> <span class="main">*</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> indicator <span class="free">A</span> <span class="free">x</span> <span class="main">*</span> <span class="free">g</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> has_absolute_integral_change_of_variables_1'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sets lebesgue"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> der_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_field_derivative</span> <span class="free">g'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">g</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g'</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span> <span class="main">∧</span>
           integral <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g'</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>
     <span class="main">⟷</span> <span class="free">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> integral <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g'</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vec <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> real <span class="main">^</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="free">S</span> <span class="main">∧</span>
           integral <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g'</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> vec <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec <span class="free">b</span> <span class="main">::</span> real <span class="main">^</span> <span class="main">1</span><span class="main">)</span>
         <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vec <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">::</span> real <span class="main">^</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span>
           integral <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> vec <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec <span class="free">b</span> <span class="main">::</span> real <span class="main">^</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> has_field_derivative_iff_has_vector_derivative
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_absolute_integral_change_of_variables_1 assms<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> absolutely_integrable_on_1_iff integral_on_1_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Ln_times_of_nat<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">;</span> <span class="free">z</span> <span class="main">≠</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> Ln<span class="main">(</span>of_nat <span class="free">r</span> <span class="main">*</span> <span class="free">z</span> <span class="main">::</span> complex<span class="main">)</span> <span class="main">=</span> ln <span class="main">(</span>of_nat <span class="free">r</span><span class="main">)</span> <span class="main">+</span> Ln<span class="main">(</span><span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ln_times_of_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_nat <span class="free">r</span>"</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_of_real_0_I<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>of_real <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>real_normed_div_algebra<span class="main">)</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> tendsto_of_real_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>  

<span class="keyword1"><span class="command">lemma</span></span> negligible_atLeastAtMostI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟹</span> negligible <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">lemma</span></span> vector_derivative_cong_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>nhds <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"vector_derivative <span class="free">f</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> vector_derivative <span class="free">g</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">y</span> <span class="keyword1">within</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> eventually_nhds_x_imp_x<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">g</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">has_vector_derivative</span> <span class="bound">D</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
           <span class="main">(</span><span class="main">λ</span><span class="bound">D</span><span class="main">.</span> <span class="main">(</span><span class="free">g</span> <span class="keyword1">has_vector_derivative</span> <span class="bound">D</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext has_vector_derivative_cong_ev refl assms<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_derivative_def assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> differentiable_of_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"of_real <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_real <span class="keyword1">has_vector_derivative</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> differentiableI_vector<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> higher_deriv_cong_ev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>nhds <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">g</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>nhds <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span>nhds <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nhds <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_eventually<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> deriv <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> deriv <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>nhds <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">rule</span> deriv_cong_ev<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> deriv_cong_ev Suc <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> funpow_Suc_right <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> funpow.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> eventually_nhds_x_imp_x<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> deriv_of_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">A</span> <span class="main">≠</span> bot <span class="main">⟹</span> vector_derivative of_real <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> vector_derivative_within <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deriv_Re <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"deriv Re <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> DERIV_imp_deriv <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> vector_derivative_of_real_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">differentiable</span> <span class="keyword1">at</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_real <span class="main">(</span>deriv <span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span>of_real <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_real <span class="main">(</span>deriv <span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> vector_derivative_chain_at<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real field_derivative_eq_vector_derivative assms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> vector_derivative_of_real_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>of_real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> deriv <span class="free">f</span> <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vector_derivative <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> of_real<span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> deriv <span class="free">f</span> <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> vector_derivative_chain_at_general<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> Ln_holomorphic <span class="main">[</span><span class="operator">holomorphic_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Ln <span class="keyword1">holomorphic_on</span> <span class="main">(</span><span class="free">A</span> <span class="main">::</span> complex set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_onI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Ln <span class="keyword1">has_field_derivative</span> inverse <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Ln <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="skolem">z</span> <span class="keyword1">within</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> field_differentiable_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> higher_deriv_Polygamma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∉</span> <span class="main">ℤ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Polygamma <span class="free">m</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> 
             Polygamma <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">z</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>real_normed_field<span class="main">,</span>euclidean_space<span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Polygamma <span class="free">m</span><span class="main">)</span> <span class="bound">u</span> <span class="main">=</span> Polygamma <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>nhds <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc.IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Polygamma <span class="free">m</span><span class="main">)</span> <span class="bound">u</span> <span class="main">=</span> Polygamma <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>nhds <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nhds <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_eventually<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> deriv <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Polygamma <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="bound">z</span> <span class="main">=</span> 
             deriv <span class="main">(</span>Polygamma <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span>nhds <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">intro</span> deriv_cong_ev refl<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> UNIV <span class="main">-</span> <span class="main">ℤ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">(</span>nhds <span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_nhds_in_open open_Diff open_UNIV<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> deriv_Polygamma<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_nhds_x_imp_x<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> higher_deriv_cmult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"open <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">j</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deriv <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> deriv <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_nhds_in_open<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> Suc.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> deriv_cong_ev refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc.IH<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> deriv <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> deriv_cmult holomorphic_on_imp_differentiable_at holomorphic_higher_deriv<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> higher_deriv_ln_Gamma_complex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>complex<span class="main">)</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> ln_Gamma <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> ln_Gamma <span class="free">x</span> <span class="keyword1">else</span> Polygamma <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">j'</span><span class="main">)</span> <span class="main">(</span>deriv ln_Gamma<span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">j'</span><span class="main">)</span> Digamma <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_nhds_in_open<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">-</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> higher_deriv_cong_ev refl<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_Diff deriv_ln_Gamma_complex<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Polygamma <span class="skolem">j'</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> higher_deriv_Polygamma<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Ints_cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_nonpos_Reals_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> funpow.simps <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_Suc_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> higher_deriv_ln_Gamma_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> ln_Gamma <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> ln_Gamma <span class="free">x</span> <span class="keyword1">else</span> Polygamma <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">j'</span><span class="main">)</span> <span class="main">(</span>deriv ln_Gamma<span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">j'</span><span class="main">)</span> Digamma <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_nhds_in_open<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> higher_deriv_cong_ev refl<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_Diff deriv_ln_Gamma_real<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Polygamma <span class="skolem">j'</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> higher_deriv_Polygamma<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Ints_cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_nonpos_Reals_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> funpow.simps <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_Suc_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  
<span class="keyword1"><span class="command">lemma</span></span> higher_deriv_ln_Gamma_complex_of_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> ln_Gamma <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_real <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> ln_Gamma <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> higher_deriv_ln_Gamma_real higher_deriv_ln_Gamma_complex
                   ln_Gamma_complex_of_real Polygamma_of_real<span class="main">)</span>
<span class="comment1">(* END TODO *)</span>

<span class="comment1">(* TODO: could be automated with Laurent series expansions in the future *)</span>
<span class="keyword1"><span class="command">lemma</span></span> stirling_limit_aux1<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> Ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">z</span> <span class="main">*</span> of_real <span class="bound">y</span><span class="main">)</span> <span class="main">/</span> of_real <span class="bound">y</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">complex</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">z</span> <span class="main">*</span> of_real <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> <span class="main">1</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> has_vector_derivative_real_field<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>Ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">z</span> <span class="main">*</span> of_real <span class="bound">y</span><span class="main">)</span> <span class="main">-</span> of_real <span class="bound">y</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">¦</span><span class="bound">y</span><span class="main">¦</span><span class="main">)</span> <span class="main">─</span><span class="main">0</span><span class="main">→</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_vector_derivative_def has_derivative_def netlimit_at 
          scaleR_conv_of_real <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span>Ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">z</span> <span class="main">*</span> of_real <span class="bound">y</span><span class="main">)</span> <span class="main">-</span> of_real <span class="bound">y</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">/</span> of_real <span class="main">¦</span><span class="bound">y</span><span class="main">¦</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ at_le<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> Ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">z</span> <span class="main">*</span> of_real <span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">y</span><span class="main">)</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_at_right_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> LIM_zero_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> stirling_limit_aux2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">*</span> Ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">z</span> <span class="main">/</span> of_real <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">z</span><span class="main">)</span> at_top"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword1"><span class="command">using</span></span> stirling_limit_aux1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_at_top_to_right<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Union_atLeastAtMost<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span>real <span class="bound">n</span><span class="main">..</span>real <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span>real <span class="bound">n</span><span class="main">..</span>real <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> real <span class="free">N</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> real <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> real <span class="main">(</span>nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">⌊</span><span class="skolem">x</span><span class="main">⌋</span> <span class="main">&lt;</span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>real <span class="bound">n</span><span class="main">..</span>real <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"nat <span class="main"><span class="main"><span class="main">⌊</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span><span class="main"><span class="main"><span class="main">⌋</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cones in the complex plane›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">complex_cone</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> complex set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">complex_cone</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> rcis <span class="main">(</span>norm <span class="bound">z</span><span class="main">)</span> <span class="bound">y</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">complex_cone'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> complex set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">complex_cone'</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> complex_cone <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zero_in_complex_cone <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∈</span> complex_cone <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_cone_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> complex_coneE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> complex_cone <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">r</span> <span class="free">α</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> rcis <span class="free">r</span> <span class="free">α</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> rcis <span class="main">(</span>norm <span class="free">z</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> complex_cone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"norm <span class="free">z</span>"</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> arg_cis <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">&lt;..</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"arg <span class="main">(</span>cis <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> arg_unique<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> arg_mult_of_real_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"arg <span class="main">(</span>of_real <span class="free">r</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> arg <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> arg_bounded<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> arg_unique<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_mult sgn_of_real cis_arg<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> arg_mult_of_real_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"arg <span class="main">(</span><span class="free">z</span> <span class="main">*</span> of_real <span class="free">r</span><span class="main">)</span> <span class="main">=</span> arg <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> arg_mult_of_real_left<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> arg_rcis <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">&lt;..</span>pi<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"arg <span class="main">(</span>rcis <span class="free">r</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rcis_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rcis_in_complex_cone <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"rcis <span class="free">r</span> <span class="free">α</span> <span class="main">∈</span> complex_cone <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_cone_def<span class="main">)</span>  

<span class="keyword1"><span class="command">lemma</span></span> arg_imp_in_complex_cone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arg <span class="free">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> complex_cone <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> rcis <span class="main">(</span>norm <span class="free">z</span><span class="main">)</span> <span class="main">(</span>arg <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rcis_cmod_arg<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> complex_cone <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> complex_cone_altdef<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi <span class="main">&lt;</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"complex_cone <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> insert <span class="main">0</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> arg <span class="bound">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> complex_cone <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> rcis <span class="skolem">r</span> <span class="skolem">α</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> complex_coneE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arg <span class="skolem">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> *<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> *<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> *<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms *<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span>pi<span class="main">&lt;..</span>pi<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> *<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> insert <span class="main">0</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> arg <span class="bound">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">:</span> arg_imp_in_complex_cone›</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nonneg_of_real_in_complex_cone <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"of_real <span class="free">x</span> <span class="main">∈</span> complex_cone <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rcis <span class="free">x</span> <span class="main">0</span> <span class="main">∈</span> complex_cone <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rcis_in_complex_cone<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> one_in_complex_cone <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main">∈</span> complex_cone <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nonneg_of_real_in_complex_cone<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> nonneg_of_real_in_complex_cone<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> of_nat_in_complex_cone <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> of_nat <span class="free">n</span> <span class="main">∈</span> complex_cone <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nonneg_of_real_in_complex_cone<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"real <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> nonneg_of_real_in_complex_cone<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Another integral representation of the Beta function›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> complex_cone_inter_nonpos_Reals<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi <span class="main">&lt;</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"complex_cone <span class="free">a</span> <span class="free">b</span> <span class="main">∩</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Reals_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"complex_of_real <span class="skolem">x</span> <span class="main">∈</span> complex_cone <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_cone_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"complex_of_real <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> has_integral_Beta_real'<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> Beta <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Beta_conv_nn_integral<span class="main">:</span>
          <span class="quoted"><span class="quoted">"Beta <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">u</span><span class="main">.</span> ennreal <span class="main">(</span>indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">u</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">u</span><span class="main">.</span> ennreal <span class="main">(</span>indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">u</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Beta <span class="free">a</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_pos_pos Beta_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span>Gamma <span class="free">a</span> <span class="main">*</span> Gamma <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">t</span><span class="main">.</span> ennreal <span class="main">(</span>indicator <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="bound">t</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">t</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">*</span>
    <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">t</span><span class="main">.</span> ennreal <span class="main">(</span>indicator <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="bound">t</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">t</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_mult'<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gamma_conv_nn_integral_real<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">t</span><span class="main">.</span> <span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">u</span><span class="main">.</span> ennreal <span class="main">(</span>indicator <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="bound">t</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">t</span><span class="main">)</span> <span class="main">*</span>
                            ennreal <span class="main">(</span>indicator <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="bound">u</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">u</span><span class="main">)</span> <span class="main">∂</span>lborel <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nn_integral_cmult nn_integral_multc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">t</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">u</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="bound">u</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>
                            <span class="main">/</span> exp <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong_AE AE_I<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def divide_ennreal ennreal_mult' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> exp_add mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">t</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">u</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="bound">u</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>
                            <span class="main">/</span> exp <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="bound">u</span><span class="main">)</span> 
                    <span class="main">∂</span><span class="main">(</span>density <span class="main">(</span>distr lborel borel <span class="main">(</span><span class="main">(*)</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">¦</span><span class="bound">t</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong mult_indicator_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> lborel_distr_mult' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">t</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">u</span><span class="main">.</span> 
                     indicator <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">(</span><span class="bound">u</span> <span class="main">*</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">*</span>
                     <span class="main">(</span><span class="bound">u</span> <span class="main">*</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="bound">t</span> <span class="main">*</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong mult_indicator_cong<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nn_integral_density nn_integral_distr <span class="dynamic"><span class="dynamic">algebra_simps</span></span> powr_diff
             <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> ennreal_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">t</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> <span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">u</span><span class="main">.</span> indicator <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span>
                     <span class="bound">t</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="bound">u</span> <span class="main">*</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="bound">u</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_cmult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> nn_integral_cong<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def zero_le_mult_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">t</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> <span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">u</span><span class="main">.</span> indicator <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span>
                     <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="bound">u</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_add powr_diff indicator_def powr_mult <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">u</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> <span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">t</span><span class="main">.</span> indicator <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">)</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">*</span>
                     <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="bound">u</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lborel_pair.Fubini'<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">u</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="bound">u</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">t</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">t</span> <span class="main">*</span>
                     <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="bound">u</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong mult_indicator_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">u</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">u</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">t</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">t</span> <span class="main">*</span>
                     <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="bound">u</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong_AE AE_I<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">u</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">u</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">t</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">t</span> <span class="main">*</span>
                     <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="bound">t</span> <span class="main">*</span> <span class="main">(</span><span class="bound">u</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">∂</span><span class="main">(</span>density <span class="main">(</span>distr lborel borel <span class="main">(</span><span class="main">(*)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">¦</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="bound">u</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong mult_indicator_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> lborel_distr_mult' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">u</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">u</span> <span class="main">*</span> 
                    <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">t</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">u</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> ennreal <span class="main">(</span>indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">(</span><span class="bound">t</span> <span class="main">/</span> <span class="main">(</span><span class="bound">u</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                     <span class="main">(</span><span class="bound">t</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">t</span><span class="main">)</span>
                    <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong mult_indicator_cong<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nn_integral_distr nn_integral_density add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">u</span><span class="main">.</span> <span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">t</span><span class="main">.</span> indicator <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">)</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">*</span> 
                    <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="bound">u</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">t</span> <span class="main">/</span> <span class="main">(</span><span class="bound">u</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">t</span>
                    <span class="main">∂</span>lborel <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_cmult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> nn_integral_cong<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def <span class="dynamic"><span class="dynamic">field_simps</span></span> divide_ennreal <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> ennreal_mult ennreal_mult'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">u</span><span class="main">.</span> <span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">t</span><span class="main">.</span> ennreal <span class="main">(</span>indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">u</span> <span class="main">*</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                            ennreal <span class="main">(</span>indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">t</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">t</span><span class="main">)</span>
                    <span class="main">∂</span>lborel <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def powr_add powr_diff powr_divide powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span> add_ac
             <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> ennreal_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">I</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">t</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">t</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">t</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nn_integral_cmult nn_integral_multc I_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">t</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">t</span> <span class="main">*</span> <span class="bound">t</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> exp <span class="bound">t</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
               ennreal <span class="main">(</span>Gamma <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Gamma_conv_nn_integral_real<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nn_integral_cong_AE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> AE_I<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="main"><span class="main"><span class="main">_</span></span></span> <span class="main"><span class="main"><span class="main">_</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> 
             <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span>Gamma <span class="free">a</span> <span class="main">*</span> Gamma <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">I</span> <span class="main">*</span> ennreal <span class="main">(</span>Gamma <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span>Gamma <span class="free">a</span> <span class="main">*</span> Gamma <span class="free">b</span><span class="main">)</span> <span class="main">/</span> ennreal <span class="main">(</span>Gamma <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           <span class="skolem">I</span> <span class="main">*</span> ennreal <span class="main">(</span>Gamma <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> ennreal <span class="main">(</span>Gamma <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Gamma <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ennreal_mult_divide_eq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span>Gamma <span class="free">a</span> <span class="main">*</span> Gamma <span class="free">b</span><span class="main">)</span> <span class="main">/</span> ennreal <span class="main">(</span>Gamma <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               ennreal <span class="main">(</span>Gamma <span class="free">a</span> <span class="main">*</span> Gamma <span class="free">b</span> <span class="main">/</span> Gamma <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_ennreal<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ennreal <span class="main">(</span>Beta <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Beta_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span>Beta <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">u</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">has_integral</span> Beta <span class="free">a</span> <span class="free">b</span><span class="main">)</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹Beta <span class="free">a</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> has_integral_iff_nn_integral_lebesgue<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def measurable_completion nn_integral_completion I_def mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">u</span> <span class="main">*</span> <span class="skolem">f</span> <span class="bound">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="bound">u</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">…</span> <span class="keyword1">has_integral</span> Beta <span class="free">a</span> <span class="free">b</span><span class="main">)</span> UNIV <span class="main">⟷</span> <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">has_integral</span> Beta <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_restrict_UNIV<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="main">…</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> has_integral_Beta2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">has_integral</span> Beta <span class="main">(</span><span class="main">-</span> <span class="free">a</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">u</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> Beta <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="keyword1">has_integral</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_integral_Beta_real'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">a</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_divide_distrib f_def C_def<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> bij<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">g</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bij_betwI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">sqrt</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="keyword1">absolutely_integrable_on</span> <span class="skolem">g</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">∧</span> integral <span class="main">(</span><span class="skolem">g</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> I bij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_def has_integral_iff absolutely_integrable_on_def f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">absolutely_integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">∧</span>
                         integral <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_absolute_integral_change_of_variables_1' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                 <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> absolutely_integrable_on_def f_def has_integral_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def g_def powr_def exp_minus ln_realpow <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_mult_right<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> has_integral_Beta3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">has_integral</span>
             Beta <span class="main">(</span><span class="main">-</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> Beta <span class="main">(</span><span class="main">-</span> <span class="free">a</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> int<span class="main">:</span> <span class="quoted"><span class="quoted">"nn_integral lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nn_integral_has_integral_lebesgue<span class="main">[</span><span class="operator">OF</span> _ has_integral_Beta2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nn_integral lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span>indicat_real <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> sqrt <span class="free">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> sqrt <span class="free">b</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">*</span> sqrt <span class="free">b</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lborel_distr_mult'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"sqrt <span class="free"><span class="free"><span class="free">b</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nn_integral_density nn_integral_distr mult_ac <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> ennreal_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span>indicat_real <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">*</span> sqrt <span class="free">b</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def <span class="dynamic"><span class="dynamic">field_simps</span></span> zero_less_mult_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span>indicat_real <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">b</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def powr_add powr_half_sqrt powr_mult<span class="main">)</span>    
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">b</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span>indicat_real <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_cmult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> ennreal_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span>indicat_real <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> int <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span><span class="free">b</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> ennreal <span class="skolem">C</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="skolem">C</span> <span class="main">*</span> <span class="free">b</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_mult<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def mult_ac Beta_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span> <span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span>indicat_real <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="skolem">C</span> <span class="main">*</span> <span class="free">b</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> has_integral_iff_nn_integral_lebesgue<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def measurable_completion nn_integral_completion Beta_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> has_integral_restrict_UNIV<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Asymptotics of the real $\log\Gamma$ function and its derivatives›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This is the error term that occurs in the expansion of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ln_Gamma</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. It can be shown to 
  be of order $O(s^{-n})$.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stirling_integral</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>real_normed_div_algebra<span class="main">,</span> banach<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stirling_integral</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> 
     lim <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="bound">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">^</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">approx</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">approx</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> 
    <span class="main">(</span><span class="main">∑</span><span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">..&lt;</span><span class="bound">N</span><span class="main">.</span> <span class="free">s</span> <span class="main">/</span> of_nat <span class="bound">n</span> <span class="main">-</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span> <span class="main">/</span> of_nat <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>euler_mascheroni <span class="main">*</span> <span class="free">s</span> <span class="main">+</span> ln <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>⟶ ln_Gamma s›</span></span>›</span>
    <span class="main">(</span>ln_Gamma <span class="main">(</span>of_nat <span class="bound">N</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">/</span> of_nat <span class="bound">N</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> of_nat <span class="bound">N</span> <span class="main">*</span> ln <span class="main">(</span>of_nat <span class="bound">N</span><span class="main">)</span> <span class="main">+</span> of_nat <span class="bound">N</span><span class="main">)</span> <span class="main">-</span> <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>⟶ 0›</span></span>›</span>
    <span class="free">s</span> <span class="main">*</span> <span class="main">(</span>harm <span class="main">(</span><span class="bound">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="main">(</span><span class="bound">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> euler_mascheroni<span class="main">)</span> <span class="main">+</span> <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>⟶ 0›</span></span>›</span>
    <span class="free">s</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_nat <span class="bound">N</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="main">(</span><span class="bound">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>⟶ 0›</span></span>›</span>
    <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_nat <span class="bound">N</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>       <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>⟶ 0›</span></span>›</span>
    of_nat <span class="bound">N</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_nat <span class="bound">N</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>  <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>⟶ s›</span></span>›</span>
    <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">s</span> <span class="main">-</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>       
  
<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   integrable_pbernpoly_1<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span><span class="main">-</span>pbernpoly <span class="main">1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     integral_pbernpoly_1_aux<span class="main">:</span>
            <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>of_real <span class="main">(</span>pbernpoly <span class="main">1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">approx</span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     has_integral_pbernpoly_1<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> pbernpoly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> 
              <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">&lt;</span><span class="free">N</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">m</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_nat <span class="bound">m</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> 
                        ln <span class="main">(</span>of_nat <span class="bound">m</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">{</span>of_nat <span class="bound">n</span><span class="main">..</span>of_nat <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> has_integral<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>pbernpoly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> 
             <span class="main">(</span>of_nat <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="skolem">n</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> 
           <span class="main">{</span>of_nat <span class="skolem">n</span><span class="main">..</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> has_integral_spike<span class="main">)</span>      
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">has_integral</span> 
              <span class="main">(</span>of_nat <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_real <span class="main">(</span>real <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_real <span class="main">(</span>real <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> 
            <span class="main">{</span>of_nat <span class="skolem">n</span><span class="main">..</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> s has_integral_const_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_diff has_integral_mult_right fundamental_theorem_of_calculus<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> has_vector_derivative_real_field
               <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span>
                     complex_nonpos_Reals_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">has_integral</span> 
              <span class="main">(</span>of_nat <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="skolem">n</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> 
            <span class="main">{</span>of_nat <span class="skolem">n</span><span class="main">..</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
             
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pbernpoly <span class="main">1</span> <span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
         <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>of_nat <span class="skolem">n</span><span class="main">..</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> real <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> real <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"floor <span class="skolem">x</span> <span class="main">=</span> int <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> s x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complex_of_real <span class="skolem">x</span> <span class="main">≠</span> <span class="main">-</span><span class="free">s</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff complex_nonpos_Reals_iff <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pbernpoly <span class="main">1</span> <span class="skolem">x</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pbernpoly_def bernpoly_def frac_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> add_eq_0_iff2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span><span class="main">.</span> <span class="bound">I</span><span class="main">∈</span><span class="var">?A</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>pbernpoly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> 
              <span class="main">(</span>Inf <span class="bound">I</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>Inf <span class="bound">I</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>Inf <span class="bound">I</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="bound">I</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> pbernpoly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">I</span><span class="main">∈</span><span class="var">?A</span><span class="main">.</span> <span class="main">(</span>Inf <span class="bound">I</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>Inf <span class="bound">I</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>Inf <span class="bound">I</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span>real <span class="bound">n</span><span class="main">..</span>real <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span> <span class="keyword1">has_integral</span> <span class="var">?i</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_Union * finite_imageI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> negligible_atLeastAtMostI pairwiseI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">hence</span></span> has_integral<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> pbernpoly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="var">?i</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> has_integral_spike_set_eq<span class="main">)</span>
       <span class="main">(</span><span class="operator">use</span> Union_atLeastAtMost assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> <span class="quasi_keyword">intro</span><span class="main">!</span><span class="main">:</span> empty_imp_negligible›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> pbernpoly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> integral<span class="main">:</span>   <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> pbernpoly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> pbernpoly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>

  <span class="keyword1"><span class="command">note</span></span> has_integral_neg<span class="main">[</span><span class="operator">OF</span> has_integral<span class="main">]</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">&lt;</span><span class="free">N</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_nat <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> 
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def atLeast0LessThan <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum_negf <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> has_integral<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="main">1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">…</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      
  <span class="keyword1"><span class="command">note</span></span> integral
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="free">N</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> 
                    <span class="main">(</span>ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">N</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?S</span> <span class="main">-</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def sum_subtractf atLeast0LessThan<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="free">N</span><span class="main">.</span> of_nat <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="free">N</span><span class="main">.</span> ln <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?S1</span> <span class="main">+</span> <span class="main">_</span> <span class="main">*</span> <span class="var">?S2</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum.distrib sum_subtractf sum_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S2</span> <span class="main">=</span> ln <span class="main">(</span>of_nat <span class="free">N</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_lessThan_telescope<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">.</span> of_nat <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">.</span> of_nat <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">.</span> of_nat <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> sum_subtractf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">.</span> of_nat <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">.</span> <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>of_nat <span class="free">N</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">N</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">.</span> of_nat <span class="bound">n</span> <span class="main">*</span> ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">-</span><span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">.</span> ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>of_nat <span class="free">N</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">N</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">+</span> of_nat <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  complex_nonpos_Reals_iff complex_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">.</span> ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">.</span> ln <span class="main">(</span>of_nat <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Ln_times_of_nat <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ln <span class="main">(</span>fact <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">.</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">N</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ln_times_of_nat fact_reduce add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">.</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">.</span> <span class="free">s</span> <span class="main">/</span> <span class="bound">n</span> <span class="main">-</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span><span class="main">/</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left sum_subtractf<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> N <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>fact <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ln_Gamma <span class="main">(</span>of_nat <span class="free">N</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_Gamma_complex_conv_fact<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> of_nat <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>harm <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> harm_def <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span>ln_Gamma <span class="main">(</span>of_nat <span class="free">N</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span> <span class="main">=</span> <span class="main">1</span><span class="main">..&lt;</span><span class="free">N</span><span class="main">.</span> <span class="free">s</span> <span class="main">/</span> of_nat <span class="bound">n</span> <span class="main">-</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span> <span class="main">/</span> of_nat <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                 <span class="free">s</span> <span class="main">*</span> harm <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> of_nat <span class="main">(</span><span class="free">N</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="main">(</span>of_nat <span class="free">N</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span>
                <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_nat <span class="free">N</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="free">s</span><span class="main">)</span> <span class="main">-</span> of_nat <span class="free">N</span> <span class="main">=</span> <span class="free">approx</span> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> of_nat_diff ln_div approx_def Ln_of_nat 
                          ln_Gamma_complex_of_real <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>of_nat <span class="free">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>of_real <span class="main">(</span>pbernpoly <span class="main">1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">…</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> integrable_ln_Gamma_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> s <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> integrable_neg<span class="main">[</span><span class="operator">OF</span> integrable_pbernpoly_1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integrable_negligible<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">x</span> <span class="main">+</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff add_eq_0_iff2 complex_nonpos_Reals_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> False s <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> integrable_continuous_real <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This following proof is based on ``Rudiments of the theory of the gamma function'' 
  by Bruce Berndt~\cite{berndt}.
›</span></span>
<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">lemma</span></span> integral_pbernpoly_1<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> pbernpoly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">⇢</span> <span class="main">-</span>ln_Gamma <span class="free">s</span> <span class="main">-</span> <span class="free">s</span> <span class="main">+</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">s</span> <span class="main">+</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
  <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">+</span> of_real <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">using</span></span> that s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff complex_nonpos_Reals_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">approx</span> <span class="main">⤏</span> ln_Gamma <span class="free">s</span> <span class="main">-</span> <span class="main">0</span> <span class="main">-</span> <span class="main">0</span> <span class="main">+</span> <span class="main">0</span> <span class="main">-</span> <span class="main">0</span> <span class="main">+</span> <span class="free">s</span> <span class="main">-</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">s</span> <span class="main">-</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> approx_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_add tendsto_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∉</span> <span class="main">ℤ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_nonpos_Reals_iff <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Ints_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">.</span> <span class="free">s</span> <span class="main">/</span> of_nat <span class="bound">i</span> <span class="main">-</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span> <span class="main">/</span> of_nat <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> 
             ln_Gamma <span class="free">s</span> <span class="main">+</span> euler_mascheroni <span class="main">*</span> <span class="free">s</span> <span class="main">+</span> ln <span class="free">s</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">⇢</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> ln_Gamma_series'_aux<span class="main">[</span><span class="operator">OF</span> s'<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> sums_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_sequentially_Suc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sum.atLeast1_atMost_eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atLeastLessThanSuc_atLeastAtMost<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">-</span> <span class="main">(</span>euler_mascheroni <span class="main">*</span> <span class="free">s</span> <span class="main">+</span> ln <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> ln_Gamma <span class="free">s</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="main">(</span>ln_Gamma <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">/</span> real <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> 
                 real <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_of_real_0_I 
             filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_sandwich filterlim_real_sequentially<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln_Gamma <span class="bound">x</span> <span class="main">-</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> ln_Gamma_bounds<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln_Gamma <span class="bound">x</span> <span class="main">-</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">≤</span> 
              <span class="main">1</span> <span class="main">/</span> <span class="numeral">12</span> <span class="main">*</span> inverse <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> ln_Gamma_bounds<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">12</span> <span class="main">*</span> inverse <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult_right_zero tendsto_inverse_0_at_top filterlim_ident<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span> <span class="main">*</span> of_real <span class="main">(</span>harm <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>real <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> euler_mascheroni<span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> 
            <span class="free">s</span> <span class="main">*</span> of_real <span class="main">(</span>euler_mascheroni <span class="main">-</span> euler_mascheroni<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_sequentially_Suc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span> 
         <span class="main">(</span><span class="operator">insert</span> euler_mascheroni_LIMSEQ<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span>harm <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> euler_mascheroni<span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong refl eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>nat"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ln_of_nat of_real_harm<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span>harm <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> euler_mascheroni<span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> at_top"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> tendsto_divide_0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span><span class="main">)</span> 
         <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_ident filterlim_at_infinity_conv_norm_at_top filterlim_abs_real<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>of_real <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>complex_of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> of_real <span class="skolem">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that s
      <span class="keyword1"><span class="command">using</span></span> Ln_divide_of_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"of_real <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">s</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> neq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> Ln_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>of_real <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong refl<span class="main">)</span> 
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>of_real <span class="main">(</span>real <span class="bound">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_real <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ filterlim_real_sequentially<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_sequentially_Suc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_nat <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_mult_right_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span> <span class="main">/</span> of_real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> at_top"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> tendsto_divide_0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span><span class="main">)</span> 
         <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_ident  filterlim_at_infinity_conv_norm_at_top filterlim_abs_real<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>of_real <span class="skolem">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span> <span class="main">/</span> of_real <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> Ln_divide_of_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">x</span> <span class="main">+</span> <span class="free">s</span>"</span></span><span class="main">]</span> neq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> Ln_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong refl<span class="main">)</span> 
                 <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_real <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_real <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>        
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_mult_right_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ filterlim_real_sequentially<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_nat <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span> <span class="main">/</span> of_real <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">s</span><span class="main">)</span> at_top"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stirling_limit_aux2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">s</span> <span class="main">/</span> of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> ln <span class="main">(</span>of_real <span class="skolem">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
      <span class="keyword1"><span class="command">using</span></span> that s Ln_divide_of_real <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">x</span> <span class="main">+</span> <span class="free">s</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> neq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ln_of_real <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_real <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="free">s</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong refl<span class="main">)</span> 
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_real <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_real <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_real <span class="main">(</span>real <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ filterlim_real_sequentially<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> of_nat <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span>ln <span class="main">(</span>of_nat <span class="bound">n</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">-</span> ln <span class="main">(</span>of_nat <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>pbernpoly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span>
                         ln_Gamma <span class="free">s</span> <span class="main">+</span> <span class="free">s</span> <span class="main">-</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">s</span> <span class="main">-</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integral_pbernpoly_1_aux
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong refl<span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>pbernpoly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="main">-</span>integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> pbernpoly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_minus_cancel_left <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">lemma</span></span> pbernpoly_integral_conv_pbernpoly_integral_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> pbernpoly <span class="free">n</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span>
             of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span>real <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> of_nat <span class="free">N</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">-</span>
             of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">s</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> of_nat <span class="free">n</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> 
               integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span> <span class="main">=</span> has_field_derivative_pbernpoly_Suc'
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="main">-</span>of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span>of_nat <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="free">N</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span>
            of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">s</span> <span class="main">^</span> <span class="free">n</span> <span class="main">+</span>
            integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span>of_nat <span class="free">n</span> <span class="main">*</span> inverse <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> 
          <span class="main">(</span>of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="keyword1">has_integral</span> <span class="main">-</span><span class="skolem">I</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integration_by_parts_interior_strong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bounded_bilinear_mult<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span>real <span class="free">N</span><span class="main">}</span> <span class="main">-</span> real <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">N</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="main">ℤ</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> of_int <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_cases<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> x'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> of_nat <span class="main">(</span>nat <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x'<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span>
        complex_of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_vector_derivative_of_real<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span>
            complex_of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> x s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complex_of_real <span class="skolem">x</span> <span class="main">+</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff complex_nonpos_Reals_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_vector_derivative</span> 
             <span class="main">-</span> of_nat <span class="free">n</span> <span class="main">*</span> inverse <span class="main">(</span>of_real <span class="skolem">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x s assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> has_vector_derivative_real_field <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> power_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
               <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> power_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complex_of_real <span class="skolem">x</span> <span class="main">+</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
      <span class="keyword1"><span class="command">using</span></span> that s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff complex_nonpos_Reals_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span> 
         <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
            pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span>of_nat <span class="free">N</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="free">N</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">-</span>
            of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">s</span> <span class="main">^</span> <span class="free">n</span> <span class="main">-</span> <span class="main">-</span><span class="skolem">I</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> integrable_ln_Gamma_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def has_integral_integral <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
              inverse <span class="main">(</span>of_real <span class="main">(</span>real <span class="free">N</span><span class="main">)</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="main">(</span>of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span>real <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> 
                  of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
              inverse <span class="main">(</span>of_real <span class="main">0</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="main">(</span>of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">-</span> <span class="skolem">I</span><span class="main">)</span>
            <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> of_nat <span class="free">n</span> <span class="main">*</span> inverse <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">n</span> <span class="main">*</span> <span class="main">(</span>of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span>
                         of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> 
                         <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span>
                            <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">-</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> has_integral_neg<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I_def has_integral_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span> integral_mult_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 
             <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> power_Suc of_nat_Suc <span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pbernpoly_over_power_tendsto_0<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> of_nat <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">+</span> of_nat <span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff complex_nonpos_Reals_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> bounded_pbernpoly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> c <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> c <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> real <span class="bound">x</span> <span class="main">+</span> Re <span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span>of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span>real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> 
                                    <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> of_nat <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
                          <span class="main">(</span><span class="skolem">c</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">x</span> <span class="main">+</span> Re <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span>real <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> 
                                    <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> of_nat <span class="skolem">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
            <span class="main">(</span><span class="skolem">c</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> norm <span class="main">(</span><span class="free">s</span> <span class="main">+</span> of_nat <span class="skolem">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_divide norm_mult norm_power neq <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="skolem">x</span> <span class="main">+</span> Re <span class="free">s</span><span class="main">)</span> <span class="main">≤</span> cmod <span class="main">(</span><span class="free">s</span> <span class="main">+</span> of_nat <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> complex_Re_le_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">+</span> of_nat <span class="skolem">x</span>"</span></span><span class="main">]</span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_nonpos_Reals_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>real <span class="skolem">x</span> <span class="main">+</span> Re <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s elim c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> neq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono power_mono mult_pos_pos divide_nonneg_pos zero_less_power<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">x</span> <span class="main">+</span> Re <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_null_comparison<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> convergent_stirling_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"convergent <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span> 
             <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"convergent <span class="main">(</span><span class="var">?f</span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convergent <span class="main">(</span><span class="var">?f</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> integral_pbernpoly_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> convergentI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convergent <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="var">?f</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="bound">N</span> <span class="main">-</span>
            of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> 
                <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> of_nat <span class="bound">N</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span>
            of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">s</span> <span class="main">^</span> Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> 
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"convergent <span class="var">?g</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> convergent_add convergent_diff Suc 
            convergent_const convergentI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> pbernpoly_over_power_tendsto_0<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> of_nat <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="var">?f</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> pbernpoly_integral_conv_pbernpoly_integral_Suc<span class="main">)</span> 
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc power_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convergent <span class="main">…</span> <span class="main">⟷</span> convergent <span class="main">(</span><span class="var">?f</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> convergent_mult_const_iff<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stirling_integral_conv_stirling_integral_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"stirling_integral <span class="free">n</span> <span class="free">s</span> <span class="main">=</span>
             of_nat <span class="free">n</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> stirling_integral <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">-</span>
             of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">s</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span>real <span class="bound">N</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> of_nat <span class="bound">N</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">-</span>
             of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">s</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span>
             integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_nat <span class="free">n</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> 
                <span class="main">(</span>of_real <span class="main">(</span>pbernpoly <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⇢</span> <span class="main">0</span> <span class="main">-</span> of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">s</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span>
                   of_nat <span class="free">n</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> stirling_integral <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">⇢</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> stirling_integral_def integral_mult_right
    <span class="keyword1"><span class="command">using</span></span> convergent_stirling_integral<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main">]</span> assms s
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> pbernpoly_over_power_tendsto_0<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> convergent_LIMSEQ_iff <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span> 
               <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span>
               of_nat <span class="free">n</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> stirling_integral <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">-</span>
                 of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">s</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span><span class="main">]</span> pbernpoly_integral_conv_pbernpoly_integral_Suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> 
          assms <span class="keyword1"><span class="command">unfolding</span></span> integral_mult_right
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> power_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> stirling_integral_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> limI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stirling_integral_1_unfold<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"stirling_integral <span class="main">1</span> <span class="free">s</span> <span class="main">=</span> stirling_integral <span class="free">m</span> <span class="free">s</span> <span class="main">/</span> of_nat <span class="free">m</span> <span class="main">-</span> 
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="bound">k</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">s</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stirling_integral <span class="main">1</span> <span class="free">s</span> <span class="main">=</span> stirling_integral <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="free">s</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">-</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">.</span> of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="bound">k</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">s</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">.</span> of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="bound">k</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">s</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> Suc.IH
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stirling_integral <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="free">s</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> 
                 stirling_integral <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                 of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> 
                   <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">s</span> <span class="main">^</span> Suc <span class="skolem">m</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?A</span> <span class="main">-</span> <span class="var">?B</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> stirling_integral_conv_stirling_integral_Suc<span class="main">)</span>
                            <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc power_Suc <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">-</span> <span class="var">?B</span> <span class="main">-</span> <span class="var">?C</span> <span class="main">=</span> <span class="var">?A</span> <span class="main">-</span> <span class="main">(</span><span class="var">?B</span> <span class="main">+</span> <span class="var">?C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> diff_diff_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">+</span> <span class="var">?C</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..&lt;</span>Suc <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">.</span> of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span>
                             <span class="main">(</span>of_nat <span class="bound">k</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">s</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">note</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> ln_Gamma_stirling_complex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ln_Gamma <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">s</span> <span class="main">-</span> <span class="free">s</span> <span class="main">+</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="bound">k</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">s</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> 
             stirling_integral <span class="free">m</span> <span class="free">s</span> <span class="main">/</span> of_nat <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln_Gamma <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">s</span> <span class="main">-</span> <span class="free">s</span> <span class="main">+</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> stirling_integral <span class="main">1</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> limI<span class="main">[</span><span class="operator">OF</span> integral_pbernpoly_1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stirling_integral_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stirling_integral <span class="main">1</span> <span class="free">s</span> <span class="main">=</span> stirling_integral <span class="free">m</span> <span class="free">s</span> <span class="main">/</span> of_nat <span class="free">m</span> <span class="main">-</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="bound">k</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">s</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stirling_integral_1_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> LIMSEQ_stirling_integral<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">x</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>
     <span class="main">⇢</span> stirling_integral <span class="free">n</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stirling_integral_def 
  <span class="keyword1"><span class="command">using</span></span> convergent_stirling_integral<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> convergent_LIMSEQ_iff<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> has_integral_of_real <span class="main">=</span> has_integral_linear<span class="main">[</span><span class="operator">OF</span> _ bounded_linear_of_real<span class="main">,</span> <span class="operator">unfolded</span> o_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> integral_of_real <span class="main">=</span> integral_linear<span class="main">[</span><span class="operator">OF</span> _ bounded_linear_of_real<span class="main">,</span> <span class="operator">unfolded</span> o_def<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> integrable_ln_Gamma_aux_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> pbernpoly <span class="free">n</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> complex_of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="free">N</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_ln_Gamma_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_real <span class="free">s</span>"</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> integrable_linear<span class="main">[</span><span class="operator">OF</span> this bounded_linear_Re<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> o_def Re_complex_of_real<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   stirling_integral_complex_of_real<span class="main">:</span>
            <span class="quoted"><span class="quoted">"stirling_integral <span class="free">n</span> <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_real <span class="main">(</span>stirling_integral <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   LIMSEQ_stirling_integral_real<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> pbernpoly <span class="free">n</span> <span class="bound">t</span> <span class="main">/</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>
            <span class="main">⇢</span> stirling_integral <span class="free">n</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   stirling_integral_real_convergent<span class="main">:</span>
            <span class="quoted"><span class="quoted">"convergent <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> pbernpoly <span class="free">n</span> <span class="bound">t</span> <span class="main">/</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">t</span> <span class="main">/</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⇢</span> stirling_integral <span class="free">n</span> <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LIMSEQ_stirling_integral<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"complex_of_real <span class="free">x</span>"</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> of_real <span class="main">(</span>integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> pbernpoly <span class="free">n</span> <span class="bound">t</span> <span class="main">/</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⇢</span> stirling_integral <span class="free">n</span> <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_ln_Gamma_aux_real<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> integral_of_real<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> tendsto_Re<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> pbernpoly <span class="free">n</span> <span class="bound">t</span> <span class="main">/</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⇢</span> Re <span class="main">(</span>stirling_integral <span class="free">n</span> <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"convergent <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> pbernpoly <span class="free">n</span> <span class="bound">t</span> <span class="main">/</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> convergentI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> pbernpoly <span class="free">n</span> <span class="bound">t</span> <span class="main">/</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⇢</span> stirling_integral <span class="free">n</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> stirling_integral_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> convergent_LIMSEQ_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> tendsto_of_real<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted">complex</span><span class="main">]</span> 
       integrable_ln_Gamma_aux_real<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">xa</span><span class="main">.</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">xa</span><span class="main">}</span> 
                    <span class="main">(</span><span class="main">λ</span><span class="bound">xa</span><span class="main">.</span> complex_of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>complex_of_real <span class="bound">xa</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>
             <span class="main">⇢</span> complex_of_real <span class="main">(</span>stirling_integral <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> integral_of_real <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> LIMSEQ_unique<span class="main">[</span><span class="operator">OF</span> this LIMSEQ_stirling_integral<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"complex_of_real <span class="free">x</span>"</span></span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> assms
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"stirling_integral <span class="free">n</span> <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_real <span class="main">(</span>stirling_integral <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ln_Gamma_stirling_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ln_Gamma <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">x</span> <span class="main">-</span> <span class="free">x</span> <span class="main">+</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span>
              <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> bernoulli <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="bound">k</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
              stirling_integral <span class="free">m</span> <span class="free">x</span> <span class="main">/</span> of_nat <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complex_of_real <span class="main">(</span>ln_Gamma <span class="free">x</span><span class="main">)</span> <span class="main">=</span> ln_Gamma <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_Gamma_complex_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln_Gamma <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> complex_of_real <span class="main">(</span>
                <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">x</span> <span class="main">-</span> <span class="free">x</span> <span class="main">+</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span>
                <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> bernoulli <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="bound">k</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                stirling_integral <span class="free">m</span> <span class="free">x</span> <span class="main">/</span> of_nat <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_Gamma_stirling_complex<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ln_of_real stirling_integral_complex_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_real_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> stirling_integral_bound_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> norm <span class="main">(</span>stirling_integral <span class="free">n</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span>  <span class="free">c</span> <span class="main">/</span> Re <span class="bound">s</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bounded_pbernpoly<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"pbernpoly <span class="free">n</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_real_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> c_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>stirling_integral <span class="free">n</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> Re <span class="skolem">s</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_norm_ubound<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ LIMSEQ_stirling_integral<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> norm <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> s that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_nonneg_pos<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> s that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bound</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">/</span> <span class="main">(</span>Re <span class="skolem">s</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> 
                        <span class="skolem">c</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span>real <span class="bound">N</span> <span class="main">+</span> Re <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> norm <span class="main">(</span>integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span> 
              <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> 
            <span class="skolem">c</span> <span class="main">/</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> Re <span class="skolem">s</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">N</span><span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="skolem">c</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">+</span> Re <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> n s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> Re <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="var">?F</span> <span class="main">(</span>real <span class="skolem">N</span><span class="main">)</span> <span class="main">-</span> <span class="var">?F</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fundamental_theorem_of_calculus<span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> power_diff add_eq_0_iff2
                   has_field_derivative_iff_has_vector_derivative <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>      
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="main">(</span>real <span class="skolem">N</span><span class="main">)</span> <span class="main">-</span> <span class="var">?F</span> <span class="main">0</span> <span class="main">=</span> <span class="var">?bound</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> Re <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="var">?bound</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
              integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> Re <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> integral_norm_bound_integral integrable_ln_Gamma_aux s ballI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> norm <span class="main">(</span>of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> norm_divide norm_power <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono<span class="main">)</span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> Re <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> x c c_nonneg s nz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> complex_Re_le_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono power_mono mult_pos_pos zero_less_power add_nonneg_pos<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> n s * pos nz c<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_nonpos_Reals_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?bound</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> <span class="main">(</span>Re <span class="skolem">s</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c_nonneg elim s n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">/</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Re <span class="skolem">s</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span>
                      <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> <span class="main">(</span>real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> Re <span class="skolem">s</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> s n<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_nonpos_Reals_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stirling_integral_bound_aux_integral1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">-</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> max <span class="free">b</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span>
           <span class="numeral">2</span><span class="main">*</span><span class="free">c</span><span class="main">*</span><span class="main">(</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="free">b</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">c</span><span class="main">/</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">r</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">l</span><span class="main">..</span><span class="free">r</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> <span class="free">a</span> <span class="main">-</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">c</span> <span class="main">/</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F3</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">-</span><span class="free">c</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F1</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="free">c</span> <span class="main">/</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F3</span> <span class="keyword1">has_vector_derivative</span> <span class="main">(</span><span class="free">c</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">A</span>
    <span class="keyword1"><span class="command">unfolding</span></span> F1_def F3_def <span class="keyword1"><span class="command">using</span></span> assms that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> power_diff add_eq_0_iff2
             <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> has_field_derivative_iff_has_vector_derivative<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="skolem">F1</span> <span class="skolem">x1</span> <span class="main">-</span> <span class="skolem">F1</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">l</span><span class="main">..</span><span class="skolem">x1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fundamental_theorem_of_calculus deriv<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x1_def max_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> max <span class="free">b</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="skolem">F1</span> <span class="skolem">x1</span> <span class="main">-</span> <span class="skolem">F1</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">l</span><span class="main">..</span><span class="skolem">x1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_spike_finite_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="free"><span class="free"><span class="free">l</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x1_def max_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> I1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> max <span class="free">b</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="skolem">F1</span> <span class="skolem">x1</span> <span class="main">-</span> <span class="skolem">F1</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">l</span><span class="main">..</span><span class="skolem">x1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> <span class="free">b</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="skolem">x2</span> <span class="main">-</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span> <span class="main">/</span> <span class="free">b</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">{</span><span class="skolem">x1</span><span class="main">..</span><span class="skolem">x2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_integral_const_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">/</span> <span class="free">b</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="skolem">x1</span></span> <span class="quoted"><span class="skolem">x2</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x1_def x2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> max <span class="free">b</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x2</span> <span class="main">-</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span> <span class="main">/</span> <span class="free">b</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">x1</span><span class="main">..</span><span class="skolem">x2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_spike_finite_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">x1</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">x2</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x1_def x2_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> I2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> max <span class="free">b</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x2</span> <span class="main">-</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span> <span class="main">/</span> <span class="free">b</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">x1</span><span class="main">..</span><span class="skolem">x2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> I3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="skolem">F3</span> <span class="free">r</span> <span class="main">-</span> <span class="skolem">F3</span> <span class="skolem">x2</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">x2</span><span class="main">..</span><span class="free">r</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fundamental_theorem_of_calculus deriv<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x2_def min_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> max <span class="free">b</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="skolem">F3</span> <span class="free">r</span> <span class="main">-</span> <span class="skolem">F3</span> <span class="skolem">x2</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">x2</span><span class="main">..</span><span class="free">r</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_spike_finite_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="free"><span class="free"><span class="free">r</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x2_def min_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> I3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> max <span class="free">b</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="skolem">F3</span> <span class="free">r</span> <span class="main">-</span> <span class="skolem">F3</span> <span class="skolem">x2</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">x2</span><span class="main">..</span><span class="free">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> max <span class="free">b</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="skolem">F1</span> <span class="skolem">x1</span> <span class="main">-</span> <span class="skolem">F1</span> <span class="free">l</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x2</span> <span class="main">-</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span> <span class="main">/</span> <span class="free">b</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F3</span> <span class="free">r</span> <span class="main">-</span> <span class="skolem">F3</span> <span class="skolem">x2</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="free">l</span><span class="main">..</span><span class="free">r</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_combine<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ has_integral_combine<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ I1 I2<span class="main"><span class="main">]</span></span> I3<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x1_def x2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F1</span> <span class="skolem">x1</span> <span class="main">-</span> <span class="skolem">F1</span> <span class="free">l</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x2</span> <span class="main">-</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span> <span class="main">/</span> <span class="free">b</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">F3</span> <span class="free">r</span> <span class="main">-</span> <span class="skolem">F3</span> <span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span>
             <span class="skolem">F1</span> <span class="skolem">x1</span> <span class="main">-</span> <span class="skolem">F1</span> <span class="free">l</span> <span class="main">+</span> <span class="skolem">F3</span> <span class="free">r</span> <span class="main">-</span> <span class="skolem">F3</span> <span class="skolem">x2</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x2</span> <span class="main">-</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span> <span class="main">/</span> <span class="free">b</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">-</span> <span class="skolem">x1</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x2_def x1_def min_def max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="main">*</span> <span class="free">c</span> <span class="main">/</span> <span class="free">b</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">c</span> <span class="main">/</span> <span class="free">b</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_diff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F1</span> <span class="skolem">x1</span> <span class="main">-</span> <span class="skolem">F1</span> <span class="free">l</span> <span class="main">+</span> <span class="skolem">F3</span> <span class="free">r</span> <span class="main">-</span> <span class="skolem">F3</span> <span class="skolem">x2</span> <span class="main">=</span>
               <span class="free">c</span><span class="main">/</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">/</span><span class="free">b</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">r</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x1_def x2_def F1_def F3_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">c</span> <span class="main">/</span> <span class="free">b</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
             <span class="numeral">2</span><span class="main">*</span><span class="free">c</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="free">b</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="free">c</span><span class="main">/</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">r</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stirling_integral_bound_aux_integral2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">I</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> max <span class="free">b</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="free">I</span><span class="main">)</span> <span class="main">{</span><span class="free">l</span><span class="main">..</span><span class="free">r</span><span class="main">}</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> min <span class="free">l</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">=</span> max <span class="free">r</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="free">c</span> <span class="main">/</span> real <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="skolem">l'</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">r'</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> has_int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> max <span class="free">b</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">l'</span><span class="main">..</span><span class="skolem">r'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> A_def B_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> stirling_integral_bound_aux_integral1<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> l'_def r'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> max <span class="free">b</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="free">l</span><span class="main">..</span><span class="free">r</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integrable_on_subinterval<span class="main"><span class="main">[</span></span><span class="operator">OF</span> has_integral_integrable<span class="main"><span class="main">[</span></span><span class="operator">OF</span> has_int<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> l'_def r'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> has_int'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">/</span> max <span class="free">b</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">a</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">{</span><span class="free">l</span><span class="main">..</span><span class="free">r</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> integrable_on_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">≤</span> <span class="skolem">A</span> <span class="main">-</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_integral_subset_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ has_int' has_int<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> l'_def r'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B_def l'_def r'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">I</span></span><span class="main">]</span> has_int' <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stirling_integral_bound_aux'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">::</span>complex<span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> complex_cone' <span class="free">α</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">⟹</span>
                     norm <span class="main">(</span>stirling_integral <span class="free">n</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">/</span> norm <span class="bound">s</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bounded_pbernpoly<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"pbernpoly <span class="free">n</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_real_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> c_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> Beta <span class="main">(</span><span class="main">-</span> <span class="main">(</span>real_of_int <span class="main">(</span><span class="main">-</span> int <span class="free">n</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> max <span class="skolem">D</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">c</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">/</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span>sin <span class="free">α</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>stirling_integral <span class="free">n</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="main">/</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> complex_cone' <span class="free">α</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Lim_norm_ubound<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ LIMSEQ_stirling_integral<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> s α <span class="keyword1"><span class="command">have</span></span> arg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>arg <span class="skolem">s</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">α</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_cone_altdef<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> complex_cone_inter_nonpos_Reals<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">α</span>"</span></span> <span class="quoted"><span class="free">α</span></span><span class="main">]</span> α s  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> norm <span class="main">(</span>integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="bound">N</span><span class="main">}</span>
              <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> 
            <span class="skolem">C</span> <span class="main">/</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>nat"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">N</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> norm <span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">n</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                  <span class="skolem">D</span> <span class="main">*</span> <span class="main">(</span>norm <span class="skolem">s</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> has_integral_mult_left<span class="main">[</span><span class="operator">OF</span> has_integral_Beta3<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">n</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">s</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> assms True
          <span class="keyword1"><span class="command">unfolding</span></span> D_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> int'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> norm <span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">n</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_integral</span>
                  <span class="skolem">D</span> <span class="main">*</span> <span class="main">(</span>norm <span class="skolem">s</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> has_integral_interior <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">hence</span></span> integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> norm <span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">n</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
                integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> norm <span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">n</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> integral_norm_bound_integral s ballI integrable_ln_Gamma_aux<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>real<span class="main">..}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>real<span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span>real_of_int <span class="main">(</span><span class="main">-</span> int <span class="free">n</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> int <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span>real_of_int <span class="main">(</span><span class="main">-</span> int <span class="free">n</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_spike_set_eq<span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span>real_of_int <span class="main">(</span><span class="main">-</span> int <span class="free">n</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">integrable_on</span>
                   <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integrable_on_subinterval<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"complex_of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> True x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> norm <span class="main">(</span>of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> norm_divide norm_power <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono<span class="main">)</span> <span class="operator">simp_all</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> sqrt <span class="main">(</span><span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono mult_pos_pos zero_less_power power_mono<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cmod <span class="skolem">s</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≤</span> cmod <span class="main">(</span>complex_of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> x True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> x True c_nonneg assms nz <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> add_nonneg_pos›</span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_powr <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> powr_realpow<span class="main">)</span>
               <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_half_sqrt add_nonneg_pos<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">/</span> <span class="main">…</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> norm <span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">n</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>complex_of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>complex_of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> integral <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> norm <span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">n</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> c_nonneg
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integral_subset_le integrable integrable_on_subinterval<span class="main"><span class="main">[</span></span><span class="operator">OF</span> integrable<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">D</span> <span class="main">*</span> <span class="main">(</span>norm <span class="skolem">s</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> int' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm <span class="skolem">s</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span><span class="free">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> norm <span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">n</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_powr <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> norm <span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">-</span>real <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> <span class="skolem">D</span> <span class="main">/</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_minus powr_realpow <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="main">/</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

      <span class="keyword1"><span class="command">next</span></span>

        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">¦</span>arg <span class="skolem">s</span><span class="main">¦</span> <span class="main">=</span> cos <span class="main">(</span>arg <span class="skolem">s</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span>arg <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> Re <span class="main">(</span>rcis <span class="main">(</span>norm <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>arg <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> norm <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Re_rcis<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Re <span class="skolem">s</span> <span class="main">/</span> norm <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> rcis_cmod_arg<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> cos <span class="main">(</span>pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>arg <span class="skolem">s</span><span class="main">¦</span> <span class="main">≥</span> pi <span class="main">/</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> arg α <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> cos_mono_le_eq<span class="main">)</span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">α</span> <span class="main">*</span> norm <span class="skolem">s</span> <span class="main">=</span> sin <span class="main">(</span>pi <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">*</span> norm <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sin <span class="main">(</span>pi <span class="main">-</span> <span class="main">¦</span>arg <span class="skolem">s</span><span class="main">¦</span><span class="main">)</span> <span class="main">*</span> norm <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> α arg <span class="quoted"><span class="quoted">‹<span class="main">¦</span>arg <span class="skolem">s</span><span class="main">¦</span> <span class="main">≥</span> pi <span class="main">/</span> <span class="numeral">2</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono sin_monotone_2pi_le<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">¦</span>arg <span class="skolem">s</span><span class="main">¦</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> arg_bounded<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sin_ge_zero<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span>pi <span class="main">-</span> <span class="main">¦</span>arg <span class="skolem">s</span><span class="main">¦</span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span>sin <span class="main">¦</span>arg <span class="skolem">s</span><span class="main">¦</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">¦</span>sin <span class="main">(</span>arg <span class="skolem">s</span><span class="main">)</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">*</span> norm <span class="skolem">s</span> <span class="main">=</span> <span class="main">¦</span>Im <span class="main">(</span>rcis <span class="main">(</span>norm <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>arg <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">¦</span>Im <span class="skolem">s</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> rcis_cmod_arg<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> abs_Im_ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Im <span class="skolem">s</span><span class="main">¦</span> <span class="main">≥</span> sin <span class="free">α</span> <span class="main">*</span> norm <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> s <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>›</span></span> False
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cmod_def zero_le_mult_iff complex_nonpos_Reals_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">α</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sin_gt_zero<span class="main">)</span> <span class="operator">auto</span>
  
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">/</span> max <span class="main">¦</span>Im <span class="skolem">s</span><span class="main">¦</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">+</span> Re <span class="skolem">s</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_integral</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span>"</span></span>
                          <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">c</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">/</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">¦</span>Im <span class="skolem">s</span><span class="main">¦</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> s c_nonneg assms False 
                stirling_integral_bound_aux_integral2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>Re <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Im <span class="skolem">s</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">N</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_real <span class="bound">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
                integral <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">/</span> max <span class="main">¦</span>Im <span class="skolem">s</span><span class="main">¦</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">+</span> Re <span class="skolem">s</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> integral_norm_bound_integral integrable_ln_Gamma_aux s ballI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">/</span> max <span class="main">¦</span>Im <span class="skolem">s</span><span class="main">¦</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">+</span> Re <span class="skolem">s</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">integrable_on</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> I<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>real <span class="skolem">N</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"complex_of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>complex_of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>complex_of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span>
                  <span class="skolem">c</span> <span class="main">/</span> norm <span class="main">(</span>complex_of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> norm_divide norm_power <span class="keyword1"><span class="command">using</span></span> c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono<span class="main">)</span> <span class="operator">simp_all</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> max <span class="main">¦</span>Im <span class="skolem">s</span><span class="main">¦</span> <span class="main">¦</span><span class="skolem">x</span> <span class="main">+</span> Re <span class="skolem">s</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> c_nonneg nz abs_Re_le_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span><span class="main">]</span> abs_Im_le_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono power_mono mult_pos_pos zero_less_power<span class="main">)</span>
               <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_max_iff_disj<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>complex_of_real <span class="main">(</span>pbernpoly <span class="free">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>complex_of_real <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_nonpos_Reals_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">c</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">/</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">¦</span>Im <span class="skolem">s</span><span class="main">¦</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> has_integral_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">c</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">/</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>sin <span class="free">α</span> <span class="main">*</span> norm <span class="skolem">s</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sin <span class="free">α</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> s c_nonneg abs_Im_ge
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono mult_pos_pos zero_less_power power_mono mult_nonneg_nonneg<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">c</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">/</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span>sin <span class="free">α</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="main">/</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> C_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> that assms complex_cone_inter_nonpos_Reals<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">-</span></span><span class="free"><span class="free">α</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">α</span></span></span></span><span class="main"><span class="main">]</span></span> α <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stirling_integral_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> norm <span class="main">(</span>stirling_integral <span class="free">n</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">/</span> Re <span class="bound">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span><span class="main">.</span> of_nat <span class="free">n</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> stirling_integral <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">s</span> <span class="main">-</span>
                  of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> stirling_integral_bound_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main">]</span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> norm <span class="main">(</span>stirling_integral <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> Re <span class="bound">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">=</span> real <span class="free">n</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">=</span> <span class="main">¦</span>bernoulli <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">¦</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> c2_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c2_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_nonpos_Reals_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stirling_integral <span class="free">n</span> <span class="skolem">s</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s' assms 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stirling_integral_conv_stirling_integral_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">…</span> <span class="main">≤</span> norm <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> stirling_integral <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span>
                           norm <span class="main">(</span>of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> norm_triangle_ineq4<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real <span class="free">n</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span>stirling_integral <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span>
                      <span class="skolem">c2</span> <span class="main">/</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?A</span> <span class="main">+</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide norm_mult norm_power c2_def <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> real <span class="free">n</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">/</span> Re <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono c s<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">c1</span> <span class="main">/</span> Re <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c1_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">/</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">/</span> Re <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s c2_nonneg
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono power_mono complex_Re_le_cmod mult_pos_pos zero_less_power<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">/</span> Re <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span> <span class="main">+</span> <span class="skolem">c2</span> <span class="main">/</span> Re <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">/</span> Re <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>stirling_integral <span class="free">n</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">/</span> Re <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stirling_integral_bound'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">::</span>complex<span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> complex_cone' <span class="free">α</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">⟹</span> norm <span class="main">(</span>stirling_integral <span class="free">n</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">/</span> norm <span class="bound">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span><span class="main">.</span> of_nat <span class="free">n</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> stirling_integral <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">s</span> <span class="main">-</span>
                  of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> stirling_integral_bound_aux'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main">]</span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">::</span>complex<span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> complex_cone' <span class="free">α</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">⟹</span>
            norm <span class="main">(</span>stirling_integral <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> norm <span class="bound">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">=</span> real <span class="free">n</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">=</span> <span class="main">¦</span>bernoulli <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">¦</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> c2_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c2_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword3"><span class="command">assume</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> complex_cone' <span class="free">α</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> complex_cone_inter_nonpos_Reals<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">α</span>"</span></span> <span class="quoted"><span class="free">α</span></span><span class="main">]</span> assms s <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stirling_integral <span class="free">n</span> <span class="skolem">s</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s' assms 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> stirling_integral_conv_stirling_integral_Suc<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">…</span> <span class="main">≤</span> norm <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">/</span> of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> stirling_integral <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span>
                           norm <span class="main">(</span>of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> norm_triangle_ineq4<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real <span class="free">n</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span>stirling_integral <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span>
                      <span class="skolem">c2</span> <span class="main">/</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?A</span> <span class="main">+</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide norm_mult norm_power c2_def <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> real <span class="free">n</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">/</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono c s<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">c1</span> <span class="main">/</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c1_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">/</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span> <span class="main">+</span> <span class="skolem">c2</span> <span class="main">/</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">/</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>stirling_integral <span class="free">n</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">+</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">/</span> norm <span class="skolem">s</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> stirling_integral_holomorphic <span class="main">[</span><span class="operator">holomorphic_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"stirling_integral <span class="free">m</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">s</span><span class="main">::</span>complex<span class="main">.</span> of_nat <span class="free">m</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> Ln <span class="bound">s</span> <span class="main">-</span> <span class="bound">s</span> <span class="main">+</span> of_real <span class="main">(</span>ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="bound">k</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> 
          ln_Gamma <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Reals_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> stirling_integral <span class="free">m</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_cong refl<span class="main">)</span> 
                   <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> ln_Gamma_stirling_complex<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"stirling_integral <span class="free">m</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stirling_integral_continuous_on_complex <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"continuous_on <span class="free">A</span> <span class="main">(</span>stirling_integral <span class="free">m</span> <span class="main">::</span> <span class="main">_</span> <span class="main">⇒</span> complex<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_on_imp_continuous_on stirling_integral_holomorphic assms<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> has_field_derivative_stirling_integral_complex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>stirling_integral <span class="free">n</span> <span class="keyword1">has_field_derivative</span> deriv <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> holomorphic_derivI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> stirling_integral_holomorphic<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span></span></span>  <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">-</span></span></span><span class="main"><span class="main"><span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>


 
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   deriv_stirling_integral_complex_of_real<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span>
               complex_of_real <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="free">x</span> <span class="main">=</span> <span class="var">?rhs</span> <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span>     differentiable_stirling_integral_real<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="free">x</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span> <span class="bound">x</span><span class="main">.</span> complex_of_real <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"open <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt<span class="main">)</span>      

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?rhs</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="skolem">x</span>"</span></span> 
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">j</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Re <span class="main">(</span>stirling_integral <span class="free">n</span> <span class="main">(</span>of_real <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> 
                  Re <span class="main">(</span>deriv <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> stirling_integral <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 n
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span> has_vector_derivative_real_field
                 field_differentiable_derivI holomorphic_on_imp_differentiable_at<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span><span class="main"><span class="main">]</span></span>
                 stirling_integral_holomorphic <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_nonpos_Reals_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span>stirling_integral <span class="free">n</span> <span class="keyword1">has_field_derivative</span> 
             Re <span class="main">(</span>deriv <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> stirling_integral <span class="free">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eventually_nhds_in_open<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> 0 n
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_field_derivative_cong_ev refl<span class="main">)</span> 
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> stirling_integral_complex_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stirling_integral <span class="free">n</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> field_differentiable_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 0 n <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> stirling_integral_complex_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> conjunct1<span class="main">[</span><span class="operator">OF</span> Suc.IH<span class="main">]</span> conjunct2<span class="main">[</span><span class="operator">OF</span> Suc.IH<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span>
                 of_real <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deriv <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span>
              vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span> <span class="main">(</span>of_real <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> n x
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> vector_derivative_of_real_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 
                   holomorphic_on_imp_differentiable_at<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?A</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span> holomorphic_higher_deriv
                   stirling_integral_holomorphic<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_nonpos_Reals_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> vector_derivative <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> of_real <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eventually_nhds_in_open<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> x
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> vector_derivative_cong_eq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_real <span class="main">(</span>deriv <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> vector_derivative_of_real_left holomorphic_on_imp_differentiable_at<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?A</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span>
              field_differentiable_imp_differentiable IH<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Re <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span> <span class="main">(</span>of_real <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> 
             Re <span class="main">(</span>deriv <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.prems n
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">derivative_intros</span></span> has_vector_derivative_real_field field_differentiable_derivI
                holomorphic_on_imp_differentiable_at<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?A</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span> stirling_integral_holomorphic
                holomorphic_higher_deriv<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_nonpos_Reals_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> 
                  Re <span class="main">(</span>deriv <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> eventually_nhds_in_open<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> Suc.prems *
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> has_field_derivative_cong_ev refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">n</span><span class="main">)</span> <span class="keyword1">field_differentiable</span> <span class="keyword1">at</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> field_differentiable_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> *<span class="main">[</span><span class="operator">OF</span> Suc.prems<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="free">x</span> <span class="main">=</span> <span class="var">?rhs</span> <span class="free">x</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Unfortunately, asymptotic power series cannot, in general, be differentiated. However, since 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">ln_Gamma</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is holomorphic on the entire positive real half-space, we can differentiate 
  its asymptotic expansion after all.

  To do this, we use an ad-hoc version of the more general approach outlined in Erdelyi's
  ``Asymptotic Expansions'' for holomorphic functions: We bound the value of the $j$-th derivative 
  of the remainder term at some value $x$ by applying Cauchy's integral formula along a circle 
  centred at $x$ with radius $\frac{1}{2} x$.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> deriv_stirling_integral_real_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">m</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> stirling_integral_bound<span class="main">[</span><span class="operator">OF</span> m<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> c <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">note</span></span> c <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> cmod <span class="main">(</span>stirling_integral <span class="free">m</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> c_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> Suc <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">=</span> <span class="skolem">B</span> <span class="main">*</span> fact <span class="free">j</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> norm <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">m</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> 
          <span class="skolem">B'</span> <span class="main">*</span> norm <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> cball <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">complex</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> Re <span class="skolem">s</span> <span class="main">≤</span> norm <span class="main">(</span>of_real <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> complex_Re_le_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_real <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">s</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_complex_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_nonpos_Reals_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> stirling_integral <span class="free">m</span> <span class="bound">u</span> <span class="main">/</span> <span class="main">(</span><span class="bound">u</span> <span class="main">-</span> of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">j</span><span class="main">)</span> <span class="keyword1">has_contour_integral</span>
            complex_of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> fact <span class="free">j</span> <span class="main">*</span> 
              <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">m</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>circlepath <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> m elim
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Cauchy_has_contour_integral_higher_derivative_circlepath 
                stirling_integral_continuous_on_complex stirling_integral_holomorphic<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">/</span> fact <span class="free">j</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">m</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
            <span class="skolem">B</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> has_contour_integral_bound_circlepath<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword3"><span class="command">assume</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">u</span> <span class="main">-</span> of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>of_real <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span>of_real <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> complex_Re_le_cmod<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_minus_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> Re_u<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">u</span> <span class="main">≥</span> <span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>stirling_integral <span class="free">m</span> <span class="skolem">u</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">-</span> of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">≤</span> 
              <span class="skolem">c</span> <span class="main">/</span> Re <span class="skolem">u</span> <span class="main">^</span> <span class="free">m</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Re_u elim
        <span class="keyword1"><span class="command">unfolding</span></span> norm_divide norm_power dist
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono zero_le_power c<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="free">m</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c_nonneg elim Re_u
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono divide_left_mono power_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">B</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> Suc <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B_def <span class="dynamic"><span class="dynamic">field_simps</span></span> power_add<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>stirling_integral <span class="free">m</span> <span class="skolem">u</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">-</span> of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">B</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> Suc <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> elim c_nonneg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> power_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">m</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">B'</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> norm_divide norm_mult norm_power B'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> elim m <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac deriv_stirling_integral_complex_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bigoI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stirling_sum</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stirling_sum</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> 
     <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">.</span> <span class="main">(</span>of_real <span class="main">(</span>bernoulli <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> pochhammer <span class="main">(</span>of_nat <span class="bound">k</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">/</span> <span class="main">(</span>of_nat <span class="bound">k</span> <span class="main">*</span>
                                 of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> inverse <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">^</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stirling_sum'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stirling_sum'</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> 
     <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">.</span> <span class="main">(</span>of_real <span class="main">(</span>bernoulli' <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> 
       pochhammer <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> inverse <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">^</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stirling_sum_complex_of_real<span class="main">:</span>
  <span class="quoted"><span class="quoted">"stirling_sum <span class="free">j</span> <span class="free">m</span> <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> complex_of_real <span class="main">(</span>stirling_sum <span class="free">j</span> <span class="free">m</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stirling_sum_def pochhammer_of_real <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> stirling_sum'_complex_of_real<span class="main">:</span>
  <span class="quoted"><span class="quoted">"stirling_sum' <span class="free">j</span> <span class="free">m</span> <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> complex_of_real <span class="main">(</span>stirling_sum' <span class="free">j</span> <span class="free">m</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stirling_sum'_def pochhammer_of_real <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> has_field_derivative_stirling_sum_complex <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span>stirling_sum <span class="free">j</span> <span class="free">m</span> <span class="keyword1">has_field_derivative</span> stirling_sum <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> stirling_sum_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> sum_distrib_left
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_sum<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc 
                              <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pochhammer_Suc power_diff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> has_field_derivative_stirling_sum_real <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>stirling_sum <span class="free">j</span> <span class="free">m</span> <span class="keyword1">has_field_derivative</span> stirling_sum <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> stirling_sum_def <span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> sum_distrib_left
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_sum<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc 
                              <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pochhammer_Suc power_diff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> has_field_derivative_stirling_sum'_complex <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>stirling_sum' <span class="free">j</span> <span class="free">m</span> <span class="keyword1">has_field_derivative</span> stirling_sum' <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">j</span> <span class="main">*</span> complex_of_real <span class="main">(</span>bernoulli' <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> 
                          pochhammer <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">j'</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">n</span> <span class="main">*</span> inverse <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">T'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span>of_nat <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="bound">n</span> <span class="main">*</span> inverse <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">m</span><span class="main">.</span> <span class="skolem">T</span> <span class="bound">k</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">m</span><span class="main">.</span> <span class="skolem">T'</span> <span class="bound">k</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms Suc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DERIV_sum<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def T'_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> 
             <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>  <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc power_Suc of_nat_add<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">m</span><span class="main">.</span> <span class="skolem">T</span> <span class="bound">k</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> stirling_sum' <span class="free">j</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc T_def c_def stirling_sum'_def fun_eq_iff add_ac mult.assoc sum_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">m</span><span class="main">.</span> <span class="skolem">T'</span> <span class="bound">k</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> stirling_sum' <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T'_def c_def Suc stirling_sum'_def sum_distrib_left 
          sum_distrib_right <span class="dynamic"><span class="dynamic">algebra_simps</span></span> pochhammer_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> has_field_derivative_stirling_sum'_real <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>stirling_sum' <span class="free">j</span> <span class="free">m</span> <span class="keyword1">has_field_derivative</span> stirling_sum' <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">j</span> <span class="main">*</span> <span class="main">(</span>bernoulli' <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> pochhammer <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">j'</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="bound">n</span> <span class="main">*</span> inverse <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">T'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="main">(</span>of_nat <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">c</span> <span class="bound">n</span> <span class="main">*</span> inverse <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">m</span><span class="main">.</span> <span class="skolem">T</span> <span class="bound">k</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">has_field_derivative</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">m</span><span class="main">.</span> <span class="skolem">T'</span> <span class="bound">k</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms Suc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DERIV_sum<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def T'_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> 
             <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>  <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc power_Suc of_nat_add<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">m</span><span class="main">.</span> <span class="skolem">T</span> <span class="bound">k</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> stirling_sum' <span class="free">j</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc T_def c_def stirling_sum'_def fun_eq_iff add_ac mult.assoc sum_distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">m</span><span class="main">.</span> <span class="skolem">T'</span> <span class="bound">k</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> stirling_sum' <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T'_def c_def Suc stirling_sum'_def sum_distrib_left 
          sum_distrib_right <span class="dynamic"><span class="dynamic">algebra_simps</span></span> pochhammer_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> higher_deriv_stirling_sum_complex<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>stirling_sum <span class="free">j</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> stirling_sum <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"deriv <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>stirling_sum <span class="free">j</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> deriv <span class="main">(</span>stirling_sum <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_nhds_in_open<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> Re <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> Suc.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> deriv_cong_ev refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt Suc.IH<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> Suc.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> stirling_sum <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DERIV_imp_deriv has_field_derivative_stirling_sum_complex<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Polygamma_approx</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>real_normed_field<span class="main">,</span> ln<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Polygamma_approx</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> 
     <span class="main">(</span>deriv <span class="main">^^</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">+</span> of_real <span class="main">(</span>ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> stirling_sum <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> Polygamma_approx_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"Polygamma_approx <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> deriv <span class="main">(</span>Polygamma_approx <span class="free">j</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polygamma_approx_def<span class="main">)</span>  

<span class="keyword1"><span class="command">lemma</span></span> Polygamma_approx_0<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"Polygamma_approx <span class="main">0</span> <span class="free">m</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="free">x</span> <span class="main">-</span> <span class="free">x</span> <span class="main">+</span> of_real <span class="main">(</span>ln <span class="main">(</span><span class="numeral">2</span><span class="main">*</span>pi<span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> stirling_sum <span class="main">0</span> <span class="free">m</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polygamma_approx_def<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> Polygamma_approx_1_complex<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> 
     Polygamma_approx <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span> <span class="main">=</span> ln <span class="free">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">+</span> stirling_sum <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Polygamma_approx_Suc Polygamma_approx_0
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DERIV_imp_deriv<span class="main">)</span> 
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Reals_cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
     
<span class="keyword1"><span class="command">lemma</span></span> Polygamma_approx_1_real<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">⟹</span> 
     Polygamma_approx <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span> <span class="main">=</span> ln <span class="free">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">)</span> <span class="main">+</span> stirling_sum <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Polygamma_approx_Suc Polygamma_approx_0
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DERIV_imp_deriv<span class="main">)</span> 
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Reals_cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
 
<span class="keyword1"><span class="command">lemma</span></span> stirling_sum_2_conv_stirling_sum'_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>real_div_algebra<span class="main">,</span> field_char_0<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"stirling_sum' <span class="main">1</span> <span class="free">m</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> stirling_sum <span class="numeral">2</span> <span class="free">m</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> pochhammer_2<span class="main">:</span> <span class="quoted"><span class="quoted">"pochhammer <span class="main">(</span>of_nat <span class="skolem">k</span><span class="main">)</span> <span class="numeral">2</span> <span class="main">=</span> of_nat <span class="skolem">k</span> <span class="main">*</span> of_nat <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pochhammer_Suc eval_nat_numeral add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stirling_sum <span class="numeral">2</span> <span class="free">m</span> <span class="free">x</span> <span class="main">=</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> of_real <span class="main">(</span>bernoulli' <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> inverse <span class="free">x</span> <span class="main">^</span> Suc <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> stirling_sum_def pochhammer_2 power2_minus power_one mult_1_left
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stirling_sum_def pochhammer_2 power2_eq_square <span class="dynamic"><span class="dynamic">divide_simps</span></span> bernoulli'_def
                 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_Suc power_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> of_real <span class="main">(</span>bernoulli' <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> inverse <span class="free">x</span> <span class="main">^</span> Suc <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sum.atLeast_Suc_lessThan<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="free">x</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">m</span><span class="main">.</span> of_real <span class="main">(</span>bernoulli' <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> inverse <span class="free">x</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.atLeast0_lessThan_Suc_shift<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bernoulli'_def <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">m</span><span class="main">.</span> of_real <span class="main">(</span>bernoulli' <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> inverse <span class="free">x</span> <span class="main">^</span> Suc <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> stirling_sum' <span class="main">1</span> <span class="free">m</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stirling_sum'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Polygamma_approx_2_real<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Polygamma_approx <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span> <span class="main">=</span> stirling_sum' <span class="main">1</span> <span class="free">m</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polygamma_approx <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span> <span class="main">=</span> deriv <span class="main">(</span>Polygamma_approx <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polygamma_approx_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> deriv <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> stirling_sum <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">m</span> <span class="bound">x</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_nhds_in_open<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> deriv_cong_ev<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Polygamma_approx_1_real<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> stirling_sum <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DERIV_imp_deriv<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> 
           <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Reals_cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> stirling_sum' <span class="main">1</span> <span class="free">m</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> stirling_sum_2_conv_stirling_sum'_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> Polygamma_approx_2_complex<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Polygamma_approx <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span> <span class="main">=</span> stirling_sum' <span class="main">1</span> <span class="free">m</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polygamma_approx <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span> <span class="main">=</span> deriv <span class="main">(</span>Polygamma_approx <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polygamma_approx_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> deriv <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">+</span> stirling_sum <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">m</span> <span class="bound">x</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_nhds_in_open<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> deriv_cong_ev<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Polygamma_approx_1_complex<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="free">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> stirling_sum <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DERIV_imp_deriv<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> 
           <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Reals_cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> stirling_sum' <span class="main">1</span> <span class="free">m</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> stirling_sum_2_conv_stirling_sum'_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> stirling_sum_2_conv_stirling_sum'_1<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> Polygamma_approx_ge_2_real<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Polygamma_approx <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span> <span class="main">=</span> stirling_sum' <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">j</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>0 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polygamma_approx_2_real<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polygamma_approx <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="skolem">x</span> <span class="main">=</span> deriv <span class="main">(</span>Polygamma_approx <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polygamma_approx_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> deriv <span class="main">(</span>stirling_sum' <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_nhds_in_open<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> Suc.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> deriv_cong_ev refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc.IH<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> stirling_sum' <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DERIV_imp_deriv <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> Polygamma_approx_ge_2_complex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Polygamma_approx <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span> <span class="main">=</span> stirling_sum' <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="free">m</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">j</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>0 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polygamma_approx_2_complex<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polygamma_approx <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="skolem">x</span> <span class="main">=</span> deriv <span class="main">(</span>Polygamma_approx <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polygamma_approx_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> deriv <span class="main">(</span>stirling_sum' <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_nhds_in_open<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> Re <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> Suc.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> deriv_cong_ev refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc.IH open_halfspace_Re_gt<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> stirling_sum' <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="free">m</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.prems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DERIV_imp_deriv <span class="dynamic"><span class="dynamic">derivative_intros</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Polygamma_approx_complex_of_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Polygamma_approx <span class="free">j</span> <span class="free">m</span> <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_real <span class="main">(</span>Polygamma_approx <span class="free">j</span> <span class="free">m</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polygamma_approx_0 Ln_of_real stirling_sum_complex_of_real<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="main">(</span>Suc <span class="skolem">j'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j'</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polygamma_approx_1_complex 
                    Polygamma_approx_1_real stirling_sum_complex_of_real Ln_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polygamma_approx_ge_2_complex Polygamma_approx_ge_2_real 
                    stirling_sum'_complex_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> higher_deriv_Polygamma_approx <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>Polygamma_approx <span class="free">i</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> Polygamma_approx <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polygamma_approx_def funpow_add<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> stirling_sum_holomorphic <span class="main">[</span><span class="operator">holomorphic_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟹</span> stirling_sum <span class="free">j</span> <span class="free">m</span> <span class="keyword1">holomorphic_on</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> stirling_sum_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">lemma</span></span> Polygamma_approx_holomorphic <span class="main">[</span><span class="operator">holomorphic_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Polygamma_approx <span class="free">j</span> <span class="free">m</span> <span class="keyword1">holomorphic_on</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> Re <span class="bound">s</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Polygamma_approx_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Reals_cases<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> higher_deriv_lnGamma_stirling<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> ln_Gamma <span class="bound">x</span> <span class="main">-</span> Polygamma_approx <span class="free">j</span> <span class="free">m</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> ln_Gamma <span class="bound">x</span> <span class="main">-</span> Polygamma_approx <span class="free">j</span> <span class="free">m</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">=</span>
                          inverse <span class="main">(</span>real <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">¦</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">m</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> x <span class="main">=</span> this
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">y</span> <span class="keyword1">in</span> nhds <span class="main">(</span>complex_of_real <span class="skolem">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">-</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> elim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_nhds_in_open<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln_Gamma <span class="bound">x</span> <span class="main">-</span> Polygamma_approx <span class="main">0</span> <span class="free">m</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span>inverse <span class="main">(</span>of_nat <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> stirling_integral <span class="free">m</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x m
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> higher_deriv_cong_ev refl<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ln_Gamma_stirling_complex Polygamma_approx_def 
            <span class="dynamic"><span class="dynamic">field_simps</span></span> open_halfspace_Re_gt stirling_sum_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span> inverse <span class="main">(</span>of_nat <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">m</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x m
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> higher_deriv_cmult<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">-</span></span></span><span class="main"><span class="main"><span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> stirling_integral_holomorphic<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln_Gamma <span class="bound">x</span> <span class="main">-</span> Polygamma_approx <span class="main">0</span> <span class="free">m</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> ln_Gamma <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>Polygamma_approx <span class="main">0</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>of_real <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> higher_deriv_diff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> Re <span class="bound"><span class="bound"><span class="bound">s</span></span></span> <span class="main"><span class="main"><span class="main">&gt;</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">holomorphic_intros</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nonpos_Reals_cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_halfspace_Re_gt<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>Polygamma_approx <span class="main">0</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span>
                 of_real <span class="main">(</span>Polygamma_approx <span class="free">j</span> <span class="free">m</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x m
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polygamma_approx_complex_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">-</span> inverse <span class="main">(</span>of_nat <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">m</span><span class="main">)</span> <span class="main">(</span>complex_of_real <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                 inverse <span class="main">(</span>real <span class="free">m</span><span class="main">)</span> <span class="main">*</span> <span class="main">¦</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">m</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x m <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult norm_inverse deriv_stirling_integral_complex_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> ln_Gamma <span class="main">(</span>complex_of_real <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> of_real <span class="main">(</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> ln_Gamma <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> higher_deriv_ln_Gamma_complex_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">…</span> <span class="main">-</span> of_real <span class="main">(</span>Polygamma_approx <span class="free">j</span> <span class="free">m</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="main">¦</span><span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> ln_Gamma <span class="skolem">x</span> <span class="main">-</span> Polygamma_approx <span class="free">j</span> <span class="free">m</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_real_diff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> norm_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> bigthetaI_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> m
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> ln_Gamma <span class="bound">x</span> <span class="main">-</span> Polygamma_approx <span class="free">j</span> <span class="free">m</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> 
             <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">m</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>stirling_integral <span class="free">m</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> deriv_stirling_integral_real_bound<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Polygamma_approx_1_real'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Polygamma_approx <span class="main">1</span> <span class="free">m</span> <span class="free">x</span> <span class="main">=</span> ln <span class="free">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">m</span><span class="main">.</span> bernoulli' <span class="bound">k</span> <span class="main">*</span> inverse <span class="free">x</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">/</span> real <span class="bound">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polygamma_approx <span class="main">1</span> <span class="free">m</span> <span class="free">x</span> <span class="main">=</span> ln <span class="free">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> 
          <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span>Suc <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> bernoulli <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> inverse <span class="free">x</span> <span class="main">^</span> Suc <span class="bound">k</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">-</span> <span class="main">(</span><span class="main">_</span> <span class="main">+</span> <span class="var">?S</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polygamma_approx_1_real stirling_sum_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span>Suc <span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> bernoulli' <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> inverse <span class="free">x</span> <span class="main">^</span> Suc <span class="bound">k</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bernoulli'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> bernoulli' <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> inverse <span class="free">x</span> <span class="main">^</span> Suc <span class="bound">k</span> <span class="main">/</span> real <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sum.atLeast_Suc_lessThan<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">..</span><span class="free">m</span><span class="main">.</span> bernoulli' <span class="bound">k</span> <span class="main">*</span> inverse <span class="free">x</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">/</span> real <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.shift_bounds_Suc_ivl <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atLeastLessThanSuc_atLeastAtMost<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   ln_Gamma_real_asymptotics<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln_Gamma <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">+</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span>
                     <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">1</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> bernoulli <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>real <span class="bound">k</span> <span class="main">*</span> real <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span><span class="main">^</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>   Digamma_real_asymptotics<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Digamma <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">m</span><span class="main">.</span> bernoulli' <span class="bound">k</span> <span class="main">/</span> real <span class="bound">k</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">x</span> <span class="main">^</span> Suc <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>   Polygamma_real_asymptotics<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> 
             <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Polygamma <span class="free">j</span> <span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">j</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">m</span><span class="main">.</span> bernoulli' <span class="bound">k</span> <span class="main">*</span>
                     pochhammer <span class="main">(</span>real <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?th3</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> ln_Gamma <span class="keyword1">else</span> Polygamma <span class="main">(</span><span class="bound">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">G</span> <span class="skolem">j</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> Polygamma_approx <span class="skolem">j</span> <span class="free">m</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">h</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">h</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">G</span> <span class="skolem">j</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> 
            <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>deriv <span class="main">^^</span> <span class="skolem">j</span><span class="main">)</span> ln_Gamma <span class="bound">x</span> <span class="main">-</span> Polygamma_approx <span class="skolem">j</span> <span class="free">m</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="var">?f</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span>
            <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> funpow.simps <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> higher_deriv_ln_Gamma_real G_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> higher_deriv_lnGamma_stirling<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>  
    
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> simplify_landau_sum<span class="main">]</span><span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> *<span class="main">[</span><span class="operator">OF</span> Polygamma_approx_0<span class="main">]</span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th1</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def Polygamma_approx_0 stirling_sum_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> *<span class="main">[</span><span class="operator">OF</span> Polygamma_approx_1_real'<span class="main">]</span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      
  <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> *<span class="main">[</span><span class="operator">OF</span> Polygamma_approx_ge_2_real<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span> assms j <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?th3</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def stirling_sum'_def power_add power_diff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Asymptotics of the complex Gamma function›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>m›</span></span></span></span>-th order remainder of Stirling's formula for $\log\Gamma$ is $O(s^{-m})$ uniformly over
  any complex cone $\text{arg}(z) \leq \alpha$, $z\neq 0$ for any angle
  $\alpha\in(0, \pi)$. This means that there is bounded by $c z^{-m}$ for some constant $c$ for
  all $z$ in this cone.
›</span></span>
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">α</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≡</span> principal <span class="main">(</span>complex_cone' <span class="free">α</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> stirling_integral_bigo<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"stirling_integral <span class="free">m</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">s</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> complex_cone' <span class="free">α</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">⟹</span> norm <span class="main">(</span>stirling_integral <span class="free">m</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> norm <span class="bound">s</span> <span class="main">^</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stirling_integral_bound'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> α<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> norm <span class="main">(</span>stirling_integral <span class="free">m</span> <span class="main">1</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> α <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> complex_cone' <span class="free">α</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_principal<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> norm <span class="main">(</span>stirling_integral <span class="free">m</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span>
                     <span class="skolem">c</span> <span class="main">*</span> norm <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="bound">s</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> c <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main">:</span> norm_divide norm_power›</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"stirling_integral <span class="free">m</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">s</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following is a more explicit statement of this:
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> ln_Gamma_complex_asymptotics_explicit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">α</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">C</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">::</span>complex<span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟶</span>
               ln_Gamma <span class="bound">s</span> <span class="main">=</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">s</span> <span class="main">-</span> <span class="bound">s</span> <span class="main">+</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span>
                            <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> bernoulli <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">R</span> <span class="bound">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">¦</span>arg <span class="bound">s</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">α</span> <span class="main">⟶</span> norm <span class="main">(</span><span class="free">R</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span> <span class="free">C</span> <span class="main">/</span> norm <span class="bound">s</span> <span class="main">^</span> <span class="free">m</span>"</span></span>    
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> complex_cone' <span class="free">α</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">⟹</span> norm <span class="main">(</span>stirling_integral <span class="free">m</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> norm <span class="bound">s</span> <span class="main">^</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stirling_integral_bound'<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> norm <span class="main">(</span>stirling_integral <span class="free">m</span> <span class="main">1</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>complex<span class="main">.</span> stirling_integral <span class="free">m</span> <span class="bound">s</span> <span class="main">/</span> of_nat <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> ln_Gamma_stirling_complex<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">m</span></span><span class="main">]</span> assms <span class="keyword3"><span class="command">show</span></span>
           <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">::</span>complex<span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟶</span>
               ln_Gamma <span class="bound">s</span> <span class="main">=</span> <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">s</span> <span class="main">-</span> <span class="bound">s</span> <span class="main">+</span> ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..&lt;</span><span class="free">m</span><span class="main">.</span> bernoulli <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="bound">s</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">R</span> <span class="bound">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">¦</span>arg <span class="bound">s</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">α</span> <span class="main">⟶</span> cmod <span class="main">(</span><span class="skolem">R</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">/</span> real <span class="free">m</span> <span class="main">/</span> cmod <span class="bound">s</span> <span class="main">^</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 c<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_cone_altdef abs_le_iff R_def norm_divide <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lastly, we can also derive the asymptotics of $\Gamma$ itself:
  \[\Gamma(z) \sim \sqrt{2\pi / z} \left(\frac{z}{e}\right)^z\]
  uniformly for $|z|\to\infty$ within the cone $\text{arg}(z) \leq \alpha$ for $\alpha\in(0,\pi)$:
›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">α</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span>pi<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≡</span> inf at_infinity <span class="main">(</span>principal <span class="main">(</span>complex_cone' <span class="free">α</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Gamma_complex_asymp_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Gamma <span class="main">∼[</span><span class="free">F</span><span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="bound">s</span> <span class="main">/</span> <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> stirling_integral <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> complex_cone' <span class="free">α</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_inf_principal F_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> F_def eventually_inf_principal
    <span class="keyword1"><span class="command">using</span></span> eventually_not_equal_at_infinity <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> Gamma <span class="bound">s</span> <span class="main">=</span>
                     sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="bound">s</span> <span class="main">/</span> <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="skolem">I</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> elim <span class="keyword1"><span class="command">have</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> <span class="main">ℝ<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> complex_cone_inter_nonpos_Reals<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">α</span>"</span></span> <span class="quoted"><span class="free">α</span></span><span class="main">]</span> α <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> elim <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
    <span class="keyword1"><span class="command">from</span></span> s' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="skolem">s</span> <span class="main">=</span> exp <span class="main">(</span>ln_Gamma <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Gamma_complex_altdef <span class="keyword1"><span class="command">using</span></span> nonpos_Ints_subset_nonpos_Reals <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> s' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln_Gamma <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> Ln <span class="skolem">s</span> <span class="main">-</span> <span class="skolem">s</span> <span class="main">+</span> complex_of_real <span class="main">(</span>ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">I</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_Gamma_stirling_complex<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_add exp_diff I_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">…</span> <span class="main">=</span> exp <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> Ln <span class="skolem">s</span><span class="main">)</span> <span class="main">/</span> exp <span class="skolem">s</span> <span class="main">*</span>
                        exp <span class="main">(</span>complex_of_real <span class="main">(</span>ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="skolem">I</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> exp_diff exp_add <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_diff exp_add<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> Ln <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span>complex_of_real <span class="main">(</span>ln <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> exp_of_real<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> powr_half_sqrt<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="skolem">s</span> <span class="main">=</span> exp <span class="main">1</span> <span class="keyword1">powr</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">1</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">/</span> exp <span class="main">1</span> <span class="keyword1">powr</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_diff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Ln <span class="main">(</span><span class="skolem">s</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="main">=</span> Ln <span class="skolem">s</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Ln_divide_of_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"exp <span class="main">1</span>"</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> exp_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">/</span> exp <span class="main">1</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> powr_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> exp_diff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="skolem">s</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">s</span> <span class="main">/</span> <span class="skolem">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="skolem">I</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Gamma <span class="main">∼[</span><span class="free">F</span><span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="bound">s</span> <span class="main">/</span> <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> exp <span class="main">(</span><span class="skolem">I</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equiv_refl_ev<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∼[</span><span class="free">F</span><span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="main">/</span> exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="bound">s</span> <span class="main">/</span> <span class="bound">s</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≤</span> principal <span class="main">(</span>complex_cone' <span class="free">α</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> le_principal F_def eventually_inf_principal
      <span class="keyword1"><span class="command">using</span></span> eventually_not_equal_at_infinity <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">∈</span> <span class="keyword1">O[</span>principal <span class="main">(</span>complex_cone' <span class="free">α</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span><span class="main">](</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> stirling_integral_bigo<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">α</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> α <span class="keyword1"><span class="command">unfolding</span></span> F_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.big.filter_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.smallI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted">real</span>
      <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>complex<span class="main">.</span> norm <span class="bound">z</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">c</span><span class="main">)</span> at_infinity"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_infinity<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>complex<span class="main">.</span> <span class="bound">z</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> at_infinity"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_not_equal_at_infinity<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">::</span>complex<span class="main">.</span> norm <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="bound">z</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> norm <span class="main">(</span><span class="main">1</span> <span class="main">::</span> complex<span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> F_def eventually_inf_principal
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> norm_divide <span class="dynamic"><span class="dynamic">field_simps</span></span>›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> smalloD_tendsto<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">tendsto_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">I</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="skolem">I</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∼[</span><span class="free">F</span><span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> asymp_equivI' <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span> refl <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>