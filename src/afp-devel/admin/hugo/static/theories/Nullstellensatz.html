<div id="Algebraically_Closed_Fields">
<div class="head">
<h1>Theory Algebraically_Closed_Fields</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Algebraically Closed Fields›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Algebraically_Closed_Fields
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Fundamental_Theorem_Algebra.html">HOL-Computational_Algebra.Fundamental_Theorem_Algebra</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prod_eq_zeroE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prod <span class="free">f</span> <span class="free">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>semiring_no_zero_divisors<span class="main">,</span>comm_monoid_mult<span class="main">,</span>zero_neq_one<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">i</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">thesis</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">from</span></span> empty<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">I</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> insert.hyps<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">j</span> <span class="main">*</span> prod <span class="free">f</span> <span class="skolem">I</span> <span class="main">=</span> prod <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> prod <span class="free">f</span> <span class="skolem">I</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> _ <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prod <span class="free">f</span> <span class="skolem">I</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> _ this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">I</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> degree_prod_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">(</span>prod <span class="free">f</span> <span class="free">I</span> <span class="main">::</span> <span class="main">_</span><span class="main">::</span>semiring_no_zero_divisors poly<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> Polynomial.degree <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">J</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> insert <span class="skolem">j</span> <span class="skolem">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">(</span>prod <span class="free">f</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">J</span><span class="main">.</span> Polynomial.degree <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert.hyps<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">(</span>prod <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">J</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Polynomial.degree <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span> <span class="main">*</span> prod <span class="free">f</span> <span class="skolem">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Polynomial.degree <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> Polynomial.degree <span class="main">(</span>prod <span class="free">f</span> <span class="skolem">J</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> degree_mult_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prod <span class="free">f</span> <span class="skolem">J</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prod <span class="free">f</span> <span class="skolem">J</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_eq_zeroE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> insert.hyps<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span>insert <span class="skolem">j</span> <span class="skolem">J</span><span class="main">.</span> Polynomial.degree <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">class</span></span> alg_closed_field <span class="main">=</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> alg_closed_field_axiom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>field poly<span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Polynomial.degree <span class="bound">p</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">z</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rootE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Polynomial.degree <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">z</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> alg_closed_field_axiom<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> infinite_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">:]</span><span class="main">)</span> <span class="main">+</span> <span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span>UNIV<span class="main">.</span> Polynomial.degree <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_prod_eq<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_UNIV_card_ge_0<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Polynomial.degree <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">&lt;</span> Polynomial.degree <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="skolem">p</span> <span class="main">=</span> Polynomial.degree <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_add_eq_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Polynomial.degree <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rootE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span>UNIV<span class="main">.</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">-</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_def poly_prod<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I cancel_comm_monoid_add_class.diff_cancel fin one_neq_zero prod_zero_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> linear_factorsE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="free">A</span> <span class="free">m</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Polynomial.smult <span class="free">c</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">m</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="free">m</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="bound">a</span> <span class="main">∉</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Polynomial.smult <span class="skolem">c</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">m</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly_root_induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span><span class="main"><span class="main">.</span></span> True"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 0<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> Polynomial.smult <span class="main">0</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="main">{}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>no_roots <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Polynomial.degree <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Polynomial.degree <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rootE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> no_roots<span class="main">)</span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> degree_eq_zeroE<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> no_roots<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> Polynomial.smult <span class="skolem">c</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="main">{}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>root <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> Polynomial.smult <span class="skolem">c</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">m</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> root.hyps<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="keyword1">then</span> Suc <span class="main">(</span><span class="skolem">m</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">m</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> root.prems<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="skolem">a</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">(</span>Polynomial.smult <span class="main">(</span><span class="main">-</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span><span class="main">-</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult_smult_right <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m'</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.remove<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m'</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span>
                          <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m'</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m'</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.insert_remove<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m'</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m'</span> <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m'</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m'</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod.cong<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m'</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m'</span> <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m'_def 2<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="skolem">a</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">=</span> Polynomial.smult <span class="main">(</span><span class="main">-</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m'</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">∉</span> insert <span class="skolem">a</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m'_def 2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_eq_zeroE<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">m</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> * that<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p poly_prod * fin <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> prod_eq_zeroE<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* alg_closed_field *)</span>

<span class="keyword1"><span class="command">instance</span></span> complex <span class="main">::</span> <span class="quoted">alg_closed_field</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">rule</span> fundamental_theorem_of_algebra<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> constant_degree<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Lex_Order_PP">
<div class="head">
<h1>Theory Lex_Order_PP</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Properties of the Lexicographic Order on Power-Products›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Lex_Order_PP
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Polynomials/Power_Products.html">Polynomials.Power_Products</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove some useful properties of the purely lexicographic order relation on
  power-products.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lex_pm_keys_leE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="free">s</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> keys <span class="main">(</span><span class="free">s</span><span class="main">::</span><span class="tfree">'x</span><span class="main">::</span>linorder <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>add_linorder_min<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">y</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> keys <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> lex_pm_alt
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> keys <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">=</span> <span class="free">t</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> order.refl<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="free">s</span> <span class="skolem">y</span> <span class="main">&lt;</span> lookup <span class="free">t</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">y'</span></span><span class="main">&lt;</span><span class="skolem">y</span><span class="main">.</span> lookup <span class="free">s</span> <span class="bound">y'</span> <span class="main">=</span> lookup <span class="free">t</span> <span class="bound">y'</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> zero_min 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> lookup <span class="free">t</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_less_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> keys <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dual_order.strict_implies_not_eq in_keys_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="free">s</span> <span class="free">x</span> <span class="main">=</span> lookup <span class="free">t</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> keys <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> in_keys_iff not_False_eq_True<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> order.refl <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lex_pm_except_max<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="free">s</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"keys <span class="free">s</span> <span class="main">∪</span> keys <span class="free">t</span> <span class="main">⊆</span> <span class="main">{..</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="main">(</span>except <span class="free">s</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>except <span class="free">t</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> lookup <span class="free">s</span> <span class="bound">x</span> <span class="main">&lt;</span> lookup <span class="free">t</span> <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">y</span></span><span class="main">&lt;</span><span class="bound">x</span><span class="main">.</span> lookup <span class="free">s</span> <span class="bound">y</span> <span class="main">=</span> lookup <span class="free">t</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lex_pm_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lex_pm_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">z</span></span><span class="main">&lt;</span><span class="skolem">y</span><span class="main">.</span> lookup <span class="free">s</span> <span class="bound">z</span> <span class="main">=</span> lookup <span class="free">t</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="free">s</span> <span class="skolem">z</span> <span class="main">=</span> lookup <span class="free">t</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="free">s</span> <span class="skolem">y</span> <span class="main">&lt;</span> lookup <span class="free">t</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> keys <span class="free">s</span> <span class="main">∪</span> keys <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lookup_not_eq_zero_eq_in_keys<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"except <span class="free">s</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> except <span class="free">t</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>except <span class="free">s</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> lookup <span class="main">(</span>except <span class="free">t</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> linorder_cases<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_except eq<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="main">{..</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> keys <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> keys <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">z</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y lookup_except in_keys_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y lookup_except<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lex_pm_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lex_pm_alt
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> disjI2 exI conjI allI impI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">x</span>›</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>except <span class="free">s</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">&lt;</span> lookup <span class="main">(</span>except <span class="free">t</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_except<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">&lt;</span> <span class="skolem">y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>except <span class="free">s</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> lookup <span class="main">(</span>except <span class="free">t</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_except eq<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lex_pm_strict_plus_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="free">s</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> keys <span class="free">t</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> keys <span class="free">u</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="main">(</span><span class="free">u</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>add_linorder_min<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="free">s</span> <span class="skolem">x</span> <span class="main">&lt;</span> lookup <span class="free">t</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">⟹</span> lookup <span class="free">s</span> <span class="bound">y</span> <span class="main">=</span> lookup <span class="free">t</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lex_pm_strict_def less_poly_mapping_def less_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> keys <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lookup_not_eq_zero_eq_in_keys<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lookup_u<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="free">u</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lookup <span class="free">u</span> <span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> keys <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> keys <span class="free">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span><span class="free">u</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">&lt;</span> lookup <span class="free">t</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_add lookup_u<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span><span class="free">u</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> lookup <span class="free">t</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span> <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_add 2 lookup_u<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lex_pm_strict_def less_poly_mapping_def less_fun_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Univariate_PM">
<div class="head">
<h1>Theory Univariate_PM</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Polynomial Mappings and Univariate Polynomials›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Univariate_PM
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Polynomial.html">HOL-Computational_Algebra.Polynomial</a>"</span> <a href="../Polynomials/MPoly_PM.html">Polynomials.MPoly_PM</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Morphisms <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pm_of_poly›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>poly_of_pm›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Many things in this section are copied from theory <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Polynomials.MPoly_Type_Univariate›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>poly.coeff <span class="free">p</span> <span class="main">(</span>lookup <span class="bound">t</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">when</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span>
          Poly_Mapping.single <span class="free">x</span> <span class="main">`</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">d</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subset_antisym subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?M</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">⟹</span> Poly_Mapping.lookup <span class="skolem">t</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PPs_def in_keys_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> Poly_Mapping.single <span class="free">x</span> <span class="main">(</span>lookup <span class="skolem">t</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> poly_mapping_eqI <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> lookup_single_eq lookup_single_not_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">d</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PPs_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> pm_of_poly <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>comm_monoid_add"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">p</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span>poly.coeff <span class="bound">p</span> <span class="main">(</span>lookup <span class="bound">t</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">when</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'x</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>poly.coeff <span class="skolem">p</span> <span class="main">(</span>lookup <span class="bound">t</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">when</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">]</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pm_of_poly_aux
    <span class="keyword1"><span class="command">using</span></span> finite_surj<span class="main">[</span><span class="operator">OF</span> MOST_coeff_eq_0<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> eventually_cofinite<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_of_pm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>comm_monoid_add poly"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly_of_pm</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Abs_poly <span class="main">(</span><span class="main">λ</span><span class="bound">d</span><span class="main">.</span> lookup <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>Poly_Mapping.single <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lookup_pm_of_poly_single <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>pm_of_poly <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> poly.coeff <span class="free">p</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly.rep_eq PPs_closed_single<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> keys_pm_of_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>pm_of_poly <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Poly_Mapping.single <span class="free">x</span> <span class="main">`</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">d</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>pm_of_poly <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>poly.coeff <span class="free">p</span> <span class="main">(</span>lookup <span class="bound">t</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">when</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly.rep_eq <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lookup_not_eq_zero_eq_in_keys<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Poly_Mapping.single <span class="free">x</span> <span class="main">`</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> poly.coeff <span class="free">p</span> <span class="bound">d</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> pm_of_poly_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> coeff_poly_of_pm <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly.coeff <span class="main">(</span>poly_of_pm <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> lookup <span class="free">p</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="free">x</span> <span class="main">`</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> lookup <span class="free">p</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="bound">d</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> lookup <span class="free">p</span> <span class="bound">d</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀<span class="hidden">⇩</span><sub>∞</sub></span> <span class="bound">k</span><span class="main">.</span> lookup <span class="free">p</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coeff_def eventually_cofinite
    <span class="keyword1"><span class="command">using</span></span> finite_imageD<span class="main">[</span><span class="operator">OF</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 0 Poly_Mapping.finite_lookup<span class="main"><span class="main">]</span></span><span class="main">]</span> inj_single
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inj_eq inj_onI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_pm_def Abs_poly_inverse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_of_pm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="main">(</span>poly_of_pm <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="free">p</span> <span class="main">⊆</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>pm_of_poly <span class="free">x</span> <span class="main">(</span>poly_of_pm <span class="free">x</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> lookup <span class="free">p</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly.rep_eq when_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="free">x</span> <span class="main">(</span>lookup <span class="skolem">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PPsD keys_subset_singleton_imp_monomial<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lookup <span class="free">p</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">(</span>lookup <span class="skolem">t</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lookup <span class="free">p</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∉</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms PolysD <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∉</span> keys <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lookup <span class="free">p</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_pm_of_poly <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">(</span>pm_of_poly <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_pm_def coeff_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_in_Polys<span class="main">:</span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="free">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_pm_of_poly PPs_closed_single <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> PolysI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly.rep_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_eq_zero_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> poly_of_pm_of_poly pm_of_poly_zero<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_monom<span class="main">:</span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="main">(</span>Polynomial.monom <span class="free">c</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> monomial <span class="free">c</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>pm_of_poly <span class="free">x</span> <span class="main">(</span>Polynomial.monom <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> lookup <span class="main">(</span>monomial <span class="free">c</span> <span class="main">(</span>monomial <span class="free">d</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pm_of_poly.rep_eq lookup_single PPs_singleton when_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> monomial_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly.rep_eq lookup_single PPs_singleton<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> pm_of_poly <span class="free">x</span> <span class="free">p</span> <span class="main">+</span> pm_of_poly <span class="free">x</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly.rep_eq lookup_add when_add_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> pm_of_poly <span class="free">x</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly.rep_eq when_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> pm_of_poly <span class="free">x</span> <span class="free">p</span> <span class="main">-</span> pm_of_poly <span class="free">x</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly.rep_eq lookup_minus when_diff_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly_monom <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> single_one monom_eq_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_pCons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="main">(</span>pCons <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span>
      monomial <span class="free">c</span> <span class="main">0</span> <span class="main">+</span> punit.monom_mult <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>monoid_mult<span class="main">)</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>pm_of_poly <span class="free">x</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="free">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="var">?l</span> <span class="skolem">t</span> <span class="main">=</span> lookup <span class="var">?r</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">-</span> <span class="var">?x</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span> <span class="main">⟷</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">-</span> <span class="var">?x</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_single<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span> <span class="main">+</span> <span class="var">?x</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_plus<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> lookup <span class="skolem">t</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adds_minus lookup_add lookup_single_eq n_not_Suc_n neq0_conv plus_eq_zero_2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly.rep_eq lookup_add lookup_single punit.lookup_monom_mult 1 coeff_pCons
                    lookup_minus <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.split<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span> <span class="main">⟷</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">t</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPsD<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">t</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> keys <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹keys <span class="skolem">t</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> keys <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> lookup <span class="skolem">t</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adds_poly_mappingI le0 le_funI lookup_single_eq lookup_single_not_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zero_in_PPs<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly.rep_eq lookup_add lookup_single punit.lookup_monom_mult when_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_smult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="main">(</span>Polynomial.smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">⋅</span> pm_of_poly <span class="free">x</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly.rep_eq when_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_times<span class="main">:</span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> pm_of_poly <span class="free">x</span> <span class="free">p</span> <span class="main">*</span> pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">q</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>ring_1 poly<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly_plus pm_of_poly_pCons map_scale_eq_times pCons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span>
             <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> times_monomial_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="main">(</span>sum <span class="free">f</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly_plus<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="main">(</span>prod <span class="free">f</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">::</span> <span class="main">_</span><span class="main">::</span>ring_1 poly<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly_times<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> pm_of_poly_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">p</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>ring_1 poly<span class="main">)</span> <span class="main">^</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly_times<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_pm_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> poly_of_pm_of_poly pm_of_poly_zero<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_pm_eq_zero_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> keys <span class="free">p</span> <span class="main">∩</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> Poly_Mapping.single <span class="free">x</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> PPs_singleton <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> lookup <span class="free">p</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="free">p</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> Polynomial.coeff <span class="main">(</span>poly_of_pm <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"keys <span class="free">p</span> <span class="main">∩</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="free">p</span> <span class="main">∩</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="free">x</span> <span class="skolem">d</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_single<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∉</span> keys <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Polynomial.coeff <span class="main">(</span>poly_of_pm <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> leading_coeff_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_pm_monomial<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">(</span>monomial <span class="free">c</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Polynomial.monom <span class="free">c</span> <span class="main">(</span>lookup <span class="free">t</span> <span class="free">x</span><span class="main">)</span> <span class="keyword1">when</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> Poly_Mapping.single <span class="free">x</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PPsD keys_subset_singleton_imp_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Polynomial.monom.abs_eq coeff_poly_of_pm
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_of_pm_def lookup_single when_def
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> monomial_inj <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">Abs_poly</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≠</span> monomial <span class="skolem">d</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">d</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PPs_closed_single<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Polynomial.monom.abs_eq coeff_poly_of_pm
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_of_pm_def lookup_single when_def zero_poly.abs_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_pm_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> poly_of_pm <span class="free">x</span> <span class="free">p</span> <span class="main">+</span> poly_of_pm <span class="free">x</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Polynomial.plus_poly.abs_eq coeff_poly_of_pm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_pm_def lookup_add<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_pm_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">(</span><span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> poly_of_pm <span class="free">x</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Polynomial.uminus_poly.abs_eq coeff_poly_of_pm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_pm_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_pm_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> poly_of_pm <span class="free">x</span> <span class="free">p</span> <span class="main">-</span> poly_of_pm <span class="free">x</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Polynomial.minus_poly.abs_eq coeff_poly_of_pm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_pm_def lookup_minus<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_pm_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_pm_monomial zero_in_PPs <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> single_one monom_eq_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_pm_times<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> poly_of_pm <span class="free">x</span> <span class="free">p</span> <span class="main">*</span> poly_of_pm <span class="free">x</span> <span class="main">(</span><span class="free">q</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>comm_semiring_1<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> poly_of_pm <span class="free">x</span> <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> poly_of_pm <span class="free">x</span> <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">t</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> Poly_Mapping.single <span class="free">x</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> PPs_singleton <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">*</span> poly_of_pm <span class="free">x</span> <span class="free">q</span> <span class="main">=</span> Polynomial.monom <span class="skolem">c</span> <span class="main">(</span>lookup <span class="skolem">t</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> poly_of_pm <span class="free">x</span> <span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True poly_of_pm_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly_of_pm <span class="free">x</span> <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">d</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.smult <span class="skolem">c</span> <span class="main">(</span>poly_of_pm <span class="free">x</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> poly_of_pm <span class="free">x</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">⋅</span> <span class="free">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Polynomial.smult.abs_eq coeff_poly_of_pm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_pm_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polynomial.times_poly_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> map_scale_eq_times<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="free">x</span> <span class="skolem">a</span> <span class="keyword1">adds</span> Poly_Mapping.single <span class="free">x</span> <span class="skolem">b</span> <span class="main">⟷</span> <span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adds_def deg_pm_mono deg_pm_single le_Suc_ex single_add<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> pCons <span class="main">0</span> <span class="main">(</span>poly_of_pm <span class="free">x</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly.coeff_inject<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_pCons punit.lookup_monom_mult adds_zero monomial_0_iff 1
                            <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> single_diff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.split<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Suc that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Polynomial.monom <span class="skolem">c</span> <span class="main">(</span>lookup <span class="main">(</span>monomial <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> poly_of_pm <span class="free">x</span> <span class="free">q</span> <span class="main">=</span>
                          poly_of_pm <span class="free">x</span> <span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span>
                                            <span class="main">(</span><span class="main">(</span>monomial <span class="skolem">c</span> <span class="main">(</span>monomial <span class="skolem">d</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Polynomial.times_poly_def 2 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly_of_pm <span class="free">x</span> <span class="main">(</span>monomial <span class="skolem">c</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">(</span>Suc <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> times_monomial_monomial <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> single_add times_monomial_left<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">(+)</span> <span class="skolem">t</span> <span class="main">`</span> keys <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> times_monomial_left
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> punit.keys_monom_mult_subset<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">+</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">-</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_minus<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_of_pm_eq_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_pm_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly_mapping_plus_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_pm_plus eq distrib_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_pm_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">(</span>sum <span class="free">f</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> poly_of_pm <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_pm_plus<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_pm_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">(</span>prod <span class="free">f</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> poly_of_pm <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_pm_times<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_pm_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> poly_of_pm <span class="free">x</span> <span class="free">p</span> <span class="main">^</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_pm_times<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Evaluating Polynomials›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_eq_poly_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>poly_of_pm <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> poly_eval <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="keyword1">when</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly_mapping_plus_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">p</span> <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="keyword1">when</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span>keys <span class="skolem">t</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">when</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> lookup <span class="skolem">t</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_eval_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span>keys <span class="skolem">t</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">when</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> lookup <span class="skolem">t</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">when</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> lookup <span class="skolem">t</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.mono_neutral_left ballI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_keys_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> PPsD<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span> <span class="main">^</span> lookup <span class="skolem">t</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_pm_plus poly_of_pm_monomial poly_monom poly_eval_plus True 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="keyword1">when</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>monomial <span class="skolem">c</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span>keys <span class="skolem">t</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">when</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> lookup <span class="skolem">t</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_eval_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> finite_keys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span>keys <span class="skolem">t</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">when</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> lookup <span class="skolem">t</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> prod_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> False <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> keys <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PPs_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span>keys <span class="skolem">t</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">when</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> lookup <span class="skolem">t</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> keys <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> lookup <span class="skolem">t</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="free">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="keyword1">when</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> lookup <span class="skolem">t</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_power<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_pm_plus poly_of_pm_monomial poly_monom poly_eval_plus False 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> poly_eq_poly_eval'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>poly_of_pm <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">a</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_eq_poly_eval <span class="keyword1"><span class="command">using</span></span> refl
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eval_cong<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> indets <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="keyword1">when</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_eval_eq_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_eval <span class="free">a</span> <span class="main">(</span>pm_of_poly <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> poly <span class="free">p</span> <span class="main">(</span><span class="free">a</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly_pCons poly_eval_plus poly_eval_times poly_eval_monomial
              <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> times_monomial_left<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Morphisms <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>flat_pm_of_poly›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>poly_of_focus›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">flat_pm_of_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> poly <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>semiring_1<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">flat_pm_of_poly</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> flatten <span class="main">∘</span> pm_of_poly <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_of_focus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>comm_monoid_add<span class="main">)</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly_of_focus</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> poly_of_pm <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∘</span> focus <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flat_pm_of_poly_in_Polys<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>poly.coeff <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">Y</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="free">p</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">Y</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="var">?p</span> <span class="main">`</span> keys <span class="var">?p</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">Y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_pm_of_poly image_image<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> pm_of_poly_in_Polys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"flatten <span class="var">?p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> flatten_in_Polys<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> flat_pm_of_poly_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> indets_flat_pm_of_poly_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"indets <span class="main">(</span>flat_pm_of_poly <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>indets <span class="main">`</span> range <span class="main">(</span>poly.coeff <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"pm_of_poly <span class="free">x</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>indets <span class="main">`</span> range <span class="main">(</span>poly.coeff <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>poly.coeff <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="var">?Y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> PolysI_alt<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="free">p</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="var">?Y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> flat_pm_of_poly_in_Polys<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> flat_pm_of_poly_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> flat_pm_of_poly_monom<span class="main">:</span> <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="main">(</span>Polynomial.monom <span class="free">c</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span>
                                    punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="free">d</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> flat_pm_of_poly_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span>
                                  flat_pm_of_poly <span class="free">x</span> <span class="free">p</span> <span class="main">+</span> flat_pm_of_poly <span class="free">x</span> <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> flat_pm_of_poly_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> flat_pm_of_poly_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="main">(</span>sum <span class="free">f</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> flat_pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> flat_pm_of_poly_def pm_of_poly_monom flatten_monomial pm_of_poly_plus
                    flatten_plus pm_of_poly_sum flatten_sum<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> flat_pm_of_poly_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> flat_pm_of_poly <span class="free">x</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> flat_pm_of_poly_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span>
                                  flat_pm_of_poly <span class="free">x</span> <span class="free">p</span> <span class="main">-</span> flat_pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">q</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>ring poly<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> flat_pm_of_poly_def pm_of_poly_minus flatten_minus<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> flat_pm_of_poly_pCons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="main">(</span>pCons <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span>
    <span class="free">c</span> <span class="main">+</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>flat_pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">p</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>comm_semiring_1 poly<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> flat_pm_of_poly_def pm_of_poly_pCons flatten_plus flatten_monomial flatten_times
          <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> times_monomial_left<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> flat_pm_of_poly_smult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="main">(</span>Polynomial.smult <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> flat_pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">p</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>comm_semiring_1 poly<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> flat_pm_of_poly_def map_scale_eq_times flatten_times flatten_monomial pm_of_poly_times<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> flat_pm_of_poly_times<span class="main">:</span> <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> flat_pm_of_poly <span class="free">x</span> <span class="free">p</span> <span class="main">*</span> flat_pm_of_poly <span class="free">x</span> <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> flat_pm_of_poly_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="main">(</span>prod <span class="free">f</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span>
                                  <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> flat_pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">::</span> <span class="main">_</span><span class="main">::</span>comm_ring_1 poly<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> flat_pm_of_poly_power<span class="main">:</span> <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> flat_pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="free">p</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>comm_ring_1 poly<span class="main">)</span> <span class="main">^</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> flat_pm_of_poly_def flatten_times pm_of_poly_times flatten_prod pm_of_poly_prod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> coeff_poly_of_focus_subset_Polys<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>poly.coeff <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>poly.coeff <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> range <span class="main">(</span>lookup <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_of_focus_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> focus_coeffs_subset_Polys'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> poly_of_focus_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_focus <span class="free">x</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> poly_of_focus_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> poly_of_focus <span class="free">x</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> poly_of_focus_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> poly_of_focus <span class="free">x</span> <span class="free">p</span> <span class="main">+</span> poly_of_focus <span class="free">x</span> <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> poly_of_focus_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> poly_of_focus <span class="free">x</span> <span class="free">p</span> <span class="main">-</span> poly_of_focus <span class="free">x</span> <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> poly_of_focus_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_focus <span class="free">x</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> poly_of_focus_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_focus <span class="free">x</span> <span class="main">(</span>sum <span class="free">f</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_focus_def keys_focus poly_of_pm_plus focus_plus poly_of_pm_minus focus_minus
                    poly_of_pm_sum focus_sum<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_focus_eq_zero_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_focus <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> focus_in_Polys<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_of_focus_def poly_of_pm_eq_zero_iff Int_absorb2 <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> PolysD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_focus_monomial<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_of_focus <span class="free">x</span> <span class="main">(</span>monomial <span class="free">c</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Polynomial.monom <span class="main">(</span>monomial <span class="free">c</span> <span class="main">(</span>except <span class="free">t</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lookup <span class="free">t</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_focus_def focus_monomial poly_of_pm_monomial PPs_def keys_except lookup_except<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> poly_of_focus_times<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> poly_of_focus <span class="free">x</span> <span class="free">p</span> <span class="main">*</span> poly_of_focus <span class="free">x</span> <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> poly_of_focus_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_focus <span class="free">x</span> <span class="main">(</span>prod <span class="free">f</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span>
                                  <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">::</span> <span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>comm_semiring_1<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> poly_of_focus_power<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="free">p</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>comm_semiring_1<span class="main">)</span> <span class="main">^</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_focus_def poly_of_pm_times focus_times poly_of_pm_prod focus_prod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> flat_pm_of_poly_of_focus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> flat_pm_of_poly_def poly_of_focus_def pm_of_poly_of_pm focus_in_Polys<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_of_focus_flat_pm_of_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>poly.coeff <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_of_focus <span class="free">x</span> <span class="main">(</span>flat_pm_of_poly <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>pm_of_poly <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">`</span> keys <span class="main">(</span>pm_of_poly <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_pm_of_poly image_image<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> flat_pm_of_poly_def poly_of_focus_def focus_flatten pm_of_poly_in_Polys<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> flat_pm_of_poly_eq_zeroD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"flat_pm_of_poly <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>poly.coeff <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> poly_of_focus <span class="free">x</span> <span class="main">(</span>flat_pm_of_poly <span class="free">x</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_of_focus_flat_pm_of_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_poly_of_focus<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_focus_def poly_eq_poly_eval' focus_in_Polys<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> poly_poly_of_focus_monomial<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>comm_semiring_1<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_poly_of_focus poly_eval_focus <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_subst_id<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Nullstellensatz">
<div class="head">
<h1>Theory Nullstellensatz</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Hilbert's Nullstellensatz›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Nullstellensatz
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Algebraically_Closed_Fields.html">Algebraically_Closed_Fields</a>
          <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Fraction_Field.html">HOL-Computational_Algebra.Fraction_Field</a>"</span>
          <a href="Lex_Order_PP.html">Lex_Order_PP</a>
          <a href="Univariate_PM.html">Univariate_PM</a>
          <a href="../Groebner_Bases/Groebner_PM.html">Groebner_Bases.Groebner_PM</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove the geometric version of Hilbert's Nullstellensatz, i.e. the precise correspondence
  between algebraic varieties and radical ideals.
  The field-theoretic version of the Nullstellensatz is proved in theory <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Nullstellensatz_Field›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_linorder_induct <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> empty insert<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>linorder set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">A</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">⟹</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="bound">a</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>insert <span class="bound">a</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> Max <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Suc.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_in<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Suc.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>›</span></span> _ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Suc.prems<span class="main">(</span>2<span class="main">)</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_ge<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Fract_same<span class="main">:</span> <span class="quoted"><span class="quoted">"Fract <span class="free">a</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="keyword1">when</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> One_fract_def Zero_fract_def eq_fract when_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Fract_eq_zero_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"Fract <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Zero_fract_def eq_fract<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eq_fract<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult_eq_0_iff one_neq_zero<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> poly_plus_rightE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> poly <span class="free">p</span> <span class="free">x</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">0</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> poly <span class="main">0</span> <span class="free">x</span> <span class="main">+</span> <span class="main">0</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> poly <span class="skolem">p</span> <span class="free">x</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pCons.hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>poly <span class="skolem">p</span> <span class="free">x</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly <span class="main">(</span>pCons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">+</span> <span class="main">(</span>poly <span class="skolem">p</span> <span class="free">x</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pCons.prems<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_minus_rightE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> poly <span class="free">p</span> <span class="free">x</span> <span class="main">-</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>comm_ring<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_right' diff_add_cancel poly_plus_rightE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_poly_plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">f</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">f</span> <span class="free">p</span> <span class="main">+</span> map_poly <span class="free">f</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polynomial.poly_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_map_poly assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_poly_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">a</span> <span class="main">-</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">f</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">f</span> <span class="free">p</span> <span class="main">-</span> map_poly <span class="free">f</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polynomial.poly_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_map_poly assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_poly_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">f</span> <span class="main">(</span>sum <span class="free">g</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> map_poly <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_poly_plus assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_poly_times<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">f</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">f</span> <span class="free">p</span> <span class="main">*</span> map_poly <span class="free">f</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">c</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms map_poly_plus map_poly_smult map_poly_pCons pCons<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> poly_Fract<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>Polynomial.coeffs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fract <span class="bound">x</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span> <span class="free">m</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span>Fract <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Fract <span class="free">q</span> <span class="main">(</span><span class="free">b</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">0</span> <span class="main">(</span>Fract <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Fract <span class="main">0</span> <span class="main">(</span><span class="free">b</span> <span class="main">^</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fract_collapse<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pCons <span class="skolem">c</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> pCons.hyps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">c</span> <span class="main">(</span>set <span class="main">(</span>Polynomial.coeffs <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>Polynomial.coeffs <span class="main">(</span>pCons <span class="skolem">c</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> pCons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fract <span class="bound">x</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>Polynomial.coeffs <span class="skolem">p</span><span class="main">)</span> <span class="main">⊆</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fract <span class="bound">x</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q0</span></span> <span class="skolem"><span class="skolem">m0</span></span> <span class="keyword2"><span class="keyword">where</span></span> poly_p<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="main">(</span>Fract <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Fract <span class="skolem">q0</span> <span class="main">(</span><span class="free">b</span> <span class="main">^</span> <span class="skolem">m0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pCons.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c0</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> Fract <span class="skolem">c0</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>pCons <span class="skolem">c</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Fract <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Fract <span class="skolem">c0</span> <span class="main">(</span><span class="free">b</span> <span class="main">^</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c fract_collapse<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pCons.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>pCons <span class="skolem">c</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Fract <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Fract <span class="main">(</span><span class="skolem">c0</span> <span class="main">*</span> <span class="free">b</span> <span class="main">^</span> Suc <span class="skolem">m0</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">q0</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span> <span class="main">^</span> Suc <span class="skolem">m0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_p c<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pCons.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ordered_term<span class="main">)</span> lt_sum_le_Max<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>sum <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> ord_term_lin.Max <span class="main">{</span>lt <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">|</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>infinite <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_term_min<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_term_min<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> insert.hyps<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>sum <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span> <span class="main">+</span> sum <span class="free">f</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> ord_term_lin.max <span class="main">(</span>lt <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>sum <span class="free">f</span> <span class="skolem">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_plus_le_max<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> ord_term_lin.max <span class="main">(</span>lt <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ord_term_lin.Max <span class="main">{</span>lt <span class="main">(</span><span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.hyps<span class="main">(</span>3<span class="main">)</span> ord_term_lin.max.mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> insert.hyps<span class="main">(</span>1<span class="main">)</span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ord_term_lin.Max <span class="main">(</span>insert <span class="main">(</span>lt <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>lt <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ord_term_lin.Max <span class="main">{</span>lt <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">A</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">ord_term_lin.Max</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ideals and Varieties›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">variety_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>comm_semiring_1<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">variety_of</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">.</span> poly_eval <span class="bound">a</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ideal_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>comm_semiring_1<span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ideal_of</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> poly_eval <span class="bound">a</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒱</span> <span class="main">≡</span> variety_of"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℐ</span> <span class="main">≡</span> ideal_of"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> variety_ofI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> poly_eval <span class="free">a</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> 𝒱 <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> variety_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> variety_ofI_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_eval <span class="free">a</span> <span class="main">`</span> <span class="free">F</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> 𝒱 <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> variety_ofI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> variety_ofD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> 𝒱 <span class="free">F</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> poly_eval <span class="free">a</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> variety_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> variety_of_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">{}</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> variety_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> variety_of_UNIV <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"𝒱 UNIV <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_empty_eq UNIV_I one_neq_zero poly_eval_one variety_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> variety_of_antimono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">⟹</span> 𝒱 <span class="free">G</span> <span class="main">⊆</span> 𝒱 <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> variety_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> variety_of_ideal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>ideal <span class="free">F</span><span class="main">)</span> <span class="main">=</span> 𝒱 <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>ideal <span class="free">F</span><span class="main">)</span> <span class="main">⊆</span> 𝒱 <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> variety_of_antimono ideal.span_superset<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="free">F</span> <span class="main">⊆</span> 𝒱 <span class="main">(</span>ideal <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subsetI variety_ofI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ideal.span_induct_alt<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> base
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">g</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="free">F</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_eval_plus poly_eval_times <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> variety_ofD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_ofI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> poly_eval <span class="bound">a</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> ℐ <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_ofD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> ℐ <span class="free">A</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> poly_eval <span class="free">a</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_of_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ℐ <span class="main">{}</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_of_antimono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> ℐ <span class="free">B</span> <span class="main">⊆</span> ℐ <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ideal_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_ideal_of <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>ℐ <span class="free">A</span><span class="main">)</span> <span class="main">=</span> ℐ <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal.span_eq_iff
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.subspaceI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> ℐ <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_ofI<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ℐ <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_ofD<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> ℐ <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_ofD<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">∈</span> ℐ <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_ofI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eval_plus f g<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ℐ <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_ofD<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">∈</span> ℐ <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_ofI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eval_times f<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_of_UN<span class="main">:</span> <span class="quoted"><span class="quoted">"ℐ <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋂</span><span class="bound">j</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> ℐ <span class="main">(</span><span class="free">A</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI ideal_ofI INT_I<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">j</span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ℐ <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_ofD<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">A</span> <span class="main">`</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋂</span><span class="bound">j</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> ℐ <span class="main">(</span><span class="free">A</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ℐ <span class="main">(</span><span class="free">A</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_ofD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> ideal_of_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"ℐ <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> ℐ <span class="free">A</span> <span class="main">∩</span> ℐ <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ideal_of_UN<span class="main">[</span><span class="operator">of</span> <span class="quoted">id</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> variety_of_ideal_of_variety <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>ℐ <span class="main">(</span>𝒱 <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 𝒱 <span class="free">F</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?V</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> ℐ <span class="main">(</span>𝒱 <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ideal_ofI <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> variety_ofD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>ℐ <span class="var">?V</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_of_antimono<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?V</span> <span class="main">⊆</span> 𝒱 <span class="main">(</span>ℐ <span class="var">?V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> variety_ofI <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ideal_ofD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_of_inj_on<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on ℐ <span class="main">(</span>range <span class="main">(</span>𝒱<span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>comm_semiring_1<span class="main">)</span> set <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> range 𝒱"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> 𝒱 <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> range 𝒱"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> 𝒱 <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ℐ <span class="skolem">A</span> <span class="main">=</span> ℐ <span class="skolem">B</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>ℐ <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> 𝒱 <span class="main">(</span>ℐ <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A B<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_of_variety_of_ideal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ℐ <span class="main">(</span>𝒱 <span class="main">(</span>ℐ <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ℐ <span class="free">A</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?I</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> 𝒱 <span class="main">(</span>ℐ <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> variety_ofI <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ideal_ofD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ℐ <span class="main">(</span>𝒱 <span class="var">?I</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_of_antimono<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="main">⊆</span> ℐ <span class="main">(</span>𝒱 <span class="var">?I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ideal_ofI <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> variety_ofD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> variety_of_inj_on<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on 𝒱 <span class="main">(</span>range <span class="main">(</span>ℐ<span class="main">::</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>comm_semiring_1<span class="main">)</span> set <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F</span> <span class="skolem">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> range ℐ"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> ℐ <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">∈</span> range ℐ"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> ℐ <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="skolem">F</span> <span class="main">=</span> 𝒱 <span class="skolem">G</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ℐ <span class="main">(</span>𝒱 <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> ℐ <span class="main">(</span>𝒱 <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F G<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_map_indets_ideal_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="free">f</span> <span class="main">`</span> ℐ <span class="free">A</span> <span class="main">=</span> ℐ <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">-`</span> <span class="main">(</span><span class="free">A</span><span class="main">::</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>comm_semiring_1<span class="main">)</span> set<span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span>range <span class="free">f</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'x</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">-`</span> <span class="free">A</span><span class="main">.</span> poly_eval <span class="main">(</span><span class="bound">a</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="skolem">a</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"the_inv <span class="free">f</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">=</span> id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms the_inv_f_f<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∘</span> the_inv <span class="free">f</span> <span class="main">∘</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">∘</span> the_inv <span class="free">f</span><span class="main">)</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">∘</span> the_inv <span class="free">f</span><span class="main">)</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ideal_of_def poly_eval_map_indets <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> range_map_indets <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> imageI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> variety_of_map_indets<span class="main">:</span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>map_indets <span class="free">f</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">-`</span> 𝒱 <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> variety_of_def poly_eval_map_indets<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Radical Ideals›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">radical</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>monoid_mult set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">√</span><span class="keyword3">(</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>999<span class="main">]</span> 999<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">radical</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="bound">f</span> <span class="main">^</span> <span class="bound">m</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> radicalI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">^</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> <span class="main">√</span><span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> radical_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> radicalE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">√</span><span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">m</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">^</span> <span class="free">m</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> radical_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> radical_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">√</span><span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> radical_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> radical_UNIV <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">√</span>UNIV <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> radical_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> radical_ideal_eq_UNIV_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">√</span>ideal <span class="free">F</span> <span class="main">=</span> UNIV <span class="main">⟷</span> ideal <span class="free">F</span> <span class="main">=</span> UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">√</span>ideal <span class="free">F</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalE<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_eq_UNIV_iff_contains_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_in_radical_ideal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> radicalI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">^</span> <span class="main">1</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal.span_zero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> radical_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">√</span><span class="free">F</span> <span class="main">⊆</span> <span class="main">√</span><span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> radicalE <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> radicalI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> radical_superset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="main">√</span><span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">^</span> <span class="main">1</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">√</span><span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> radical_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">√</span><span class="main">√</span><span class="free">F</span> <span class="main">=</span> <span class="main">√</span><span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">√</span><span class="main">√</span><span class="free">F</span> <span class="main">⊆</span> <span class="main">√</span><span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> radicalE <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> radicalI <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> radical_superset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> radical_Int_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">√</span><span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">√</span><span class="free">A</span> <span class="main">∩</span> <span class="main">√</span><span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> radicalI <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> radicalE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> radical_ideal_Int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">√</span><span class="main">(</span>ideal <span class="free">F</span> <span class="main">∩</span> ideal <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">√</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="main">√</span>ideal <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> radical_Int_subset
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subset_antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">√</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="main">√</span>ideal <span class="free">G</span> <span class="main">⊆</span> <span class="main">√</span><span class="main">(</span>ideal <span class="free">F</span> <span class="main">∩</span> ideal <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="main">√</span>ideal <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m1</span></span> <span class="keyword2"><span class="keyword">where</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m1</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">G</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m2</span> <span class="main">∈</span> ideal <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalE<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m1</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m2</span> <span class="main">∈</span> ideal <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_scale<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> p1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m2</span> <span class="main">*</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m1</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_scale<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m2</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> ideal <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add mult.commute<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">√</span><span class="main">(</span>ideal <span class="free">F</span> <span class="main">∩</span> ideal <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ideal_radical_ideal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span><span class="main">√</span>ideal <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal.span_eq_iff
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.subspaceI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">^</span> <span class="main">1</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal.span_zero<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_add ideal.span_scale<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_add ideal.span_scale<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> binomial_ring
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_sum<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">n</span> <span class="keyword1">choose</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> b<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_scale<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> a<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">n</span> <span class="keyword1">choose</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_scale<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult_distrib ideal.span_scale<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> radical_ideal_of <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">√</span>ℐ <span class="free">A</span> <span class="main">=</span> ℐ <span class="main">(</span><span class="free">A</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒</span> <span class="main">_</span><span class="main">::</span>semiring_1_no_zero_divisors<span class="main">)</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">√</span>ℐ <span class="free">A</span> <span class="main">⊆</span> ℐ <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> radicalE <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ideal_ofD <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ideal_ofI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_eval_power<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> radical_superset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> variety_of_radical_ideal <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span><span class="main">√</span>ideal <span class="free">F</span><span class="main">)</span> <span class="main">=</span> 𝒱 <span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>semiring_1_no_zero_divisors<span class="main">)</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_superset<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radical_superset<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span><span class="main">√</span>ideal <span class="free">F</span><span class="main">)</span> <span class="main">⊆</span> 𝒱 <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_of_antimono<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="free">F</span> <span class="main">⊆</span> 𝒱 <span class="main">(</span><span class="main">√</span>ideal <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subsetI variety_ofI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="main">(</span>ideal <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalE<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="main">(</span>ideal <span class="free">F</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofD<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eval_power<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> image_map_indets_radical<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="free">f</span> <span class="main">`</span> <span class="main">√</span><span class="free">F</span> <span class="main">=</span> <span class="main">√</span><span class="main">(</span>map_indets <span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>comm_ring_1<span class="main">)</span> set<span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span>range <span class="free">f</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="free">f</span> <span class="main">`</span> <span class="main">√</span><span class="free">F</span> <span class="main">⊆</span> <span class="main">√</span><span class="main">(</span>map_indets <span class="free">f</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span>range <span class="free">f</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> radical_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> map_indets_power range_map_indets <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> imageI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">√</span><span class="main">(</span>map_indets <span class="free">f</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span>range <span class="free">f</span><span class="main">]</span> <span class="main">⊆</span> map_indets <span class="free">f</span> <span class="main">`</span> <span class="main">√</span><span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">√</span><span class="main">(</span>map_indets <span class="free">f</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span>range <span class="free">f</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">√</span><span class="main">(</span>map_indets <span class="free">f</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> range <span class="main">(</span>map_indets <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> range_map_indets<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> map_indets <span class="free">f</span> <span class="main">`</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalE<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">=</span> map_indets <span class="free">f</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">=</span> id"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">g</span> <span class="main">∘</span> map_indets <span class="free">f</span> <span class="main">=</span> <span class="main">(</span>id<span class="main">::</span><span class="main">_</span> <span class="main">⇒</span> <span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_indets_inverseE<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">g</span> <span class="main">(</span>map_indets <span class="free">f</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p'</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pointfree_idE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> p_m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">g</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> map_indets <span class="skolem">g</span> <span class="main">(</span>map_indets <span class="free">f</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map_indets <span class="skolem">g</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> range <span class="main">_</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> map_indets <span class="free">f</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> map_indets <span class="free">f</span> <span class="main">(</span>map_indets <span class="skolem">g</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">g</span> <span class="skolem">p</span> <span class="main">∈</span> <span class="main">√</span><span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> radicalI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">g</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_m eq <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> map_indets_power<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> map_indets <span class="free">f</span> <span class="main">`</span> <span class="main">√</span><span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Geometric Version of the Nullstellensatz›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> weak_Nullstellensatz_aux_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">i</span> <span class="main">∈</span> ideal <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> ideal <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> <span class="free">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">^</span> <span class="free">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>infinite <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ideal.span_zero <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> infinite<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">from</span></span> ideal.span_zero <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> empty<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">j</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">i</span> <span class="main">∈</span> ideal <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> insert.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> ideal <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">I</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> <span class="free">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">^</span> <span class="free">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="free">m</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="skolem">j</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">^</span> <span class="free">m</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">j</span> <span class="main">^</span> <span class="free">m</span> <span class="skolem">j</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">thesis</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="skolem">j</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">^</span> <span class="main">0</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">j</span> <span class="main">^</span> <span class="main">0</span> <span class="main">+</span> <span class="main">0</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 0<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="skolem">j</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">j</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="skolem">j</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">j</span> <span class="main">^</span> Suc <span class="skolem">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span> <span class="main">+</span> <span class="free">g</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> c <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">j</span> <span class="main">^</span> <span class="free">m</span> <span class="skolem">j</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">^</span> <span class="free">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">j</span> <span class="main">∈</span> ideal <span class="free">B</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ideal.span_add ideal.span_scale insert.prems insertI1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert.hyps<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span>insert <span class="skolem">j</span> <span class="skolem">I</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> <span class="free">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span>
                                <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span> <span class="main">^</span> <span class="free">m</span> <span class="skolem">j</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">^</span> <span class="free">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> insert.hyps<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span>insert <span class="skolem">j</span> <span class="skolem">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">^</span> <span class="free">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="var">?c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span>insert <span class="skolem">j</span> <span class="skolem">I</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">i</span><span class="main">)</span> <span class="main">^</span> <span class="free">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span>insert <span class="skolem">j</span> <span class="skolem">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">^</span> <span class="free">m</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="var">?c</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> weak_Nullstellensatz_aux_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="free">x</span><span class="main">::</span><span class="tfree">'x</span><span class="main">::</span><span class="main">{</span>countable<span class="main">,</span>linorder<span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>alg_closed_field"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> ideal <span class="main">(</span>poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="free">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="free">x</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="free">x</span> <span class="free">X</span> <span class="main">-</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">interpret</span></span> i<span class="main">:</span> pm_powerprod <span class="quoted">lex_pm</span> <span class="quoted"><span class="quoted">"lex_pm_strict<span class="main">::</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">_</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lex_pm_def lex_pm_strict_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lex_pm_zero_min lex_pm_plus_monotone <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lex_pm_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lpp_focus<span class="main">:</span> <span class="quoted"><span class="quoted">"i.lpp <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> except <span class="main">(</span>i.lpp <span class="skolem">g</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> keys_focus_g<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> except <span class="bound">t</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> keys <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> keys_focus <span class="keyword1"><span class="command">using</span></span> refl
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> image_cong<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">t</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPsD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"except <span class="skolem">t</span> <span class="main">(</span><span class="main">-</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> except <span class="skolem">t</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span> <span class="main">∩</span> <span class="main">-</span> <span class="free">X</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Int_commute except_keys_Int inf.orderE inf_left_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∉</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="free">x</span> <span class="free">X</span> <span class="main">∩</span> <span class="main">-</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"except <span class="skolem">t</span> <span class="main">(</span><span class="main">-</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> except <span class="skolem">t</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.lt_eqI_keys<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"i.lpp <span class="skolem">g</span> <span class="main">∈</span> keys <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.lt_in_keys<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"except <span class="main">(</span>i.lpp <span class="skolem">g</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">∈</span> keys <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> keys_focus_g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>

      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> except <span class="skolem">s</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> keys_focus_g <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="skolem">s</span> <span class="main">(</span>i.lpp <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.lt_max_keys<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">s</span> <span class="main">∪</span> keys <span class="main">(</span>i.lpp <span class="skolem">g</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{..</span><span class="free">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Un_least<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">g</span> <span class="main">⊆</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> keys <span class="skolem">g</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">s</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPsD<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">s</span> <span class="main">⊆</span> <span class="main">{..</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹i.lpp <span class="skolem">g</span> <span class="main">∈</span> keys <span class="skolem">g</span>›</span></span> <span class="quoted"><span class="quoted">‹keys <span class="skolem">g</span> <span class="main">⊆</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"i.lpp <span class="skolem">g</span> <span class="main">∈</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>i.lpp <span class="skolem">g</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPsD<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>i.lpp <span class="skolem">g</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{..</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="skolem">t</span> <span class="main">(</span>except <span class="main">(</span>i.lpp <span class="skolem">g</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lex_pm_except_max<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> i.punit.reduced_GB <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> fin_G<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> G_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ideal_G<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">G</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> G_isGB<span class="main">:</span> <span class="quoted"><span class="quoted">"i.punit.is_Groebner_basis <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.finite_reduced_GB_Polys<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i.reduced_GB_Polys<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i.reduced_GB_ideal_Polys<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">rule</span> i.reduced_GB_nonzero_Polys<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> i.reduced_GB_is_GB_Polys<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G'</span> <span class="main">=</span> focus <span class="free">X</span> <span class="main">`</span> <span class="skolem">G</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> fin_G <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> fin_G'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">G'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="skolem">G'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> G'_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G'</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G'_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> focus_in_Polys<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G''</span> <span class="main">=</span> i.lcf <span class="main">`</span> <span class="skolem">G'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="skolem">G'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="skolem">G''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G''_def i.punit.lc_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lookup_focus_in<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span> <span class="skolem">t</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">∈</span> range <span class="main">(</span>lookup <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rangeI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> that G_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"range <span class="main">(</span>lookup <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span> <span class="main">-</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> focus_coeffs_subset_Polys'<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">_</span> <span class="main">∈</span> range <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span> <span class="main">-</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="free">x</span> <span class="free">X</span> <span class="main">-</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq2<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> lcf_in<span class="main">:</span> <span class="quoted"><span class="quoted">"i.lcf <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
    <span class="keyword1"><span class="command">unfolding</span></span> i.punit.lc_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> G''_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G''</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">G''</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="skolem">G'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> i.lcf <span class="skolem">g'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G''_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">∈</span> <span class="skolem">G'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> focus <span class="free">X</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c g' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lcf_in<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> poly_of_pm <span class="free">x</span> <span class="main">`</span> <span class="skolem">G''</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> fin_G' <span class="keyword1"><span class="command">have</span></span> fin_P<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_def G''_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="skolem">P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g''</span> <span class="main">∈</span> <span class="skolem">G''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> poly_of_pm <span class="free">x</span> <span class="skolem">g''</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="skolem">g''</span> <span class="main">∩</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_pm_eq_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g''</span> <span class="main">∈</span> <span class="skolem">G''</span>›</span></span> G''_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g''</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">g''</span> <span class="main">⊆</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">g''</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g''</span> <span class="main">∈</span> <span class="skolem">G''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="skolem">G''</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P</span><span class="main">.</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Z_def <span class="keyword1"><span class="command">using</span></span> fin_P
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_UN_I<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">z</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_roots_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> infinite_UNIV<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span><span class="main"><span class="main">=</span></span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">Z</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_compl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> a_nz<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>i.lcf <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that G_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>i.lcf <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> poly <span class="main">(</span>poly_of_pm <span class="free">x</span> <span class="main">(</span>i.lcf <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> poly_eq_poly_eval' lcf_in that<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_of_pm <span class="free">x</span> <span class="main">(</span>i.lcf <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def G''_def G'_def that <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">Z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Z_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> lookup_e_focus<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span><span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>lookup <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span> <span class="skolem">t</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"focus <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">=</span> focus <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">∩</span> insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> focus_Int<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> focus <span class="free">X</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_commute eq1 <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> Diff_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_poly_eval_focus<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> lpp_e_focus<span class="main">:</span> <span class="quoted"><span class="quoted">"i.lpp <span class="main">(</span><span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> except <span class="main">(</span>i.lpp <span class="skolem">g</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.lt_eqI_keys<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> that G_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span><span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>except <span class="main">(</span>i.lpp <span class="skolem">g</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>i.lcf <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lookup_e_focus lpp_focus i.punit.lc_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> a_nz<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"except <span class="main">(</span>i.lpp <span class="skolem">g</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">∈</span> keys <span class="main">(</span><span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>

    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span><span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> lookup <span class="main">(</span><span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span><span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>lookup <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lookup_e_focus<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lookup_not_eq_zero_eq_in_keys<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="skolem">t</span> <span class="main">(</span>i.lpp <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.lt_max_keys<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="skolem">t</span> <span class="main">(</span>except <span class="main">(</span>i.lpp <span class="skolem">g</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lpp_focus<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G3</span> <span class="main">=</span> <span class="var">?e</span> <span class="main">`</span> focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">`</span> <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G3</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="skolem">G3</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h0</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">h0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G3_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> G_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h0</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eval_focus_in_Polys<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> fin_G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">G3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G3_def<span class="main">)</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">G3</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span> <span class="main">=</span> <span class="var">?e</span> <span class="main">`</span> focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">`</span> ideal <span class="skolem">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> G3_def image_poly_eval_focus_ideal<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ideal <span class="main">(</span><span class="var">?e</span> <span class="main">`</span> focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ideal_G image_poly_eval_focus_ideal<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">G3</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span> <span class="main">=</span> ideal <span class="main">(</span><span class="var">?e</span> <span class="main">`</span> focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">G3</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">G3</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> G3_isGB<span class="main">:</span> <span class="quoted"><span class="quoted">"i.punit.is_Groebner_basis <span class="skolem">G3</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.isGB_I_spoly_rep<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> dickson_grading_varnum<span class="main"><span class="main">,</span></span>
                                          <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> i.dgrad_p_set_varnum<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g1</span> <span class="skolem">g2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">∈</span> <span class="skolem">G3</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1'</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">=</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">g1'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> G3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> lpp1<span class="main">:</span> <span class="quoted"><span class="quoted">"i.lpp <span class="skolem">g1</span> <span class="main">=</span> except <span class="main">(</span>i.lpp <span class="skolem">g1'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lpp_e_focus<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g1'</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> G_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1'</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">∈</span> <span class="skolem">G3</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2'</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">=</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">g2'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> G3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> lpp2<span class="main">:</span> <span class="quoted"><span class="quoted">"i.lpp <span class="skolem">g2</span> <span class="main">=</span> except <span class="main">(</span>i.lpp <span class="skolem">g2'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lpp_e_focus<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2'</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> G_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2'</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> lcs <span class="main">(</span>except <span class="main">(</span>i.lpp <span class="skolem">g1'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>except <span class="main">(</span>i.lpp <span class="skolem">g2'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">=</span> i.lcf <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g1'</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">=</span> i.lcf <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g2'</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">c1</span> <span class="main">*</span> poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">c2</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">c2</span> <span class="main">*</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> except <span class="main">(</span>i.lpp <span class="skolem">g1'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">g1'</span> <span class="main">-</span>
                          <span class="skolem">c1</span> <span class="main">*</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> except <span class="main">(</span>i.lpp <span class="skolem">g2'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">g2'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c1_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g1'</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lcf_in<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> eval_c1<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">c1</span><span class="main">)</span> <span class="main">=</span> monomial <span class="main">(</span>poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">c1</span><span class="main">)</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> focus_Polys poly_eval_sum poly_eval_monomial monomial_power_map_scale
                  times_monomial_monomial <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> punit.monomial_prod_sum monomial_sum<span class="main">)</span>
           <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eval_alt<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2'</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lcf_in<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> eval_c2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">=</span> monomial <span class="main">(</span>poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> focus_Polys poly_eval_sum poly_eval_monomial monomial_power_map_scale
                  times_monomial_monomial <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> punit.monomial_prod_sum monomial_sum<span class="main">)</span>
           <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eval_alt<span class="main">)</span>

      <span class="keyword3"><span class="command">assume</span></span> spoly_nz<span class="main">:</span> <span class="quoted"><span class="quoted">"i.punit.spoly <span class="skolem">g1</span> <span class="skolem">g2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g1 g2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> c1_nz<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">c1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c1_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g1'</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> a_nz<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> c2_nz<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">c2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c2_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2'</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> a_nz<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g1'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"except <span class="main">(</span>i.lpp <span class="skolem">g1'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">∈</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> PPs_closed_except' i.PPs_closed_lpp<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"except <span class="main">(</span>i.lpp <span class="skolem">g2'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">∈</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> PPs_closed_except' i.PPs_closed_lpp<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_closed_lcs<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="main">.[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span> <span class="main">(</span><span class="operator">rule</span> PPs_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span> <span class="main">(</span><span class="operator">intro</span> Polys_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span> <span class="main">(</span><span class="operator">intro</span> Polys_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g1'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> s_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Polys_closed_minus Polys_closed_times Polys_closed_monom_mult PPs_closed_minus<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> ideal <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> s_def times_monomial_left<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ideal.span_diff ideal.span_scale ideal.span_base <span class="quoted"><span class="quoted">‹<span class="skolem">g1'</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2'</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> G_isGB <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>i.punit.red <span class="skolem">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.GB_imp_zero_reducibility<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>›</span></span> G_sub fin_G <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q0</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> <span class="skolem">q0</span> <span class="bound">g</span> <span class="main">*</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="skolem">q0</span> <span class="bound">g</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> lex_pm <span class="main">(</span>i.lpp <span class="main">(</span><span class="skolem">q0</span> <span class="bound">g</span> <span class="main">*</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>i.lpp <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.red_rtrancl_repE<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> dickson_grading_varnum<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">,</span></span>
                                            <span class="operator">simplified</span> i.dgrad_p_set_varnum<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">blast</span>

      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> inverse <span class="skolem">c</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">∑</span><span class="bound">h</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">y</span></span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span><span class="main">}</span><span class="main">.</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="skolem">q0</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> eq4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">t</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> monomial <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> focus_Polys_Compl Polys_closed_monomial PPs_closed_minus<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∉</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">.[</span><span class="free">X</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">.[</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPs_mono<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eval_monomial<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> c2_nz <span class="keyword1"><span class="command">have</span></span> eq5<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">c</span> <span class="main">*</span> poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">c2</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> lookup <span class="skolem">g1</span> <span class="main">(</span>i.lpp <span class="skolem">g1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> lpp1 <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g1'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def mult.assoc divide_inverse_commute g1 lookup_e_focus
                <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lpp_focus i.punit.lc_def c1_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> c1_nz <span class="keyword1"><span class="command">have</span></span> eq6<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">c</span> <span class="main">*</span> poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">c1</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> lookup <span class="skolem">g2</span> <span class="main">(</span>i.lpp <span class="skolem">g2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> lpp2 <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_def mult.assoc mult.left_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">c1</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span>
                    divide_inverse_commute g2 lookup_e_focus <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lpp_focus i.punit.lc_def c2_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> l_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> lcs <span class="main">(</span>i.lpp <span class="skolem">g1</span><span class="main">)</span> <span class="main">(</span>i.lpp <span class="skolem">g2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> l_def lpp1 lpp2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> spoly_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"i.punit.spoly <span class="skolem">g1</span> <span class="skolem">g2</span> <span class="main">=</span> <span class="main">(</span>inverse <span class="skolem">c</span><span class="main">)</span> <span class="main">⋅</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_def focus_minus focus_times poly_eval_minus poly_eval_times eval_c1 eval_c2
                      eq4 eq5 eq6 map_scale_eq_times times_monomial_monomial right_diff_distrib
                      i.punit.spoly_def Let_def
                 <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> mult.assoc times_monomial_left g1 g2 lpp1 lpp2 l_alt<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> inverse <span class="skolem">c</span> <span class="main">⋅</span> <span class="main">(</span><span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="skolem">q0</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 focus_sum poly_eval_sum focus_times poly_eval_times map_scale_sum_distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="skolem">G3</span><span class="main">.</span> <span class="main">∑</span><span class="bound">h</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">y</span></span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> <span class="var">?e</span> <span class="main">(</span>focus<span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span><span class="main">}</span><span class="main">.</span>
                                      inverse <span class="skolem">c</span> <span class="main">⋅</span> <span class="main">(</span><span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="skolem">q0</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> G3_def image_image <span class="keyword1"><span class="command">using</span></span> fin_G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.image_gen<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="skolem">G3</span><span class="main">.</span> inverse <span class="skolem">c</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">∑</span><span class="bound">h</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">y</span></span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> <span class="var">?e</span> <span class="main">(</span>focus<span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span><span class="main">}</span><span class="main">.</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="skolem">q0</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_scale_eq_times sum_distrib_left sum_distrib_right mult.assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="skolem">G3</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">g</span> <span class="main">*</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_def sum_distrib_right<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"i.punit.spoly <span class="skolem">g1</span> <span class="skolem">g2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">g</span><span class="main">∈</span><span class="skolem">G3</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">g</span> <span class="main">*</span> <span class="bound">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"i.punit.spoly_rep <span class="main">(</span>varnum <span class="free">X</span><span class="main">)</span> <span class="main">0</span> <span class="skolem">G3</span> <span class="skolem">g1</span> <span class="skolem">g2</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.spoly_repI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> d<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"varnum <span class="free"><span class="free">X</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
                                        <span class="operator">simplified</span> i.dgrad_p_set_varnum<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> Polys_closed_map_scale Polys_closed_sum<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g0</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q0</span> <span class="skolem">g0</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">g0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eval_focus_in_Polys<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">g0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq1<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"i.lpp <span class="main">(</span><span class="skolem">q</span> <span class="skolem">g</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> i.lpp <span class="main">(</span><span class="main">∑</span><span class="bound">h</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">y</span></span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span><span class="main">}</span><span class="main">.</span> inverse <span class="skolem">c</span> <span class="main">⋅</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="skolem">q0</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_def map_scale_sum_distrib_left sum_distrib_right<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="main">…</span> <span class="main">(</span>i.ordered_powerprod_lin.Max
                <span class="main">{</span>i.lpp <span class="main">(</span>inverse <span class="skolem">c</span> <span class="main">⋅</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="skolem">q0</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">|</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="main">_</span> <span class="main">(</span>i.ordered_powerprod_lin.Max <span class="var">?A</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> i.punit.lt_sum_le_Max<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="main">…</span> <span class="main">(</span>i.lpp <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> i.ordered_powerprod_lin.Max.boundedI<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> fin_G <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">h</span></span> <span class="main">∈</span> <span class="skolem">G</span><span class="main">.</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="bound">h</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> q_def sum.empty map_scale_zero_right<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> i.lpp <span class="main">(</span>inverse <span class="skolem">c</span> <span class="main">⋅</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>3<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"i.lpp <span class="main">(</span>inverse <span class="skolem">c</span> <span class="main">⋅</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span>
                      i.lpp <span class="main">(</span>inverse <span class="skolem">c</span> <span class="main">⋅</span> <span class="main">(</span><span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">h</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> map_scale_eq_times mult.assoc g poly_eval_times focus_times<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹inverse <span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> i.lpp <span class="main">(</span><span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">h</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.lt_map_scale<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="main">…</span> <span class="main">(</span>i.lpp <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">h</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.lt_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span><span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">h</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> keys <span class="main">(</span><span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">h</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> keys_poly_eval_focus_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> except <span class="bound">v</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> keys <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">h</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">h</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> except <span class="skolem">v</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="skolem">u</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">(</span>lookup <span class="skolem">v</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add.right_neutral i.plus_monotone_left lex_pm_zero_min<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> u <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> plus_except<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="skolem">v</span> <span class="main">(</span>i.lpp <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">h</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.lt_max_keys<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="skolem">u</span> <span class="main">(</span>i.lpp <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">h</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="main">(</span>i.lpp <span class="main">(</span><span class="skolem">q0</span> <span class="skolem">h</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="main">…</span> <span class="main">(</span>i.lpp <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="skolem">t</span> <span class="main">(</span>i.lpp <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="main">…</span> <span class="skolem">l</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.lt_less<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> spoly_nz <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> spoly_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="skolem">l</span> <span class="skolem">t</span>"</span></span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1'</span> <span class="main">=</span> flatten <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g1'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> flatten <span class="main">(</span>monomial <span class="skolem">c1</span> <span class="main">(</span>i.lpp <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g1'</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> i.punit.tail <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g1'</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> c1_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> i.punit.leading_monomial_tail<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g1'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span>except <span class="main">(</span>i.lpp <span class="skolem">g1'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">c1</span> <span class="main">+</span>
                                              flatten <span class="main">(</span>i.punit.tail <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g1'</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> flatten_plus flatten_monomial lpp_focus<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">1</span> <span class="main">(</span>except <span class="main">(</span>i.lpp <span class="skolem">g1'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">c1</span> <span class="main">+</span>
                              flatten <span class="main">(</span>i.punit.tail <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g1'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g1'</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">*</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> except <span class="main">(</span>i.lpp <span class="skolem">g1'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="var">?l</span> <span class="main">=</span>
                          punit.monom_mult <span class="main">1</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">+</span>
                          <span class="skolem">c2</span> <span class="main">*</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> i.lpp <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g1'</span><span class="main">)</span><span class="main">)</span>
                                                  <span class="main">(</span>flatten <span class="main">(</span>i.punit.tail <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g1'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> punit.monom_mult <span class="main">1</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">+</span> <span class="var">?a</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.monom_mult_dist_right punit.monom_mult_assoc l_def minus_plus adds_lcs<span class="main">)</span>
               <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left lpp_focus <span class="quoted"><span class="quoted">‹<span class="skolem">g1'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> times_monomial_left<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">*</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> except <span class="main">(</span>i.lpp <span class="skolem">g1'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">g1'</span> <span class="main">=</span>
                                punit.monom_mult <span class="main">1</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">+</span> <span class="var">?a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2'</span> <span class="main">=</span> flatten <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g2'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> flatten <span class="main">(</span>monomial <span class="skolem">c2</span> <span class="main">(</span>i.lpp <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g2'</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> i.punit.tail <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g2'</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> c2_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> i.punit.leading_monomial_tail<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span>except <span class="main">(</span>i.lpp <span class="skolem">g2'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">c2</span> <span class="main">+</span>
                                              flatten <span class="main">(</span>i.punit.tail <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g2'</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> flatten_plus flatten_monomial lpp_focus<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">1</span> <span class="main">(</span>except <span class="main">(</span>i.lpp <span class="skolem">g2'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">c2</span> <span class="main">+</span>
                              flatten <span class="main">(</span>i.punit.tail <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g2'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g2'</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">*</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> except <span class="main">(</span>i.lpp <span class="skolem">g2'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="var">?l</span> <span class="main">=</span>
                          punit.monom_mult <span class="main">1</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">+</span>
                          <span class="skolem">c1</span> <span class="main">*</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> i.lpp <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g2'</span><span class="main">)</span><span class="main">)</span>
                                                  <span class="main">(</span>flatten <span class="main">(</span>i.punit.tail <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g2'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> punit.monom_mult <span class="main">1</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">+</span> <span class="var">?b</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.monom_mult_dist_right punit.monom_mult_assoc l_def minus_plus adds_lcs_2<span class="main">)</span>
               <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left lpp_focus <span class="quoted"><span class="quoted">‹<span class="skolem">g2'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> times_monomial_left<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">*</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> except <span class="main">(</span>i.lpp <span class="skolem">g2'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="skolem">g2'</span> <span class="main">=</span>
                                punit.monom_mult <span class="main">1</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">*</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">+</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">have</span></span> lex_pm_strict_t<span class="main">:</span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="skolem">t</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> i.lpp <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">+</span> i.lpp <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> i.lpp <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span>
                                            <span class="main">(</span>flatten <span class="main">(</span>i.punit.tail <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">d</span> <span class="skolem">h</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="main">(</span><span class="skolem">u</span> <span class="main">+</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="skolem">v</span> <span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
              <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> lex_pm_strict_plus_left<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">z</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> keys <span class="skolem">w</span>"</span></span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPsD<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">{..&lt;</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> keys <span class="skolem">u</span>"</span></span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPsD<span class="main">)</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"focus <span class="free">X</span> <span class="skolem">h</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">∈</span> <span class="skolem">G'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G'_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G'</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"i.lpp <span class="var">?h</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.PPs_closed_lpp<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∈</span> keys <span class="skolem">d</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> keys <span class="main">(</span>punit.monom_mult <span class="main">1</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> i.lpp <span class="var">?h</span><span class="main">)</span> <span class="main">(</span>flatten <span class="main">(</span>i.punit.tail <span class="var">?h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t1</span> <span class="main">+</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_keys_timesE<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t3</span> <span class="main">∈</span> keys <span class="main">(</span>flatten <span class="main">(</span>i.punit.tail <span class="var">?h</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> t2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">-</span> i.lpp <span class="var">?h</span> <span class="main">+</span> <span class="skolem">t3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> punit.keys_monom_mult<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t4</span></span> <span class="skolem"><span class="skolem">t5</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t4</span> <span class="main">∈</span> keys <span class="main">(</span>i.punit.tail <span class="var">?h</span><span class="main">)</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> t5_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t5</span> <span class="main">∈</span> keys <span class="main">(</span>lookup <span class="main">(</span>i.punit.tail <span class="var">?h</span><span class="main">)</span> <span class="skolem">t4</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t3</span> <span class="main">=</span> <span class="skolem">t4</span> <span class="main">+</span> <span class="skolem">t5</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> keys_flatten_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="skolem">t4</span> <span class="main">(</span>i.lpp <span class="var">?h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.keys_tail_less_lt<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="var">?h</span> <span class="skolem">t4</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lookup_focus_in<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>lookup <span class="var">?h</span> <span class="skolem">t4</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> t5_in <span class="keyword1"><span class="command">have</span></span> t5_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t5</span> <span class="main">∈</span> keys <span class="main">(</span>lookup <span class="var">?h</span> <span class="skolem">t4</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i.punit.lookup_tail <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t5</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
            <span class="keyword1"><span class="command">with</span></span> 1 <span class="quoted"><span class="quoted">‹i.lpp <span class="var">?h</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="main">(</span><span class="skolem">t5</span> <span class="main">+</span> <span class="skolem">t4</span><span class="main">)</span> <span class="main">(</span>i.lpp <span class="var">?h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 0<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="skolem">t3</span> <span class="main">(</span>i.lpp <span class="var">?h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> t3 add.commute<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="skolem">t2</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> i.lpp <span class="var">?h</span> <span class="main">+</span> i.lpp <span class="var">?h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t2
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.plus_monotone_strict_left<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹i.lpp <span class="var">?h</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">-</span> i.lpp <span class="var">?h</span> <span class="main">+</span> i.lpp <span class="var">?h</span> <span class="main">∈</span> <span class="main">.[</span><span class="free">X</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> PPs_closed_plus PPs_closed_minus<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t1</span> <span class="main">∈</span> keys <span class="skolem">d</span>›</span></span> that<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∈</span> <span class="main">.[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> PolysD<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 0<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">s</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">s</span> <span class="skolem">t</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> keys <span class="main">(</span><span class="var">?a</span> <span class="main">-</span> <span class="var">?b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_def a b<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> keys <span class="var">?a</span> <span class="main">∪</span> keys <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> keys_minus<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="var">?a</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="skolem">t</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> i.lpp <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g1'</span><span class="main">)</span> <span class="main">+</span> i.lpp <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g1'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g1'</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c2</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lex_pm_strict_t<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g1'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="skolem">t</span> <span class="skolem">l</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lpp_focus l_def minus_plus adds_lcs<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lex_pm <span class="skolem">l</span> <span class="skolem">t</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="var">?b</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="skolem">t</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> i.lpp <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g2'</span><span class="main">)</span> <span class="main">+</span> i.lpp <span class="main">(</span>focus <span class="free">X</span> <span class="skolem">g2'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2'</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c1</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lex_pm_strict_t<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">_</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="skolem">t</span> <span class="skolem">l</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lpp_focus l_def minus_plus adds_lcs_2<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lex_pm <span class="skolem">l</span> <span class="skolem">t</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> lcs <span class="main">(</span>i.lpp <span class="skolem">g1</span><span class="main">)</span> <span class="main">(</span>i.lpp <span class="skolem">g2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> l_def lpp1 lpp2<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lex_pm_strict <span class="main">(</span>i.lpp <span class="main">(</span><span class="skolem">q</span> <span class="skolem">g</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lcs <span class="main">(</span>i.lpp <span class="skolem">g1</span><span class="main">)</span> <span class="main">(</span>i.lpp <span class="skolem">g2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span><span class="var">?e</span> <span class="main">`</span> focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span><span class="var">?e</span> <span class="main">`</span> focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_in_Polys<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">1</span> <span class="main">∈</span> ideal <span class="skolem">G3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_in_Polys <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> eq3<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">…</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">note</span></span> G3_isGB
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="skolem">G3</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"i.lpp <span class="skolem">g</span> <span class="keyword1">adds</span> i.lpp <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.GB_adds_lt<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"i.lpp <span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i.punit.lt_monomial adds_zero <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> single_one<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>i.lcf <span class="skolem">g</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.lt_eq_min_term_monomial<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">G3</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="var">?e</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">g'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G3_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"i.lpp <span class="skolem">g</span> <span class="main">=</span> except <span class="main">(</span>i.lpp <span class="skolem">g'</span><span class="main">)</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lpp_e_focus<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>i.lpp <span class="skolem">g'</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹i.lpp <span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span>›</span></span> except_eq_zero_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> PolysI subsetI PPsI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="skolem">y</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">g'</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lex_pm <span class="skolem">t</span> <span class="main">(</span>i.lpp <span class="skolem">g'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> i.punit.lt_max_keys<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> keys <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> keys <span class="main">(</span>i.lpp <span class="skolem">g'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lex_pm_keys_leE<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹keys <span class="main">(</span>i.lpp <span class="skolem">g'</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> G_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"indets <span class="skolem">g'</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> indets <span class="skolem">g'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_indetsI<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> insert <span class="free">x</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≤</span> <span class="skolem">y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> ideal <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_G<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> ideal <span class="main">(</span><span class="var">?e</span> <span class="main">`</span> focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> weak_Nullstellensatz_aux_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>alg_closed_field"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> ideal <span class="main">(</span>poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="free">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> poly_of_pm <span class="free">x</span> <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_def poly_of_pm_eq_zero_iff <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> keys_eq_empty <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> PolysD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> Polynomial.smult <span class="skolem">c</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">m</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">z</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> linear_factorsE<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>4<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="bound">z</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">1</span> <span class="main">∉</span> ideal <span class="main">(</span>poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="bound">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">1</span> <span class="main">∉</span> ideal <span class="main">(</span>poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="bound">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">a</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> monomial <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">g</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">gh</span> <span class="bound">a</span><span class="main">.</span> fst <span class="bound">gh</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∧</span> fst <span class="bound">gh</span> <span class="main">+</span> snd <span class="bound">gh</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> monomial <span class="bound">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">gh</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gh</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">gh</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">gh</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> asm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">`</span> ideal <span class="free">F</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_poly_eval_focus_ideal one_in_Polys<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> image_image <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> poly <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>monomial <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_poly_of_focus<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> monomial <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="skolem">g</span><span class="main">)</span> <span class="var">?x</span> <span class="main">-</span> <span class="skolem">h</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> monomial <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_minus_rightE<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">-</span> <span class="skolem">h</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> monomial <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_poly_of_focus_monomial<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">-</span> <span class="skolem">h</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> monomial <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> ideal <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">g</span><span class="main">,</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">gh</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> gh_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="skolem">gh</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="skolem">gh</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> monomial <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> fst <span class="main">(</span><span class="skolem">gh</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> P_def add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">(</span><span class="skolem">h</span> <span class="bound">a</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> monomial <span class="bound">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">g</span> <span class="bound">a</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">(</span><span class="skolem">h</span> <span class="bound">a</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> monomial <span class="bound">a</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">g'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weak_Nullstellensatz_aux_1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">(</span><span class="skolem">h</span> <span class="bound">a</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> monomial <span class="bound">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">g</span> <span class="bound">a</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span> <span class="main">(</span><span class="operator">intro</span> prod.neutral ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 1 power_one<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">a</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> monomial <span class="bound">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">g'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 2 power_mult_distrib prod.distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> monomial <span class="bound">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> pm_of_poly <span class="free">x</span> <span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">[:</span><span class="main">-</span> <span class="bound">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pm_of_poly_prod pm_of_poly_pCons single_uminus punit.monom_mult_monomial
              <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> single_one<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> monomial <span class="main">(</span>inverse <span class="skolem">c</span><span class="main">)</span> <span class="main">0</span> <span class="main">*</span> pm_of_poly <span class="free">x</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p map_scale_assoc <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> map_scale_eq_times<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> monomial <span class="main">(</span>inverse <span class="skolem">c</span><span class="main">)</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> poly_of_pm <span class="free">x</span> <span class="skolem">f</span>›</span></span> pm_of_poly_of_pm<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">a</span> <span class="main">^</span> <span class="skolem">m</span> <span class="bound">a</span><span class="main">)</span> <span class="main">*</span> monomial <span class="main">(</span>inverse <span class="skolem">c</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> ideal <span class="free">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">∈</span> ideal <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ideal.span_add ideal.span_scale<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> ideal <span class="main">(</span>poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="skolem">a</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> weak_Nullstellensatz<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="free">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">{}</span><span class="main">::</span><span class="main">(</span><span class="tfree">'x</span><span class="main">::</span><span class="main">{</span>countable<span class="main">,</span>linorder<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>alg_closed_field<span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_eq_UNIV_iff_contains_one
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> ideal <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> ideal <span class="main">(</span>poly_eval <span class="skolem">a</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_linorder_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> empty.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> monomial <span class="skolem">c</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Polys_empty <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ideal <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>inverse <span class="skolem">c</span><span class="main">)</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">∈</span> ideal <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_scale<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f times_monomial_monomial<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> empty.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">0</span> <span class="main">`</span> <span class="skolem">F</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>poly_eval <span class="main">0</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> ideal <span class="main">(</span>poly_eval <span class="main">0</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ideal_eq_zero_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> empty.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">X</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> ideal <span class="main">(</span>poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="skolem">a0</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> focus <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∉</span> ideal <span class="var">?F</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> insert.hyps<span class="main">(</span>1<span class="main">)</span> insert.prems<span class="main">(</span>2<span class="main">)</span> insert.hyps<span class="main">(</span>2<span class="main">)</span> insert.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a0</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> ideal <span class="main">(</span>poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="skolem">a0</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> focus <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weak_Nullstellensatz_aux_2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> insert.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> insert.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> ideal <span class="main">(</span>poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="skolem">a0</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> focus <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insert.prems<span class="main">(</span>3<span class="main">)</span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weak_Nullstellensatz_aux_3<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="skolem">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> insert.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="skolem">x</span> <span class="skolem">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="skolem">a0</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>focus <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="skolem">x</span> <span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eval_focus_in_Polys<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="skolem">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_mono<span class="main">)</span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> monomial <span class="skolem">a0</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>focus <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> ideal <span class="main">(</span>poly_eval <span class="skolem">a1</span> <span class="main">`</span> <span class="var">?F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> insert.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a1</span> <span class="main">`</span> <span class="var">?F</span> <span class="main">=</span> poly_eval <span class="main">(</span><span class="skolem">a1</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> poly_eval <span class="skolem">a1</span> <span class="main">(</span>monomial <span class="skolem">a0</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_image poly_eval_poly_eval_focus fun_upd_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>poly_eval <span class="skolem">a</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">≠</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_eq_UNIV_iff_contains_one<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>poly_eval <span class="skolem">a</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ideal_field_disj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">`</span> <span class="free">F</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">`</span> <span class="free">F</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofI_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> radical_idealI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'x</span><span class="main">::</span><span class="main">{</span>countable<span class="main">,</span>linorder<span class="main">}</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>alg_closed_field<span class="main">)</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Polys_alt<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Poly_Mapping.single <span class="free">x</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">1</span> <span class="var">?x</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> insert_subset
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI Polys_closed_minus one_in_Polys Polys_closed_monom_mult PPs_closed_single<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_mono<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weak_Nullstellensatz<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F'</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> fin'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> F'_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F'</span> <span class="main">⊆</span> insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f'</span><span class="main">∈</span><span class="skolem">F'</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f'</span> <span class="main">*</span> <span class="bound">f'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.spanE<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="var">?f</span> <span class="main">∈</span> <span class="skolem">F'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">.</span> Fract <span class="bound">x</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F''</span> <span class="main">=</span> <span class="skolem">F'</span> <span class="main">-</span> <span class="main">{</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q0</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> g_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def fract_collapse<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> g_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def fract_collapse<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> g_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">g</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> g_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> g_times<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">g</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> fin' <span class="keyword1"><span class="command">have</span></span> fin''<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F''_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> F'_sub <span class="keyword1"><span class="command">have</span></span> F''_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F''</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F''_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="var">?f</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="var">?x</span> <span class="main">*</span> focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> focus_times focus_monomial except_single <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> times_monomial_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="free">f</span> <span class="main">=</span> monomial <span class="free">f</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> focus_Polys_Compl<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="var">?f</span> <span class="main">=</span> monomial <span class="free">f</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_monomial_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly <span class="skolem">g</span> <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Fract <span class="main">1</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_focus_def focus_minus poly_of_pm_minus poly_of_pm_monomial
                PPs_closed_single map_poly_minus g_0 g_1 g_minus map_poly_monom poly_monom<span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def Fract_same <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly <span class="skolem">g</span> <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Fract <span class="main">1</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> Fract <span class="skolem">f'</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="skolem">F''</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f'</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> that F''_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">⊆</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"focus <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="skolem">f'</span> <span class="main">=</span> monomial <span class="skolem">f'</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> focus_Polys_Compl<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_of_focus_def focus_minus poly_of_pm_minus poly_of_pm_monomial
                zero_in_PPs map_poly_minus g_0 g_1 g_minus map_poly_monom poly_monom<span class="main">)</span>
           <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p0m0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p0m0</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f'</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">z</span><span class="main">.</span> poly <span class="main">(</span>map_poly <span class="skolem">g</span> <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="skolem">q</span> <span class="bound">f'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Fract <span class="main">1</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span>
                                              Fract <span class="main">(</span>fst <span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> snd <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p0</span> <span class="main">=</span> fst <span class="main">∘</span> <span class="skolem">p0m0</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m0</span> <span class="main">=</span> snd <span class="main">∘</span> <span class="skolem">p0m0</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> Max <span class="main">(</span><span class="skolem">m0</span> <span class="main">`</span> <span class="skolem">F''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly <span class="skolem">g</span> <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Fract <span class="main">1</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> Fract <span class="main">(</span><span class="skolem">p0</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m0</span> <span class="skolem">f'</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f'</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def Fract_eq_zero_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>Polynomial.coeffs <span class="main">(</span>map_poly <span class="skolem">g</span> <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Fract <span class="bound">x</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_coeffs_map_poly g_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly <span class="skolem">g</span> <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Fract <span class="main">1</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> Fract <span class="skolem">p</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_Fract<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly <span class="skolem">g</span> <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="skolem">q</span> <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Fract <span class="main">1</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> Fract <span class="main">(</span>fst <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">m'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> snd <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">m'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> p0_def m0_def p0m0_def o_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    
    <span class="keyword1"><span class="command">note</span></span> eq
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> True fin' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">f'</span><span class="main">∈</span><span class="skolem">F'</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f'</span> <span class="main">*</span> <span class="bound">f'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">q0</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f'</span><span class="main">∈</span><span class="skolem">F''</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f'</span> <span class="main">*</span> <span class="bound">f'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q0_def F''_def sum.remove<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_of_focus <span class="free">x</span> <span class="main">1</span> <span class="main">=</span> poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="skolem">q0</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f'</span><span class="main">∈</span><span class="skolem">F''</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f'</span> <span class="main">*</span> <span class="bound">f'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> poly <span class="main">(</span>map_poly <span class="skolem">g</span> <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="skolem">q0</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f'</span><span class="main">∈</span><span class="skolem">F''</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f'</span> <span class="main">*</span> <span class="bound">f'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Fract <span class="main">1</span> <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly <span class="main">(</span>map_poly <span class="skolem">g</span> <span class="main">(</span>poly_of_focus <span class="free">x</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f'</span><span class="main">∈</span><span class="skolem">F''</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">f'</span> <span class="main">*</span> <span class="bound">f'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Fract <span class="main">1</span> <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_of_focus_plus map_poly_plus g_0 g_plus g_times poly_add
                poly_of_focus_times map_poly_times poly_mult eq1 mult_zero_right add_0_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f'</span><span class="main">∈</span><span class="skolem">F''</span><span class="main">.</span> Fract <span class="main">(</span><span class="skolem">p0</span> <span class="bound">f'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m0</span> <span class="bound">f'</span><span class="main">)</span> <span class="main">*</span> Fract <span class="bound">f'</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_of_focus_sum poly_of_focus_times map_poly_sum map_poly_times
                g_0 g_plus g_times poly_sum poly_mult eq2 eq3 <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> sum.cong<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Fract <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> Fract <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f'</span><span class="main">∈</span><span class="skolem">F''</span><span class="main">.</span> Fract <span class="main">(</span><span class="skolem">p0</span> <span class="bound">f'</span> <span class="main">*</span> <span class="bound">f'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m0</span> <span class="bound">f'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f'</span><span class="main">∈</span><span class="skolem">F''</span><span class="main">.</span> Fract <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p0</span> <span class="bound">f'</span> <span class="main">*</span> <span class="bound">f'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m0</span> <span class="bound">f'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f'</span><span class="main">∈</span><span class="skolem">F''</span><span class="main">.</span> Fract <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">m0</span> <span class="bound">f'</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">p0</span> <span class="bound">f'</span><span class="main">)</span> <span class="main">*</span> <span class="bound">f'</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="skolem">F''</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m0</span> <span class="skolem">f'</span> <span class="main">∈</span> <span class="skolem">m0</span> <span class="main">`</span> <span class="skolem">F''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> _ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m0</span> <span class="skolem">f'</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_ge<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin''<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">=</span> <span class="free">f</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">m0</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">m0</span> <span class="skolem">f'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Fract <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p0</span> <span class="skolem">f'</span> <span class="main">*</span> <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m0</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">=</span> Fract <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m0</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m0</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">*</span>
                                                        Fract <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">m0</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p0</span> <span class="skolem">f'</span> <span class="main">*</span> <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Fract <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m0</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m0</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Fract_same<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Fract <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">p0</span> <span class="skolem">f'</span> <span class="main">*</span> <span class="skolem">f'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m0</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">=</span> Fract <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">m0</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">p0</span> <span class="skolem">f'</span> <span class="main">*</span> <span class="skolem">f'</span><span class="main">)</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fin'' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Fract <span class="main">(</span><span class="main">∑</span><span class="bound">f'</span><span class="main">∈</span><span class="skolem">F''</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">m0</span> <span class="bound">f'</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">p0</span> <span class="bound">f'</span><span class="main">)</span> <span class="main">*</span> <span class="bound">f'</span><span class="main">)</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">F''</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fract_collapse<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">f'</span><span class="main">∈</span><span class="skolem">F''</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">m0</span> <span class="bound">f'</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">p0</span> <span class="bound">f'</span><span class="main">)</span> <span class="main">*</span> <span class="bound">f'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_fract<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> ideal <span class="skolem">F''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.sum_in_spanI<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F''</span> <span class="main">⊆</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> F'_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="skolem">F'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.sum_in_spanI<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ideal_eq_UNIV_iff_contains_one<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> radical_idealI_extend_indets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single None <span class="main">1</span><span class="main">)</span> <span class="main">(</span>extend_indets <span class="free">f</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">(</span>extend_indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="main">(</span><span class="main">_</span><span class="main">::</span><span class="main">{</span>countable<span class="main">,</span>linorder<span class="main">}</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>alg_closed_field<span class="main">)</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="free">X</span> <span class="main">∪</span> indets <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> fin_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_def finite_indets<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> F_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_def Polys_alt<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"extend_indets <span class="main">`</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"extend_indets <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Some <span class="main">`</span> <span class="skolem">Y</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> fin_Y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="var">?X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indets_extend_indets <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> PolysI_alt imageI <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> PolysD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> f_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="var">?X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indets_extend_indets <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> PolysI_alt imageI <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> PolysD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radical_idealI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="var">?F</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalE<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"extend_indets <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> extend_indets <span class="main">`</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> extend_indets_ideal_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> extend_indets_power <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="var">?F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">-</span> <span class="main">{</span>None<span class="main">}</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_power<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> PolysI_alt <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indets_extend_indets<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"extend_indets <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> extend_indets <span class="main">`</span> ideal <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> extend_indets_ideal extend_indets_power<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> inj_image_mem_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_extend_indets<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Nullstellensatz<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="main">(</span><span class="main">_</span><span class="main">::</span><span class="main">{</span>countable<span class="main">,</span>linorder<span class="main">}</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>alg_closed_field<span class="main">)</span> <span class="main">∈</span> ℐ <span class="main">(</span>𝒱 <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> radical_idealI_extend_indets<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">1</span> <span class="main">(</span>monomial <span class="main">1</span> None<span class="main">)</span> <span class="main">(</span>extend_indets <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>extend_indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subset_antisym subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>extend_indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="var">?f</span> <span class="main">∈</span> insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>extend_indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofD<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">(</span>extend_indets <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_eval_minus poly_eval_times <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> times_monomial_left<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="skolem">a</span> <span class="main">∘</span> Some<span class="main">)</span> <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eval_extend_indets<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∘</span> Some <span class="main">∈</span> 𝒱 <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"extend_indets <span class="skolem">f'</span> <span class="main">∈</span> insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>extend_indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">(</span>extend_indets <span class="skolem">f'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofD<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="skolem">a</span> <span class="main">∘</span> Some<span class="main">)</span> <span class="skolem">f'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_eval_extend_indets<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="skolem">a</span> <span class="main">∘</span> Some<span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_ofD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹poly_eval <span class="main">(</span><span class="skolem">a</span> <span class="main">∘</span> Some<span class="main">)</span> <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> strong_Nullstellensatz<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ℐ <span class="main">(</span>𝒱 <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">√</span>ideal <span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="main">_</span><span class="main">::</span><span class="main">{</span>countable<span class="main">,</span>linorder<span class="main">}</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>alg_closed_field<span class="main">)</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subset_antisym subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ℐ <span class="main">(</span>𝒱 <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Nullstellensatz<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">metis</span> ideal_ofI variety_ofD variety_of_radical_ideal<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemma can be used for actually <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹deciding›</span></span> whether a polynomial is contained in
  the radical of an ideal or not.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> radical_ideal_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="main">(</span><span class="main">_</span><span class="main">::</span><span class="main">{</span>countable<span class="main">,</span>linorder<span class="main">}</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>alg_closed_field<span class="main">)</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span> <span class="main">⟷</span>
            <span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> insert_subset
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI Polys_closed_minus one_in_Polys Polys_closed_monom_mult PPs_closed_single<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_mono<span class="main">)</span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subset_antisym subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="var">?f</span> <span class="main">∈</span> insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_eval_minus poly_eval_times poly_eval_power <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> times_monomial_left<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="main">(</span>ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> variety_of_ideal<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="free">F</span>›</span></span> ideal.span_mono <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_subsetD<span class="main">)</span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofD<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹poly_eval <span class="skolem">a</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weak_Nullstellensatz<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subset_antisym subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="main">(</span>ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> variety_of_ideal<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofD<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radical_idealI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Nullstellensatz_Field">
<div class="head">
<h1>Theory Nullstellensatz_Field</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Field-Theoretic Version of Hilbert's Nullstellensatz›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Nullstellensatz_Field
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Nullstellensatz.html">Nullstellensatz</a> <span class="quoted">"<a href="../../HOL/HOL-Types_To_Sets/Types_To_Sets.html">HOL-Types_To_Sets.Types_To_Sets</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Building upon the geometric version of Hilbert's Nullstellensatz in
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="Nullstellensatz.html"></a><a href="Nullstellensatz.html">Nullstellensatz.Nullstellensatz</a><span class="antiquote"><span class="antiquote">}</span></span></span></span>, we prove its field-theoretic version here. To that end we employ
  the `types to sets' methodology.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Getting Rid of Sort Constraints in Geometric Version›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can use the `types to sets' approach to get rid of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">class</span></span> countable<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">class</span></span> linorder<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  sort constraints on the type of indeterminates in the geometric version of the Nullstellensatz.
  Once the `types to sets' methodology is integrated as a standard component into the main library of
  Isabelle, the theorems in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="Nullstellensatz.html"></a><a href="Nullstellensatz.html">Nullstellensatz.Nullstellensatz</a><span class="antiquote"><span class="antiquote">}</span></span></span></span> could be replaced by their counterparts
  in this section.›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> radical_idealI_internalized <span class="main">=</span> radical_idealI<span class="main">[</span><span class="operator">unoverload_type</span> <span class="tfree">'x</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> radical_idealI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>alg_closed_field<span class="main">)</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> insert <span class="free">x</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> fin_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Y_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> F_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'y</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to be isomorphic to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Y</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">Rep</span> <span class="main">::</span> <span class="tfree">'y</span> <span class="main">⇒</span> <span class="tfree">'x</span><span class="main">)</span> <span class="bound">Abs</span><span class="main">.</span> type_definition <span class="bound">Rep</span> <span class="bound">Abs</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rep</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'y</span> <span class="main">⇒</span> <span class="tfree">'x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">abs</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> <span class="main">⇒</span> <span class="tfree">'y</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"type_definition <span class="skolem">rep</span> <span class="skolem">abs</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> y<span class="main">:</span> type_definition <span class="quoted"><span class="skolem">rep</span></span> <span class="quoted"><span class="skolem">abs</span></span> <span class="quoted"><span class="skolem">Y</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">from</span></span> well_ordering <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">le_y'</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'y</span> <span class="main">×</span> <span class="tfree">'y</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> fld<span class="main">:</span> <span class="quoted"><span class="quoted">"Field <span class="skolem">le_y'</span> <span class="main">=</span> UNIV"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wo<span class="main">:</span> <span class="quoted"><span class="quoted">"Well_order <span class="skolem">le_y'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">le_y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">le_y</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">::</span><span class="tfree">'y</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">le_y'</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">rep</span> <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> map_indets_map_indets
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> map_indets_id<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> y.Abs_inverse <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> PolysD<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"map_indets <span class="main">(</span><span class="skolem">rep</span> <span class="main">∘</span> <span class="skolem">abs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span> <span class="main">=</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">from</span></span> F_sub <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="main">(</span><span class="skolem">rep</span> <span class="main">∘</span> <span class="skolem">abs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> PolysD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_apply image_subset_iff map_indets_id subsetD y.Abs_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> F_sub <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> map_indets <span class="main">(</span><span class="skolem">rep</span> <span class="main">∘</span> <span class="skolem">abs</span><span class="main">)</span> <span class="main">`</span> <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> PolysD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_apply image_eqI map_indets_id subsetD subsetI y.Abs_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="skolem">rep</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inj_onI y.Rep_inject<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>map_indets <span class="skolem">rep</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_indets_injI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> fin_Y <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">abs</span> <span class="main">`</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> wo <span class="keyword1"><span class="command">have</span></span> le_y_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">le_y</span> <span class="skolem">x</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_y_def well_order_on_def linear_order_on_def partial_order_on_def
                    preorder_on_def refl_on_def fld<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> le_y_total<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">le_y</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">le_y</span> <span class="skolem">y</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_y_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> wo <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_y_def well_order_on_def linear_order_on_def total_on_def
                      Relation.total_on_def fld<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">from</span></span> 4 finite_imp_inj_to_nat_seg y.Abs_image <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"class.countable <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"class.linorder <span class="skolem">le_y</span> <span class="main">(</span>strict <span class="skolem">le_y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> refl<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> le_y_refl<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> wo
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_y_def well_order_on_def linear_order_on_def partial_order_on_def
                      preorder_on_def fld <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> transD<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> wo
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_y_def well_order_on_def linear_order_on_def partial_order_on_def
                      preorder_on_def antisym_def fld<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> le_y_total<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">abs</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="skolem">abs</span> <span class="main">`</span> <span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span> <span class="main">⊆</span> map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> image_map_indets_Polys<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">abs</span> <span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">abs</span> <span class="main">`</span> <span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">abs</span> <span class="free">f</span> <span class="main">∈</span> map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> image_map_indets_Polys<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> y.Abs_inject <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">abs</span> <span class="free">x</span> <span class="main">∉</span> <span class="skolem">abs</span> <span class="main">`</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="main">(</span><span class="skolem">abs</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>
                                    <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="main">(</span><span class="skolem">abs</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>
                                    <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∘</span> <span class="skolem">abs</span><span class="main">)</span> <span class="main">-`</span> 𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_indets_minus map_indets_times map_indets_monomial
                <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> variety_of_map_indets times_monomial_left<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> vimage_empty<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">abs</span> <span class="free">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radical_idealI_internalized<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'x</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'y</span></span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">untransferred</span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">rep</span> <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> map_indets <span class="skolem">rep</span> <span class="main">`</span> <span class="main">√</span>ideal <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">√</span><span class="main">(</span>ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_map_indets_ideal image_map_indets_radical image_image map_indets_map_indets
                    1 y.Rep_range<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> radical_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 0<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> rl <span class="main">=</span> this<span class="main">[</span><span class="operator">cancel_type_definition</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> radical_idealI_extend_indets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single None <span class="main">1</span><span class="main">)</span> <span class="main">(</span>extend_indets <span class="free">f</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">(</span>extend_indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>alg_closed_field<span class="main">)</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="free">X</span> <span class="main">∪</span> indets <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> fin_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_def finite_indets<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> F_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="skolem">Y</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_def Polys_alt<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"extend_indets <span class="main">`</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"extend_indets <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Some <span class="main">`</span> <span class="skolem">Y</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> fin_Y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> F_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="var">?X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indets_extend_indets <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> PolysI_alt imageI <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> PolysD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> f_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="var">?X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indets_extend_indets <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> PolysI_alt imageI <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> PolysD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"None <span class="main">∉</span> <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radical_idealI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="var">?F</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalE<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"extend_indets <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> extend_indets <span class="main">`</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> extend_indets_ideal_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> extend_indets_power <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="var">?F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalE<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">-</span> <span class="main">{</span>None<span class="main">}</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_closed_power<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> PolysI_alt <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indets_extend_indets<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"extend_indets <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> extend_indets <span class="main">`</span> ideal <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> extend_indets_ideal extend_indets_power<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> inj_image_mem_iff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_extend_indets<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Nullstellensatz<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>alg_closed_field<span class="main">)</span> <span class="main">∈</span> ℐ <span class="main">(</span>𝒱 <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> radical_idealI_extend_indets<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">1</span> <span class="main">(</span>monomial <span class="main">1</span> None<span class="main">)</span> <span class="main">(</span>extend_indets <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>extend_indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subset_antisym subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>extend_indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="var">?f</span> <span class="main">∈</span> insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>extend_indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofD<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">(</span>extend_indets <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_eval_minus poly_eval_times <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> times_monomial_left<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="skolem">a</span> <span class="main">∘</span> Some<span class="main">)</span> <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eval_extend_indets<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∘</span> Some <span class="main">∈</span> 𝒱 <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"extend_indets <span class="skolem">f'</span> <span class="main">∈</span> insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>extend_indets <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">(</span>extend_indets <span class="skolem">f'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofD<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="skolem">a</span> <span class="main">∘</span> Some<span class="main">)</span> <span class="skolem">f'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_eval_extend_indets<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="main">(</span><span class="skolem">a</span> <span class="main">∘</span> Some<span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_ofD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹poly_eval <span class="main">(</span><span class="skolem">a</span> <span class="main">∘</span> Some<span class="main">)</span> <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> strong_Nullstellensatz<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ℐ <span class="main">(</span>𝒱 <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">√</span>ideal <span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>alg_closed_field<span class="main">)</span> set<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subset_antisym subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ℐ <span class="main">(</span>𝒱 <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Nullstellensatz<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">metis</span> ideal_ofI variety_ofD variety_of_radical_ideal<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> weak_Nullstellensatz<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="free">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">{}</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒</span> <span class="main">_</span><span class="main">::</span>alg_closed_field<span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">=</span> UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ℐ <span class="main">(</span>𝒱 <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> strong_Nullstellensatz<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> radical_ideal_eq_UNIV_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> radical_ideal_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>alg_closed_field<span class="main">)</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span> <span class="main">⟷</span>
            <span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="free">x</span> <span class="main">1</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radicalE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> insert_subset
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI Polys_closed_minus one_in_Polys Polys_closed_monom_mult PPs_closed_single<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">⊆</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Polys_mono<span class="main">)</span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subset_antisym subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="var">?f</span> <span class="main">∈</span> insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_eval_minus poly_eval_times poly_eval_power <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> times_monomial_left<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="main">(</span>ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> variety_of_ideal<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="free">F</span>›</span></span> ideal.span_mono <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_subsetD<span class="main">)</span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofD<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹poly_eval <span class="skolem">a</span> <span class="main">(</span><span class="free">f</span> <span class="main">^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> weak_Nullstellensatz<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subset_antisym subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="main">(</span>ideal <span class="main">(</span>insert <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?f</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> variety_of_ideal<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofD<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> radical_idealI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Field-Theoretic Version of the Nullstellensatz›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Due to the possibility of infinite indeterminate-types, we have to explicitly add the set of
  indeterminates under consideration to the definition of maximal ideals.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">generates_max_ideal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>comm_ring_1<span class="main">)</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">generates_max_ideal</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">⟷</span> <span class="main">(</span>ideal <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≠</span> UNIV <span class="main">∧</span>
                                      <span class="main">(</span><span class="main">∀</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">]</span> <span class="main">⟶</span> ideal <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">⊂</span> ideal <span class="bound">F'</span> <span class="main">⟶</span> ideal <span class="bound">F'</span> <span class="main">=</span> UNIV<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> generates_max_idealI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">≠</span> UNIV"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">F'</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">⟹</span> ideal <span class="free">F</span> <span class="main">⊂</span> ideal <span class="bound">F'</span> <span class="main">⟹</span> ideal <span class="bound">F'</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generates_max_ideal <span class="free">X</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generates_max_ideal_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> generates_max_idealI_alt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">≠</span> UNIV"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">⟹</span> <span class="bound">p</span> <span class="main">∉</span> ideal <span class="free">F</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="bound">p</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generates_max_ideal <span class="free">X</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> generates_max_idealI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F'</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">⊂</span> ideal <span class="skolem">F'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> ideal.span_subset_spanI <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">F'</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">F'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">F'</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="skolem">p</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∉</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> ideal <span class="main">(</span><span class="skolem">F'</span> <span class="main">∪</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">F'</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ideal <span class="main">(</span>ideal <span class="skolem">F'</span> <span class="main">∪</span> ideal <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal.span_Un ideal.span_span<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">F'</span> <span class="main">∪</span> ideal <span class="free">F</span> <span class="main">=</span> ideal <span class="skolem">F'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">F'</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ideal_eq_UNIV_iff_contains_one ideal.span_span<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> generates_max_idealD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"generates_max_ideal <span class="free">X</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">≠</span> UNIV"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F'</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">⟹</span> ideal <span class="free">F</span> <span class="main">⊂</span> ideal <span class="free">F'</span> <span class="main">⟹</span> ideal <span class="free">F'</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generates_max_ideal_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> generates_max_ideal_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"generates_max_ideal <span class="free">X</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F'</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">⊆</span> ideal <span class="free">F'</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">=</span> ideal <span class="free">F'</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"ideal <span class="free">F'</span> <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> generates_max_ideal_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> max_ideal_UNIV_radical<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"generates_max_ideal UNIV <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">√</span>ideal <span class="free">F</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">√</span>ideal <span class="free">F</span> <span class="main">≠</span> ideal <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> radical_superset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">⊂</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ideal <span class="main">(</span><span class="main">√</span>ideal <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">⊂</span> ideal <span class="main">(</span><span class="main">√</span>ideal <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms _ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span><span class="main">√</span>ideal <span class="free">F</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> generates_max_idealD<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">√</span>ideal <span class="free">F</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> radicalE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ideal_eq_UNIV_iff_contains_one<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">≠</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> generates_max_idealD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> max_ideal_shape_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="free">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Polys_closed_minus Polys_closed_monomial PPs_closed_single zero_in_PPs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> max_ideal_shapeI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"generates_max_ideal <span class="free">X</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="free">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"generates_max_ideal <span class="free">X</span> <span class="var">?F</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> generates_max_idealI_alt<span class="main">)</span>
  <span class="comment1">(* Proof modeled after https://math.stackexchange.com/a/1028331. *)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal <span class="var">?F</span> <span class="main">≠</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ideal <span class="var">?F</span> <span class="main">=</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="main">(</span>ideal <span class="var">?F</span><span class="main">)</span> <span class="main">=</span> 𝒱 UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"𝒱 <span class="var">?F</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> 𝒱 <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_eval_minus poly_eval_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> ideal <span class="var">?F</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="skolem">p</span> <span class="var">?F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_base<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="free">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> monomial <span class="main">(</span><span class="free">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> poly_subst <span class="var">?g</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> poly_subst <span class="var">?f</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def poly_subst_poly_subst
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> poly_subst_id<span class="main">)</span>
        <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_subst_plus poly_subst_monomial subst_pp_single <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> times_monomial_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">∈</span>keys <span class="skolem">q</span><span class="main">.</span> punit.monom_mult <span class="main">(</span>lookup <span class="skolem">q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>subst_pp <span class="var">?f</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> poly_subst_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> punit.monom_mult <span class="main">(</span>lookup <span class="skolem">q</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>subst_pp <span class="var">?f</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span>
                  <span class="main">(</span><span class="main">∑</span><span class="bound">t</span><span class="main">∈</span>keys <span class="skolem">q</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> monomial <span class="main">(</span>lookup <span class="skolem">q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">0</span> <span class="main">*</span> subst_pp <span class="var">?f</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">+</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.remove in_keys_iff <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> times_monomial_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> monomial <span class="main">(</span>lookup <span class="skolem">q</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">+</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> times_monomial_left<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="var">?r</span> <span class="main">=</span> monomial <span class="main">(</span>lookup <span class="skolem">q</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> ideal <span class="var">?F</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ideal.span_sum ideal.span_scale<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">t</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> keys <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> indets <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_indetsI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> indets <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> indets <span class="main">(</span><span class="var">?g</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_indets_poly_substE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> indets_plus_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> indets <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span>Poly_Mapping.single <span class="skolem">y</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span>
                                                indets <span class="main">(</span>monomial <span class="main">(</span><span class="free">a</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> indets <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> indets <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indets_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PolysD<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> keys <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">t</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">^</span> lookup <span class="skolem">t</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">^</span> Suc <span class="main">(</span>lookup <span class="skolem">t</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subst_pp <span class="var">?f</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span>keys <span class="skolem">t</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">y</span> <span class="main">^</span> lookup <span class="skolem">t</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> subst_pp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> keys <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">y</span><span class="main">∈</span>keys <span class="skolem">t</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">.</span> <span class="var">?f</span> <span class="bound">y</span> <span class="main">^</span> lookup <span class="skolem">t</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="var">?f</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span>lookup <span class="skolem">t</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="var">?f</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.remove mult.commute eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> ideal <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ideal.span_scale ideal.span_base imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subst_pp <span class="var">?f</span> <span class="skolem">t</span> <span class="main">∈</span> ideal <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> ideal <span class="main">(</span>insert <span class="skolem">p</span> <span class="var">?F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_mono<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="skolem">p</span> <span class="var">?F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">-</span> <span class="var">?r</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="skolem">p</span> <span class="var">?F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>lookup <span class="skolem">q</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="skolem">p</span> <span class="var">?F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>inverse <span class="main">(</span>lookup <span class="skolem">q</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="main">*</span> monomial <span class="main">(</span>lookup <span class="skolem">q</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="skolem">p</span> <span class="var">?F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_scale<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>inverse <span class="main">(</span>lookup <span class="skolem">q</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> lookup <span class="skolem">q</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="skolem">p</span> <span class="var">?F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_monomial_monomial<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">q</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">q</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> eq <span class="quoted"><span class="quoted">‹<span class="var">?r</span> <span class="main">∈</span> ideal <span class="var">?F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∉</span> ideal <span class="var">?F</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>insert <span class="skolem">p</span> <span class="var">?F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We first prove the following lemma assuming that the type of indeterminates is finite, and then
  transfer the result to arbitrary types of indeterminates by using the `types to sets' methodology.
  This approach facilitates the proof considerably.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> max_ideal_shapeD_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"generates_max_ideal UNIV <span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span><span class="main">::</span>finite <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>alg_closed_field<span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">=</span> ideal <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="free">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'x</span> set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋂</span><span class="bound">a</span><span class="main">∈</span>𝒱 <span class="free">F</span><span class="main">.</span> ideal <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="bound">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ℐ <span class="main">(</span>𝒱 <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI ideal_ofI INT_I<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="skolem">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> ideal <span class="var">?B</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="skolem">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eval_minus poly_eval_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="main">(</span>ideal <span class="var">?B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> variety_of_ideal<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofD<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ℐ <span class="main">(</span>𝒱 <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_ofD<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">1</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="skolem">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> <span class="main">√</span>ideal <span class="var">?B</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> fin max_ideal_shape_aux
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Nullstellensatz<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ℐ <span class="main">(</span>𝒱 <span class="var">?B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ideal_ofI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a0</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a0</span> <span class="main">∈</span> 𝒱 <span class="var">?B</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a0</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">0</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rangeI<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a0</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a0</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> variety_ofD<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a0</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eval_minus poly_eval_monomial<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly_eval <span class="skolem">a0</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ideal <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">1</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="skolem">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> max_ideal_shapeI <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max_ideal_UNIV_radical<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">1</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="skolem">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> fin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">√</span>ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> strong_Nullstellensatz<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max_ideal_UNIV_radical<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> generates_max_idealD<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="skolem">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> UNIV"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">≠</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> 𝒱 <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms max_ideal_shape_aux <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> generates_max_ideal_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">=</span> <span class="var">?B</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?B</span> <span class="main">≠</span> UNIV›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> max_ideal_shapeD_internalized <span class="main">=</span> max_ideal_shapeD_finite<span class="main">[</span><span class="operator">unoverload_type</span> <span class="tfree">'x</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> max_ideal_shapeD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"generates_max_ideal <span class="free">X</span> <span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> nat<span class="main">)</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">::</span>alg_closed_field<span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">=</span> ideal <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="free">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">≠</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> generates_max_idealD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∉</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_eq_UNIV_iff_contains_one<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> monomial <span class="skolem">c</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> True Polys_empty<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="skolem">c</span> <span class="main">0</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ideal.span_base<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>inverse <span class="skolem">c</span><span class="main">)</span> <span class="main">0</span> <span class="main">*</span> monomial <span class="skolem">c</span> <span class="main">0</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_scale<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span>inverse <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">0</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_monomial_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">∉</span> ideal <span class="free">F</span>›</span></span> left_inverse <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">=</span> ideal <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span>undefined <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'y</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to be isomorphic to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">Rep</span> <span class="main">::</span> <span class="tfree">'y</span> <span class="main">⇒</span> <span class="tfree">'x</span><span class="main">)</span> <span class="bound">Abs</span><span class="main">.</span> type_definition <span class="bound">Rep</span> <span class="bound">Abs</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rep</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'y</span> <span class="main">⇒</span> <span class="tfree">'x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">abs</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> <span class="main">⇒</span> <span class="tfree">'y</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"type_definition <span class="skolem">rep</span> <span class="skolem">abs</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> y<span class="main">:</span> type_definition <span class="quoted"><span class="skolem">rep</span></span> <span class="quoted"><span class="skolem">abs</span></span> <span class="quoted"><span class="free">X</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"map_indets <span class="main">(</span><span class="skolem">rep</span> <span class="main">∘</span> <span class="skolem">abs</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">A</span> <span class="main">=</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="main">(</span><span class="skolem">rep</span> <span class="main">∘</span> <span class="skolem">abs</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">A</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> PolysD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_apply image_subset_iff map_indets_id subsetD y.Abs_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> map_indets <span class="main">(</span><span class="skolem">rep</span> <span class="main">∘</span> <span class="skolem">abs</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> PolysD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> comp_apply image_eqI map_indets_id subsetD subsetI y.Abs_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="skolem">rep</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inj_onI y.Rep_inject<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>map_indets <span class="skolem">rep</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_indets_injI<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"class.finite <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">abs</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV<span class="main">::</span><span class="tfree">'y</span> set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> y.Abs_image<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generates_max_ideal UNIV <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> generates_max_idealI notI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">rep</span> <span class="main">1</span> <span class="main">∈</span> map_indets <span class="skolem">rep</span> <span class="main">`</span> ideal <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> map_indets_plus map_indets_times <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> ideal <span class="main">(</span>map_indets <span class="skolem">rep</span> <span class="main">`</span> map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_ideal_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">rep</span> <span class="main">`</span> map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span> <span class="main">=</span> <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> image_image map_indets_map_indets 1<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">≠</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> generates_max_idealD<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_eq_UNIV_iff_contains_one<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">⊂</span> ideal <span class="skolem">F'</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> inj_on_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">rep</span> <span class="main">`</span> ideal <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">⊂</span> map_indets <span class="skolem">rep</span> <span class="main">`</span> ideal <span class="skolem">F'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_strict_subset<span class="main">)</span> <span class="main">(</span><span class="operator">fact</span> 3<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> subset_UNIV<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">⊂</span> ideal <span class="main">(</span>map_indets <span class="skolem">rep</span> <span class="main">`</span> <span class="skolem">F'</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 assms<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_map_indets_ideal image_image map_indets_map_indets 1 y.Rep_range<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">⊂</span> ideal <span class="main">(</span>map_indets <span class="skolem">rep</span> <span class="main">`</span> <span class="skolem">F'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> psubsetI notI ideal.span_subset_spanI subsetI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> ideal.span_base sub <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="main">(</span>map_indets <span class="skolem">rep</span> <span class="main">`</span> <span class="skolem">F'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">=</span> ideal <span class="main">(</span>map_indets <span class="skolem">rep</span> <span class="main">`</span> <span class="skolem">F'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> sub <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> _ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>map_indets <span class="skolem">rep</span> <span class="main">`</span> <span class="skolem">F'</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> generates_max_idealD<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> subset_UNIV <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">rep</span> <span class="main">`</span> <span class="skolem">F'</span> <span class="main">⊆</span> range <span class="main">(</span>map_indets <span class="skolem">rep</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> range_map_indets y.Rep_range<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">rep</span> <span class="main">`</span> <span class="skolem">F'</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">P[</span>range <span class="skolem">rep</span><span class="main">]</span> <span class="main">=</span> ideal <span class="main">(</span>map_indets <span class="skolem">rep</span> <span class="main">`</span> <span class="skolem">F'</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span>range <span class="skolem">rep</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> map_indets <span class="skolem">rep</span> <span class="main">`</span> ideal <span class="skolem">F'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> image_map_indets_ideal<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">rep</span> <span class="main">`</span> ideal <span class="skolem">F'</span> <span class="main">=</span> range <span class="main">(</span>map_indets <span class="skolem">rep</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> range_map_indets<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">F'</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inj_image_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span>
                 ideal <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="skolem">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?A</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max_ideal_shapeD_internalized<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'x</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'y</span></span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">untransferred</span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"map_indets <span class="skolem">rep</span> <span class="main">`</span> ideal <span class="main">(</span>map_indets <span class="skolem">abs</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> map_indets <span class="skolem">rep</span> <span class="main">`</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> 2 assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">=</span>
           ideal <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="main">(</span><span class="skolem">rep</span> <span class="bound">x</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="skolem">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> ideal <span class="var">?B</span> <span class="main">∩</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_map_indets_ideal y.Rep_range image_image map_indets_map_indets
              map_indets_minus map_indets_monomial 1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">1</span> <span class="main">(</span>Poly_Mapping.single <span class="bound">x</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">∘</span> <span class="skolem">abs</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?C</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> comp_apply image_iff image_subset_iff y.Abs_image y.Abs_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> y.Rep_inverse y.Rep_range <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span> <span class="main">=</span> ideal <span class="var">?C</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">=</span> ideal <span class="var">?C</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subset_antisym ideal.span_subset_spanI subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> ideal.span_base <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">∘</span> <span class="skolem">abs</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Polys_closed_minus Polys_closed_monomial PPs_closed_single zero_in_PPs<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="var">?C</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal.span_base<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> rl <span class="main">=</span> this<span class="main">[</span><span class="operator">cancel_type_definition</span><span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Nullstellensatz_field<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="keyword1">P[</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"generates_max_ideal <span class="free">X</span> <span class="main">(</span><span class="free">F</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">_</span><span class="main">::</span>alg_closed_field<span class="main">)</span> set<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">⊂</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subset_not_subset_eq
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI notI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">⊆</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ideal.span_zero zero_in_Polys<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">F</span> <span class="main">=</span> ideal <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">1</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="skolem">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max_ideal_shapeD<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> monomial <span class="main">1</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> monomial <span class="main">(</span><span class="skolem">a</span> <span class="bound">x</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="free">x</span> <span class="main">∈</span> <span class="var">?p</span> <span class="main">`</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_superset<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="free">x</span> <span class="main">∈</span> ideal <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="free">x</span> <span class="main">∈</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Polys_closed_minus Polys_closed_monomial PPs_closed_single zero_in_PPs<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="free">x</span> <span class="main">∈</span> ideal <span class="free">F</span> <span class="main">∩</span> <span class="keyword1">P[</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_eq_diff_eq diff_self monomial_0D monomial_inj one_neq_zero singletonD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div>