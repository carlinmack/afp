<div id="Sequence">
<div class="head">
<h1>Theory Sequence</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       A Definitional Encoding of TLA in Isabelle/HOL
    Authors:     Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
                 Stephan Merz &lt;Stephan.Merz at loria.fr&gt;
    Year:        2011
    Maintainer:  Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹(Infinite) Sequences›</span></span> 

<span class="keyword1"><span class="command">theory</span></span> Sequence
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lamport's Temporal Logic of Actions (TLA) is a linear-time temporal logic,
  and its semantics is defined over infinite sequence of states, which we
  simply represent by the type <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'a seq›</span></span></span></span>, defined as an abbreviation
  for the type <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nat ⇒ 'a›</span></span></span></span>, where <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'a›</span></span></span></span> is the type of sequence 
  elements.

  This theory defines some useful notions about such sequences, and in particular
  concepts related to stuttering (finite repetitions of states), which are
  important for the semantics of TLA. We identify a finite sequence with an
  infinite sequence that ends in infinite stuttering. In this way, we avoid the
  complications of having to handle both finite and infinite sequences of states:
  see e.g. Devillers et al \cite{Devillers97} who discuss several variants of
  representing possibly infinite sequences in HOL, Isabelle and PVS.
›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> seq <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Some operators on sequences"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some general functions on sequences are provided›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">first</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> seq <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">first</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">second</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">second</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">suffix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> seq <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> seq"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span>"</span> 60<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1"><span class="free">|<span class="hidden">⇩</span><sub>s</sub></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tail</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> seq <span class="main">⇒</span> <span class="tfree">'a</span> seq"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tail</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">app</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">##</span>"</span> 60<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main"><span class="free">##</span></span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span>  <span class="main">≡</span> <span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main">(</span><span class="bound">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s |<span class="hidden">⇩</span><sub>s</sub> i›</span></span></span></span> returns the suffix of sequence <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> from
  index <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">i</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">first</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> returns the first element of a sequence
  while  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">second</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> returns the second element. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">tail</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> returns the
  sequence starting at the second element. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">s</span></span> <span class="main"><span class="main">##</span></span> <span class="free"><span class="free">σ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> prefixes the
  sequence <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">σ</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> by element <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">first</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">second</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"</span></span>

<span class="keyword1" id="Sequence-first_tail_second"><span class="command">lemma</span></span> first_tail_second<span class="main">:</span> <span class="quoted"><span class="quoted">"first<span class="main">(</span>tail <span class="free">s</span><span class="main">)</span> <span class="main">=</span> second <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> first_def second_def tail_def suffix_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">suffix</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"</span></span>

<span class="keyword1" id="Sequence-suffix_first"><span class="command">lemma</span></span> suffix_first<span class="main">:</span> <span class="quoted"><span class="quoted">"first <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def first_def<span class="main">)</span>

<span class="keyword1" id="Sequence-suffix_second"><span class="command">lemma</span></span> suffix_second<span class="main">:</span> <span class="quoted"><span class="quoted">"second <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def second_def<span class="main">)</span>

<span class="keyword1" id="Sequence-suffix_plus"><span class="command">lemma</span></span> suffix_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span> <span class="main">=</span> <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def add.assoc<span class="main">)</span>

<span class="keyword1" id="Sequence-suffix_commute"><span class="command">lemma</span></span> suffix_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_plus add.commute<span class="main">)</span>

<span class="keyword1" id="Sequence-suffix_plus_com"><span class="command">lemma</span></span> suffix_plus_com<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span> <span class="main">=</span> <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span> <span class="main">=</span> <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> suffix_plus<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span> <span class="main">=</span> <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-suffix_zero"><span class="command">lemma</span></span> suffix_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def<span class="main">)</span>

<span class="keyword1" id="Sequence-suffix_tail"><span class="command">lemma</span></span> suffix_tail<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">1</span> <span class="main">=</span> tail <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tail_def<span class="main">)</span>

<span class="keyword1" id="Sequence-tail_suffix_suc"><span class="command">lemma</span></span> tail_suffix_suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> tail <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def tail_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Properties of  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">app</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"</span></span>

<span class="keyword1" id="Sequence-seq_app_second"><span class="command">lemma</span></span> seq_app_second<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">##</span> <span class="free">σ</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> app_def<span class="main">)</span>

<span class="keyword1" id="Sequence-seq_app_first"><span class="command">lemma</span></span> seq_app_first<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">##</span> <span class="free">σ</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="free">s</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> app_def<span class="main">)</span>

<span class="keyword1" id="Sequence-seq_app_first_tail"><span class="command">lemma</span></span> seq_app_first_tail<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first <span class="free">s</span><span class="main">)</span> <span class="main">##</span> <span class="main">(</span>tail <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first <span class="free">s</span> <span class="main">##</span> tail <span class="free">s</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">s</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> first_def app_def suffix_def tail_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-seq_app_tail"><span class="command">lemma</span></span> seq_app_tail<span class="main">:</span> <span class="quoted"><span class="quoted">"tail <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> app_def tail_def suffix_def<span class="main">)</span>

<span class="keyword1" id="Sequence-seq_app_greater_than_zero"><span class="command">lemma</span></span> seq_app_greater_than_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span> <span class="main">##</span> <span class="free">σ</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">σ</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> app_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Finite and Empty Sequences"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We identify finite and empty sequences and prove lemmas about them. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fin</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">≥</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">inf</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">¬</span><span class="main">(</span>fin <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">last</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">last</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">≥</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">j</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">laststate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">laststate</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>last <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emptyseq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emptyseq</span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">s</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">s</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">notemptyseq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">notemptyseq</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">¬</span><span class="main">(</span>emptyseq <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">fin</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> holds if there is an element
  in the sequence such that all subsequent elements are identical,
  i.e. the sequence is finite. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"last <span class="free"><span class="free">s</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> returns the smallest index
  from which on all elements of a finite sequence <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are identical. Note that 
  if <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s›</span></span></span></span> is not finite then an arbitrary number is returned.
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">laststate</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> returns the last element of a finite sequence. We assume 
  that the sequence is finite when using  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">last</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">laststate</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  Predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">emptyseq</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> identifies empty sequences -- i.e. all states in
  the sequence are identical to the initial one, while <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">notemptyseq</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> holds
  if the given sequence is not empty.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">emptyseq</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"</span></span>

<span class="keyword1" id="Sequence-empty_is_finite"><span class="command">lemma</span></span> empty_is_finite<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fin <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fin_def emptyseq_def<span class="main">)</span>

<span class="keyword1" id="Sequence-empty_suffix_is_empty"><span class="command">lemma</span></span> empty_suffix_is_empty<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emptyseq_def<span class="main">)</span>
 <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
 <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emptyseq_def suffix_def<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span>
 <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emptyseq_def suffix_def<span class="main">)</span>
 <span class="keyword1"><span class="command">ultimately</span></span>
 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-suc_empty"><span class="command">lemma</span></span> suc_empty<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H1<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> H1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> empty_suffix_is_empty<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_plus<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-empty_suffix_exteq"><span class="command">lemma</span></span> empty_suffix_exteq<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span><span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="free">s</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emptyseq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="free">m</span> <span class="main">=</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emptyseq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-empty_suffix_eq"><span class="command">lemma</span></span> empty_suffix_eq<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">=</span> <span class="free">s</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> empty_suffix_exteq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-seq_empty_all"><span class="command">lemma</span></span> seq_empty_all<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="free">i</span> <span class="main">=</span> <span class="free">s</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="free">i</span> <span class="main">=</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emptyseq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="free">j</span> <span class="main">=</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emptyseq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">last</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">laststate</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"</span></span> 

<span class="keyword1" id="Sequence-fin_stut_after_last"><span class="command">lemma</span></span> fin_stut_after_last<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"fin <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">≥</span> last <span class="free">s</span><span class="main">.</span> <span class="free">s</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">s</span> <span class="main">(</span>last <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> last <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">≥</span> <span class="skolem">i</span><span class="main">.</span> <span class="free">s</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">s</span> <span class="skolem">i</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">i</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fin_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>last <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> last_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LeastI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> j <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">s</span> <span class="main">(</span>last <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Stuttering Invariance"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This subsection provides functions for removing stuttering
  steps of sequences, i.e. we formalise Lamports <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>♮›</span></span></span></span> operator.
  Our formal definition is close to that of Wahab in the PVS prover.

  The key novelty with the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Sequence</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> theory, is the treatment of
  stuttering invariance, which enables verification of stuttering invariance of
  the operators derived using it. Such proofs require comparing sequences
  up to stuttering. Here, Lamport's \cite{Lamport94} method is used to
  mechanise the equality of sequences up to stuttering: he defines 
  the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>♮›</span></span></span></span> operator, which collapses a sequence by removing
  all stuttering steps, except possibly infinite stuttering at the end of the sequence. 
  These are left unchanged.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nonstutseq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nonstutseq</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">&gt;</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stutstep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">stutstep</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nextnat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nextnat</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> emptyseq <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nextsuffix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nextsuffix</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>nextnat <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="quoted">"<span class="entity">next</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">next</span> <span class="main">0</span> <span class="main">=</span> id"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">next</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> nextsuffix <span class="keyword1">o</span> <span class="main">(</span><span class="free">next</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">collapse</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">♮</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">♮</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>next <span class="bound">n</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">nonstutseq</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> identifies sequences without any 
  stuttering steps -- except possibly for infinite stuttering at the end.
  Further, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"stutstep <span class="free"><span class="free">s</span></span> <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a predicate which holds if the element
  after <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">s</span></span> <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is equal to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">s</span></span> <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, i.e. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is
  a stuttering step.
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"collapse <span class="free"><span class="free">s</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> formalises Lamports  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">♮</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  operator. It returns the first state of the result of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"next <span class="free"><span class="free">n</span></span> <span class="free"><span class="free">s</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"next <span class="free"><span class="free">n</span></span> <span class="free"><span class="free">s</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> finds suffix of the $n^{th}$ change. Hence the first
  element, which <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">♮</span></span> <span class="free"><span class="free">s</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> returns, is the state after the $n^{th}$ 
  change.  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"next <span class="free"><span class="free">n</span></span> <span class="free"><span class="free">s</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is defined by primitive recursion on 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> using function composition of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">nextsuffix</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. E.g.
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"next <span class="numeral"><span class="numeral">3</span></span> <span class="free"><span class="free">s</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> equals <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"nextsuffix <span class="main"><span class="main">(</span></span>nextsuffix <span class="main"><span class="main">(</span></span>nextsuffix <span class="free"><span class="free">s</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"nextsuffix <span class="free"><span class="free">s</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> returns the suffix of the sequence starting at the
  next changing state. It uses <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"nextnat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to obtain this. All the real
  computation is done in this function. Firstly, an empty sequence will obviously
  not contain any changes, and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>0›</span></span></span></span> is therefore returned. In this case 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"nextsuffix"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> behaves like the identify function. If the sequence is not
  empty then the smallest number <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">i</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> such that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">s</span></span> <span class="free"><span class="free">i</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is different
  from the initial state is returned. This is achieved by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Least"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">nonstutseq</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"</span></span>

<span class="keyword1" id="Sequence-seq_empty_is_nonstut"><span class="command">lemma</span></span> seq_empty_is_nonstut<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nonstutseq <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nonstutseq_def seq_empty_all<span class="main">)</span>

<span class="keyword1" id="Sequence-notempty_exist_nonstut"><span class="command">lemma</span></span> notempty_exist_nonstut<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> emptyseq <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">s</span> <span class="free">m</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emptyseq_def suffix_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> i <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">nextnat</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"</span></span>

<span class="keyword1" id="Sequence-nextnat_le_unch"><span class="command">lemma</span></span> nextnat_le_unch<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> nextnat <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="free">n</span> <span class="main">=</span> <span class="free">s</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nextnat <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextnat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> H <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> emptyseq <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"nextnat <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextnat_def<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="free">n</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">n</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">n</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> H a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-stutnempty"><span class="command">lemma</span></span> stutnempty<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> stutstep <span class="free">s</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> emptyseq <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> emptyseq_def suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutstep_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">(</span><span class="main">0</span><span class="main">+</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">(</span><span class="main">0</span><span class="main">+</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-notstutstep_nexnat1"><span class="command">lemma</span></span> notstutstep_nexnat1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> stutstep <span class="free">s</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> h'<span class="main">:</span> <span class="quoted"><span class="quoted">"nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextnat_def stutnempty<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutstep_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">1</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Least <span class="var">?P</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"Least <span class="var">?P</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> Least <span class="var">?P</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> h' <span class="keyword1"><span class="command">have</span></span> g1'<span class="main">:</span> <span class="quoted"><span class="quoted">"nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> emptyseq <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stutnempty<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">≠</span>  <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emptyseq_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LeastI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> h' <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> g2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-stutstep_notempty_notempty"><span class="command">lemma</span></span> stutstep_notempty_notempty<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="var">?sn</span>"</span></span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"stutstep <span class="free">s</span> <span class="free">n</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="var">?s</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emptyseq_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="skolem">k</span> <span class="main">=</span> <span class="var">?s</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
    <span class="keyword3"><span class="command">assume</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="skolem">k</span> <span class="main">=</span> <span class="var">?sn</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?sn</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emptyseq_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">s</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def stutstep_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-stutstep_empty_suc"><span class="command">lemma</span></span> stutstep_empty_suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"stutstep <span class="free">s</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> emptyseq <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> stutstep_notempty_notempty suc_empty<span class="main">)</span>

<span class="keyword1" id="Sequence-stutstep_notempty_sucnextnat"><span class="command">lemma</span></span> stutstep_notempty_sucnextnat<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> emptyseq  <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"stutstep <span class="free">s</span> <span class="free">n</span>"</span></span> 
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">s</span> <span class="main">(</span><span class="main">0</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutstep_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emptyseq_def suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> h2 <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">i</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutstep_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> g2 g1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?P</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> g2 g1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="main">(</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> G1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h1 h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> emptyseq  <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutstep_empty_suc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextnat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextnat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> h2 <span class="keyword1"><span class="command">have</span></span> g2'<span class="main">:</span> <span class="quoted"><span class="quoted">"nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutstep_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> G1 g1 g2' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-nextnat_empty_neq"><span class="command">lemma</span></span> nextnat_empty_neq<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span>nextnat <span class="free">s</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"nextnat <span class="free">s</span> <span class="main">=</span>  <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextnat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emptyseq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LeastI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-nextnat_empty_gzero"><span class="command">lemma</span></span> nextnat_empty_gzero<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nextnat <span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span>nextnat <span class="free">s</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nextnat_empty_neq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nextnat <span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"nextnat <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"nextnat <span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">nextsuffix</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"</span></span>

<span class="keyword1" id="Sequence-empty_nextsuffix"><span class="command">lemma</span></span> empty_nextsuffix<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nextsuffix <span class="free">s</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextsuffix_def nextnat_def<span class="main">)</span>

<span class="keyword1" id="Sequence-empty_nextsuffix_id"><span class="command">lemma</span></span> empty_nextsuffix_id<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nextsuffix <span class="free">s</span> <span class="main">=</span> id <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_nextsuffix<span class="main">)</span>

<span class="keyword1" id="Sequence-notstutstep_nextsuffix1"><span class="command">lemma</span></span> notstutstep_nextsuffix1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> stutstep <span class="free">s</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nextsuffix <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> nextsuffix_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> notstutstep_nexnat1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">next</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"</span></span>

<span class="keyword1" id="Sequence-next_suc_suffix"><span class="command">lemma</span></span> next_suc_suffix<span class="main">:</span> <span class="quoted"><span class="quoted">"next <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> nextsuffix <span class="main">(</span>next <span class="free">n</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Sequence-next_suffix_com"><span class="command">lemma</span></span> next_suffix_com<span class="main">:</span> <span class="quoted"><span class="quoted">"nextsuffix <span class="main">(</span>next <span class="free">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>next <span class="free">n</span> <span class="main">(</span>nextsuffix <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Sequence-next_plus"><span class="command">lemma</span></span> next_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"next <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> next <span class="free">m</span> <span class="main">(</span>next <span class="free">n</span> <span class="free">s</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Sequence-next_empty"><span class="command">lemma</span></span> next_empty<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"next <span class="free">n</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"next <span class="main">0</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"next <span class="skolem">n</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"next <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> nextsuffix <span class="main">(</span>next <span class="skolem">n</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"next <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> nextsuffix <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> H <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"next <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextsuffix_def nextnat_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-notempty_nextnotzero"><span class="command">lemma</span></span> notempty_nextnotzero<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>next <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">0</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span>nextnat <span class="free">s</span><span class="main">)</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nextnat_empty_neq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"next <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> nextsuffix <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>next <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span>  <span class="free">s</span> <span class="main">(</span>nextnat <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextsuffix_def suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> g1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-next_ex_id"><span class="command">lemma</span></span> next_ex_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="free">s</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span>next <span class="free">m</span> <span class="free">s</span><span class="main">)</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>next <span class="free">m</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span> <span class="main">=</span> next <span class="main">0</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>next <span class="main">0</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>next <span class="skolem">m</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> a1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>next <span class="skolem">m</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"next <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> nextsuffix <span class="main">(</span>next <span class="skolem">m</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"next <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span>next <span class="skolem">m</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>nextnat <span class="main">(</span>next <span class="skolem">m</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextsuffix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> next <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span>next <span class="skolem">m</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"next <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span>next <span class="skolem">m</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">with</span></span> a1' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"next <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"next <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> next <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>next <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>next <span class="free">m</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">i</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span>next <span class="free">m</span> <span class="free">s</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>next <span class="free">m</span> <span class="free">s</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">collapse</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"</span></span>

<span class="keyword1" id="Sequence-emptyseq_collapse_eq"><span class="command">lemma</span></span> emptyseq_collapse_eq<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">♮</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> collapse_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"next <span class="skolem">n</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> next_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emptyseq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>next <span class="skolem">n</span> <span class="free">s</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="free">s</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-empty_collapse_empty"><span class="command">lemma</span></span> empty_collapse_empty<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="main">(</span><span class="main">♮</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emptyseq_collapse_eq<span class="main">)</span>

<span class="keyword1" id="Sequence-collapse_empty_empty"><span class="command">lemma</span></span> collapse_empty_empty<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="main">(</span><span class="main">♮</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>emptyseq <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span>next <span class="bound">i</span> <span class="free">s</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> collapse_def emptyseq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>next <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">0</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> notempty_nextnotzero<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-collapse_empty_iff_empty"><span class="command">lemma</span></span> collapse_empty_iff_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="main">(</span><span class="main">♮</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> emptyseq <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> empty_collapse_empty collapse_empty_empty<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Similarity of Sequences"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Since adding or removing stuttering steps does not change the validity 
  of a stuttering-invarant formula, equality is often too strong, 
  and the weaker equality \emph{up to stuttering} is sufficient. 
  This is often called \emph{similarity} ($\approx$) 
  of sequences in the literature, and is required to
  show that logical operators are stuttering invariant. This
  is mechanised as:
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">seqsimilar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> seq<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">≈</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">σ</span></span></span> <span class="main"><span class="free">≈</span></span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">♮</span> <span class="free"><span class="bound"><span class="entity">σ</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">♮</span> <span class="free"><span class="bound"><span class="entity">τ</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">seqsimilar</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"</span></span>

<span class="keyword1" id="Sequence-seqsim_refl"><span class="command">lemma</span></span> seqsim_refl <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqsimilar_def<span class="main">)</span>

<span class="keyword1" id="Sequence-seqsim_sym"><span class="command">lemma</span></span> seqsim_sym<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≈</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqsimilar_def<span class="main">)</span>

<span class="keyword1" id="Sequence-seqeq_imp_sim"><span class="command">lemma</span></span> seqeq_imp_sim<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Sequence-seqsim_trans"><span class="command">lemma</span></span> seqsim_trans <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≈</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">z</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqsimilar_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> sim_first<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"first <span class="free">s</span> <span class="main">=</span> first <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">♮</span> <span class="free">s</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">♮</span> <span class="free">t</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqsimilar_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> collapse_def first_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> sim_first2 <span class="main">=</span> sim_first<span class="main">[</span><span class="operator">unfolded</span> first_def<span class="main">]</span>

<span class="keyword1" id="Sequence-tail_sim_second"><span class="command">lemma</span></span> tail_sim_second<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"tail <span class="free">s</span> <span class="main">≈</span> tail <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"second <span class="free">s</span> <span class="main">=</span> second <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"first <span class="main">(</span>tail <span class="free">s</span><span class="main">)</span> <span class="main">=</span> first <span class="main">(</span>tail <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sim_first<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"second <span class="free">s</span> <span class="main">=</span> second <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> first_tail_second<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-seqsimilarI"><span class="command">lemma</span></span> seqsimilarI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"first <span class="free">s</span> <span class="main">=</span> first <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"nextsuffix <span class="free">s</span> <span class="main">≈</span> nextsuffix <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> seqsimilar_def collapse_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"next <span class="skolem">n</span> <span class="free">s</span> <span class="main">0</span> <span class="main">=</span> next <span class="skolem">n</span> <span class="free">t</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> first_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
    <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"next <span class="skolem">m</span> <span class="main">(</span>nextsuffix <span class="free">s</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span>  next <span class="skolem">m</span> <span class="main">(</span>nextsuffix <span class="free">t</span><span class="main">)</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> seqsimilar_def collapse_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fun_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> m <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_suffix_com<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-seqsim_empty_empty"><span class="command">lemma</span></span> seqsim_empty_empty<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> H2<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> H2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="main">(</span><span class="main">♮</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> H1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="main">(</span><span class="main">♮</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqsimilar_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-seqsim_empty_iff_empty"><span class="command">lemma</span></span> seqsim_empty_iff_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span> <span class="main">=</span> emptyseq <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> H <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_empty_empty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≈</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this t <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_empty_empty<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-seq_empty_eq"><span class="command">lemma</span></span> seq_empty_eq<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">0</span> <span class="main">=</span> <span class="free">t</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> H2<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> H3<span class="main">:</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">s</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emptyseq_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">t</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-seqsim_notstutstep"><span class="command">lemma</span></span> seqsim_notstutstep<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>stutstep <span class="free">s</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> nextsuffix <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> notstutstep_nextsuffix1<span class="main">)</span>

<span class="keyword1" id="Sequence-stut_nextsuf_suc"><span class="command">lemma</span></span> stut_nextsuf_suc<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"stutstep <span class="free">s</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nextsuffix <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> nextsuffix <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"emptyseq <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"nextsuffix <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextsuffix_def nextnat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"nextsuffix <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suc_empty nextsuffix_def nextnat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">(</span><span class="main">0</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">x</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">(</span><span class="main">0</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> emptyseq_def suffix_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> g1 g2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>nextnat <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutstep_notempty_sucnextnat<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextsuffix_def suffix_plus<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-seqsim_suffix_seqsim"><span class="command">lemma</span></span> seqsim_suffix_seqsim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nextsuffix <span class="free">s</span> <span class="main">≈</span> nextsuffix <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> seqsimilar_def collapse_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>next <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span>next <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> seqsimilar_def collapse_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fun_cong<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"next <span class="skolem">n</span> <span class="main">(</span>nextsuffix <span class="free">s</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> next <span class="skolem">n</span> <span class="main">(</span>nextsuffix <span class="free">t</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_suffix_com<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-seqsim_stutstep"><span class="command">lemma</span></span> seqsim_stutstep<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"stutstep <span class="free">s</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?sn</span> <span class="main">≈</span> <span class="var">?s</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> seqsimilar_def collapse_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"next <span class="skolem">m</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> next <span class="skolem">m</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> H <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def stutstep_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
    <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> H  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"next <span class="skolem">m</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> next <span class="skolem">k</span> <span class="main">(</span>nextsuffix  <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stut_nextsuf_suc next_suffix_com<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"next <span class="skolem">m</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> next <span class="skolem">k</span> <span class="main">(</span>nextsuffix  <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_suffix_com<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"next <span class="skolem">m</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> next <span class="skolem">m</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-addfeqstut"><span class="command">lemma</span></span> addfeqstut<span class="main">:</span> <span class="quoted"><span class="quoted">"stutstep <span class="main">(</span><span class="main">(</span>first <span class="free">t</span><span class="main">)</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> first_def stutstep_def app_def suffix_def<span class="main">)</span>

<span class="keyword1" id="Sequence-addfeqsim"><span class="command">lemma</span></span> addfeqsim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>first <span class="free">t</span><span class="main">)</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span> <span class="main">≈</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stutstep <span class="main">(</span><span class="main">(</span>first <span class="free">t</span><span class="main">)</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> addfeqstut<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>first <span class="free">t</span><span class="main">)</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>first <span class="free">t</span><span class="main">)</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_stutstep<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"tail <span class="main">(</span><span class="main">(</span>first <span class="free">t</span><span class="main">)</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="main">(</span>first <span class="free">t</span><span class="main">)</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def tail_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≈</span> <span class="main">(</span><span class="main">(</span>first <span class="free">t</span><span class="main">)</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tail_def app_def suffix_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_sym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-addfirststut"><span class="command">lemma</span></span> addfirststut<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"first <span class="free">s</span> <span class="main">=</span> second <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> tail <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first <span class="free">s</span><span class="main">)</span> <span class="main">##</span> <span class="main">(</span>tail <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_app_first_tail<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first <span class="free">s</span><span class="main">)</span> <span class="main">=</span> first <span class="main">(</span>tail <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> first_def second_def tail_def suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first <span class="free">s</span><span class="main">)</span> <span class="main">##</span> <span class="main">(</span>tail <span class="free">s</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span>tail <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> addfeqsim<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> g1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-app_seqsimilar"><span class="command">lemma</span></span> app_seqsimilar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"stutstep <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"first <span class="free">s</span> <span class="main">=</span> first <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sim_first<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"stutstep <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutstep_def first_def app_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_stutstep<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"tail <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tail_def suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> app_def tail_def suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_stutstep<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"tail <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tail_def suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≈</span> <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> app_def tail_def suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 g2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> seqsim_sym<span class="main">]</span> g1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_sym<span class="main"><span class="main">[</span></span><span class="operator">OF</span> seqsim_trans<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"first <span class="free">s</span> <span class="main">=</span> first <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sim_first<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> stutstep <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutstep_def first_def app_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> nextsuffix <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_notstutstep<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tail <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> nextsuffix <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tail_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> nextsuffix <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_app_tail<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> nextsuffix <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_notstutstep<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tail <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> nextsuffix <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tail_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≈</span> nextsuffix <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_app_tail<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> nextsuffix <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> seqsim_sym<span class="main">]</span> g1 <span class="keyword1"><span class="command">have</span></span> g3<span class="main">:</span> <span class="quoted"><span class="quoted">"nextsuffix <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span> <span class="main">≈</span> nextsuffix <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_sym<span class="main"><span class="main">[</span></span><span class="operator">OF</span> seqsim_trans<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"first <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> first <span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> first_def app_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this g3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsimilarI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If two sequences are similar then for any suffix of one of them there
  exists a similar suffix of the other one. We will prove a stronger
  result below.
›</span></span>

<span class="keyword1" id="Sequence-simstep_disj1"><span class="command">lemma</span></span> simstep_disj1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> a1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"stutstep <span class="free">s</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_stutstep<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this a1' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> nextsuffix <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_notstutstep<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> a1' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nextsuffix <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≈</span> nextsuffix <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqsim_suffix_seqsim<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> nextsuffix <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="main">(</span>nextnat <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextsuffix_def suffix_plus_com<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">m</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-nextnat_le_seqsim"><span class="command">lemma</span></span> nextnat_le_seqsim<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> nextnat <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True   <span class="comment1">― ‹case impossible›</span>
  <span class="keyword1"><span class="command">with</span></span> n <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextnat_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> n <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> nextnat <span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">≈</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> nextnat <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nextnat_le_unch<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword1"><span class="command">have</span></span> a3'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> nextnat <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">s</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nextnat_le_unch<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> g1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stutstep <span class="free">s</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutstep_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_stutstep<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> seqsim_sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a3' a2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> seqsim_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequence-seqsim_prev_nextnat"><span class="command">lemma</span></span> seqsim_prev_nextnat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="main">(</span>nextnat <span class="free">s</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"emptyseq <span class="free">s</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="main">(</span>nextnat <span class="free">s</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextnat_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nextnat <span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nextnat_empty_gzero<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextnat_le_seqsim<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Given a suffix <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s |<span class="hidden">⇩</span><sub>s</sub> n›</span></span></span></span> of some sequence <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s›</span></span></span></span> that is
  similar to some suffix <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t |<span class="hidden">⇩</span><sub>s</sub> m›</span></span></span></span> of sequence <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t›</span></span></span></span>, there
  exists some suffix <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t |<span class="hidden">⇩</span><sub>s</sub> m'›</span></span></span></span> of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t›</span></span></span></span> such that
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s |<span class="hidden">⇩</span><sub>s</sub> n›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t |<span class="hidden">⇩</span><sub>s</sub> m'›</span></span></span></span> are similar and also
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s |<span class="hidden">⇩</span><sub>s</sub> (n+1)›</span></span></span></span> is similar to either <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t |<span class="hidden">⇩</span><sub>s</sub> m'›</span></span></span></span> or to
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t |<span class="hidden">⇩</span><sub>s</sub> (m'+1)›</span></span></span></span>.
›</span></span>

<span class="keyword1" id="Sequence-seqsim_suffix_suc"><span class="command">lemma</span></span> seqsim_suffix_suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m'</span><span class="main">.</span> <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">m'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="bound">m'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">m'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"stutstep <span class="free">s</span> <span class="free">n</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span> <span class="main">≈</span> <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_stutstep<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> H <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> emptyseq <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stutnempty<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> H <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> emptyseq <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seqsim_empty_iff_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> g4<span class="main">:</span> <span class="quoted"><span class="quoted">"nextsuffix <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="main">(</span>nextnat <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextnat_empty_gzero nextsuffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> g3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>nextnat <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_prev_nextnat<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> H <span class="keyword1"><span class="command">have</span></span> G1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span> <span class="main">≈</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>nextnat <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> G1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> nextsuffix <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> notstutstep_nextsuffix1<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nextsuffix <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">≈</span> nextsuffix <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_suffix_seqsim<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> G1 G1' g4
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="main">(</span>nextnat <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="main">(</span>nextnat <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_plus_com<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following main result about similar sequences shows that if
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s ≈ t›</span></span></span></span> holds then for any suffix <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s |<span class="hidden">⇩</span><sub>s</sub> n›</span></span></span></span> of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s›</span></span></span></span>
  there exists a suffix <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t |<span class="hidden">⇩</span><sub>s</sub> m›</span></span></span></span> such that
  \begin{itemize}
  \item <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s |<span class="hidden">⇩</span><sub>s</sub> n›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t |<span class="hidden">⇩</span><sub>s</sub> m›</span></span></span></span> are similar, and
  \item <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s |<span class="hidden">⇩</span><sub>s</sub> (n+1)›</span></span></span></span> is similar to either <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t |<span class="hidden">⇩</span><sub>s</sub> (m+1)›</span></span></span></span>
    or <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t |<span class="hidden">⇩</span><sub>s</sub> m›</span></span></span></span>.
  \end{itemize}
  The idea is to pick the largest <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>m›</span></span></span></span> such that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s |<span class="hidden">⇩</span><sub>s</sub> n ≈ t |<span class="hidden">⇩</span><sub>s</sub> m›</span></span></span></span>
  (or some such <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>m›</span></span></span></span> if <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s |<span class="hidden">⇩</span><sub>s</sub> n›</span></span></span></span> is empty).
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> sim_step<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m</span><span class="main">.</span> <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">m</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="bound">m</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="free">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="var">?Sim</span> <span class="free">n</span> <span class="bound">m</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m</span><span class="main">.</span> <span class="var">?Sim</span> <span class="main">0</span> <span class="bound">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seqsim_suffix_suc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m</span><span class="main">.</span> <span class="var">?Sim</span> <span class="skolem">n</span> <span class="bound">m</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="skolem">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m</span><span class="main">.</span> <span class="var">?Sim</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="bound">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> seqsim_suffix_suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Intensional">
<div class="head">
<h1>Theory Intensional</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       A Definitional Encoding of TLA in Isabelle/HOL
    Authors:     Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
                 Stephan Merz &lt;Stephan.Merz at loria.fr&gt;
    Year:        2011
    Maintainer:  Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Representing Intensional Logic›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Intensional 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In higher-order logic, every proof rule has a corresponding tautology, i.e.
  the \emph{deduction theorem} holds. Isabelle/HOL implements this since object-level
  implication ($\longrightarrow$) and meta-level entailment ($\Longrightarrow$) 
  commute, viz. the proof rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>impI:›</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> impI<span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
  However, the deduction theorem does not hold for 
  most modal and temporal logics \cite[page 95]{Lamport02}\cite{Merz98}.
  For example $A \vdash \Box A$ holds, meaning that if $A$ holds in any world, then
  it always holds. However, $\vdash A \longrightarrow \Box A$, stating that 
  $A$ always holds if it initially holds, is not valid.

  Merz  \cite{Merz98} overcame this problem by creating an
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Intensional</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> logic. It exploits Isabelle's 
  axiomatic type class feature  \cite{Wenzel00b} by creating a type
  class <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">world</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, which provides Skolem constants to associate formulas
  with the world they hold in. The class is trivial, not requiring any axioms.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> world 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">world</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a type class of possible worlds. It is a subclass
  of all HOL types <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">type</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. No axioms are provided, since its only
  purpose is to avoid silly use of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Intensional</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> syntax.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Abstract Syntax and Definitions›</span></span>


<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'w</span><span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> expr <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'w</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>         
<span class="keyword1"><span class="command">type_synonym</span></span>  <span class="tfree">'w</span> form <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'w</span><span class="main">,</span> bool<span class="main">)</span> expr"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The intention is that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> will be used for unlifted
types (class <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">type</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>), while <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'w</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is lifted (class <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">world</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>). 
›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'w</span><span class="main">::</span>world<span class="main">)</span> form <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Valid</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">w</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">const</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">::</span>world<span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> expr"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> unl_con<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">const</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lift</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">::</span>world<span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> expr<span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> expr"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> unl_lift<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lift</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lift2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">::</span>world<span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> expr<span class="main">,</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> expr<span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">,</span><span class="tfree">'c</span><span class="main">)</span> expr"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> unl_lift2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lift2</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lift3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">=&gt;</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">::</span>world<span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> expr<span class="main">,</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> expr<span class="main">,</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">,</span><span class="tfree">'c</span><span class="main">)</span> expr<span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> expr"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> unl_lift3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lift3</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lift4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">=&gt;</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'e</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">::</span>world<span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> expr<span class="main">,</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> expr<span class="main">,</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">,</span><span class="tfree">'c</span><span class="main">)</span> expr<span class="main">,</span><span class="main">(</span><span class="tfree">'w</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> expr<span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">,</span><span class="tfree">'e</span><span class="main">)</span> expr"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> unl_lift4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lift4</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">zz</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">zz</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Valid <span class="free"><span class="free">F</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> asserts that the lifted formula <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> holds everywhere.
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">const</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> allows lifting of a constant, while <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">lift</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> through
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">lift4</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> allow functions with arity 1--4 to be lifted. (Note that there
  is no way to define a generic lifting operator for functions of arbitrary arity.)
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">RAll</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">::</span>world<span class="main">)</span> form<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'w</span> form"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span> <span class="quoted">"<span class="keyword1">Rall</span> "</span> 10<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> unl_Rall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1"><span class="free">Rall</span></span> <span class="bound">x</span><span class="main"><span class="free">.</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">REx</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">::</span>world<span class="main">)</span> form<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'w</span> form"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span> <span class="quoted">"<span class="keyword1">Rex</span> "</span> 10<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> unl_Rex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1"><span class="free">Rex</span></span> <span class="bound">x</span><span class="main"><span class="free">.</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">REx1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'w</span><span class="main">::</span>world<span class="main">)</span> form<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'w</span> form"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span> <span class="quoted">"<span class="keyword1">Rex!</span> "</span> 10<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> unl_Rex1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1"><span class="free">Rex!</span></span> <span class="bound">x</span><span class="main"><span class="free">.</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span> <span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">RAll</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">REx</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">REx1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> introduces ``rigid'' quantification
  over values (of non-world types) within ``intensional'' formulas. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">RAll</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  is universal quantification, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">REx</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is existential quantifcation.
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">REx1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> requires unique existence.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We declare the ``unlifting rules'' as rewrite rules that will be applied
  automatically.
›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> intensional_rews<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> 
  unl_con unl_lift unl_lift2 unl_lift3 unl_lift4 
  unl_Rall unl_Rex unl_Rex1



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Concrete Syntax›</span></span>

<span class="keyword1"><span class="command">nonterminal</span></span>
  lift <span class="keyword2"><span class="keyword">and</span></span> liftargs

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The non-terminal <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">lift</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> represents lifted expressions. The idea is to use 
  Isabelle's macro mechanism to convert between the concrete and abstract syntax.
›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">""</span>            <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> lift"</span></span>                          <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">""</span>            <span class="main">::</span> <span class="quoted"><span class="quoted">"longid <span class="main">⇒</span> lift"</span></span>                      <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">""</span>            <span class="main">::</span> <span class="quoted"><span class="quoted">"var <span class="main">⇒</span> lift"</span></span>                         <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_applC"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> cargs<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>               <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span>_<span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">,</span> 1000<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">""</span>            <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> lift"</span></span>                        <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="quoted">"_lambda"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>idts<span class="main">,</span> <span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                  <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">%</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 3<span class="main">]</span> 3<span class="main">)</span>
  <span class="quoted">"_constrain"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> type<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">::</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>4<span class="main">,</span> 0<span class="main">]</span> 3<span class="main">)</span>
  <span class="quoted">""</span>            <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> liftargs"</span></span>                    <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_liftargs"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> liftargs<span class="main">]</span> <span class="main">⇒</span> liftargs"</span></span>        <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">"_Valid"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> bool"</span></span>                        <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">⊢</span> _<span class="keyword3">)</span>"</span> 5<span class="main">)</span>
  <span class="quoted">"_holdsAt"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> bool"</span></span>                  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">⊨</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>100<span class="main">,</span>10<span class="main">]</span> 10<span class="main">)</span>

  <span class="comment1">(* Syntax for lifted expressions outside the scope of ⊢ or ⊨.*)</span>
  <span class="quoted">"LIFT"</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>                          <span class="main">(</span><span class="quoted">"<span class="keyword1">LIFT</span> _"</span><span class="main">)</span>

  <span class="comment1">(* generic syntax for lifted constants and functions *)</span>
  <span class="quoted">"_const"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> lift"</span></span>                          <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">#</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_lift"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">&lt;</span>_<span class="keyword1">&gt;</span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_lift2"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>            <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">&lt;</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword1">&gt;</span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_lift3"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> lift<span class="main">,</span> lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>      <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">&lt;</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword1">&gt;</span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>
  <span class="quoted">"_lift4"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> lift<span class="main">,</span> lift<span class="main">,</span> lift<span class="main">,</span>lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>      <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">&lt;</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword1">&gt;</span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>

  <span class="comment1">(* concrete syntax for common infix functions: reuse same symbol *)</span>
  <span class="quoted">"_liftEqu"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">=</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span>51<span class="main">]</span> 50<span class="main">)</span>
  <span class="quoted">"_liftNeq"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">≠</span>"</span> 50<span class="main">)</span>
  <span class="quoted">"_liftNot"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> lift"</span></span>                        <span class="main">(</span><span class="quoted">"<span class="keyword1">¬</span> _"</span> <span class="main">[</span>90<span class="main">]</span> 90<span class="main">)</span>
  <span class="quoted">"_liftAnd"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∧</span>"</span> 35<span class="main">)</span>
  <span class="quoted">"_liftOr"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∨</span>"</span> 30<span class="main">)</span>
  <span class="quoted">"_liftImp"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⟶</span>"</span> 25<span class="main">)</span>
  <span class="quoted">"_liftIf"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>          <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">if</span> <span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">then</span> <span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">else</span> <span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> 10<span class="main">)</span>
  <span class="quoted">"_liftPlus"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">+</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>66<span class="main">,</span>65<span class="main">]</span> 65<span class="main">)</span>
  <span class="quoted">"_liftMinus"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">-</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>66<span class="main">,</span>65<span class="main">]</span> 65<span class="main">)</span>
  <span class="quoted">"_liftTimes"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">*</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>71<span class="main">,</span>70<span class="main">]</span> 70<span class="main">)</span>
  <span class="quoted">"_liftDiv"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">div</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>71<span class="main">,</span>70<span class="main">]</span> 70<span class="main">)</span>
  <span class="quoted">"_liftMod"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">mod</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>71<span class="main">,</span>70<span class="main">]</span> 70<span class="main">)</span>
  <span class="quoted">"_liftLess"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">&lt;</span> _<span class="keyword3">)</span>"</span>  <span class="main">[</span>50<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>
  <span class="quoted">"_liftLeq"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">≤</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>
  <span class="quoted">"_liftMem"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">∈</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>
  <span class="quoted">"_liftNotMem"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">∉</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>
  <span class="quoted">"_liftFinset"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"liftargs <span class="main">=&gt;</span> lift"</span></span>                    <span class="main">(</span><span class="quoted">"<span class="keyword1">{</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span><span class="main">)</span>
  <span class="comment1">(** TODO: syntax for lifted collection / comprehension **)</span>
  <span class="quoted">"_liftPair"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span>liftargs<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                   <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">'(</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword1">')</span><span class="keyword3">)</span>"</span><span class="main">)</span>
  <span class="comment1">(* infix syntax for list operations *)</span>
  <span class="quoted">"_liftCons"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">#</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>65<span class="main">,</span>66<span class="main">]</span> 65<span class="main">)</span>
  <span class="quoted">"_liftApp"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">@</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>65<span class="main">,</span>66<span class="main">]</span> 65<span class="main">)</span>
  <span class="quoted">"_liftList"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"liftargs <span class="main">⇒</span> lift"</span></span>                      <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1">]</span>"</span><span class="main">)</span>

  <span class="comment1">(* Rigid quantification (syntax level) *)</span>
  <span class="quoted">"_ARAll"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>idts<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                    <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">!</span> _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_AREx"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>idts<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                    <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">?</span> _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_AREx1"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>idts<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                    <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">?!</span> _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_RAll"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>idts<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">∀</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_REx"</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>idts<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">∃</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_REx1"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>idts<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">∃!</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_const"</span>        <span class="main">⇌</span>  <span class="quoted">"<span class="keyword1">CONST</span> const"</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_lift"</span>         <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> lift"</span>
  <span class="quoted">"_lift2"</span>        <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> lift2"</span>
  <span class="quoted">"_lift3"</span>        <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> lift3"</span>
  <span class="quoted">"_lift4"</span>        <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> lift4"</span>
  <span class="quoted">"_Valid"</span>        <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> Valid"</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_RAll <span class="free">x</span> <span class="free">A</span>"</span>     <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">Rall</span> <span class="free">x</span><span class="main">.</span> <span class="free">A</span>"</span>
  <span class="quoted">"_REx <span class="free">x</span> <span class="free">A</span>"</span>      <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">Rex</span> <span class="free">x</span><span class="main">.</span> <span class="free">A</span>"</span>
  <span class="quoted">"_REx1 <span class="free">x</span> <span class="free">A</span>"</span>     <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">Rex!</span> <span class="free">x</span><span class="main">.</span> <span class="free">A</span>"</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_ARAll"</span>        <span class="main">⇀</span>  <span class="quoted">"_RAll"</span>
  <span class="quoted">"_AREx"</span>         <span class="main">⇀</span> <span class="quoted">"_REx"</span>
  <span class="quoted">"_AREx1"</span>        <span class="main">⇀</span> <span class="quoted">"_REx1"</span>

  <span class="quoted">"<span class="free">w</span> <span class="main">⊨</span> A"</span>        <span class="main">⇀</span> <span class="quoted">"<span class="free">A</span> <span class="free">w</span>"</span>
  <span class="quoted">"<span class="keyword1">LIFT</span> A"</span>        <span class="main">⇀</span> <span class="quoted">"<span class="free">A</span><span class="main">::</span><span class="main">_</span><span class="main">⇒</span><span class="main">_</span>"</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_liftEqu"</span>      <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="main">(=)</span>"</span>
  <span class="quoted">"_liftNeq <span class="free">u</span> <span class="free">v</span>"</span>  <span class="main">⇌</span> <span class="quoted">"_liftNot <span class="main">(</span>_liftEqu <span class="free">u</span> <span class="free">v</span><span class="main">)</span>"</span>
  <span class="quoted">"_liftNot"</span>      <span class="main">⇌</span> <span class="quoted">"_lift <span class="main">(</span><span class="keyword1">CONST</span> Not<span class="main">)</span>"</span>
  <span class="quoted">"_liftAnd"</span>      <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="main">(&amp;)</span>"</span>
  <span class="quoted">"_liftOr"</span>       <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="main">(</span><span class="main">(|)</span> <span class="main">)</span>"</span>
  <span class="quoted">"_liftImp"</span>      <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="main">(--&gt;)</span>"</span>
  <span class="quoted">"_liftIf"</span>       <span class="main">⇌</span> <span class="quoted">"_lift3 <span class="main">(</span><span class="keyword1">CONST</span> If<span class="main">)</span>"</span>
  <span class="quoted">"_liftPlus"</span>     <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="main">(+)</span>"</span>
  <span class="quoted">"_liftMinus"</span>    <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="main">(-)</span>"</span>
  <span class="quoted">"_liftTimes"</span>    <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="main">(*)</span>"</span>
  <span class="quoted">"_liftDiv"</span>      <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="keyword1">(div)</span>"</span>
 <span class="quoted">"_liftMod"</span>      <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="keyword1">(mod)</span>"</span>
  <span class="quoted">"_liftLess"</span>     <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="main">(&lt;)</span>"</span>
  <span class="quoted">"_liftLeq"</span>      <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="main">(&lt;=)</span>"</span>
  <span class="quoted">"_liftMem"</span>      <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="main">(:)</span>"</span>
  <span class="quoted">"_liftNotMem <span class="free">x</span> <span class="free">xs</span>"</span>             <span class="main">⇌</span> <span class="quoted">"_liftNot <span class="main">(</span>_liftMem <span class="free">x</span> <span class="free">xs</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_liftFinset <span class="main">(</span>_liftargs <span class="free">x</span> <span class="free">xs</span><span class="main">)</span>"</span> <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="main">(</span><span class="keyword1">CONST</span> insert<span class="main">)</span> <span class="free">x</span> <span class="main">(</span>_liftFinset <span class="free">xs</span><span class="main">)</span>"</span>
  <span class="quoted">"_liftFinset <span class="free">x</span>"</span>                <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="main">(</span><span class="keyword1">CONST</span> insert<span class="main">)</span> <span class="free">x</span> <span class="main">(</span>_const <span class="main">(</span><span class="keyword1">CONST</span> Set.empty<span class="main">)</span><span class="main">)</span>"</span>
  <span class="quoted">"_liftPair <span class="free">x</span> <span class="main">(</span>_liftargs <span class="free">y</span> <span class="free">z</span><span class="main">)</span>"</span>  <span class="main">⇌</span> <span class="quoted">"_liftPair <span class="free">x</span> <span class="main">(</span>_liftPair <span class="free">y</span> <span class="free">z</span><span class="main">)</span>"</span>
  <span class="quoted">"_liftPair"</span>                    <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="main">(</span><span class="keyword1">CONST</span> Pair<span class="main">)</span>"</span>
  <span class="quoted">"_liftCons"</span>                    <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="main">(</span><span class="keyword1">CONST</span> Cons<span class="main">)</span>"</span>
  <span class="quoted">"_liftApp"</span>                     <span class="main">⇌</span> <span class="quoted">"_lift2 <span class="main">(@)</span>"</span>
  <span class="quoted">"_liftList <span class="main">(</span>_liftargs <span class="free">x</span> <span class="free">xs</span><span class="main">)</span>"</span>   <span class="main">⇌</span> <span class="quoted">"_liftCons <span class="free">x</span> <span class="main">(</span>_liftList <span class="free">xs</span><span class="main">)</span>"</span>
  <span class="quoted">"_liftList <span class="free">x</span>"</span>                  <span class="main">⇌</span> <span class="quoted">"_liftCons <span class="free">x</span> <span class="main">(</span>_const <span class="main">[]</span><span class="main">)</span>"</span>

  <span class="quoted">"<span class="free">w</span> <span class="main">⊨</span> <span class="main">¬</span> A"</span> <span class="main">↽</span> <span class="quoted">"_liftNot <span class="free">A</span> <span class="free">w</span>"</span>
  <span class="quoted">"<span class="free">w</span> <span class="main">⊨</span> A <span class="main">∧</span> B"</span> <span class="main">↽</span> <span class="quoted">"_liftAnd <span class="free">A</span> <span class="free">B</span> <span class="free">w</span>"</span>
  <span class="quoted">"<span class="free">w</span> <span class="main">⊨</span> A <span class="main">∨</span> B"</span> <span class="main">↽</span> <span class="quoted">"_liftOr <span class="free">A</span> <span class="free">B</span> <span class="free">w</span>"</span>
  <span class="quoted">"<span class="free">w</span> <span class="main">⊨</span> A <span class="main">⟶</span> B"</span> <span class="main">↽</span> <span class="quoted">"_liftImp <span class="free">A</span> <span class="free">B</span> <span class="free">w</span>"</span>
  <span class="quoted">"<span class="free">w</span> <span class="main">⊨</span> u <span class="main">=</span> v"</span> <span class="main">↽</span> <span class="quoted">"_liftEqu <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span>
  <span class="quoted">"<span class="free">w</span> <span class="main">⊨</span> <span class="main">∀</span><span class="free">x</span><span class="main">.</span> A"</span> <span class="main">↽</span> <span class="quoted">"_RAll <span class="free">x</span> <span class="free">A</span> <span class="free">w</span>"</span>
  <span class="quoted">"<span class="free">w</span> <span class="main">⊨</span> <span class="main">∃</span><span class="free">x</span><span class="main">.</span> A"</span> <span class="main">↽</span> <span class="quoted">"_REx <span class="free">x</span> <span class="free">A</span> <span class="free">w</span>"</span>
  <span class="quoted">"<span class="free">w</span> <span class="main">⊨</span> <span class="main">∃!</span><span class="free">x</span><span class="main">.</span> A"</span> <span class="main">↽</span> <span class="quoted">"_REx1 <span class="free">x</span> <span class="free">A</span> <span class="free">w</span>"</span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  <span class="quoted">"_Valid"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> bool"</span></span>                        <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">|-</span> _<span class="keyword3">)</span>"</span> 5<span class="main">)</span>
  <span class="quoted">"_holdsAt"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> bool"</span></span>                  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">|=</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>100<span class="main">,</span>10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_liftNeq"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">~=</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span>51<span class="main">]</span> 50<span class="main">)</span>
  <span class="quoted">"_liftNot"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> lift"</span></span>                        <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">~</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>90<span class="main">]</span> 90<span class="main">)</span>
  <span class="quoted">"_liftAnd"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">&amp;</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>36<span class="main">,</span>35<span class="main">]</span> 35<span class="main">)</span>
  <span class="quoted">"_liftOr"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">|</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>31<span class="main">,</span>30<span class="main">]</span> 30<span class="main">)</span>
  <span class="quoted">"_liftImp"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">--&gt;</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>26<span class="main">,</span>25<span class="main">]</span> 25<span class="main">)</span>
  <span class="quoted">"_liftLeq"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">&lt;=</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>
  <span class="quoted">"_liftMem"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">:</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>
  <span class="quoted">"_liftNotMem"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">~:</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>
  <span class="quoted">"_RAll"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>idts<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                      <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">ALL</span> _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_REx"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>idts<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                      <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">EX</span> _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_REx1"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>idts<span class="main">,</span> lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span>                      <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">EX!</span> _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas and Tactics›</span></span>

<span class="keyword1" id="Intensional-intD"><span class="command">lemma</span></span> intD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> A <span class="main">⟹</span> <span class="free">w</span> <span class="main">⊨</span> A"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊢</span> A"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">⊨</span> A"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Valid_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Intensional-intI"><span class="command">lemma</span></span> intI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> P1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">⊨</span> A<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> A"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Valid_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Basic unlifting introduces a parameter <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and applies basic rewrites, e.g 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">⊢</span></span> F <span class="main"><span class="main">=</span></span> G"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> becomes <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">F</span></span> <span class="free"><span class="free">w</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">G</span></span> <span class="free"><span class="free">w</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">⊢</span></span> F <span class="main"><span class="main">⟶</span></span> G"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> becomes   
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">F</span></span> <span class="free"><span class="free">w</span></span> <span class="main"><span class="main">⟶</span></span> <span class="free"><span class="free">G</span></span> <span class="free"><span class="free">w</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">method_setup</span></span> int_unlift <span class="main">=</span> <span class="quoted">‹
  Scan.succeed <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="entity">SIMPLE_METHOD'</span>
    <span class="main">(</span>resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> intI<span class="antiquote">}</span></span></span> THEN' rewrite_goal_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> intensional_rews<span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">)</span>
›</span> <span class="quoted">"method to unlift and followed by intensional rewrites"</span>

<span class="keyword1" id="Intensional-inteq_reflection"><span class="command">lemma</span></span> inteq_reflection<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> P1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> x<span class="main">=</span>y"</span></span> <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">≡</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> P1 <span class="keyword1"><span class="command">have</span></span> P2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="free">x</span> <span class="bound">w</span> <span class="main">=</span> <span class="free">y</span> <span class="bound">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Valid_def unl_lift2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> P3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≡</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted">"eq_reflection"</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Intensional-int_simps"><span class="command">lemma</span></span> int_simps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>x<span class="main">=</span>x<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>True"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">¬</span> <span class="main">#</span>True<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>False"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">¬</span> <span class="main">#</span>False<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>True"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">¬</span><span class="main">¬</span> P<span class="main">)</span> <span class="main">=</span> P"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> P<span class="main">)</span> <span class="main">=</span> P<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>False"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>P <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>P<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">#</span>False"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>P <span class="main">≠</span> Q<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>P <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> Q<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">#</span>True<span class="main">=</span>P<span class="main">)</span> <span class="main">=</span> P"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>P<span class="main">=</span><span class="main">#</span>True<span class="main">)</span> <span class="main">=</span> P"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">#</span>True <span class="main">⟶</span> P<span class="main">)</span> <span class="main">=</span> P"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">#</span>False <span class="main">⟶</span> P<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>True"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>P <span class="main">⟶</span> <span class="main">#</span>True<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>True"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>P <span class="main">⟶</span> P<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>True"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>P <span class="main">⟶</span> <span class="main">#</span>False<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>P<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>P <span class="main">⟶</span> <span class="main">~</span>P<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>P<span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>P <span class="main">∧</span> <span class="main">#</span>True<span class="main">)</span> <span class="main">=</span> P"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">#</span>True <span class="main">∧</span> P<span class="main">)</span> <span class="main">=</span> P"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>P <span class="main">∧</span> <span class="main">#</span>False<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>False"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">#</span>False <span class="main">∧</span> P<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>False"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>P <span class="main">∧</span> P<span class="main">)</span> <span class="main">=</span> P"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>P <span class="main">∧</span> <span class="main">~</span>P<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>False"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">¬</span>P <span class="main">∧</span> P<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>False"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>P <span class="main">∨</span> <span class="main">#</span>True<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>True"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">#</span>True <span class="main">∨</span> P<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>True"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>P <span class="main">∨</span> <span class="main">#</span>False<span class="main">)</span> <span class="main">=</span> P"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">#</span>False <span class="main">∨</span> P<span class="main">)</span> <span class="main">=</span> P"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>P <span class="main">∨</span> P<span class="main">)</span> <span class="main">=</span> P"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>P <span class="main">∨</span> <span class="main">¬</span>P<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>True"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">¬</span>P <span class="main">∨</span> P<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>True"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> P<span class="main">)</span> <span class="main">=</span> P"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> P<span class="main">)</span> <span class="main">=</span> P"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> intensional_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> int_simps<span class="main">[</span><span class="operator">THEN</span> inteq_reflection<span class="main">]</span>

<span class="keyword1"><span class="command">method_setup</span></span> int_rewrite <span class="main">=</span> <span class="quoted">‹
  Scan.succeed <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="entity">SIMPLE_METHOD'</span> <span class="main">(</span>rewrite_goal_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> intensional_simps<span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">)</span>
›</span> <span class="quoted">"rewrite method at intensional level"</span>

<span class="keyword1" id="Intensional-Not_Rall"><span class="command">lemma</span></span> Not_Rall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="main">¬</span>F <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Intensional-Not_Rex"><span class="command">lemma</span></span> Not_Rex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">¬</span>F <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Intensional-TrueW"><span class="command">lemma</span></span> TrueW <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">#</span>True"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Intensional-int_eq"><span class="command">lemma</span></span> int_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> X <span class="main">=</span> Y <span class="main">⟹</span> <span class="free">X</span> <span class="main">=</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inteq_reflection<span class="main">)</span>

<span class="keyword1" id="Intensional-int_iffI"><span class="command">lemma</span></span> int_iffI<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> G"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> G <span class="main">⟶</span> F"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">=</span> G"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Intensional-int_iffD1"><span class="command">lemma</span></span> int_iffD1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">=</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> G"</span></span>
  <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Intensional-int_iffD2"><span class="command">lemma</span></span> int_iffD2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">=</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> G <span class="main">⟶</span> F"</span></span>
  <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Intensional-lift_imp_trans"><span class="command">lemma</span></span> lift_imp_trans<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> A <span class="main">⟶</span> B"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> B <span class="main">⟶</span> C"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> A <span class="main">⟶</span> C"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Intensional-lift_imp_neg"><span class="command">lemma</span></span> lift_imp_neg<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> A <span class="main">⟶</span> B"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span>B <span class="main">⟶</span> <span class="main">¬</span>A"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Intensional-lift_and_com"><span class="command">lemma</span></span> lift_and_com<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>A <span class="main">∧</span> B<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>B <span class="main">∧</span> A<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Semantics">
<div class="head">
<h1>Theory Semantics</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       A Definitional Encoding of TLA in Isabelle/HOL
    Authors:     Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
                 Stephan Merz &lt;Stephan.Merz at loria.fr&gt;
    Year:        2011
    Maintainer:  Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Semantics›</span></span> 

<span class="keyword1"><span class="command">theory</span></span> Semantics
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Sequence.html">Sequence</a> <a href="Intensional.html">Intensional</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This theory mechanises a \emph{shallow} embedding of \tlastar{} using the
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Sequence›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Intensional›</span></span></span></span> theories. A shallow embedding
  represents \tlastar{} using Isabelle/HOL predicates, while a \emph{deep}
  embedding would represent \tlastar{} formulas and pre-formulas as mutually
  inductive datatypes\footnote{See e.g. \cite{Wildmoser04} for a discussion
  about deep vs. shallow embeddings in Isabelle/HOL.}.  
  The choice of a shallow over a deep embedding is motivated by the following 
  factors: a shallow embedding is usually less involved, and existing Isabelle
  theories and tools can be applied more directly to enhance automation; due to
  the lifting in the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Intensional›</span></span></span></span> theory, a shallow embedding can reuse
  standard logical operators, whilst a deep embedding requires a different
  set of operators for both formulas and pre-formulas. Finally, since our 
  target is system verification rather than proving meta-properties of \tlastar{},
  which requires a deep embedding, a shallow embedding is more fit for purpose.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Types of Formulas"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  To mechanise the \tlastar{} semantics, the following
  type abbreviations are used:
›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> formfun <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> seq <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> formula <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span>bool<span class="main">)</span> formfun"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> stfun <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> stpred <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span>bool<span class="main">)</span> stfun"</span></span>

<span class="keyword1"><span class="command">instance</span></span> 
 <span class="quoted">"fun"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">,</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">world</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">instance</span></span>
 <span class="quoted">"prod"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">,</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">world</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Pair and function are instantiated to be of type class world.
  This allows use of the lifted intensional logic for formulas, and 
  standard logical connectives can therefore be used.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Semantics of TLA*"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The semantics of \tlastar{} is defined.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">always</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>world<span class="main">)</span> formula <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">always</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nexts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>world<span class="main">)</span> formula <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nexts</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>tail <span class="bound">s</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">before</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>world<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> stfun <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> formfun"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">before</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>first <span class="bound">s</span><span class="main">)</span> <span class="main">⊨</span> f"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">after</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>world<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> stfun <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> formfun"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">after</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>second <span class="bound">s</span><span class="main">)</span> <span class="main">⊨</span> f"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unch</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>world<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> stfun <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">unch</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">⊨</span> <span class="main">(</span>after <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>before <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">action</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>world<span class="main">)</span> formula <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> stfun <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">action</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊨</span> P<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊨</span> unch <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Concrete Syntax"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is the concrete syntax for the (abstract) operators above.›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
 <span class="quoted">"_always"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">□</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>90<span class="main">]</span> 90<span class="main">)</span> 
 <span class="quoted">"_nexts"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">○</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>90<span class="main">]</span> 90<span class="main">)</span> 
 <span class="quoted">"_action"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span>lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">□[</span>_<span class="keyword1">]'_</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>20<span class="main">,</span>1000<span class="main">]</span> 90<span class="main">)</span>
 <span class="quoted">"_before"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> lift"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">$</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>100<span class="main">]</span> 99<span class="main">)</span>
 <span class="quoted">"_after"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> lift"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">$</span><span class="keyword3">)</span>"</span> <span class="main">[</span>100<span class="main">]</span> 99<span class="main">)</span>
 <span class="quoted">"_prime"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> lift"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">`</span><span class="keyword3">)</span>"</span> <span class="main">[</span>100<span class="main">]</span> 99<span class="main">)</span>  
 <span class="quoted">"_unch"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> lift"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">Unchanged</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>100<span class="main">]</span> 99<span class="main">)</span> 
 <span class="quoted">"TEMP"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">TEMP</span> _<span class="keyword3">)</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
 <span class="quoted">"_always"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">[]</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>90<span class="main">]</span> 90<span class="main">)</span>
 <span class="quoted">"_nexts"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">Next</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>90<span class="main">]</span> 90<span class="main">)</span>
 <span class="quoted">"_action"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span>lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">[][</span>_<span class="keyword1">]'_</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>20<span class="main">,</span>1000<span class="main">]</span> 90<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
 <span class="quoted">"_always"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> always"</span>
 <span class="quoted">"_nexts"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> nexts"</span>
 <span class="quoted">"_action"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> action"</span>
 <span class="quoted">"_before"</span>    <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> before"</span> 
 <span class="quoted">"_after"</span>     <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> after"</span> 
 <span class="quoted">"_prime"</span>     <span class="main">⇀</span> <span class="quoted">"<span class="keyword1">CONST</span> after"</span>
 <span class="quoted">"_unch"</span>     <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> unch"</span> 
 <span class="quoted">"<span class="keyword1">TEMP</span> F"</span> <span class="main">⇀</span> <span class="quoted">"<span class="main">(</span><span class="free">F</span><span class="main">::</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span>"</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Abbreviations"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some standard temporal abbreviations, with their concrete syntax.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">actrans</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>world<span class="main">)</span> formula <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> stfun <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">actrans</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">TEMP</span><span class="main">(</span>P <span class="main">∨</span> unch <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eventually</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>world<span class="main">)</span> formula <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">eventually</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="keyword1">LIFT</span><span class="main">(</span><span class="main">¬</span><span class="main">□</span><span class="main">(</span><span class="main">¬</span>F<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">angle_action</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>world<span class="main">)</span> formula <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> stfun <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">angle_action</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">LIFT</span><span class="main">(</span><span class="main">¬</span><span class="main">□[</span><span class="main">¬</span>P<span class="main">]_</span>v<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">angle_actrans</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>world<span class="main">)</span> formula <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> stfun <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">angle_actrans</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">(</span><span class="main">¬</span> actrans <span class="main">(</span><span class="keyword1">LIFT</span><span class="main">(</span><span class="main">¬</span>P<span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">leadsto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>world<span class="main">)</span> formula <span class="main">⇒</span> <span class="tfree">'a</span> formula <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">leadsto</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="keyword1">LIFT</span> <span class="main">□</span><span class="main">(</span>P <span class="main">⟶</span> eventually <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Concrete Syntax"</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  <span class="quoted">"_actrans"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span>lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">[</span>_<span class="keyword1">]'_</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span>  <span class="main">[</span>20<span class="main">,</span>1000<span class="main">]</span> 90<span class="main">)</span>
  <span class="quoted">"_eventually"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">&lt;&gt;</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>90<span class="main">]</span> 90<span class="main">)</span>
  <span class="quoted">"_angle_action"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span>lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">&lt;&gt;&lt;</span>_<span class="keyword1">&gt;'_</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>20<span class="main">,</span>1000<span class="main">]</span> 90<span class="main">)</span>
  <span class="quoted">"_angle_actrans"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span>lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">&lt;</span>_<span class="keyword1">&gt;'_</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>20<span class="main">,</span>1000<span class="main">]</span> 90<span class="main">)</span>
  <span class="quoted">"_leadsto"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span>lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">~&gt;</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>26<span class="main">,</span>25<span class="main">]</span> 25<span class="main">)</span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_eventually"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">◇</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>90<span class="main">]</span> 90<span class="main">)</span>
  <span class="quoted">"_angle_action"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span>lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">◇⟨</span>_<span class="keyword1">⟩'_</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>20<span class="main">,</span>1000<span class="main">]</span> 90<span class="main">)</span>
  <span class="quoted">"_angle_actrans"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span>lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">⟨</span>_<span class="keyword1">⟩'_</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span> <span class="main">[</span>20<span class="main">,</span>1000<span class="main">]</span> 90<span class="main">)</span>
  <span class="quoted">"_leadsto"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span>lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">↝</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>26<span class="main">,</span>25<span class="main">]</span> 25<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span> 
  <span class="quoted">"_actrans"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> actrans"</span>
  <span class="quoted">"_eventually"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> eventually"</span>
  <span class="quoted">"_angle_action"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> angle_action"</span>
  <span class="quoted">"_angle_actrans"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> angle_actrans"</span>
  <span class="quoted">"_leadsto"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> leadsto"</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Properties of Operators"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemmas show that these operators have the expected semantics.›</span></span>

<span class="keyword1" id="Semantics-eventually_defs"><span class="command">lemma</span></span> eventually_defs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊨</span> <span class="main">◇</span> F<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">⊨</span> F<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_def always_def<span class="main">)</span>

<span class="keyword1" id="Semantics-angle_action_defs"><span class="command">lemma</span></span> angle_action_defs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊨</span> <span class="main">◇⟨</span>P<span class="main">⟩_</span>v<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊨</span> P<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊨</span> v<span class="main">$</span> <span class="main">≠</span> <span class="main">$</span>v<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> angle_action_def action_def unch_def<span class="main">)</span>

<span class="keyword1" id="Semantics-unch_defs"><span class="command">lemma</span></span> unch_defs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊨</span> <span class="keyword1">Unchanged</span> v<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>second <span class="free">w</span><span class="main">)</span> <span class="main">⊨</span> v<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>first <span class="free">w</span><span class="main">)</span> <span class="main">⊨</span> v<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unch_def before_def nexts_def after_def tail_def suffix_def first_def second_def<span class="main">)</span>

<span class="keyword1" id="Semantics-linalw"><span class="command">lemma</span></span> linalw<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">a</span><span class="main">)</span> <span class="main">⊨</span> <span class="main">□</span>A"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">b</span><span class="main">)</span> <span class="main">⊨</span> <span class="main">□</span>A"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> always_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_iff_add<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="free">b</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊨</span> A"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> always_def suffix_plus <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Invariance Under Stuttering"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A key feature of \tlastar{} is that specification at different abstraction
  levels can be compared. The soundness of this relies on the stuttering invariance 
  of formulas. Since the embedding is shallow, it cannot be shown that a generic 
  \tlastar{} formula is stuttering invariant. However, this section will show that 
  each operator is stuttering invariant or preserves stuttering invariance in an
  appropriate sense, which can be used to show stuttering invariance
  for given specifications. 

  Formula <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>F›</span></span></span></span> is stuttering invariant if for any two similar behaviours
  (i.e., sequences of states), <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>F›</span></span></span></span> holds in one iff it holds in the other.
  The definition is generalised to arbitrary expressions, and not just predicates.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stutinv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> formfun <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">stutinv</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">σ</span> <span class="bound">τ</span><span class="main">.</span> <span class="bound">σ</span> <span class="main">≈</span> <span class="bound">τ</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">σ</span> <span class="main">⊨</span> F<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">τ</span> <span class="main">⊨</span> F<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The requirement for stuttering invariance is too strong for pre-formulas. 
  For example, an action formula specifies a relation between the first two states
  of a behaviour, and will rarely be satisfied by a stuttering step. This is why
  pre-formulas are ``protected'' by (square or angle) brackets in \tlastar{}:
  the only place a pre-formula <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P›</span></span></span></span> can be used is inside an action:
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>□[P]_v›</span></span></span></span>.
  To show that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>□[P]_v›</span></span></span></span> is stuttering invariant, is must be shown that a 
  slightly weaker predicate holds for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. For example, if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> contains 
  a term of the form <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>○○Q›</span></span></span></span>, then it is not a well-formed pre-formula, thus 
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>□[P]_v›</span></span></span></span> is not stuttering invariant. This weaker version of
  stuttering invariance has been named \emph{near stuttering invariance}.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nstutinv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> formfun <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nstutinv</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">σ</span> <span class="bound">τ</span><span class="main">.</span> <span class="main">(</span>first <span class="bound">σ</span> <span class="main">=</span> first <span class="bound">τ</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>tail <span class="bound">σ</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span>tail <span class="bound">τ</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">σ</span> <span class="main">⊨</span> P<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">τ</span> <span class="main">⊨</span> P<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_stutinv"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">STUTINV</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>40<span class="main">]</span> 40<span class="main">)</span>
  <span class="quoted">"_nstutinv"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">NSTUTINV</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>40<span class="main">]</span> 40<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_stutinv"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> stutinv"</span>
  <span class="quoted">"_nstutinv"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> nstutinv"</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"stutinv <span class="free"><span class="free">F</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> formalises stuttering invariance for
  formula <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. That is if two sequences are similar <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">s</span></span> <span class="main"><span class="main">≈</span></span> <span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (equal up
  to stuttering) then the validity of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> under both <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  are equivalent. Predicate <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"nstutinv <span class="free"><span class="free">P</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> should be read as \emph{nearly
  stuttering invariant} -- and is required for some stuttering invariance proofs.
›</span></span>

<span class="keyword1" id="Semantics-stutinv_strictly_stronger"><span class="command">lemma</span></span> stutinv_strictly_stronger<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> F"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> F"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> nstutinv_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"first <span class="skolem">s</span> <span class="main">=</span> first <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tail <span class="skolem">s</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span>tail <span class="skolem">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> tg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first <span class="skolem">s</span><span class="main">)</span> <span class="main">##</span> <span class="main">(</span>tail <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_app_first_tail<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> tg2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first <span class="skolem">t</span><span class="main">)</span> <span class="main">##</span> <span class="main">(</span>tail <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> seq_app_first_tail<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a1 <span class="keyword1"><span class="command">have</span></span> tg2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first <span class="skolem">s</span><span class="main">)</span> <span class="main">##</span> <span class="main">(</span>tail <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first <span class="skolem">s</span><span class="main">)</span> <span class="main">##</span> <span class="main">(</span>tail <span class="skolem">s</span><span class="main">)</span> <span class="main">≈</span> <span class="main">(</span>first <span class="skolem">s</span><span class="main">)</span> <span class="main">##</span> <span class="main">(</span>tail <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> app_seqsimilar<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> tg1 tg2' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> h <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">⊨</span> F<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊨</span> F<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">stutinv</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This subsection proves stuttering invariance, preservation of stuttering invariance
  and introduction of stuttering invariance for different formulas. 
  First, state predicates are stuttering invariant.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> stut_before<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> <span class="main">$</span>F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> seq"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>first <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>first <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sim_first<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">⊨</span> <span class="main">$</span>F<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊨</span> <span class="main">$</span>F<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> before_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Semantics-nstut_after"><span class="command">lemma</span></span> nstut_after<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> F<span class="main">$</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nstutinv_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> seq"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"tail <span class="skolem">s</span> <span class="main">≈</span> tail <span class="skolem">t</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">⊨</span> F<span class="main">$</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊨</span> F<span class="main">$</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> after_def tail_sim_second<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The always operator preserves stuttering invariance.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> stut_always<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> F"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> <span class="main">□</span>F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> seq"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">⊨</span> <span class="main">(</span><span class="main">□</span> F<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊨</span> <span class="main">(</span><span class="main">□</span> F<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊨</span> <span class="main">□</span> F"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="main">□</span> F"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> always_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">from</span></span> a2<span class="main">[</span><span class="operator">THEN</span> sim_step<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> always_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> H m <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="main">(</span><span class="main">□</span> F<span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊨</span> <span class="main">(</span><span class="main">□</span> F<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> always_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">from</span></span> a2<span class="main">[</span><span class="operator">THEN</span> seqsim_sym<span class="main">,</span> <span class="operator">THEN</span> sim_step<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span> <span class="main">≈</span> <span class="skolem">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> always_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> H m <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Assuming that formula <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is nearly suttering invariant
  then <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>□[P]_v›</span></span></span></span> will be stuttering invariant.
›</span></span>

<span class="keyword1" id="Semantics-stut_action_lemma"><span class="command">lemma</span></span> stut_action_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> P"</span></span> <span class="keyword2"><span class="keyword">and</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">⊨</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊨</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> action_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊨</span> <span class="keyword1">Unchanged</span> v<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">(</span><span class="free">s</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unch_defs first_def second_def suffix_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> st<span class="main">[</span><span class="operator">THEN</span> sim_step<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    a2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span> 
          <span class="main">∧</span> <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="skolem">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="skolem">m</span> <span class="main">∨</span> <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="skolem">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> g1''<span class="main">:</span> <span class="quoted"><span class="quoted">"first <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> first <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sim_first<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> g1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">t</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def first_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2' <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="skolem">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="skolem">m</span> <span class="main">∨</span> <span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="skolem">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> a1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span> <span class="main">⊨</span> P<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span> <span class="main">⊨</span> <span class="keyword1">Unchanged</span> v<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> action_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> g2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊨</span> P"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="skolem">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"first <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> first <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sim_first<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def first_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> g1' v <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  <span class="comment1">― ‹by contradiction›</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="skolem">n</span> <span class="main">≈</span> <span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"first <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> first <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> Suc <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sim_first<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> a3'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suffix_def first_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a1' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span> <span class="main">⊨</span> <span class="keyword1">Unchanged</span> v"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">(</span><span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span> <span class="main">(</span><span class="free">t</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unch_defs first_def second_def suffix_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> g1' a3' v <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  <span class="comment1">― ‹again, by contradiction›</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span> <span class="main">⊨</span> P"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tail <span class="main">(</span><span class="free">s</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≈</span> tail <span class="main">(</span><span class="free">t</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tail_def suffix_plus<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> H g1'' a4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nstutinv_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> stut_action<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> P"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> seq"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">⊨</span> <span class="main">□[</span>P<span class="main">]_</span>v<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊨</span> <span class="main">□[</span>P<span class="main">]_</span>v<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊨</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span>
    <span class="keyword1"><span class="command">with</span></span> H st <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stut_action_lemma<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span>
    <span class="keyword1"><span class="command">with</span></span> H st<span class="main">[</span><span class="operator">THEN</span> seqsim_sym<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊨</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stut_action_lemma<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The lemmas below shows that propositional and predicate operators 
  preserve stuttering invariance.
›</span></span>

<span class="keyword1" id="Semantics-stut_and"><span class="command">lemma</span></span> stut_and<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">STUTINV</span> F<span class="main">;</span><span class="keyword1">STUTINV</span> G<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_or"><span class="command">lemma</span></span> stut_or<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">STUTINV</span> F<span class="main">;</span><span class="keyword1">STUTINV</span> G<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_imp"><span class="command">lemma</span></span> stut_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">STUTINV</span> F<span class="main">;</span><span class="keyword1">STUTINV</span> G<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">(</span>F <span class="main">⟶</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_eq"><span class="command">lemma</span></span> stut_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">STUTINV</span> F<span class="main">;</span><span class="keyword1">STUTINV</span> G<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">(</span>F <span class="main">=</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_noteq"><span class="command">lemma</span></span> stut_noteq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">STUTINV</span> F<span class="main">;</span><span class="keyword1">STUTINV</span> G<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">(</span>F <span class="main">≠</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_not"><span class="command">lemma</span></span> stut_not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> F <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">(</span><span class="main">¬</span> F<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_all"><span class="command">lemma</span></span> stut_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">STUTINV</span> <span class="main">(</span>F <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_ex"><span class="command">lemma</span></span> stut_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">STUTINV</span> <span class="main">(</span>F <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_const"><span class="command">lemma</span></span> stut_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> <span class="main">#</span><span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_fun1"><span class="command">lemma</span></span> stut_fun1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> X <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">(</span><span class="free">f</span> <span class="main">&lt;</span>X<span class="main">&gt;</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_fun2"><span class="command">lemma</span></span> stut_fun2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">STUTINV</span> X<span class="main">;</span><span class="keyword1">STUTINV</span> Y<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">(</span><span class="free">f</span> <span class="main">&lt;</span>X<span class="main">,</span>Y<span class="main">&gt;</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_fun3"><span class="command">lemma</span></span> stut_fun3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">STUTINV</span> X<span class="main">;</span><span class="keyword1">STUTINV</span> Y<span class="main">;</span><span class="keyword1">STUTINV</span> Z<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">(</span><span class="free">f</span> <span class="main">&lt;</span>X<span class="main">,</span>Y<span class="main">,</span>Z<span class="main">&gt;</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_fun4"><span class="command">lemma</span></span> stut_fun4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">STUTINV</span> X<span class="main">;</span><span class="keyword1">STUTINV</span> Y<span class="main">;</span><span class="keyword1">STUTINV</span> Z<span class="main">;</span> <span class="keyword1">STUTINV</span> W<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">(</span><span class="free">f</span> <span class="main">&lt;</span>X<span class="main">,</span>Y<span class="main">,</span>Z<span class="main">,</span>W<span class="main">&gt;</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_plus"><span class="command">lemma</span></span> stut_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">STUTINV</span> x<span class="main">;</span><span class="keyword1">STUTINV</span> y<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">(</span>x<span class="main">+</span>y<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">nstutinv</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This subsection shows analogous properties about near stuttering
  invariance.

  If a formula <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is stuttering invariant then <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>○F›</span></span></span></span> is
  nearly stuttering invariant.
›</span></span>

<span class="keyword1" id="Semantics-nstut_nexts"><span class="command">lemma</span></span> nstut_nexts<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> F"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> <span class="main">○</span>F"</span></span>
<span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def nstutinv_def nexts_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The lemmas below shows that propositional and predicate operators 
  preserves near stuttering invariance.
›</span></span>

<span class="keyword1" id="Semantics-nstut_and"><span class="command">lemma</span></span> nstut_and<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">NSTUTINV</span> F<span class="main">;</span><span class="keyword1">NSTUTINV</span> G<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">NSTUTINV</span> <span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nstutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-nstut_or"><span class="command">lemma</span></span> nstut_or<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">NSTUTINV</span> F<span class="main">;</span><span class="keyword1">NSTUTINV</span> G<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">NSTUTINV</span> <span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nstutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-nstut_imp"><span class="command">lemma</span></span> nstut_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">NSTUTINV</span> F<span class="main">;</span><span class="keyword1">NSTUTINV</span> G<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">NSTUTINV</span> <span class="main">(</span>F <span class="main">⟶</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nstutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-nstut_eq"><span class="command">lemma</span></span> nstut_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">NSTUTINV</span> F<span class="main">;</span> <span class="keyword1">NSTUTINV</span> G<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">NSTUTINV</span> <span class="main">(</span>F <span class="main">=</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nstutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-nstut_not"><span class="command">lemma</span></span> nstut_not<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> F <span class="main">⟹</span> <span class="keyword1">NSTUTINV</span> <span class="main">(</span><span class="main">¬</span> F<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nstutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-nstut_noteq"><span class="command">lemma</span></span> nstut_noteq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">NSTUTINV</span> F<span class="main">;</span> <span class="keyword1">NSTUTINV</span> G<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">NSTUTINV</span> <span class="main">(</span>F <span class="main">≠</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nstut_eq nstut_not<span class="main">)</span>

<span class="keyword1" id="Semantics-nstut_all"><span class="command">lemma</span></span> nstut_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">NSTUTINV</span> <span class="main">(</span>F <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">NSTUTINV</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nstutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-nstut_ex"><span class="command">lemma</span></span> nstut_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">NSTUTINV</span> <span class="main">(</span>F <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">NSTUTINV</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nstutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-nstut_const"><span class="command">lemma</span></span> nstut_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> <span class="main">#</span><span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nstutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-nstut_fun1"><span class="command">lemma</span></span> nstut_fun1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> X <span class="main">⟹</span> <span class="keyword1">NSTUTINV</span> <span class="main">(</span><span class="free">f</span> <span class="main">&lt;</span>X<span class="main">&gt;</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nstutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-nstut_fun2"><span class="command">lemma</span></span> nstut_fun2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">NSTUTINV</span> X<span class="main">;</span> <span class="keyword1">NSTUTINV</span> Y<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">NSTUTINV</span> <span class="main">(</span><span class="free">f</span> <span class="main">&lt;</span>X<span class="main">,</span>Y<span class="main">&gt;</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nstutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-nstut_fun3"><span class="command">lemma</span></span> nstut_fun3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">NSTUTINV</span> X<span class="main">;</span> <span class="keyword1">NSTUTINV</span> Y<span class="main">;</span> <span class="keyword1">NSTUTINV</span> Z<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">NSTUTINV</span> <span class="main">(</span><span class="free">f</span> <span class="main">&lt;</span>X<span class="main">,</span>Y<span class="main">,</span>Z<span class="main">&gt;</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nstutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-nstut_fun4"><span class="command">lemma</span></span> nstut_fun4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">NSTUTINV</span> X<span class="main">;</span> <span class="keyword1">NSTUTINV</span> Y<span class="main">;</span> <span class="keyword1">NSTUTINV</span> Z<span class="main">;</span> <span class="keyword1">NSTUTINV</span> W<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">NSTUTINV</span> <span class="main">(</span><span class="free">f</span> <span class="main">&lt;</span>X<span class="main">,</span>Y<span class="main">,</span>Z<span class="main">,</span>W<span class="main">&gt;</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nstutinv_def<span class="main">)</span>

<span class="keyword1" id="Semantics-nstut_plus"><span class="command">lemma</span></span> nstut_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">NSTUTINV</span> x<span class="main">;</span><span class="keyword1">NSTUTINV</span> y<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">NSTUTINV</span> <span class="main">(</span>x<span class="main">+</span>y<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nstut_fun2<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Abbreviations"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We show the obvious fact that the same properties holds for abbreviated
  operators.
›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> nstut_before <span class="main">=</span> stut_before<span class="main">[</span><span class="operator">THEN</span> stutinv_strictly_stronger<span class="main">]</span>

<span class="keyword1" id="Semantics-nstut_unch"><span class="command">lemma</span></span> nstut_unch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> <span class="main">(</span><span class="keyword1">Unchanged</span> v<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> unch_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> v<span class="main">$</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nstut_after<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> <span class="main">$</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stut_before<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> stutinv_strictly_stronger<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> g1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> <span class="main">(</span>v<span class="main">$</span> <span class="main">=</span> <span class="main">$</span>v<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nstut_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Formulas <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>[P]_v›</span></span></span></span> are not \tlastar{} formulas by themselves,
  but we need to reason about them when they appear wrapped
  inside <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>□[-]_v›</span></span></span></span>. We only require that it preserves nearly
  stuttering invariance. Observe that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>[P]_v›</span></span></span></span> trivially holds for
  a stuttering step, so it cannot be stuttering invariant.
›</span></span>

<span class="keyword1" id="Semantics-nstut_actrans"><span class="command">lemma</span></span> nstut_actrans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> P <span class="main">⟹</span> <span class="keyword1">NSTUTINV</span> <span class="main">[</span>P<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> actrans_def nstut_unch nstut_or<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_eventually"><span class="command">lemma</span></span> stut_eventually<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> F <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">◇</span>F"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_def stut_not stut_always<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_leadsto"><span class="command">lemma</span></span> stut_leadsto<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">STUTINV</span> F<span class="main">;</span> <span class="keyword1">STUTINV</span> G<span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">(</span>F <span class="main">↝</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> leadsto_def stut_always stut_eventually stut_imp<span class="main">)</span>

<span class="keyword1" id="Semantics-stut_angle_action"><span class="command">lemma</span></span> stut_angle_action<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> P <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">◇⟨</span>P<span class="main">⟩_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> angle_action_def nstut_not stut_action stut_not<span class="main">)</span>

<span class="keyword1" id="Semantics-nstut_angle_acttrans"><span class="command">lemma</span></span> nstut_angle_acttrans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> P <span class="main">⟹</span> <span class="keyword1">NSTUTINV</span> <span class="main">⟨</span>P<span class="main">⟩_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> angle_actrans_def nstut_not nstut_actrans<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> stutinvs <span class="main">=</span> stut_before stut_always stut_action
  stut_and stut_or stut_imp stut_eq stut_noteq stut_not
  stut_all stut_ex stut_eventually stut_leadsto stut_angle_action stut_const 
  stut_fun1 stut_fun2 stut_fun3 stut_fun4

<span class="keyword1"><span class="command">lemmas</span></span> nstutinvs <span class="main">=</span>  nstut_after nstut_nexts nstut_actrans
  nstut_unch nstut_and nstut_or nstut_imp nstut_eq nstut_noteq nstut_not
  nstut_all nstut_ex nstut_angle_acttrans stutinv_strictly_stronger 
  nstut_fun1 nstut_fun2 nstut_fun3 nstut_fun4 stutinvs<span class="main">[</span><span class="operator">THEN</span> stutinv_strictly_stronger<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> bothstutinvs <span class="main">=</span> stutinvs nstutinvs

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PreFormulas">
<div class="head">
<h1>Theory PreFormulas</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       A Definitional Encoding of TLA in Isabelle/HOL
    Authors:     Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
                 Stephan Merz &lt;Stephan.Merz at loria.fr&gt;
    Year:        2011
    Maintainer:  Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Reasoning about PreFormulas"</span></span>

<span class="keyword1"><span class="command">theory</span></span> PreFormulas  
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Semantics.html">Semantics</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Semantic separation of formulas and pre-formulas requires a deep embedding.
  We introduce a syntactically distinct notion of validity, written <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>|~ A›</span></span></span></span>,
  for pre-formulas. Although it is semantically identical to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊢ A›</span></span></span></span>, it
  helps users distinguish pre-formulas from formulas in \tlastar{} proofs.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">PreValid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'w</span><span class="main">::</span>world<span class="main">)</span> form <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">PreValid</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">⊨</span> A"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_PreValid"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> bool"</span></span>     <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">|~</span> _<span class="keyword3">)</span>"</span> 5<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_PreValid"</span>  <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> PreValid"</span>

<span class="keyword1" id="PreFormulas-prefD"><span class="command">lemma</span></span> prefD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> A <span class="main">⟹</span> <span class="free">w</span> <span class="main">⊨</span> A"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PreValid_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-prefI"><span class="command">lemma</span></span> prefI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">⊨</span> A<span class="main">)</span> <span class="main">⟹</span> <span class="main">|~</span> A"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PreValid_def<span class="main">)</span>

<span class="keyword1"><span class="command">method_setup</span></span> pref_unlift <span class="main">=</span> <span class="quoted">‹
  Scan.succeed <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="entity">SIMPLE_METHOD'</span>
    <span class="main">(</span>resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> prefI<span class="antiquote">}</span></span></span> THEN' rewrite_goal_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> intensional_rews<span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">)</span>
›</span> <span class="quoted">"int_unlift for PreFormulas"</span>

<span class="keyword1" id="PreFormulas-prefeq_reflection"><span class="command">lemma</span></span> prefeq_reflection<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> P1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> x<span class="main">=</span>y"</span></span> <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">≡</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> P1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eq_reflection<span class="main">)</span> <span class="operator">force</span>

<span class="keyword1" id="PreFormulas-pref_True"><span class="command">lemma</span></span> pref_True<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">#</span>True"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="PreFormulas-pref_eq"><span class="command">lemma</span></span> pref_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> X <span class="main">=</span> Y <span class="main">⟹</span> <span class="free">X</span> <span class="main">=</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prefeq_reflection<span class="main">)</span>

<span class="keyword1" id="PreFormulas-pref_iffI"><span class="command">lemma</span></span> pref_iffI<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">⟶</span> G"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> G <span class="main">⟶</span> F"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">=</span> G"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="PreFormulas-pref_iffD1"><span class="command">lemma</span></span> pref_iffD1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">=</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">⟶</span> G"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="PreFormulas-pref_iffD2"><span class="command">lemma</span></span> pref_iffD2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">=</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> G <span class="main">⟶</span> F"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="PreFormulas-unl_pref_imp"><span class="command">lemma</span></span> unl_pref_imp<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">⟶</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">⊨</span> F <span class="main">⟹</span> <span class="bound">w</span> <span class="main">⊨</span> G"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="PreFormulas-pref_imp_trans"><span class="command">lemma</span></span> pref_imp_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">⟶</span> G"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> G <span class="main">⟶</span> H"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">⟶</span> H"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Lemmas about <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Unchanged›</span></span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Many of the \tlastar{} axioms only require a state function witness
  which leaves the state space unchanged. An obvious witness is the
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">id</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> function. The lemmas require that the given formula is
  invariant under stuttering.
›</span></span>

<span class="keyword1" id="PreFormulas-pre_id_unch"><span class="command">lemma</span></span> pre_id_unch<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"stutinv <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">∧</span> <span class="keyword1">Unchanged</span> id <span class="main">⟶</span> <span class="main">○</span>F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">pref_unlift</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> F"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="keyword1">Unchanged</span> id"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>id <span class="main">(</span>second <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> id <span class="main">(</span>first <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unch_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="main">(</span>tail <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> addfirststut<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> h a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tail <span class="skolem">s</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stutinv_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="main">○</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> nexts_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="PreFormulas-pre_ex_unch"><span class="command">lemma</span></span> pre_ex_unch<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"stutinv <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">v</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>world <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span> <span class="main">|~</span> F <span class="main">∧</span> <span class="keyword1">Unchanged</span> v <span class="main">⟶</span> <span class="main">○</span>F<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> pre_id_unch<span class="main">[</span><span class="operator">OF</span> h<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="PreFormulas-unch_pair"><span class="command">lemma</span></span> unch_pair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Unchanged</span> x <span class="main">∧</span> <span class="keyword1">Unchanged</span> y<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unch_def before_def after_def nexts_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> unch_eq1 <span class="main">=</span> unch_pair<span class="main">[</span><span class="operator">THEN</span> pref_eq<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> unch_eq2 <span class="main">=</span> unch_pair<span class="main">[</span><span class="operator">THEN</span> prefeq_reflection<span class="main">]</span>

<span class="keyword1" id="PreFormulas-angle_actrans_sem"><span class="command">lemma</span></span> angle_actrans_sem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span>F<span class="main">⟩_</span>v <span class="main">=</span> <span class="main">(</span>F <span class="main">∧</span> v<span class="main">$</span> <span class="main">≠</span> <span class="main">$</span>v<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> angle_actrans_def actrans_def unch_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> angle_actrans_sem_eq <span class="main">=</span> angle_actrans_sem<span class="main">[</span><span class="operator">THEN</span> pref_eq<span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Lemmas about <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>after›</span></span></span></span>"</span></span>

<span class="keyword1" id="PreFormulas-after_const"><span class="command">lemma</span></span> after_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">(</span><span class="main">#</span><span class="free">c</span><span class="main">)</span><span class="main">`</span> <span class="main">=</span> <span class="main">#</span><span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def before_def after_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-after_fun1"><span class="command">lemma</span></span> after_fun1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="free">f</span><span class="main">&lt;</span>x<span class="main">&gt;</span><span class="main">`</span> <span class="main">=</span> <span class="free">f</span><span class="main">&lt;</span>x<span class="main">`</span><span class="main">&gt;</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def before_def after_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-after_fun2"><span class="command">lemma</span></span> after_fun2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="free">f</span><span class="main">&lt;</span>x<span class="main">,</span>y<span class="main">&gt;</span><span class="main">`</span> <span class="main">=</span> <span class="free">f</span> <span class="main">&lt;</span>x<span class="main">`</span><span class="main">,</span>y<span class="main">`</span><span class="main">&gt;</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def before_def after_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-after_fun3"><span class="command">lemma</span></span> after_fun3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="free">f</span><span class="main">&lt;</span>x<span class="main">,</span>y<span class="main">,</span>z<span class="main">&gt;</span><span class="main">`</span> <span class="main">=</span> <span class="free">f</span> <span class="main">&lt;</span>x<span class="main">`</span><span class="main">,</span>y<span class="main">`</span><span class="main">,</span>z<span class="main">`</span><span class="main">&gt;</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def before_def after_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-after_fun4"><span class="command">lemma</span></span> after_fun4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="free">f</span><span class="main">&lt;</span>x<span class="main">,</span>y<span class="main">,</span>z<span class="main">,</span>zz<span class="main">&gt;</span><span class="main">`</span> <span class="main">=</span> <span class="free">f</span> <span class="main">&lt;</span>x<span class="main">`</span><span class="main">,</span>y<span class="main">`</span><span class="main">,</span>z<span class="main">`</span><span class="main">,</span>zz<span class="main">`</span><span class="main">&gt;</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def before_def after_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-after_forall"><span class="command">lemma</span></span> after_forall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> P <span class="bound">x</span><span class="main">)</span><span class="main">`</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span>P <span class="bound">x</span><span class="main">)</span><span class="main">`</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def before_def after_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-after_exists"><span class="command">lemma</span></span> after_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> P <span class="bound">x</span><span class="main">)</span><span class="main">`</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span>P <span class="bound">x</span><span class="main">)</span><span class="main">`</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def before_def after_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-after_exists1"><span class="command">lemma</span></span> after_exists1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">(</span><span class="main">∃!</span> <span class="bound">x</span><span class="main">.</span> P <span class="bound">x</span><span class="main">)</span><span class="main">`</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃!</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span>P <span class="bound">x</span><span class="main">)</span><span class="main">`</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def before_def after_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> all_after <span class="main">=</span> after_const after_fun1 after_fun2 after_fun3 after_fun4
  after_forall after_exists after_exists1 

<span class="keyword1"><span class="command">lemmas</span></span> all_after_unl <span class="main">=</span> all_after<span class="main">[</span><span class="operator">THEN</span> prefD<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> all_after_eq <span class="main">=</span> all_after<span class="main">[</span><span class="operator">THEN</span> prefeq_reflection<span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Lemmas about <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>before›</span></span></span></span>"</span></span>

<span class="keyword1" id="PreFormulas-before_const"><span class="command">lemma</span></span> before_const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span><span class="main">(</span><span class="main">#</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">#</span><span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> before_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-before_fun1"><span class="command">lemma</span></span> before_fun1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span><span class="main">(</span><span class="free">f</span><span class="main">&lt;</span>x<span class="main">&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">&lt;</span><span class="main">$</span>x<span class="main">&gt;</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> before_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-before_fun2"><span class="command">lemma</span></span> before_fun2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span><span class="main">(</span><span class="free">f</span><span class="main">&lt;</span>x<span class="main">,</span>y<span class="main">&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">&lt;</span><span class="main">$</span>x<span class="main">,</span><span class="main">$</span>y<span class="main">&gt;</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> before_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-before_fun3"><span class="command">lemma</span></span> before_fun3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span><span class="main">(</span><span class="free">f</span><span class="main">&lt;</span>x<span class="main">,</span>y<span class="main">,</span>z<span class="main">&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">&lt;</span><span class="main">$</span>x<span class="main">,</span><span class="main">$</span>y<span class="main">,</span><span class="main">$</span>z<span class="main">&gt;</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> before_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-before_fun4"><span class="command">lemma</span></span> before_fun4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span><span class="main">(</span><span class="free">f</span><span class="main">&lt;</span>x<span class="main">,</span>y<span class="main">,</span>z<span class="main">,</span>zz<span class="main">&gt;</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">&lt;</span><span class="main">$</span>x<span class="main">,</span><span class="main">$</span>y<span class="main">,</span><span class="main">$</span>z<span class="main">,</span><span class="main">$</span>zz<span class="main">&gt;</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> before_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-before_forall"><span class="command">lemma</span></span> before_forall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span><span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> P <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">$</span><span class="main">(</span>P <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> before_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-before_exists"><span class="command">lemma</span></span> before_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span><span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> P <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="main">$</span><span class="main">(</span>P <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> before_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-before_exists1"><span class="command">lemma</span></span> before_exists1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span><span class="main">(</span><span class="main">∃!</span> <span class="bound">x</span><span class="main">.</span> P <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃!</span> <span class="bound">x</span><span class="main">.</span> <span class="main">$</span><span class="main">(</span>P <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> before_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemmas</span></span> all_before <span class="main">=</span> before_const before_fun1 before_fun2 before_fun3 before_fun4
  before_forall before_exists before_exists1

<span class="keyword1"><span class="command">lemmas</span></span> all_before_unl <span class="main">=</span> all_before<span class="main">[</span><span class="operator">THEN</span> intD<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> all_before_eq <span class="main">=</span> all_before<span class="main">[</span><span class="operator">THEN</span> inteq_reflection<span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Some general properties"</span></span>

<span class="keyword1" id="PreFormulas-angle_actrans_conj"><span class="command">lemma</span></span> angle_actrans_conj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">(</span><span class="main">⟨</span>F <span class="main">∧</span> G<span class="main">⟩_</span>v<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span>F<span class="main">⟩_</span>v <span class="main">∧</span> <span class="main">⟨</span>G<span class="main">⟩_</span>v<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> angle_actrans_def actrans_def unch_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-angle_actrans_disj"><span class="command">lemma</span></span> angle_actrans_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">(</span><span class="main">⟨</span>F <span class="main">∨</span> G<span class="main">⟩_</span>v<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span>F<span class="main">⟩_</span>v <span class="main">∨</span> <span class="main">⟨</span>G<span class="main">⟩_</span>v<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> angle_actrans_def actrans_def unch_def<span class="main">)</span>

<span class="keyword1" id="PreFormulas-int_eq_true"><span class="command">lemma</span></span> int_eq_true<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> P <span class="main">⟹</span> <span class="main">⊢</span> P <span class="main">=</span> <span class="main">#</span>True"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="PreFormulas-pref_eq_true"><span class="command">lemma</span></span> pref_eq_true<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">⟹</span> <span class="main">|~</span> P <span class="main">=</span> <span class="main">#</span>True"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Unlifting attributes and methods"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Attribute which unlifts an intensional formula or preformula›</span></span>
<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">unl_rewr</span> <span class="entity">ctxt</span> <span class="entity">thm</span> <span class="main">=</span> 
    <span class="keyword2"><span class="keyword">let</span></span>
       <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">unl</span> <span class="main">=</span> <span class="main">(</span><span class="entity">thm</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> intD<span class="antiquote">}</span></span></span><span class="main">)</span> <span class="keyword3"><span class="keyword">handle</span></span> THM <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">thm</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> prefD<span class="antiquote">}</span></span></span><span class="main">)</span>
                                      <span class="keyword3"><span class="keyword">handle</span></span> THM <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">thm</span>
       <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">rewr</span> <span class="main">=</span> rewrite_rule <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> intensional_rews<span class="antiquote">}</span></span></span> 
     <span class="keyword2"><span class="keyword">in</span></span>
       <span class="entity">unl</span> |&gt; <span class="entity">rewr</span>
     <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
›</span>
<span class="keyword1"><span class="command">attribute_setup</span></span> unlifted <span class="main">=</span> <span class="quoted">‹
  Scan.succeed <span class="main">(</span>Thm.rule_attribute <span class="main">[</span><span class="main">]</span> <span class="main">(</span><span class="entity">unl_rewr</span> o Context.proof_of<span class="main">)</span><span class="main">)</span>
›</span> <span class="quoted">"unlift intensional formulas"</span>

<span class="keyword1"><span class="command">attribute_setup</span></span> unlift_rule <span class="main">=</span> <span class="quoted">‹
  Scan.succeed
    <span class="main">(</span>Thm.rule_attribute <span class="main">[</span><span class="main">]</span>
      <span class="main">(</span>Context.proof_of #&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> Object_Logic.rulify <span class="entity">ctxt</span> o <span class="entity">unl_rewr</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
›</span> <span class="quoted">"unlift and rulify intensional formulas"</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Attribute which turns an intensional formula or preformula into a rewrite rule.
  Formulas <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>F›</span></span></span></span> that are not equalities are turned into <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>F ≡ #True›</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">int_rewr</span> <span class="entity">thm</span> <span class="main">=</span> 
   <span class="main">(</span><span class="entity">thm</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> inteq_reflection<span class="antiquote">}</span></span></span><span class="main">)</span>
     <span class="keyword3"><span class="keyword">handle</span></span> THM <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">thm</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> prefeq_reflection<span class="antiquote">}</span></span></span><span class="main">)</span>
     <span class="keyword3"><span class="keyword">handle</span></span> THM <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">(</span><span class="entity">thm</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> int_eq_true<span class="antiquote">}</span></span></span><span class="main">)</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> inteq_reflection<span class="antiquote">}</span></span></span><span class="main">)</span>
     <span class="keyword3"><span class="keyword">handle</span></span> THM <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">(</span><span class="entity">thm</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> pref_eq_true<span class="antiquote">}</span></span></span><span class="main">)</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> prefeq_reflection<span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">attribute_setup</span></span> simp_unl <span class="main">=</span> <span class="quoted">‹
    <span class="entity">Attrib.add_del</span>
      <span class="main">(</span>Thm.declaration_attribute
        <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">th</span> <span class="main">=&gt;</span> <span class="entity">Simplifier.map_ss</span> <span class="main">(</span><span class="entity">Simplifier.add_simp</span> <span class="main">(</span><span class="entity">int_rewr</span> <span class="entity">th</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>K <span class="main">(</span>NONE<span class="main">,</span> NONE<span class="main">)</span><span class="main">)</span>  <span class="comment1">(* note only adding -- removing is ignored *)</span>
›</span> <span class="quoted">"add thm unlifted from rewrites from intensional formulas or preformulas"</span>

<span class="keyword1"><span class="command">attribute_setup</span></span> int_rewrite <span class="main">=</span> <span class="quoted">‹Scan.succeed <span class="main">(</span>Thm.rule_attribute <span class="main">[</span><span class="main">]</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">int_rewr</span><span class="main">)</span><span class="main">)</span>›</span>
  <span class="quoted">"produce rewrites from intensional formulas or preformulas"</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Rules">
<div class="head">
<h1>Theory Rules</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       A Definitional Encoding of TLA in Isabelle/HOL
    Authors:     Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
                 Stephan Merz &lt;Stephan.Merz at loria.fr&gt;
    Year:        2011
    Maintainer:  Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"A Proof System for TLA* "</span></span>

<span class="keyword1"><span class="command">theory</span></span> Rules 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="PreFormulas.html">PreFormulas</a>  
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We prove soundness of the proof system of \tlastar{}, from which the system
  verification rules from Lamport's original TLA paper will be derived. 
  This theory is still state-independent, thus state-dependent enableness proofs,
  required for proofs based on fairness assumptions, and flexible quantification,
  are not discussed here. 

  The \tlastar{} paper \cite{Merz99} suggest both a \emph{hetereogeneous} and a 
  \emph{homogenous} proof system for \tlastar{}.
  The homogeneous version eliminates the auxiliary definitions from the
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Preformula›</span></span></span></span> theory, creating a single provability relation.
  This axiomatisation is based on the fact that a pre-formula can only be used
  via the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sq›</span></span></span></span> rule. In a nutshell, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sq›</span></span></span></span> is applied to
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pax1›</span></span></span></span> to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pax5›</span></span></span></span>, and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nex›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pre›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pmp›</span></span></span></span>
  are changed to accommodate this. It is argued that while the hetereogenous version
  is easier to understand, the homogenous system avoids the introduction of an
  auxiliary provability relation. However, the price to pay is that reasoning about
  pre-formulas (in particular, actions) has to be performed in the scope of
  temporal operators such as <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>□[P]_v›</span></span></span></span>, which is notationally quite heavy,
  We prefer here the heterogeneous approach, which exposes the pre-formulas and
  lets us use standard HOL rules more directly.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"The Basic Axioms"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> fmp<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> G"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">unlifted</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> pmp<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">⟶</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> G"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">unlifted</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> sq<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">unlifted</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> action_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> pre<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> nex<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span>F"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> ax0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">#</span> True"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> ax1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">⟶</span> F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> always_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">n</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ax2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">□[</span><span class="main">□</span>F<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> always_def action_def suffix_plus<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> ax3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">∧</span> <span class="keyword1">Unchanged</span> v <span class="main">⟶</span> <span class="main">○</span>F"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>F <span class="main">⟶</span> <span class="main">○</span>F<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">(</span>F <span class="main">⟶</span> <span class="main">□</span>F<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> always_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="main">□[</span>F <span class="main">⟶</span> <span class="main">○</span>F<span class="main">]_</span>v"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> F"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">m</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span>
    <span class="keyword1"><span class="command">with</span></span> a1 H<span class="main">[</span><span class="operator">unlifted</span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def action_def tail_suffix_suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ax4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P <span class="main">⟶</span> Q<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">(</span><span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>Q<span class="main">]_</span>v<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> action_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> ax5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>v<span class="main">`</span> <span class="main">≠</span> <span class="main">$</span>v<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> action_def unch_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> pax0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">#</span> True"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> pax1 <span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">(</span><span class="main">○</span><span class="main">¬</span>F<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="main">○</span>F<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> pax2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">(</span>F <span class="main">⟶</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">○</span>F <span class="main">⟶</span> <span class="main">○</span>G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> pax3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">○</span><span class="main">□</span>F"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> always_def nexts_def tail_def suffix_plus<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> pax4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">=</span> <span class="main">(</span><span class="main">[</span>P<span class="main">]_</span>v <span class="main">∧</span> <span class="main">○</span><span class="main">□[</span>P<span class="main">]_</span>v<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> action_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span> <span class="main">⊨</span> P<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">0</span><span class="main">)</span> <span class="main">⊨</span> <span class="keyword1">Unchanged</span> v<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="main">[</span>P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> actrans_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="main">○</span><span class="main">□[</span>P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def action_def tail_def suffix_plus<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="main">[</span>P<span class="main">]_</span>v"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="main">○</span><span class="main">□[</span>P<span class="main">]_</span>v"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> action_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊨</span> <span class="keyword1">Unchanged</span> v<span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊨</span> P"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 1 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> actrans_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 2 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def action_def tail_def suffix_plus<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> pax5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">□</span>F <span class="main">⟶</span> <span class="main">□[</span><span class="main">○</span>F<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def always_def action_def tail_def suffix_plus<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Theorem to show that universal quantification distributes over the always
  operator. Since the \tlastar{} paper only addresses the propositional fragment,
  this theorem does not appear there.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> allT<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">□</span><span class="main">(</span>F <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> always_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> allActT<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">□[</span>F <span class="bound">x</span><span class="main">]_</span>v<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□[</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span><span class="main">]_</span>v<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> action_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Derived Theorems"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This section includes some derived theorems based on the axioms, taken
  from the \tlastar{} paper~\cite{Merz99}. We mimic the proofs given there
  and avoid semantic reasoning whenever possible.

  The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>alw›</span></span></span></span> theorem of~\cite{Merz99} states that if F holds
  in all worlds then it always holds, i.e. $F \vDash \Box F$. However,
  the derivation of this theorem (using the proof rules above) 
  relies on access of the set of free variables (FV), which is not
  available in a shallow encoding.

  However, we can prove a similar rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>alw2›</span></span></span></span> using an additional
  hypothesis <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">|~</span></span> F <span class="main"><span class="main">∧</span></span> <span class="keyword1"><span class="keyword1">Unchanged</span></span> v <span class="main"><span class="main">⟶</span></span> <span class="main"><span class="main">○</span></span>F"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> alw2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">∧</span> <span class="keyword1">Unchanged</span> v <span class="main">⟶</span> <span class="main">○</span>F"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nex<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> g3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">⟶</span> <span class="main">○</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> g4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">(</span>F <span class="main">⟶</span> <span class="main">○</span>F<span class="main">)</span><span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">(</span>F <span class="main">⟶</span> <span class="main">○</span>F<span class="main">)</span><span class="main">]_</span>v <span class="main">⟶</span> F <span class="main">⟶</span> <span class="main">□</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ax3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> g4<span class="main">[</span><span class="operator">unlifted</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> g5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> <span class="main">□</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> h1<span class="main">[</span><span class="operator">unlifted</span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Similar theorem, assuming that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">F</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is stuttering invariant.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> alw3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"stutinv <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">∧</span> <span class="keyword1">Unchanged</span> id <span class="main">⟶</span> <span class="main">○</span>F"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pre_id_unch<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> h1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> alw2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In a deep embedding, we could prove that all (proper) \tlastar{}
  formulas are stuttering invariant and then get rid of the second
  hypothesis of rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>alw3›</span></span></span></span>. In fact, the rule is even true
  for pre-formulas, as shown by the following rule, whose proof relies
  on semantical reasoning.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> alw<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> H1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> always_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> alw_valid_iff_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊢</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊢</span> F<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this ax1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fmp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> alw<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \cite{Merz99} proves the following theorem using the deduction theorem of
  \tlastar{}: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(⊢ F ⟹ ⊢ G) ⟹ ⊢ []F ⟶ G›</span></span></span></span>, which can only be
  proved by induction on the formula structure, in a deep embedding.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> T1<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">□</span>F <span class="main">=</span> <span class="main">[]</span>F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> always_def suffix_plus<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">n</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> T2<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">□[</span>P<span class="main">]_</span>v <span class="main">=</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">○</span><span class="main">□[</span>P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">using</span></span> pax4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">○</span><span class="main">□[</span>P<span class="main">]_</span>v<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">○</span><span class="main">□[</span>P<span class="main">]_</span>v <span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□</span><span class="main">□[</span>P<span class="main">]_</span>v"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ax3<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> 1<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ax1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> T3<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">[</span>P<span class="main">]_</span>v<span class="main">]_</span>v <span class="main">=</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">⟶</span> <span class="main">[</span>P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> actrans_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">(</span>P <span class="main">⟶</span> <span class="main">[</span>P<span class="main">]_</span>v<span class="main">)</span><span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ax4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">[</span>P<span class="main">]_</span>v<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">[</span>P<span class="main">]_</span>v <span class="main">⟶</span> v<span class="main">`</span><span class="main">≠</span> <span class="main">$</span>v <span class="main">⟶</span> P"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unch_def actrans_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">[</span>P<span class="main">]_</span>v <span class="main">⟶</span> v<span class="main">`</span><span class="main">≠</span> <span class="main">$</span>v <span class="main">⟶</span> P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ax5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">[</span>P<span class="main">]_</span>v<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ax4<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> M2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">⟶</span> G"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>F<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>G<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sq<span class="main">[</span><span class="operator">OF</span> h<span class="main">]</span> ax4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">theorem</span></span> N1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> G"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span>F <span class="main">⟶</span> <span class="main">○</span>G"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pmp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nex<span class="main"><span class="main">[</span></span><span class="operator">OF</span> h<span class="main"><span class="main">]</span></span> pax2<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> T4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">[</span>P<span class="main">]_</span>v<span class="main">]_</span>w"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">□</span><span class="main">□[</span>P<span class="main">]_</span>v<span class="main">]_</span>w"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ax2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> pax4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□</span><span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">[</span>P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> T2<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">□</span><span class="main">□[</span>P<span class="main">]_</span>v<span class="main">]_</span>w <span class="main">⟶</span> <span class="main">□[</span><span class="main">[</span>P<span class="main">]_</span>v<span class="main">]_</span>w"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> T2<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> T5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">[</span>P<span class="main">]_</span>w<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">[</span>P<span class="main">]_</span>v<span class="main">]_</span>w"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">[</span><span class="main">[</span>P<span class="main">]_</span>w<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">[</span><span class="main">[</span>P<span class="main">]_</span>v<span class="main">]_</span>w"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> actrans_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">[</span><span class="main">[</span>P<span class="main">]_</span>w<span class="main">]_</span>v<span class="main">]_</span>w <span class="main">⟶</span> <span class="main">□[</span><span class="main">[</span><span class="main">[</span>P<span class="main">]_</span>v<span class="main">]_</span>w<span class="main">]_</span>w"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> T4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> T3<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> T6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">□[</span><span class="main">○</span>F<span class="main">]_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ax1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">(</span><span class="main">□</span>F <span class="main">⟶</span> F<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nex<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> pax2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">□</span>F <span class="main">⟶</span> <span class="main">○</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> pax3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">○</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pref_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">□</span>F<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">○</span>F<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ax2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> T7<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">∧</span> <span class="keyword1">Unchanged</span> v <span class="main">⟶</span> <span class="main">○</span>F"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">(</span>F <span class="main">∧</span> <span class="main">○</span><span class="main">□</span>F<span class="main">)</span> <span class="main">=</span> <span class="main">□</span>F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">○</span>F <span class="main">⟶</span> F <span class="main">⟶</span> <span class="main">○</span>F<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sq<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> ax4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">○</span>F<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">(</span>F <span class="main">⟶</span> <span class="main">○</span>F<span class="main">)</span><span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> ax3<span class="main">[</span><span class="operator">OF</span> h<span class="main">,</span> <span class="operator">unlifted</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">○</span>F<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">(</span>F <span class="main">⟶</span> <span class="main">□</span>F<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> pax5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">∧</span> <span class="main">○</span><span class="main">□</span>F <span class="main">⟶</span> <span class="main">□</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> ax1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> F"</span></span><span class="main">,</span><span class="operator">unlifted</span><span class="main">]</span> pax3<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> F"</span></span><span class="main">,</span><span class="operator">unlifted</span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> T8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">○</span>F <span class="main">∧</span> <span class="main">○</span>G<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">○</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">○</span>G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> G <span class="main">⟶</span> F <span class="main">∧</span> G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> nex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span>F <span class="main">⟶</span> <span class="main">○</span>G <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pax2<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-T9"><span class="command">lemma</span></span> T9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□[</span>A<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">[</span>A<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pax4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">theorem</span></span> H1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P <span class="main">⟶</span> Q<span class="main">]_</span>v"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>Q<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ax4<span class="main">[</span><span class="operator">unlifted</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">theorem</span></span> H2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>F<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">using</span></span> h1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> pre sq<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> H3<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P <span class="main">⟶</span> Q<span class="main">]_</span>v"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>Q <span class="main">⟶</span> R<span class="main">]_</span>v"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P <span class="main">⟶</span> R<span class="main">]_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">(</span>P <span class="main">⟶</span> Q<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>Q <span class="main">⟶</span> R<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>P <span class="main">⟶</span> R<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">(</span>P <span class="main">⟶</span> Q<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>Q <span class="main">⟶</span> R<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>P <span class="main">⟶</span> R<span class="main">)</span><span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">(</span>Q <span class="main">⟶</span> R<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>P <span class="main">⟶</span> R<span class="main">)</span><span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> H1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> H1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> H4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">[</span>P<span class="main">]_</span>v <span class="main">⟶</span> P<span class="main">]_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> v<span class="main">`</span> <span class="main">≠</span> <span class="main">$</span>v <span class="main">⟶</span> <span class="main">(</span><span class="main">[</span>P<span class="main">]_</span>v <span class="main">⟶</span> P<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unch_def actrans_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>v<span class="main">`</span> <span class="main">≠</span> <span class="main">$</span>v <span class="main">⟶</span> <span class="main">(</span><span class="main">[</span>P<span class="main">]_</span>v <span class="main">⟶</span> P<span class="main">)</span><span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ax5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> H1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> H5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">□</span>F <span class="main">⟶</span> <span class="main">○</span><span class="main">□</span>F<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pax3<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sq<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Some other useful derived theorems"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> P1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">○</span>F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">□</span>F <span class="main">⟶</span> <span class="main">○</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ax1<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> pax3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pref_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> P2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□</span>F <span class="main">⟶</span> F <span class="main">∧</span> <span class="main">○</span>F"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ax1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> P1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">theorem</span></span> P4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">□[</span>F<span class="main">]_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">□</span>F<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>F<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> pre<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ax1<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ax2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> P5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">□[</span>P<span class="main">]_</span>v<span class="main">]_</span>w"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">□[</span>P<span class="main">]_</span>v<span class="main">]_</span>w"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> P4<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> T2<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> M0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">□[</span>F <span class="main">⟶</span> <span class="main">○</span>F<span class="main">]_</span>v"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> P1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□</span>F <span class="main">⟶</span> F <span class="main">⟶</span> <span class="main">○</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">□</span>F<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>F <span class="main">⟶</span> <span class="main">○</span>F<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ax2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> M1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">□[</span>F <span class="main">∧</span> <span class="main">○</span>F<span class="main">]_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□</span>F <span class="main">⟶</span> F <span class="main">∧</span> <span class="main">○</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> P2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">□</span>F<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>F <span class="main">∧</span> <span class="main">○</span>F<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ax2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> M3<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">○</span>F<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">using</span></span> alw<span class="main">[</span><span class="operator">OF</span> h<span class="main">]</span> T6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fmp<span class="main">)</span>

<span class="keyword1" id="Rules-M4"><span class="command">lemma</span></span> M4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">○</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">○</span>F <span class="main">∧</span> <span class="main">○</span>G<span class="main">)</span><span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> T8<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> M5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">○</span><span class="main">□[</span>P<span class="main">]_</span>v <span class="main">]_</span>w"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">○</span><span class="main">□[</span>P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pax4<span class="main"><span class="main">[</span></span><span class="operator">unlifted</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> M6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>F <span class="main">∧</span> G<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>F<span class="main">]_</span>v <span class="main">∧</span> <span class="main">□[</span>G<span class="main">]_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>F <span class="main">∧</span> G<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>F<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>F <span class="main">∧</span> G<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>G<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> M7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>F<span class="main">]_</span>v <span class="main">∧</span> <span class="main">□[</span>G<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>F <span class="main">∧</span> G<span class="main">]_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">⟶</span> G <span class="main">⟶</span> F <span class="main">∧</span> G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>F<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>G <span class="main">⟶</span> F <span class="main">∧</span> G<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ax4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> M8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>F <span class="main">∧</span> G<span class="main">]_</span>v <span class="main">=</span> <span class="main">(</span><span class="main">□[</span>F<span class="main">]_</span>v <span class="main">∧</span> <span class="main">□[</span>G<span class="main">]_</span>v<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> int_iffI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> M6 M7<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> M9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□</span>F <span class="main">⟶</span> F <span class="main">∧</span> <span class="main">○</span><span class="main">□</span>F"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pre<span class="main">[</span><span class="operator">OF</span> ax1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> pax3<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">theorem</span></span> M10<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">∧</span> <span class="keyword1">Unchanged</span> v <span class="main">⟶</span> <span class="main">○</span>F"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">∧</span> <span class="main">○</span><span class="main">□</span>F <span class="main">⟶</span> <span class="main">□</span>F"</span></span>
  <span class="keyword1"><span class="command">using</span></span> T7<span class="main">[</span><span class="operator">OF</span> h<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> M11<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">[</span>A<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">[</span>B<span class="main">]_</span>g"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>A<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">□[</span>B<span class="main">]_</span>g"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">[</span>A<span class="main">]_</span>f<span class="main">]_</span>g <span class="main">⟶</span> <span class="main">□[</span><span class="main">[</span>B<span class="main">]_</span>g<span class="main">]_</span>g"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> T4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> M12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">□[</span>A<span class="main">]_</span>f <span class="main">∧</span> <span class="main">□[</span>B<span class="main">]_</span>g<span class="main">)</span> <span class="main">=</span> <span class="main">□[</span><span class="main">[</span>A<span class="main">]_</span>f <span class="main">∧</span> <span class="main">[</span>B<span class="main">]_</span>g<span class="main">]_</span><span class="main">(</span>f<span class="main">,</span>g<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>A<span class="main">]_</span>f <span class="main">∧</span> <span class="main">□[</span>B<span class="main">]_</span>g <span class="main">⟶</span> <span class="main">□[</span><span class="main">[</span>A<span class="main">]_</span>f <span class="main">∧</span> <span class="main">[</span>B<span class="main">]_</span>g<span class="main">]_</span><span class="main">(</span>f<span class="main">,</span>g<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M8<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> T4<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">[</span><span class="main">[</span>A<span class="main">]_</span>f <span class="main">∧</span> <span class="main">[</span>B<span class="main">]_</span>g<span class="main">]_</span><span class="main">(</span>f<span class="main">,</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="main">[</span>A<span class="main">]_</span>f"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> actrans_def unch_def all_before_eq all_after_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">[</span>A<span class="main">]_</span>f <span class="main">∧</span> <span class="main">[</span>B<span class="main">]_</span>g<span class="main">]_</span><span class="main">(</span>f<span class="main">,</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="main">□[</span>A<span class="main">]_</span>f"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M11<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">[</span><span class="main">[</span>A<span class="main">]_</span>f <span class="main">∧</span> <span class="main">[</span>B<span class="main">]_</span>g<span class="main">]_</span><span class="main">(</span>f<span class="main">,</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="main">[</span>B<span class="main">]_</span>g"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> actrans_def unch_def all_before_eq all_after_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">[</span>A<span class="main">]_</span>f <span class="main">∧</span> <span class="main">[</span>B<span class="main">]_</span>g<span class="main">]_</span><span class="main">(</span>f<span class="main">,</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="main">□[</span>B<span class="main">]_</span>g"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M11<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now derive Lamport's 6 simple temporal logic rules (STL1)-(STL6) \cite{Lamport94}.
  Firstly, STL1 is the same as <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> alw<span class="antiquote"><span class="antiquote">}</span></span></span></span> derived above.
›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> STL1 <span class="main">=</span> alw

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  STL2 and STL3 have also already been derived.
›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> STL2 <span class="main">=</span> ax1 

<span class="keyword1"><span class="command">lemmas</span></span> STL3 <span class="main">=</span> T1

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  As with the derivation of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> alw<span class="antiquote"><span class="antiquote">}</span></span></span></span>, a purely syntactic derivation of 
  (STL4) relies on an additional argument -- either using <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Unchanged›</span></span></span></span>
  or <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>STUTINV›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> STL4_2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> G"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> G <span class="main">∧</span> <span class="keyword1">Unchanged</span> v <span class="main">⟶</span> <span class="main">○</span>G"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">□</span>G"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ax1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">⟶</span> G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span>F <span class="main">⟶</span> <span class="main">○</span>G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span>F <span class="main">⟶</span> G <span class="main">⟶</span> <span class="main">○</span>G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">○</span>F<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>G <span class="main">⟶</span> <span class="main">○</span>G<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> T6 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">□[</span>G <span class="main">⟶</span> <span class="main">○</span>G<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>G <span class="main">⟶</span> <span class="main">○</span>G<span class="main">]_</span>v <span class="main">⟶</span> G <span class="main">⟶</span> <span class="main">□</span>G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ax3<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-STL4_3"><span class="command">lemma</span></span> STL4_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> G"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> G"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">□</span>G"</span></span>
<span class="keyword1"><span class="command">using</span></span> h1 h2<span class="main">[</span><span class="operator">THEN</span> pre_id_unch<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4_2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Of course, the original rule can be derived semantically›</span></span>

<span class="keyword1" id="Rules-STL4"><span class="command">lemma</span></span> STL4<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">□</span>G"</span></span>
  <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> always_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Dual rule for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>◇›</span></span></span></span>›</span></span>

<span class="keyword1" id="Rules-STL4_eve"><span class="command">lemma</span></span> STL4_eve<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span>F <span class="main">⟶</span> <span class="main">◇</span>G"</span></span>
  <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_defs<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Similarly, a purely syntactic derivation of (STL5) requires extra hypotheses.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> STL5_2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">∧</span> <span class="keyword1">Unchanged</span> f <span class="main">⟶</span> <span class="main">○</span>F"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> G <span class="main">∧</span> <span class="keyword1">Unchanged</span> g <span class="main">⟶</span> <span class="main">○</span>G"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span>G<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> int_iffI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">∧</span> G <span class="main">⟶</span> F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">∧</span> G <span class="main">⟶</span> G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span>G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4_2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span>G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>f<span class="main">,</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Unchanged</span> f <span class="main">∧</span> <span class="keyword1">Unchanged</span> g"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unch_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> h1<span class="main">[</span><span class="operator">unlifted</span><span class="main">]</span> h2<span class="main">[</span><span class="operator">unlifted</span><span class="main">]</span> T8<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">,</span> <span class="operator">unlifted</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">∧</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>f<span class="main">,</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> ax1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> ax1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span>G <span class="main">⟶</span> F <span class="main">∧</span> G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> ax2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> ax2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span>G <span class="main">⟶</span> <span class="main">□[</span><span class="main">□</span>F<span class="main">]_</span><span class="main">(</span>f<span class="main">,</span>g<span class="main">)</span> <span class="main">∧</span> <span class="main">□[</span><span class="main">□</span>G<span class="main">]_</span><span class="main">(</span>f<span class="main">,</span>g<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> M8 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span>G <span class="main">⟶</span> <span class="main">□[</span><span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span>G<span class="main">]_</span><span class="main">(</span>f<span class="main">,</span>g<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> P1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> P1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span>G <span class="main">⟶</span> F <span class="main">∧</span> G <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> T8<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span>G <span class="main">]_</span><span class="main">(</span>f<span class="main">,</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="main">□[</span>F <span class="main">∧</span> G <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span><span class="main">]_</span><span class="main">(</span>f<span class="main">,</span>g<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this ax3<span class="main">[</span><span class="operator">OF</span> h3<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span>G <span class="main">]_</span><span class="main">(</span>f<span class="main">,</span>g<span class="main">)</span> <span class="main">⟶</span> F <span class="main">∧</span> G <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span>G <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> STL5_21<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"stutinv <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"stutinv <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span>G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> h1<span class="main">[</span><span class="operator">THEN</span> pre_id_unch<span class="main">]</span> h2<span class="main">[</span><span class="operator">THEN</span> pre_id_unch<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL5_2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We also derive STL5 semantically.›</span></span>

<span class="keyword1" id="Rules-STL5"><span class="command">lemma</span></span> STL5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span>G<span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> always_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Elimination rule corresponding to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>STL5›</span></span></span></span> in unlifted form.›</span></span>

<span class="keyword1" id="Rules-box_conjE"><span class="command">lemma</span></span> box_conjE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊨</span> <span class="main">□</span>F"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊨</span> <span class="main">□</span>G"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊨</span> <span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">unlifted</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Rules-box_thin"><span class="command">lemma</span></span> box_thin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊨</span> <span class="main">□</span>F"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">PROP</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">PROP</span> <span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> h2 <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally, we derive STL6 (only semantically)›</span></span>

<span class="keyword1" id="Rules-STL6"><span class="command">lemma</span></span> STL6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span><span class="main">□</span>F <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span>G<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="main">◇</span><span class="main">□</span>F"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="main">◇</span><span class="main">□</span>G"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nf</span></span> <span class="keyword2"><span class="keyword">where</span></span> nf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">nf</span><span class="main">)</span> <span class="main">⊨</span> <span class="main">□</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ng</span></span> <span class="keyword2"><span class="keyword">where</span></span> ng<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="skolem">ng</span><span class="main">)</span> <span class="main">⊨</span> <span class="main">□</span>G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="skolem">nf</span> <span class="skolem">ng</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nf</span> <span class="main">≤</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this nf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="var">?n</span><span class="main">)</span> <span class="main">⊨</span> <span class="main">□</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> linalw<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ng</span> <span class="main">≤</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this ng <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="var">?n</span><span class="main">)</span> <span class="main">⊨</span> <span class="main">□</span>G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> linalw<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span> <span class="keyword1">|<span class="hidden">⇩</span><sub>s</sub></span> <span class="var">?n</span><span class="main">)</span> <span class="main">⊨</span> <span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> box_conjE<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_defs<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">∧</span> G <span class="main">⟶</span> F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4_eve<span class="main"><span class="main">[</span></span><span class="operator">OF</span> STL4<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> h <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="main">◇</span><span class="main">□</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">∧</span> G <span class="main">⟶</span> G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span>G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4_eve<span class="main"><span class="main">[</span></span><span class="operator">OF</span> STL4<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> h <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="main">◇</span><span class="main">□</span>G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-MM0"><span class="command">lemma</span></span> MM0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">⟶</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">□</span>G"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> <span class="main">(</span>F <span class="main">⟶</span> G<span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span>G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-MM1"><span class="command">lemma</span></span> MM1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">=</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">=</span> <span class="main">□</span>G"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  
<span class="keyword1"><span class="command">theorem</span></span> MM2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>A <span class="main">∧</span> <span class="main">□</span><span class="main">(</span>B <span class="main">⟶</span> C<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span>A <span class="main">∧</span> B <span class="main">⟶</span> C<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>A <span class="main">∧</span> <span class="main">(</span>B <span class="main">⟶</span> C<span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span>A <span class="main">∧</span> B <span class="main">⟶</span> C<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> MM3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">¬</span>A <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span>A <span class="main">∧</span> B <span class="main">⟶</span> C<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> MM4<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">#</span><span class="free">F</span> <span class="main">=</span> <span class="main">#</span><span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">#</span><span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">#</span><span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> alw<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span> <span class="main">#</span><span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ax1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span> <span class="main">#</span><span class="free">F</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">□</span><span class="main">#</span><span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_neg<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> MM4b<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">¬</span><span class="main">#</span><span class="free">F</span> <span class="main">=</span> <span class="main">¬</span><span class="main">#</span><span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span><span class="main">#</span><span class="free">F</span> <span class="main">=</span> <span class="main">#</span><span class="main">(</span><span class="main">¬</span><span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">¬</span><span class="main">#</span><span class="free">F</span> <span class="main">=</span> <span class="main">□</span><span class="main">#</span><span class="main">(</span><span class="main">¬</span><span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> MM1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> MM5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">∨</span> <span class="main">□</span>G <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>G <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> MM6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">∨</span> <span class="main">□</span>G <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span>F <span class="main">∨</span> <span class="main">□</span>G<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">□</span>F <span class="main">∨</span> <span class="main">□</span><span class="main">□</span>G <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span>F <span class="main">∨</span> <span class="main">□</span>G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> MM5<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-MM10"><span class="command">lemma</span></span> MM10<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">=</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>F<span class="main">]_</span>v <span class="main">=</span> <span class="main">□[</span>G<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Rules-MM9"><span class="command">lemma</span></span> MM9<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">=</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>F<span class="main">]_</span>v <span class="main">=</span> <span class="main">□[</span>G<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> MM10<span class="main"><span class="main">[</span></span><span class="operator">OF</span> pre<span class="main"><span class="main">[</span></span><span class="operator">OF</span> h<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> MM11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">¬</span><span class="main">(</span>P <span class="main">∧</span> Q<span class="main">)</span><span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>P <span class="main">∧</span> <span class="main">¬</span>Q<span class="main">]_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">¬</span><span class="main">(</span>P <span class="main">∧</span> Q<span class="main">)</span><span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>P <span class="main">⟶</span> P <span class="main">∧</span> <span class="main">¬</span>Q<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this ax4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> MM12<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">□[</span>P<span class="main">]_</span>v<span class="main">]_</span>v <span class="main">=</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> int_iffI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">[</span>P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pax4<span class="main"><span class="main">[</span></span><span class="operator">unlifted</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">□[</span>P<span class="main">]_</span>v<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">[</span>P<span class="main">]_</span>v<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">□[</span>P<span class="main">]_</span>v<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> T3<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">□</span><span class="main">□[</span>P<span class="main">]_</span>v<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ax2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">□[</span>P<span class="main">]_</span>v<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Theorems about the eventually operator"</span></span>

<span class="comment1">― ‹rules to push negation inside modal operators, sometimes useful for rewriting›</span>
<span class="keyword1"><span class="command">theorem</span></span> dualization<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span><span class="main">□</span>F <span class="main">=</span> <span class="main">◇</span><span class="main">¬</span>F"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span><span class="main">◇</span>F <span class="main">=</span> <span class="main">□</span><span class="main">¬</span>F"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span><span class="main">□[</span>A<span class="main">]_</span>v <span class="main">=</span> <span class="main">◇⟨</span><span class="main">¬</span>A<span class="main">⟩_</span>v"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">=</span> <span class="main">□[</span><span class="main">¬</span>A<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_def angle_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span> 

<span class="keyword1"><span class="command">lemmas</span></span> dualization_rew <span class="main">=</span> dualization<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> dualization_unl <span class="main">=</span> dualization<span class="main">[</span><span class="operator">unlifted</span><span class="main">]</span>

<span class="keyword1"><span class="command">theorem</span></span> E1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span>F <span class="main">∨</span> <span class="main">◇</span>G<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">¬</span><span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">□</span><span class="main">(</span><span class="main">¬</span>F <span class="main">∧</span> <span class="main">¬</span>G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> MM1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_def STL5<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> E3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> <span class="main">◇</span>F"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ax1<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> E4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">◇</span>F"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ax1 E3<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> E5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">□</span><span class="main">◇</span>F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">□</span>F <span class="main">⟶</span> <span class="main">□</span><span class="main">◇</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main"><span class="main">[</span></span><span class="operator">OF</span> E4<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> E6<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span>F"</span></span>
  <span class="keyword1"><span class="command">using</span></span> E4<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> <span class="main">□</span>F"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">theorem</span></span> E7<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">¬</span>F <span class="main">∧</span> <span class="keyword1">Unchanged</span> v <span class="main">⟶</span> <span class="main">○</span><span class="main">¬</span>F"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">◇</span>F <span class="main">⟶</span> F <span class="main">∨</span> <span class="main">○</span><span class="main">◇</span>F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">¬</span>F <span class="main">∧</span> <span class="main">○</span><span class="main">□</span><span class="main">¬</span>F <span class="main">⟶</span> <span class="main">□</span><span class="main">¬</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M10<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> E8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">(</span>F <span class="main">⟶</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">◇</span>G"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">∧</span> <span class="main">¬</span>G<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">¬</span><span class="main">(</span>F <span class="main">⟶</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_def STL5<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> E9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">⟶</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span>F <span class="main">⟶</span> <span class="main">◇</span>G"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">⟶</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">¬</span>G <span class="main">⟶</span> <span class="main">¬</span>F<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> MM0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> <span class="main">¬</span>G"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> <span class="main">¬</span>F"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> E10<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">◇</span>F <span class="main">=</span> <span class="main">◇</span>F"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> E22<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">=</span> G"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span>F <span class="main">=</span> <span class="main">◇</span>G"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> E15<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">#</span><span class="free">F</span> <span class="main">=</span> <span class="main">#</span><span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> E15b<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">¬</span><span class="main">#</span><span class="free">F</span> <span class="main">=</span> <span class="main">¬</span><span class="main">#</span><span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> E16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span>F <span class="main">⟶</span> <span class="main">◇</span>F"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4_eve<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ax1<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹An action version of STL6›</span></span>

<span class="keyword1" id="Rules-STL6_act"><span class="command">lemma</span></span> STL6_act<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">(</span><span class="main">□[</span>F<span class="main">]_</span>v <span class="main">∧</span> <span class="main">□[</span>G<span class="main">]_</span>w<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">◇</span><span class="main">□[</span>F<span class="main">]_</span>v <span class="main">∧</span> <span class="main">◇</span><span class="main">□[</span>G<span class="main">]_</span>w<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">◇</span><span class="main">□</span><span class="main">(</span><span class="main">□[</span>F<span class="main">]_</span>v <span class="main">∧</span> <span class="main">□[</span>G<span class="main">]_</span>w<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">◇</span><span class="main">(</span><span class="main">□</span><span class="main">□[</span>F<span class="main">]_</span>v <span class="main">∧</span> <span class="main">□</span><span class="main">□[</span>G<span class="main">]_</span>w<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> E22<span class="main"><span class="main">[</span></span><span class="operator">OF</span> STL5<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> STL6<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-SE1"><span class="command">lemma</span></span> SE1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">◇</span>G <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">□</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">¬</span><span class="main">(</span><span class="main">□</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span>F <span class="main">⟶</span> <span class="main">¬</span>G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> MM0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-SE2"><span class="command">lemma</span></span> SE2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">◇</span>G <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">∧</span> G <span class="main">⟶</span> F <span class="main">∧</span> G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> ax1<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">(</span><span class="main">□</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4_eve<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> SE1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-SE3"><span class="command">lemma</span></span> SE3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">◇</span>G <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span>G <span class="main">∧</span> F<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span>G <span class="main">∧</span> F<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4_eve<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> SE2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-SE4"><span class="command">lemma</span></span> SE4<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊨</span> <span class="main">□</span>F"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊨</span> <span class="main">◇</span>G"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>F <span class="main">∧</span> G <span class="main">⟶</span> H"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊨</span> <span class="main">◇</span>H"</span></span>
  <span class="keyword1"><span class="command">using</span></span> h1 h2 h3<span class="main">[</span><span class="operator">THEN</span> STL4_eve<span class="main">]</span> SE1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">theorem</span></span> E17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">◇</span><span class="main">□</span>F <span class="main">⟶</span> <span class="main">□</span><span class="main">◇</span>F"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main"><span class="main">[</span></span><span class="operator">OF</span> STL4_eve<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ax1<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> E18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">◇</span><span class="main">□</span>F <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span>F"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ax1<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> E19<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span>F <span class="main">⟶</span> <span class="main">□</span><span class="main">◇</span><span class="main">□</span>F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">□</span>F <span class="main">∧</span> <span class="main">¬</span><span class="main">□</span>F<span class="main">)</span> <span class="main">=</span> <span class="main">#</span>False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span><span class="main">□</span>F <span class="main">∧</span> <span class="main">¬</span><span class="main">□</span>F<span class="main">)</span> <span class="main">=</span> <span class="main">◇</span><span class="main">□</span><span class="main">#</span>False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> E22<span class="main"><span class="main">[</span></span><span class="operator">OF</span> MM1<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> STL6<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> E20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span>F <span class="main">⟶</span> <span class="main">□</span><span class="main">◇</span>F"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> E19 E17<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> E21<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">◇</span><span class="main">□</span>F <span class="main">=</span> <span class="main">◇</span><span class="main">□</span>F"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> int_iffI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> E18 E19<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> E27<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span><span class="main">◇</span>F <span class="main">=</span> <span class="main">□</span><span class="main">◇</span>F"</span></span>
  <span class="keyword1"><span class="command">using</span></span> E21 <span class="keyword1"><span class="command">unfolding</span></span> eventually_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rules-E28"><span class="command">lemma</span></span> E28<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span><span class="main">◇</span>G <span class="main">⟶</span> <span class="main">□</span><span class="main">◇</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span><span class="main">□</span>F <span class="main">∧</span> <span class="main">◇</span>G<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span><span class="main">◇</span><span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4_eve<span class="main"><span class="main">[</span></span><span class="operator">OF</span> STL4<span class="main"><span class="main">[</span></span><span class="operator">OF</span> SE2<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> STL6<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-E23"><span class="command">lemma</span></span> E23<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span>F <span class="main">⟶</span> <span class="main">◇</span>F"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_def<span class="main">)</span>

<span class="keyword1" id="Rules-E24"><span class="command">lemma</span></span> E24<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span>Q <span class="main">⟶</span> <span class="main">□[</span><span class="main">◇</span>Q<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> E20 P4<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Rules-E25"><span class="command">lemma</span></span> E25<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇</span>A"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_def angle_action_def<span class="main">)</span>

<span class="keyword1" id="Rules-E26"><span class="command">lemma</span></span> E26<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">□</span><span class="main">◇</span>A"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main"><span class="main">[</span></span><span class="operator">OF</span> E25<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Rules-allBox"><span class="command">lemma</span></span> allBox<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">⊨</span> <span class="main">□</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span> <span class="main">⊨</span> <span class="main">□</span><span class="main">(</span>F <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> allT<span class="main">[</span><span class="operator">unlifted</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Rules-E29"><span class="command">lemma</span></span> E29<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">◇</span>F <span class="main">⟶</span> <span class="main">◇</span>F"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_def <span class="keyword1"><span class="command">using</span></span> pax3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rules-E30"><span class="command">lemma</span></span> E30<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> <span class="main">□</span>F"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span>F"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span>F"</span></span>
  <span class="keyword1"><span class="command">using</span></span> h2 h1<span class="main">[</span><span class="operator">THEN</span> STL4_eve<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fmp<span class="main">)</span>

<span class="keyword1" id="Rules-E31"><span class="command">lemma</span></span> E31<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">⟶</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> <span class="main">◇</span>F <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span>F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">⟶</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> <span class="main">◇</span>F <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">□</span><span class="main">(</span>F <span class="main">⟶</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> F<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SE1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">⟶</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> F <span class="main">⟶</span> <span class="main">□</span>F"</span></span> <span class="keyword1"><span class="command">using</span></span> ax1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> F <span class="main">⟶</span> <span class="main">□</span>F"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">(</span><span class="main">□</span><span class="main">(</span>F <span class="main">⟶</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> F<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4_eve<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-allActBox"><span class="command">lemma</span></span> allActBox<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">⊨</span> <span class="main">□[</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span><span class="main">]_</span>v<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">s</span> <span class="main">⊨</span> <span class="main">□[</span><span class="main">(</span>F <span class="bound">x</span><span class="main">)</span><span class="main">]_</span>v<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> allActT<span class="main">[</span><span class="operator">unlifted</span><span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">theorem</span></span> exEE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">◇</span><span class="main">(</span>F <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">◇</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="main">◇</span><span class="main">(</span>F <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">¬</span><span class="main">◇</span><span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_def Not_Rex<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> allBox<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> exActE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">◇⟨</span>F <span class="bound">x</span><span class="main">⟩_</span>v<span class="main">)</span> <span class="main">=</span> <span class="main">◇⟨</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span><span class="main">⟩_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">◇⟨</span>F <span class="bound">x</span><span class="main">⟩_</span>v<span class="main">)</span> <span class="main">=</span> <span class="main">¬</span><span class="main">◇⟨</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span><span class="main">⟩_</span>v"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> angle_action_def Not_Rex<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> allActBox<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Theorems about the leadsto operator"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> LT1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">↝</span> F"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> leadsto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> alw<span class="main"><span class="main">[</span></span><span class="operator">OF</span> E3<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> LT2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> <span class="main">◇</span>G"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> h E3<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> LT3<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">↝</span> G"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> leadsto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> alw<span class="main"><span class="main">[</span></span><span class="operator">OF</span> LT2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> h<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> LT4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> <span class="main">(</span>F <span class="main">↝</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span>G"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> leadsto_def <span class="keyword1"><span class="command">using</span></span> ax1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> F <span class="main">⟶</span> <span class="main">◇</span>G"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> LT5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">⟶</span> <span class="main">◇</span>G<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span>F <span class="main">⟶</span> <span class="main">◇</span>G"</span></span>
  <span class="keyword1"><span class="command">using</span></span> E9<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> <span class="main">◇</span>G"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">theorem</span></span> LT6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span>F <span class="main">⟶</span> <span class="main">(</span>F <span class="main">↝</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span>G"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> leadsto_def <span class="keyword1"><span class="command">using</span></span> LT5<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> LT9<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">↝</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>F <span class="main">↝</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> leadsto_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> LT7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">◇</span>F <span class="main">⟶</span> <span class="main">(</span>F <span class="main">↝</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">◇</span>G"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">◇</span>F <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">(</span>F <span class="main">↝</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span>G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main"><span class="main">[</span></span><span class="operator">OF</span> LT6<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> lift_imp_trans<span class="main">[</span><span class="operator">OF</span> this MM0<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> LT8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">◇</span>G <span class="main">⟶</span> <span class="main">(</span>F <span class="main">↝</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> leadsto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> LT13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>F <span class="main">↝</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>G <span class="main">↝</span> H<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>F <span class="main">↝</span> H<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span>G <span class="main">⟶</span> <span class="main">(</span>G <span class="main">↝</span> H<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span>H"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LT6<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">⟶</span> <span class="main">◇</span>G<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">(</span>G <span class="main">↝</span> H<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>F <span class="main">⟶</span> <span class="main">◇</span>H<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> STL4<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> lift_imp_trans<span class="main">[</span><span class="operator">OF</span> this MM0<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> leadsto_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> LT11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>F <span class="main">↝</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>F <span class="main">↝</span> <span class="main">(</span>G <span class="main">∨</span> H<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> G <span class="main">↝</span> <span class="main">(</span>G <span class="main">∨</span> H<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LT3<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> LT13<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> <span class="main">(</span>G <span class="main">∨</span> H<span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> LT12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>F <span class="main">↝</span> H<span class="main">)</span> <span class="main">⟶</span>  <span class="main">(</span>F <span class="main">↝</span> <span class="main">(</span>G <span class="main">∨</span> H<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> H <span class="main">↝</span> <span class="main">(</span>G <span class="main">∨</span> H<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LT3<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> LT13<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> <span class="main">(</span>G <span class="main">∨</span> H<span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> LT14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span> <span class="main">↝</span> H<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>F <span class="main">↝</span> H<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> leadsto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> LT15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span> <span class="main">↝</span> H<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>G <span class="main">↝</span> H<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> leadsto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">theorem</span></span> LT16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>F <span class="main">↝</span> H<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>G <span class="main">↝</span> H<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span> <span class="main">↝</span> H<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>F <span class="main">⟶</span> <span class="main">◇</span>H<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">(</span>G <span class="main">⟶</span> <span class="main">◇</span>H<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>F <span class="main">∨</span> G <span class="main">⟶</span> <span class="main">◇</span>H<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> lift_imp_trans<span class="main">[</span><span class="operator">OF</span> this MM0<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> leadsto_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> LT17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span> <span class="main">↝</span> H<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>F <span class="main">↝</span> H<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>G <span class="main">↝</span> H<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> LT14<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span> LT15<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span>
                 LT16<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> LT10<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>F <span class="main">∧</span> <span class="main">¬</span>G<span class="main">)</span> <span class="main">↝</span> G"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">↝</span> G"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">(</span>F <span class="main">∧</span> <span class="main">¬</span>G<span class="main">)</span> <span class="main">∨</span> G<span class="main">)</span> <span class="main">↝</span> G"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> LT17<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> LT1<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">↝</span> <span class="main">(</span><span class="main">(</span>F <span class="main">∧</span> <span class="main">¬</span>G<span class="main">)</span> <span class="main">∨</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LT3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> LT13<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> LT18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>A <span class="main">↝</span> <span class="main">(</span>B <span class="main">∨</span> C<span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>B <span class="main">↝</span> D<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>C <span class="main">↝</span> D<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>A <span class="main">↝</span> D<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>B <span class="main">↝</span> D<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>C <span class="main">↝</span> D<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>B <span class="main">∨</span> C<span class="main">)</span> <span class="main">↝</span> D<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LT16<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> LT13<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> LT19<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>A <span class="main">↝</span> <span class="main">(</span>D <span class="main">∨</span> B<span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>B <span class="main">↝</span> D<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>A <span class="main">↝</span> D<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> LT18<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span>"</span></span><span class="main">]</span> LT1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">D</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">theorem</span></span> LT20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>A <span class="main">↝</span> <span class="main">(</span>B <span class="main">∨</span> D<span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>B <span class="main">↝</span> D<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>A <span class="main">↝</span> D<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> LT18<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span>"</span></span><span class="main">]</span> LT1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">D</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">theorem</span></span> LT21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span> <span class="main">↝</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>F <span class="bound">x</span> <span class="main">↝</span> G<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span>G<span class="main">)</span> <span class="main">=</span> <span class="main">□</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>F <span class="bound">x</span> <span class="main">⟶</span> <span class="main">◇</span>G<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> MM1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> leadsto_def allT<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> LT22<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>F <span class="main">↝</span> <span class="main">(</span>G <span class="main">∨</span> H<span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">¬</span>G <span class="main">⟶</span> <span class="main">(</span>F <span class="main">↝</span> H<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">¬</span>G <span class="main">⟶</span> <span class="main">(</span>G <span class="main">↝</span> H<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> leadsto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> LT20<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-LT23"><span class="command">lemma</span></span> LT23<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">(</span>P <span class="main">⟶</span> <span class="main">○</span>Q<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>P <span class="main">⟶</span> <span class="main">◇</span>Q<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> E23<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> LT24<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>I <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>P <span class="main">∧</span> I<span class="main">)</span> <span class="main">↝</span> Q<span class="main">)</span> <span class="main">⟶</span> P <span class="main">↝</span> Q"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>I <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">(</span>P <span class="main">∧</span> I <span class="main">⟶</span> <span class="main">◇</span>Q<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>P <span class="main">⟶</span> <span class="main">◇</span>Q<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> lift_imp_trans<span class="main">[</span><span class="operator">OF</span> this MM0<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> leadsto_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> LT25<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>F <span class="main">↝</span> <span class="main">#</span>False<span class="main">)</span> <span class="main">=</span> <span class="main">□</span><span class="main">¬</span>F"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> leadsto_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> MM1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>F <span class="main">⟶</span> <span class="main">◇</span><span class="main">#</span>False<span class="main">)</span> <span class="main">=</span> <span class="main">¬</span>F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-LT28"><span class="command">lemma</span></span> LT28<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">⟶</span> <span class="main">○</span>P <span class="main">∨</span> <span class="main">○</span>Q"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">(</span>P <span class="main">⟶</span> <span class="main">○</span>P<span class="main">)</span> <span class="main">∨</span> <span class="main">◇</span>Q"</span></span>
  <span class="keyword1"><span class="command">using</span></span> h E23<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rules-LT29"><span class="command">lemma</span></span> LT29<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">⟶</span> <span class="main">○</span>P <span class="main">∨</span> <span class="main">○</span>Q"</span></span> <span class="keyword2"><span class="keyword">and</span></span>   h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="keyword1">Unchanged</span> v <span class="main">⟶</span> <span class="main">○</span>P"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> P <span class="main">⟶</span> <span class="main">□</span>P <span class="main">∨</span> <span class="main">◇</span>Q"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1<span class="main">[</span><span class="operator">THEN</span> LT28<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□</span><span class="main">¬</span>Q <span class="main">⟶</span> <span class="main">(</span>P <span class="main">⟶</span> <span class="main">○</span>P<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">□</span><span class="main">¬</span>Q<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>P <span class="main">⟶</span> <span class="main">○</span>P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span><span class="main">◇</span>Q <span class="main">⟶</span> <span class="main">□[</span><span class="main">□</span><span class="main">¬</span>Q<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dualization_rew <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ax2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> ax3<span class="main">[</span><span class="operator">OF</span> h2<span class="main">]</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-LT30"><span class="command">lemma</span></span> LT30<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> N <span class="main">⟶</span> <span class="main">○</span>P <span class="main">∨</span> <span class="main">○</span>Q"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> N <span class="main">⟶</span> <span class="main">(</span>P <span class="main">⟶</span> <span class="main">○</span>P<span class="main">)</span> <span class="main">∨</span> <span class="main">◇</span>Q"</span></span>
  <span class="keyword1"><span class="command">using</span></span> h E23 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rules-LT31"><span class="command">lemma</span></span> LT31<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> N <span class="main">⟶</span> <span class="main">○</span>P <span class="main">∨</span> <span class="main">○</span>Q"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="keyword1">Unchanged</span> v <span class="main">⟶</span> <span class="main">○</span>P"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>N <span class="main">⟶</span> P <span class="main">⟶</span> <span class="main">□</span>P <span class="main">∨</span> <span class="main">◇</span>Q"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1<span class="main">[</span><span class="operator">THEN</span> LT30<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> N <span class="main">⟶</span> <span class="main">□</span><span class="main">¬</span>Q <span class="main">⟶</span> P <span class="main">⟶</span> <span class="main">○</span>P"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N <span class="main">⟶</span> <span class="main">□</span><span class="main">¬</span>Q <span class="main">⟶</span> P <span class="main">⟶</span> <span class="main">○</span>P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">□</span><span class="main">¬</span>Q<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>P <span class="main">⟶</span> <span class="main">○</span>P<span class="main">]_</span>v"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ax4<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> P4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>N <span class="main">⟶</span> <span class="main">□[</span><span class="main">□</span><span class="main">¬</span>Q<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>P <span class="main">⟶</span> <span class="main">○</span>P<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span><span class="main">◇</span>Q <span class="main">⟶</span> <span class="main">□[</span><span class="main">□</span><span class="main">¬</span>Q<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dualization_rew <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ax2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">note</span></span> ax3<span class="main">[</span><span class="operator">OF</span> h2<span class="main">]</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-LT33"><span class="command">lemma</span></span> LT33<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="main">#</span><span class="free">P</span> <span class="main">∧</span> F<span class="main">)</span> <span class="main">↝</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">#</span><span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span>F <span class="main">↝</span> G<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> leadsto_def<span class="main">)</span>

<span class="keyword1" id="Rules-AA1"><span class="command">lemma</span></span> AA1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">#</span>False<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">¬</span><span class="main">◇⟨</span>Q<span class="main">⟩_</span>v"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dualization_rew <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rules-AA2"><span class="command">lemma</span></span> AA2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">∧</span> <span class="main">◇⟨</span>Q<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span>P <span class="main">∧</span> Q<span class="main">⟩_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P <span class="main">⟶</span> <span class="main">~</span><span class="main">(</span>P <span class="main">∧</span> Q<span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span>Q<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> actrans_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">~</span><span class="main">(</span>P <span class="main">∧</span> Q<span class="main">)</span><span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">¬</span>Q<span class="main">]_</span>v"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ax4<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> angle_action_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-AA3"><span class="command">lemma</span></span> AA3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">∧</span> <span class="main">□[</span>P <span class="main">⟶</span> Q<span class="main">]_</span>v <span class="main">∧</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇</span>Q"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">∧</span> <span class="main">□[</span>P <span class="main">⟶</span> Q<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>P <span class="main">∧</span> <span class="main">(</span>P <span class="main">⟶</span> Q<span class="main">)</span><span class="main">]_</span>v"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> P4<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M8<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P <span class="main">∧</span> <span class="main">(</span>P <span class="main">⟶</span> Q<span class="main">)</span><span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>Q<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">∧</span> <span class="main">□[</span>P <span class="main">⟶</span> Q<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span>Q<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">(</span>Q <span class="main">∧</span> A<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span>Q"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4_eve<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>Q <span class="main">∧</span> A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇</span>Q"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> E25<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> AA2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>Q<span class="main">]_</span>v <span class="main">∧</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇</span>Q"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-AA4"><span class="command">lemma</span></span> AA4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span><span class="main">⟨</span>A<span class="main">⟩_</span>v<span class="main">⟩_</span>w <span class="main">⟶</span> <span class="main">◇⟨</span><span class="main">⟨</span>A<span class="main">⟩_</span>w<span class="main">⟩_</span>v"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> angle_action_def angle_actrans_def <span class="keyword1"><span class="command">using</span></span> T5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rules-AA7"><span class="command">lemma</span></span> AA7<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> F <span class="main">⟶</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>F<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span>G<span class="main">⟩_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">¬</span>G<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">¬</span>F<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> M2<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> angle_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-AA6"><span class="command">lemma</span></span> AA6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P <span class="main">⟶</span> Q<span class="main">]_</span>v <span class="main">∧</span> <span class="main">◇⟨</span>P<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span>Q<span class="main">⟩_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span><span class="main">(</span>P <span class="main">⟶</span> Q<span class="main">)</span> <span class="main">∧</span> P<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span>Q<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> AA7<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> AA2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-AA8"><span class="command">lemma</span></span> AA8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">∧</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span><span class="main">□[</span>P<span class="main">]_</span>v <span class="main">∧</span> A<span class="main">⟩_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">□[</span>P<span class="main">]_</span>v<span class="main">]_</span>v <span class="main">∧</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span><span class="main">□[</span>P<span class="main">]_</span>v <span class="main">∧</span> A<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> AA2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> P5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-AA9"><span class="command">lemma</span></span> AA9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">∧</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span><span class="main">[</span>P<span class="main">]_</span>v <span class="main">∧</span> A<span class="main">⟩_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">[</span>P<span class="main">]_</span>v<span class="main">]_</span>v <span class="main">∧</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span><span class="main">[</span>P<span class="main">]_</span>v <span class="main">∧</span> A<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> AA2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-AA10"><span class="command">lemma</span></span> AA10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span><span class="main">(</span><span class="main">□[</span>P<span class="main">]_</span>v <span class="main">∧</span> <span class="main">◇⟨</span><span class="main">¬</span>P<span class="main">⟩_</span>v<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> angle_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rules-AA11"><span class="command">lemma</span></span> AA11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span><span class="main">◇⟨</span>v<span class="main">$</span> <span class="main">=</span> <span class="main">$</span>v<span class="main">⟩_</span>v"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dualization_rew <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ax5<span class="main">)</span>

<span class="keyword1" id="Rules-AA15"><span class="command">lemma</span></span> AA15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>P <span class="main">∧</span> Q<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span>P<span class="main">⟩_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> AA7<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rules-AA16"><span class="command">lemma</span></span> AA16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>P <span class="main">∧</span> Q<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span>Q<span class="main">⟩_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> AA7<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Rules-AA13"><span class="command">lemma</span></span> AA13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>P<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span>v<span class="main">$</span> <span class="main">≠</span> <span class="main">$</span>v<span class="main">⟩_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>v<span class="main">$</span> <span class="main">≠</span> <span class="main">$</span>v<span class="main">]_</span>v <span class="main">∧</span> <span class="main">◇⟨</span>P<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span>v<span class="main">$</span> <span class="main">≠</span> <span class="main">$</span>v <span class="main">∧</span> P<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> AA2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>P<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span>v<span class="main">$</span> <span class="main">≠</span> <span class="main">$</span>v <span class="main">∧</span> P<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ax5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this AA15 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-AA14"><span class="command">lemma</span></span> AA14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>P <span class="main">∨</span> Q<span class="main">⟩_</span>v <span class="main">=</span> <span class="main">(</span><span class="main">◇⟨</span>P<span class="main">⟩_</span>v <span class="main">∨</span> <span class="main">◇⟨</span>Q<span class="main">⟩_</span>v<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">¬</span><span class="main">(</span>P <span class="main">∨</span> Q<span class="main">)</span><span class="main">]_</span>v <span class="main">=</span> <span class="main">□[</span><span class="main">¬</span>P <span class="main">∧</span> <span class="main">¬</span>Q<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> MM10<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">¬</span><span class="main">(</span>P <span class="main">∨</span> Q<span class="main">)</span><span class="main">]_</span>v <span class="main">=</span> <span class="main">(</span><span class="main">□[</span><span class="main">¬</span>P<span class="main">]_</span>v <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span>Q<span class="main">]_</span>v<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> M8<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> angle_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-AA17"><span class="command">lemma</span></span> AA17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span><span class="main">[</span>P<span class="main">]_</span>v <span class="main">∧</span> A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span>P <span class="main">∧</span> A<span class="main">⟩_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>v<span class="main">$</span> <span class="main">≠</span> <span class="main">$</span>v <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>P <span class="main">∧</span> A<span class="main">)</span><span class="main">]_</span>v <span class="main">⟶</span> <span class="main">□[</span><span class="main">¬</span><span class="main">(</span><span class="main">[</span>P<span class="main">]_</span>v <span class="main">∧</span> A<span class="main">)</span><span class="main">]_</span>v"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> actrans_def unch_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ax5<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> angle_action_def M8<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-AA19"><span class="command">lemma</span></span> AA19<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">∧</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span>P <span class="main">∧</span> A<span class="main">⟩_</span>v"</span></span>
  <span class="keyword1"><span class="command">using</span></span> P4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> AA2<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Rules-AA20"><span class="command">lemma</span></span> AA20<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">⟶</span> <span class="main">○</span>P <span class="main">∨</span> <span class="main">○</span>Q"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span>  h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> A <span class="main">⟶</span> <span class="main">○</span>Q"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span>  h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="keyword1">Unchanged</span> w <span class="main">⟶</span> <span class="main">○</span>P"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span>P <span class="main">⟶</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>P <span class="main">↝</span> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h2 E23 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> A <span class="main">⟶</span> <span class="main">◇</span>Q"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>P <span class="main">∧</span> A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span><span class="main">◇</span>Q<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> AA7<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> E25<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> <span class="main">◇</span>Q"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>P <span class="main">∧</span> A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇</span>Q"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> AA19 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">∧</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇</span>Q"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> LT29<span class="main">[</span><span class="operator">OF</span> h1 h3<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">□</span>P <span class="main">⟶</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>P <span class="main">⟶</span> <span class="main">◇</span>Q<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> leadsto_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-AA21"><span class="command">lemma</span></span> AA21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">◇⟨</span><span class="main">○</span>F<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">○</span><span class="main">◇</span>F"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pax5<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> <span class="main">¬</span>F"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> angle_action_def eventually_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> AA24<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span><span class="main">⟨</span>P<span class="main">⟩_</span>f<span class="main">⟩_</span>f <span class="main">=</span> <span class="main">◇⟨</span>P<span class="main">⟩_</span>f"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> angle_action_def angle_actrans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rules-AA22"><span class="command">lemma</span></span> AA22<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> N <span class="main">⟶</span> <span class="main">○</span>P <span class="main">∨</span> <span class="main">○</span>Q"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span>  h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> N <span class="main">∧</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">○</span>Q"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span>  h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="keyword1">Unchanged</span> w <span class="main">⟶</span> <span class="main">○</span>P"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>N <span class="main">∧</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span>P <span class="main">⟶</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>P <span class="main">↝</span> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span><span class="main">(</span>N <span class="main">∧</span> P<span class="main">)</span> <span class="main">∧</span> A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">○</span>Q"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> angle_actrans_sem<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> pref_imp_trans<span class="main">[</span><span class="operator">OF</span> this E23<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span><span class="main">⟨</span><span class="main">(</span>N <span class="main">∧</span> P<span class="main">)</span> <span class="main">∧</span> A<span class="main">⟩_</span>v<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span><span class="main">◇</span>Q<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> AA7<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span><span class="main">(</span>N <span class="main">∧</span> P<span class="main">)</span> <span class="main">∧</span> A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇</span>Q"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> E25<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> AA19 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>N <span class="main">∧</span> P<span class="main">)</span> <span class="main">∧</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇</span>Q"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>N <span class="main">∧</span> <span class="main">□</span>P <span class="main">∧</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇</span>Q"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> LT31<span class="main">[</span><span class="operator">OF</span> h1 h3<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>N <span class="main">∧</span> <span class="main">(</span><span class="main">□</span>P <span class="main">⟶</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>P <span class="main">⟶</span> <span class="main">◇</span>Q<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span>N <span class="main">∧</span> <span class="main">(</span><span class="main">□</span>P <span class="main">⟶</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span>P <span class="main">⟶</span> <span class="main">◇</span>Q<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> leadsto_def STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-AA23"><span class="command">lemma</span></span> AA23<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> N <span class="main">⟶</span> <span class="main">○</span>P <span class="main">∨</span> <span class="main">○</span>Q"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> N <span class="main">∧</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">○</span>Q"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="keyword1">Unchanged</span> w <span class="main">⟶</span> <span class="main">○</span>P"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>N <span class="main">∧</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">(</span>P <span class="main">↝</span> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span>P <span class="main">⟶</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> AA22<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-AA25"><span class="command">lemma</span></span> AA25<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span>P<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">⟨</span>Q<span class="main">⟩_</span>w"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>P<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span>Q<span class="main">⟩_</span>w"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span><span class="main">⟨</span>P<span class="main">⟩_</span>v<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span><span class="main">⟨</span>P<span class="main">⟩_</span>w<span class="main">⟩_</span>v"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> AA7<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> angle_actrans_def actrans_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> AA4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>P<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span><span class="main">⟨</span>P<span class="main">⟩_</span>v<span class="main">⟩_</span>w"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> this AA7<span class="main">[</span><span class="operator">OF</span> h<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>P<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span><span class="main">⟨</span>Q<span class="main">⟩_</span>w<span class="main">⟩_</span>w"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-AA26"><span class="command">lemma</span></span> AA26<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">=</span> <span class="main">⟨</span>B<span class="main">⟩_</span>w"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">=</span> <span class="main">◇⟨</span>B<span class="main">⟩_</span>w"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">⟨</span>B<span class="main">⟩_</span>w"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇⟨</span>B<span class="main">⟩_</span>w"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> AA25<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span>B<span class="main">⟩_</span>w <span class="main">⟶</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span>B<span class="main">⟩_</span>w <span class="main">⟶</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> AA25<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> AA28<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">=</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_def angle_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">theorem</span></span> AA29<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>v <span class="main">∧</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>N <span class="main">∧</span> A<span class="main">⟩_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">□[</span>N<span class="main">]_</span>v <span class="main">∧</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>N <span class="main">∧</span> A<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main"><span class="main">[</span></span><span class="operator">OF</span> AA2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> AA30<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span><span class="main">◇⟨</span>P<span class="main">⟩_</span>f<span class="main">⟩_</span>f <span class="main">=</span> <span class="main">◇⟨</span>P<span class="main">⟩_</span>f"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> angle_action_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">theorem</span></span> AA31<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇⟨</span><span class="main">○</span>F<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇</span>F"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pref_imp_trans<span class="main">[</span><span class="operator">OF</span> AA21 E29<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rules-AA32"><span class="command">lemma</span></span> AA32<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">◇</span><span class="main">□[</span>A<span class="main">]_</span>v <span class="main">=</span> <span class="main">◇</span><span class="main">□[</span>A<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">using</span></span> E21<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> <span class="main">□[</span>A<span class="main">]_</span>v"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rules-AA33"><span class="command">lemma</span></span> AA33<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">=</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v"</span></span>
  <span class="keyword1"><span class="command">using</span></span> E27<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Lemmas about the next operator"</span></span>

<span class="keyword1" id="Rules-N2"><span class="command">lemma</span></span> N2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">=</span> G"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span>F <span class="main">=</span> <span class="main">○</span>G"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> next_and <span class="main">=</span> T8

<span class="keyword1" id="Rules-next_or"><span class="command">lemma</span></span> next_or<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">○</span>F <span class="main">∨</span> <span class="main">○</span>G<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pref_iffI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">(</span><span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>F<span class="main">)</span> <span class="main">⟶</span> <span class="main">○</span>G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="main">○</span>F <span class="main">∨</span> <span class="main">○</span>G"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T8<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span>F <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span>G <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span>F <span class="main">∨</span> <span class="main">○</span>G <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-next_imp"><span class="command">lemma</span></span> next_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">(</span>F <span class="main">⟶</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">○</span>F <span class="main">⟶</span> <span class="main">○</span>G<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pref_iffI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span>G <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span>F <span class="main">⟶</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">¬</span>F <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span>F <span class="main">⟶</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">(</span><span class="main">○</span>F <span class="main">⟶</span> <span class="main">○</span>G<span class="main">)</span> <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span>F <span class="main">⟶</span> G<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> pax2<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> next_not <span class="main">=</span> pax1

<span class="keyword1" id="Rules-next_eq"><span class="command">lemma</span></span> next_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">(</span>F <span class="main">=</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">○</span>F <span class="main">=</span> <span class="main">○</span>G<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">(</span>F <span class="main">=</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">○</span><span class="main">(</span><span class="main">(</span>F <span class="main">⟶</span> G<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>G <span class="main">⟶</span> F<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> N2<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> next_and<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> next_imp<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-next_noteq"><span class="command">lemma</span></span> next_noteq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">(</span>F <span class="main">≠</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">○</span>F <span class="main">≠</span> <span class="main">○</span>G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_eq<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Rules-next_const"><span class="command">lemma</span></span> next_const<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">#</span><span class="free">P</span> <span class="main">=</span> <span class="main">#</span><span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">#</span><span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">#</span><span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nex<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span><span class="main">#</span><span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">¬</span><span class="main">#</span><span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nex<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following are proved semantically because they are essentially
  first-order theorems.
›</span></span>
<span class="keyword1" id="Rules-next_fun1"><span class="command">lemma</span></span> next_fun1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="free">f</span><span class="main">&lt;</span>x<span class="main">&gt;</span> <span class="main">=</span> <span class="free">f</span><span class="main">&lt;</span><span class="main">○</span>x<span class="main">&gt;</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def<span class="main">)</span>

<span class="keyword1" id="Rules-next_fun2"><span class="command">lemma</span></span> next_fun2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="free">f</span><span class="main">&lt;</span>x<span class="main">,</span>y<span class="main">&gt;</span> <span class="main">=</span> <span class="free">f</span><span class="main">&lt;</span><span class="main">○</span>x<span class="main">,</span><span class="main">○</span>y<span class="main">&gt;</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def<span class="main">)</span>

<span class="keyword1" id="Rules-next_fun3"><span class="command">lemma</span></span> next_fun3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="free">f</span><span class="main">&lt;</span>x<span class="main">,</span>y<span class="main">,</span>z<span class="main">&gt;</span> <span class="main">=</span> <span class="free">f</span><span class="main">&lt;</span><span class="main">○</span>x<span class="main">,</span><span class="main">○</span>y<span class="main">,</span><span class="main">○</span>z<span class="main">&gt;</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def<span class="main">)</span>

<span class="keyword1" id="Rules-next_fun4"><span class="command">lemma</span></span> next_fun4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="free">f</span><span class="main">&lt;</span>x<span class="main">,</span>y<span class="main">,</span>z<span class="main">,</span>zz<span class="main">&gt;</span> <span class="main">=</span> <span class="free">f</span><span class="main">&lt;</span><span class="main">○</span>x<span class="main">,</span><span class="main">○</span>y<span class="main">,</span><span class="main">○</span>z<span class="main">,</span><span class="main">○</span>zz<span class="main">&gt;</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def<span class="main">)</span>

<span class="keyword1" id="Rules-next_forall"><span class="command">lemma</span></span> next_forall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> P <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">○</span> P <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def<span class="main">)</span>

<span class="keyword1" id="Rules-next_exists"><span class="command">lemma</span></span> next_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> P <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="main">○</span> P <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def<span class="main">)</span>

<span class="keyword1" id="Rules-next_exists1"><span class="command">lemma</span></span> next_exists1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">(</span><span class="main">∃!</span> <span class="bound">x</span><span class="main">.</span> P <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃!</span> <span class="bound">x</span><span class="main">.</span> <span class="main">○</span> P <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Rewrite rules to push the ``next'' operator inward over connectives.
  (Note that axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pax1›</span></span></span></span> and theorem <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>next_const›</span></span></span></span> are anyway active
  as rewrite rules.)
›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> next_commutes<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="main">=</span>
  next_and next_or next_imp next_eq 
  next_fun1 next_fun2 next_fun3 next_fun4
  next_forall next_exists next_exists1

<span class="keyword1"><span class="command">lemmas</span></span> ifs_eq<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="main">=</span> after_fun3 next_fun3 before_fun3

<span class="keyword1"><span class="command">lemmas</span></span> next_always <span class="main">=</span> pax3

<span class="keyword1" id="Rules-t1"><span class="command">lemma</span></span> t1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">○</span><span class="main">$</span>x <span class="main">=</span> x<span class="main">$</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> before_def after_def nexts_def first_tail_second<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Theorem <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>next_eventually›</span></span></span></span> should not be used "blindly".
›</span></span>
<span class="keyword1" id="Rules-next_eventually"><span class="command">lemma</span></span> next_eventually<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"stutinv <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">◇</span>F <span class="main">⟶</span> <span class="main">¬</span>F <span class="main">⟶</span> <span class="main">○</span><span class="main">◇</span>F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"stutinv <span class="main">(</span><span class="keyword1">TEMP</span> <span class="main">¬</span>F<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stut_not<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□</span><span class="main">¬</span>F <span class="main">=</span> <span class="main">(</span><span class="main">¬</span>F <span class="main">∧</span> <span class="main">○</span><span class="main">□</span><span class="main">¬</span>F<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> T7<span class="main">[</span><span class="operator">OF</span> pre_id_unch<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-next_action"><span class="command">lemma</span></span> next_action<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">□[</span>P<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">○</span><span class="main">□[</span>P<span class="main">]_</span>v"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pax4<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Higher Level Derived Rules"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In most verification tasks the low-level rules discussed above are not used directly. 
  Here, we derive some higher-level rules more suitable for verification. In particular, 
  variants of Lamport's rules <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>TLA1›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>TLA2›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>INV1›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>INV2›</span></span></span></span>
  are derived, where <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>|~›</span></span></span></span> is used where appropriate.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> TLA1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="keyword1">Unchanged</span> f <span class="main">⟶</span> <span class="main">○</span>P"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">=</span> <span class="main">(</span>P <span class="main">∧</span> <span class="main">□[</span>P <span class="main">⟶</span> <span class="main">○</span>P<span class="main">]_</span>f<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> int_iffI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ax1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> M0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">⟶</span> P <span class="main">∧</span> <span class="main">□[</span>P <span class="main">⟶</span> <span class="main">○</span>P<span class="main">]_</span>f"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> ax3<span class="main">[</span><span class="operator">OF</span> H<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> P <span class="main">∧</span> <span class="main">□[</span>P <span class="main">⟶</span> <span class="main">○</span>P<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">□</span>P"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> TLA2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> P <span class="main">⟶</span> Q"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="main">○</span>P <span class="main">∧</span> <span class="main">[</span>A<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">[</span>B<span class="main">]_</span>g"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">∧</span> <span class="main">□[</span>A<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">□</span>Q <span class="main">∧</span> <span class="main">□[</span>B<span class="main">]_</span>g"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P <span class="main">∧</span> <span class="main">○</span>P <span class="main">∧</span> <span class="main">[</span>A<span class="main">]_</span>f<span class="main">]_</span>g <span class="main">⟶</span> <span class="main">□[</span><span class="main">[</span>B<span class="main">]_</span>g<span class="main">]_</span>g"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>P <span class="main">∧</span> <span class="main">○</span>P<span class="main">]_</span>g <span class="main">∧</span> <span class="main">□[</span><span class="main">[</span>A<span class="main">]_</span>f<span class="main">]_</span>g <span class="main">⟶</span> <span class="main">□[</span>B<span class="main">]_</span>g"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M8<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> M1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> T4<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">∧</span> <span class="main">□[</span>A<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">□[</span>B<span class="main">]_</span>g"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> h1<span class="main">[</span><span class="operator">THEN</span> STL4<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> INV1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> I <span class="main">∧</span> <span class="main">[</span>N<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">○</span>I"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> I <span class="main">∧</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">□</span>I"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">[</span>N<span class="main">]_</span>f <span class="main">⟶</span> I <span class="main">⟶</span> <span class="main">○</span>I"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">[</span>N<span class="main">]_</span>f<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">□[</span>I <span class="main">⟶</span> <span class="main">○</span>I<span class="main">]_</span>f"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> I <span class="main">∧</span> <span class="keyword1">Unchanged</span> f <span class="main">⟶</span> <span class="main">○</span>I"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> actrans_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>I <span class="main">⟶</span> <span class="main">○</span>I<span class="main">]_</span>f <span class="main">⟶</span> I <span class="main">⟶</span> <span class="main">□</span>I"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ax3<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> INV2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>I <span class="main">⟶</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">=</span> <span class="main">□[</span>N <span class="main">∧</span> I <span class="main">∧</span> <span class="main">○</span>I<span class="main">]_</span>f"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> M1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>I <span class="main">⟶</span> <span class="main">(</span><span class="main">□[</span>N<span class="main">]_</span>f <span class="main">=</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="main">□[</span>I <span class="main">∧</span> <span class="main">○</span>I<span class="main">]_</span>f<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M8<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rules-R1"><span class="command">lemma</span></span> R1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="keyword1">Unchanged</span> w <span class="main">⟶</span> <span class="keyword1">Unchanged</span> v"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>F<span class="main">]_</span>w <span class="main">⟶</span> <span class="main">□[</span>F<span class="main">]_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">[</span>F<span class="main">]_</span>w <span class="main">⟶</span> <span class="main">[</span>F<span class="main">]_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> actrans_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M11<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> invmono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> I <span class="main">⟶</span> P"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="main">[</span>N<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">○</span>P"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> I <span class="main">∧</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">□</span>P"</span></span>
  <span class="keyword1"><span class="command">using</span></span> h1 INV1<span class="main">[</span><span class="operator">OF</span> h2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">theorem</span></span> preimpsplit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> I <span class="main">∧</span> N <span class="main">⟶</span> Q"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> I <span class="main">∧</span> <span class="keyword1">Unchanged</span> v <span class="main">⟶</span> Q"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> I <span class="main">∧</span> <span class="main">[</span>N<span class="main">]_</span>v <span class="main">⟶</span> Q"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">unlift_rule</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> actrans_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> refinement1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> P <span class="main">⟶</span> Q"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> I <span class="main">∧</span> <span class="main">○</span>I <span class="main">∧</span> <span class="main">[</span>A<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">[</span>B<span class="main">]_</span>g"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> P <span class="main">∧</span> <span class="main">□</span>I <span class="main">∧</span> <span class="main">□[</span>A<span class="main">]_</span>f <span class="main">⟶</span> Q <span class="main">∧</span> <span class="main">□[</span>B<span class="main">]_</span>g"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> I <span class="main">⟶</span> <span class="main">#</span>True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>I <span class="main">∧</span> <span class="main">□[</span>A<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">#</span>True <span class="main">∧</span> <span class="main">□[</span>B<span class="main">]_</span>g"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> TLA2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> h1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> inv_join<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> P <span class="main">⟶</span> <span class="main">□</span>Q"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> P <span class="main">⟶</span> <span class="main">□</span>R"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> P <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span>Q <span class="main">∧</span> R<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">unlift_rule</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> STL5<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Rules-inv_cases"><span class="command">lemma</span></span> inv_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>A <span class="main">⟶</span> B<span class="main">)</span> <span class="main">∧</span> <span class="main">□</span><span class="main">(</span><span class="main">¬</span>A <span class="main">⟶</span> B<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span>B"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">(</span>A <span class="main">⟶</span> B<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span>A <span class="main">⟶</span> B<span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span>B"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Liveness">
<div class="head">
<h1>Theory Liveness</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       A Definitional Encoding of TLA in Isabelle/HOL
    Authors:     Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
                 Stephan Merz &lt;Stephan.Merz at loria.fr&gt;
    Year:        2011
    Maintainer:  Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Liveness"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Liveness
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Rules.html">Rules</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theory derives proof rules for liveness properties.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">enabled</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> formula <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">enabled</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>first <span class="bound">s</span><span class="main">)</span> <span class="main">##</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="quoted">"_Enabled"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">Enabled</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>90<span class="main">]</span> 90<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span> <span class="quoted">"_Enabled"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> enabled"</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">WeakF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>world<span class="main">)</span> formula <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> stfun <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">WeakF</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>F<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>F<span class="main">⟩_</span>v"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">StrongF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>world<span class="main">)</span> formula <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> stfun <span class="main">⇒</span> <span class="tfree">'a</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">StrongF</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>F<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>F<span class="main">⟩_</span>v"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Lamport's TLA defines the above notions for actions.
  In \tlastar{}, (pre-)formulas generalise TLA's actions and the above
  definition is the natural generalisation of enabledness to pre-formulas.
  In particular, we have chosen to define <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>enabled›</span></span></span></span> such that it
  yields itself a temporal formula, although its value really just depends
  on the first state of the sequence it is evaluated over.
  Then, the definitions of weak and strong fairness are exactly as in TLA.
›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
 <span class="quoted">"_WF"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span>lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">WF'(</span>_<span class="keyword1">')'_</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span>  <span class="main">[</span>20<span class="main">,</span>1000<span class="main">]</span> 90<span class="main">)</span>
 <span class="quoted">"_SF"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span>lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">SF'(</span>_<span class="keyword1">')'_</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span>  <span class="main">[</span>20<span class="main">,</span>1000<span class="main">]</span> 90<span class="main">)</span>
 <span class="quoted">"_WFsp"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span>lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">WF</span> <span class="keyword1">'(</span>_<span class="keyword1">')'_</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span>  <span class="main">[</span>20<span class="main">,</span>1000<span class="main">]</span> 90<span class="main">)</span>
 <span class="quoted">"_SFsp"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>lift<span class="main">,</span>lift<span class="main">]</span> <span class="main">⇒</span> lift"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">SF</span> <span class="keyword1">'(</span>_<span class="keyword1">')'_</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span>  <span class="main">[</span>20<span class="main">,</span>1000<span class="main">]</span> 90<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
 <span class="quoted">"_WF"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> WeakF"</span>
 <span class="quoted">"_SF"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> StrongF"</span>
 <span class="quoted">"_WFsp"</span> <span class="main">⇀</span> <span class="quoted">"<span class="keyword1">CONST</span> WeakF"</span>
 <span class="quoted">"_SFsp"</span> <span class="main">⇀</span> <span class="quoted">"<span class="keyword1">CONST</span> StrongF"</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Properties of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">enabled</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> enabledI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> <span class="keyword1">Enabled</span> F"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> F"</span></span>
  <span class="keyword1"><span class="command">with</span></span> seq_app_first_tail<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>first <span class="skolem">w</span><span class="main">)</span> <span class="main">##</span> tail <span class="skolem">w</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enabled_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> enabledE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> F"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span>first <span class="free">s</span> <span class="main">##</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⊨</span> F <span class="main">⟹</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> enabled_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Liveness-enabled_mono"><span class="command">lemma</span></span> enabled_mono<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> F"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="main">⟶</span> G"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> G"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">unlifted</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> enabled_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Liveness-Enabled_disj1"><span class="command">lemma</span></span> Enabled_disj1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> F <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enabled_def<span class="main">)</span>

<span class="keyword1" id="Liveness-Enabled_disj2"><span class="command">lemma</span></span>  Enabled_disj2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> F <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">(</span>G <span class="main">∨</span> F<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enabled_def<span class="main">)</span>

<span class="keyword1" id="Liveness-Enabled_conj1"><span class="command">lemma</span></span>  Enabled_conj1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> <span class="main">(</span>F <span class="main">∧</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Enabled</span> F"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enabled_def<span class="main">)</span>

<span class="keyword1" id="Liveness-Enabled_conj2"><span class="command">lemma</span></span>  Enabled_conj2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> <span class="main">(</span>G <span class="main">∧</span> F<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Enabled</span> F"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enabled_def<span class="main">)</span>

<span class="keyword1" id="Liveness-Enabled_disjD"><span class="command">lemma</span></span> Enabled_disjD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> <span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Enabled</span> F <span class="main">∨</span> <span class="keyword1">Enabled</span> G"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enabled_def<span class="main">)</span>

<span class="keyword1" id="Liveness-Enabled_disj"><span class="command">lemma</span></span> Enabled_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> <span class="main">(</span>F <span class="main">∨</span> G<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Enabled</span> F <span class="main">∨</span> <span class="keyword1">Enabled</span> G<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enabled_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> enabled_disj_rew <span class="main">=</span> Enabled_disj<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span>

<span class="keyword1" id="Liveness-Enabled_ex"><span class="command">lemma</span></span> Enabled_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1">Enabled</span> <span class="main">(</span>F <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enabled_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Fairness Properties"</span></span> 

<span class="keyword1" id="Liveness-WF_alt"><span class="command">lemma</span></span> WF_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>v <span class="main">=</span> <span class="main">(</span><span class="main">□</span><span class="main">◇</span><span class="main">¬</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">∨</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>v <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="main">◇</span><span class="main">□</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">∨</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WeakF_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dualization_rew<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Liveness-SF_alt"><span class="command">lemma</span></span> SF_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>v <span class="main">=</span> <span class="main">(</span><span class="main">◇</span><span class="main">□</span><span class="main">¬</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">∨</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>v <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="main">□</span><span class="main">◇</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">∨</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> StrongF_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dualization_rew<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Liveness-alwaysWFI"><span class="command">lemma</span></span> alwaysWFI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>v <span class="main">⟶</span> <span class="main">□</span><span class="keyword1">WF(</span>A<span class="main">)_</span>v"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> WF_alt<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> MM6<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> WF_always<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="keyword1">WF(</span>A<span class="main">)_</span>v <span class="main">=</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> int_iffI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ax1 alwaysWFI<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> WF_eventually<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="keyword1">WF(</span>A<span class="main">)_</span>v <span class="main">=</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span><span class="keyword1">WF(</span>A<span class="main">)_</span>v <span class="main">=</span> <span class="main">(</span><span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">∧</span> <span class="main">¬</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WeakF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">¬</span><span class="keyword1">WF(</span>A<span class="main">)_</span>v <span class="main">=</span> <span class="main">¬</span><span class="keyword1">WF(</span>A<span class="main">)_</span>v"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> dualization_rew<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Liveness-alwaysSFI"><span class="command">lemma</span></span> alwaysSFI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>v <span class="main">⟶</span> <span class="main">□</span><span class="keyword1">SF(</span>A<span class="main">)_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">◇</span><span class="main">□</span><span class="main">¬</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">∨</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span><span class="main">◇</span><span class="main">□</span><span class="main">¬</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">∨</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> MM6<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> SF_alt<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> SF_always<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="keyword1">SF(</span>A<span class="main">)_</span>v <span class="main">=</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> int_iffI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ax1 alwaysSFI<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> SF_eventually<span class="main">[</span><span class="operator">simp_unl</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="keyword1">SF(</span>A<span class="main">)_</span>v <span class="main">=</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>v"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">¬</span><span class="keyword1">SF(</span>A<span class="main">)_</span>v <span class="main">=</span> <span class="main">(</span><span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">∧</span> <span class="main">¬</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> StrongF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">¬</span><span class="keyword1">SF(</span>A<span class="main">)_</span>v <span class="main">=</span> <span class="main">¬</span><span class="keyword1">SF(</span>A<span class="main">)_</span>v"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> dualization_rew<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> SF_imp_WF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">SF</span> <span class="main">(</span>A<span class="main">)_</span>v <span class="main">⟶</span> <span class="keyword1">WF</span> <span class="main">(</span>A<span class="main">)_</span>v"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> WeakF_def StrongF_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> E20<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Liveness-enabled_WFSF"><span class="command">lemma</span></span> enabled_WFSF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>F<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">WF(</span>F<span class="main">)_</span>v <span class="main">=</span> <span class="keyword1">SF(</span>F<span class="main">)_</span>v<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>F<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>F<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> E3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>F<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="keyword1">WF(</span>F<span class="main">)_</span>v <span class="main">⟶</span> <span class="keyword1">SF(</span>F<span class="main">)_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WeakF_def StrongF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>F<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>F<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main"><span class="main">[</span></span><span class="operator">OF</span> E3<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>F<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="keyword1">SF(</span>F<span class="main">)_</span>v <span class="main">⟶</span> <span class="keyword1">WF(</span>F<span class="main">)_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WeakF_def StrongF_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> WF1_general<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> N <span class="main">⟶</span> <span class="main">○</span>P <span class="main">∨</span> <span class="main">○</span>Q"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> N <span class="main">∧</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">○</span>Q"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> P <span class="main">∧</span> N <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="keyword1">Unchanged</span> w <span class="main">⟶</span> <span class="main">○</span>P"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>N <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>v <span class="main">⟶</span> <span class="main">(</span>P <span class="main">↝</span> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span>N <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>v<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span>P <span class="main">⟶</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span>P <span class="main">∧</span> N<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> h3<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> STL4<span class="main"><span class="main">]</span></span> E3<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">∧</span> <span class="main">□</span>N <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>v <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WeakF_def STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ax1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>N <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>v <span class="main">⟶</span> <span class="main">□</span>P <span class="main">⟶</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>N <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>v <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span>P <span class="main">⟶</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> AA22<span class="main">[</span><span class="operator">OF</span> h1 h2 h4<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lamport's version of the rule is derived as a special case.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> WF1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="main">[</span>N<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">○</span>P <span class="main">∨</span> <span class="main">○</span>Q"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="main">⟨</span>N <span class="main">∧</span> A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">○</span>Q"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> P <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="keyword1">Unchanged</span> v <span class="main">⟶</span> <span class="main">○</span>P"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>v <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>v <span class="main">⟶</span> <span class="main">(</span>P <span class="main">↝</span> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">□[</span>N<span class="main">]_</span>v <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>v <span class="main">⟶</span> <span class="main">(</span>P <span class="main">↝</span> Q<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> WF1_general<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> h1 T9<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="main">□[</span>N<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">○</span>P <span class="main">∨</span> <span class="main">○</span>Q"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> T9<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="main">□[</span>N<span class="main">]_</span>v <span class="main">∧</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> P <span class="main">∧</span> <span class="main">⟨</span>N <span class="main">∧</span> A<span class="main">⟩_</span>v"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> actrans_def angle_actrans_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this h2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="main">□[</span>N<span class="main">]_</span>v <span class="main">∧</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">○</span>Q"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pref_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> h3 T9<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> P <span class="main">∧</span> <span class="main">□[</span>N<span class="main">]_</span>v <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> h4<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The corresponding rule for strong fairness has an additional hypothesis
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>□F›</span></span></span></span>, which is typically a conjunction of other fairness properties
  used to prove that the helpful action eventually becomes enabled.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> SF1_general<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> N <span class="main">⟶</span> <span class="main">○</span>P <span class="main">∨</span> <span class="main">○</span>Q"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> N <span class="main">∧</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">○</span>Q"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">∧</span> <span class="main">□</span>N <span class="main">∧</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="keyword1">Unchanged</span> w <span class="main">⟶</span> <span class="main">○</span>P"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>N <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>v <span class="main">∧</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">(</span>P <span class="main">↝</span> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span>N <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>v <span class="main">∧</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span>P <span class="main">⟶</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span>P <span class="main">∧</span> <span class="main">□</span>N <span class="main">∧</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main"><span class="main">[</span></span><span class="operator">OF</span> h3<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">∧</span> <span class="main">□</span>N <span class="main">∧</span> <span class="main">□</span>F <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>v <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> StrongF_def STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ax1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">TEMP</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>N <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>v <span class="main">∧</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">□</span>P <span class="main">⟶</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>N <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>v <span class="main">∧</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span>P <span class="main">⟶</span> <span class="main">◇⟨</span>A<span class="main">⟩_</span>v<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> AA22<span class="main">[</span><span class="operator">OF</span> h1 h2 h4<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> SF1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="main">[</span>N<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">○</span>P <span class="main">∨</span> <span class="main">○</span>Q"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="main">⟨</span>N <span class="main">∧</span> A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">○</span>Q"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">∧</span> <span class="main">□[</span>N<span class="main">]_</span>v <span class="main">∧</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="keyword1">Unchanged</span> v <span class="main">⟶</span> <span class="main">○</span>P"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>v <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>v <span class="main">∧</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">(</span>P <span class="main">↝</span> Q<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">□[</span>N<span class="main">]_</span>v <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>v <span class="main">∧</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">(</span>P <span class="main">↝</span> Q<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SF1_general<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> h1 T9<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="main">□[</span>N<span class="main">]_</span>v <span class="main">⟶</span> <span class="main">○</span>P <span class="main">∨</span> <span class="main">○</span>Q"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> T9<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="main">□[</span>N<span class="main">]_</span>v <span class="main">∧</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> P <span class="main">∧</span> <span class="main">⟨</span>N <span class="main">∧</span> A<span class="main">⟩_</span>v"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> actrans_def angle_actrans_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this h2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="main">□[</span>N<span class="main">]_</span>v <span class="main">∧</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v <span class="main">⟶</span> <span class="main">○</span>Q"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pref_imp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">∧</span> <span class="main">□</span><span class="main">□[</span>N<span class="main">]_</span>v <span class="main">∧</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>v"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> h4<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lamport proposes the following rule as an introduction rule for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>WF›</span></span></span></span> formulas.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> WF2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span>N <span class="main">∧</span> B<span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="main">○</span>P <span class="main">∧</span> <span class="main">⟨</span>N <span class="main">∧</span> A<span class="main">⟩_</span>f <span class="main">⟶</span> B"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> P <span class="main">∧</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>f"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N <span class="main">∧</span> <span class="main">¬</span>B<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span>P"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="keyword1">WF(</span>M<span class="main">)_</span>g"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">¬</span><span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">¬</span><span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span>P"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">¬</span><span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g <span class="main">⟶</span>
                 <span class="main">□</span><span class="main">(</span><span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span><span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span>M<span class="main">]_</span>g<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> STL6<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="comment1">(* important to do this before STL5 is applied *)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> dualization_rew<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span><span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span>M<span class="main">]_</span>g<span class="main">)</span> <span class="main">⟶</span>
                 <span class="main">◇</span><span class="main">(</span><span class="main">(</span><span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> <span class="main">□</span><span class="main">(</span><span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span>M<span class="main">]_</span>g<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SE2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> lift_imp_trans<span class="main">[</span><span class="operator">OF</span> A B<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">¬</span><span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g <span class="main">⟶</span>
              <span class="main">◇</span><span class="main">(</span><span class="main">(</span><span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span>M<span class="main">]_</span>g<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">[</span>N<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">[</span><span class="main">¬</span>M<span class="main">]_</span>g <span class="main">⟶</span> <span class="main">[</span>N <span class="main">∧</span> <span class="main">¬</span>B<span class="main">]_</span>f"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> actrans_def angle_actrans_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">[</span>N<span class="main">]_</span>f<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">□[</span><span class="main">[</span><span class="main">¬</span>M<span class="main">]_</span>g <span class="main">⟶</span> <span class="main">[</span>N <span class="main">∧</span> <span class="main">¬</span>B<span class="main">]_</span>f<span class="main">]_</span>f"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> lift_imp_trans<span class="main">[</span><span class="operator">OF</span> this ax4<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span>M<span class="main">]_</span>g <span class="main">⟶</span> <span class="main">□[</span>N <span class="main">∧</span> <span class="main">¬</span>B<span class="main">]_</span>f"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> T4<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> h4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span>M<span class="main">]_</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span>P"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">from</span></span> STL4_eve<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">(</span><span class="main">(</span><span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span>M<span class="main">]_</span>g<span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span>P"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span>P <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span>P <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="keyword1">WF(</span>A<span class="main">)_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>f"</span></span>
        <span class="keyword1"><span class="command">using</span></span> h3<span class="main">[</span><span class="operator">THEN</span> STL4<span class="main">,</span> <span class="operator">THEN</span> STL4_eve<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> STL6<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> WeakF_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span>P <span class="main">∧</span>  <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> M1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">∧</span> <span class="main">□</span><span class="main">◇⟨</span>N <span class="main">∧</span> A<span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span><span class="main">(</span>P <span class="main">∧</span> <span class="main">○</span>P<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>N <span class="main">∧</span> A<span class="main">)</span><span class="main">⟩_</span>f"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> AA29<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span><span class="main">□</span>P <span class="main">∧</span> <span class="main">□</span><span class="main">◇⟨</span>N <span class="main">∧</span> A<span class="main">⟩_</span>f<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span><span class="main">□</span><span class="main">◇⟨</span><span class="main">(</span>P <span class="main">∧</span> <span class="main">○</span>P<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>N <span class="main">∧</span> A<span class="main">)</span><span class="main">⟩_</span>f"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4_eve<span class="main"><span class="main">[</span></span><span class="operator">OF</span> STL4<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span>P <span class="main">∧</span> <span class="main">□</span><span class="main">◇⟨</span>N <span class="main">∧</span> A<span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span><span class="main">(</span>P <span class="main">∧</span> <span class="main">○</span>P<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>N <span class="main">∧</span> A<span class="main">)</span><span class="main">⟩_</span>f"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> STL6<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> AA29<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> B1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span>P <span class="main">∧</span>  <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span><span class="main">(</span>P <span class="main">∧</span> <span class="main">○</span>P<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>N <span class="main">∧</span> A<span class="main">)</span><span class="main">⟩_</span>f"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span><span class="main">(</span>P <span class="main">∧</span> <span class="main">○</span>P<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>N <span class="main">∧</span> A<span class="main">)</span><span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">⟨</span>N <span class="main">∧</span> B<span class="main">⟩_</span>f"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> angle_actrans_sem<span class="main"><span class="main">[</span></span><span class="operator">unlifted</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> B1 this<span class="main">[</span><span class="operator">THEN</span> AA25<span class="main">,</span> <span class="operator">THEN</span> STL4<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span>P <span class="main">∧</span>  <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>N <span class="main">∧</span> B<span class="main">⟩_</span>f"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">◇⟨</span>N <span class="main">∧</span> B<span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> h1<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> AA25<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> STL4<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> A B <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WeakF_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lamport proposes an analogous theorem for introducing strong fairness, and its
  proof is very similar, in fact, it was obtained by copy and paste, with minimal
  modifications.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> SF2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span>N <span class="main">∧</span> B<span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> P <span class="main">∧</span> <span class="main">○</span>P <span class="main">∧</span> <span class="main">⟨</span>N <span class="main">∧</span> A<span class="main">⟩_</span>f <span class="main">⟶</span> B"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> P <span class="main">∧</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>A<span class="main">⟩_</span>f"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N <span class="main">∧</span> <span class="main">¬</span>B<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span>P"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F <span class="main">⟶</span> <span class="keyword1">SF(</span>M<span class="main">)_</span>g"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">¬</span><span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">¬</span><span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span>P"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">¬</span><span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g <span class="main">⟶</span>
                 <span class="main">□</span><span class="main">(</span><span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span><span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span>M<span class="main">]_</span>g<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> STL6<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="comment1">(* important to do this before STL5 is applied *)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> dualization_rew<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span><span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span>M<span class="main">]_</span>g<span class="main">)</span> <span class="main">⟶</span>
                 <span class="main">◇</span><span class="main">(</span><span class="main">(</span><span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> <span class="main">□</span><span class="main">(</span><span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span>M<span class="main">]_</span>g<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> SE2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> lift_imp_trans<span class="main">[</span><span class="operator">OF</span> A B<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F <span class="main">∧</span> <span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">¬</span><span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g <span class="main">⟶</span>
              <span class="main">◇</span><span class="main">(</span><span class="main">(</span><span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span>M<span class="main">]_</span>g<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">[</span>N<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">[</span><span class="main">¬</span>M<span class="main">]_</span>g <span class="main">⟶</span> <span class="main">[</span>N <span class="main">∧</span> <span class="main">¬</span>B<span class="main">]_</span>f"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> actrans_def angle_actrans_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">[</span>N<span class="main">]_</span>f<span class="main">]_</span>f <span class="main">⟶</span> <span class="main">□[</span><span class="main">[</span><span class="main">¬</span>M<span class="main">]_</span>g <span class="main">⟶</span> <span class="main">[</span>N <span class="main">∧</span> <span class="main">¬</span>B<span class="main">]_</span>f<span class="main">]_</span>f"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> M2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> lift_imp_trans<span class="main">[</span><span class="operator">OF</span> this ax4<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span>M<span class="main">]_</span>g <span class="main">⟶</span> <span class="main">□[</span>N <span class="main">∧</span> <span class="main">¬</span>B<span class="main">]_</span>f"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> T4<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> h4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span>M<span class="main">]_</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span>P"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">from</span></span> STL4_eve<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">(</span><span class="main">(</span><span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span>F<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span>M<span class="main">]_</span>g<span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span>P"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>f <span class="main">∧</span> <span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span>P <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">◇</span><span class="main">(</span>P <span class="main">∧</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g<span class="main">)</span> <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>f"</span></span>
        <span class="keyword1"><span class="command">using</span></span> h3<span class="main">[</span><span class="operator">THEN</span> STL4_eve<span class="main">,</span> <span class="operator">THEN</span> STL4<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> StrongF_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> E28 <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span>P <span class="main">∧</span> <span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>M<span class="main">⟩_</span>g <span class="main">∧</span> <span class="keyword1">SF(</span>A<span class="main">)_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>f"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span>P <span class="main">∧</span>  <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> M1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>P <span class="main">∧</span> <span class="main">□</span><span class="main">◇⟨</span>N <span class="main">∧</span> A<span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span><span class="main">(</span>P <span class="main">∧</span> <span class="main">○</span>P<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>N <span class="main">∧</span> A<span class="main">)</span><span class="main">⟩_</span>f"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> AA29<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span><span class="main">□</span>P <span class="main">∧</span> <span class="main">□</span><span class="main">◇⟨</span>N <span class="main">∧</span> A<span class="main">⟩_</span>f<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span><span class="main">□</span><span class="main">◇⟨</span><span class="main">(</span>P <span class="main">∧</span> <span class="main">○</span>P<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>N <span class="main">∧</span> A<span class="main">)</span><span class="main">⟩_</span>f"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4_eve<span class="main"><span class="main">[</span></span><span class="operator">OF</span> STL4<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">□</span>P <span class="main">∧</span> <span class="main">□</span><span class="main">◇⟨</span>N <span class="main">∧</span> A<span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span><span class="main">(</span>P <span class="main">∧</span> <span class="main">○</span>P<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>N <span class="main">∧</span> A<span class="main">)</span><span class="main">⟩_</span>f"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> STL6<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> AA29<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> B1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span>P <span class="main">∧</span>  <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span><span class="main">(</span>P <span class="main">∧</span> <span class="main">○</span>P<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>N <span class="main">∧</span> A<span class="main">)</span><span class="main">⟩_</span>f"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span><span class="main">(</span>P <span class="main">∧</span> <span class="main">○</span>P<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>N <span class="main">∧</span> A<span class="main">)</span><span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">⟨</span>N <span class="main">∧</span> B<span class="main">⟩_</span>f"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> angle_actrans_sem<span class="main"><span class="main">[</span></span><span class="operator">unlifted</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> B1 this<span class="main">[</span><span class="operator">THEN</span> AA25<span class="main">,</span> <span class="operator">THEN</span> STL4<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>N<span class="main">]_</span>f <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span>P <span class="main">∧</span>  <span class="main">□</span><span class="main">◇⟨</span>A<span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>N <span class="main">∧</span> B<span class="main">⟩_</span>f"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">◇⟨</span>N <span class="main">∧</span> B<span class="main">⟩_</span>f <span class="main">⟶</span> <span class="main">□</span><span class="main">◇⟨</span>M<span class="main">⟩_</span>g"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> h1<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> AA25<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> STL4<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> A B <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> StrongF_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is the lattice rule from TLA›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> wf_leadsto<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⊢</span> F <span class="bound">x</span> <span class="main">↝</span> <span class="main">(</span>G <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">#</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span> <span class="main">∧</span> F <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="free">x</span> <span class="main">↝</span> G"</span></span>
<span class="keyword1"><span class="command">using</span></span> h1
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wf_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> ih<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">⊢</span> F <span class="bound">y</span> <span class="main">↝</span> G<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="skolem">x</span> <span class="main">↝</span> G"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> ih <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">#</span><span class="main">(</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">)</span> <span class="main">∧</span> F <span class="bound">y</span><span class="main">)</span> <span class="main">↝</span> G"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> LT21<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> LT33<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> LT19<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Stuttering Invariance"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> stut_Enabled<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>F<span class="main">⟩_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> enabled_def stutinv_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sim_first<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> stut_WF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> F <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="keyword1">WF(</span>F<span class="main">)_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WeakF_def stut_Enabled bothstutinvs<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> stut_SF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">NSTUTINV</span> F <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="keyword1">SF(</span>F<span class="main">)_</span>v"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> StrongF_def stut_Enabled bothstutinvs<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> livestutinv <span class="main">=</span> stut_WF stut_SF stut_Enabled

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="State">
<div class="head">
<h1>Theory State</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       A Definitional Encoding of TLA in Isabelle/HOL
    Authors:     Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
                 Stephan Merz &lt;Stephan.Merz at loria.fr&gt;
    Year:        2011
    Maintainer:  Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Representing state in TLA*›</span></span>

<span class="keyword1"><span class="command">theory</span></span> State 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Liveness.html">Liveness</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  We adopt the hidden state appraoch, as used in the existing 
  Isabelle/HOL TLA embedding \cite{Merz98}. This approach is also used
  in \cite{Ehmety01}.
  Here, a state space is defined by its projections, and everything else is
  unknown. Thus, a variable is a projection of the state space, and has the same
  type as a state function. Moreover, strong typing is achieved, since the projection
  function may have any result type. To achieve this, the state space is represented
  by an undefined type, which is an instance of the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>world›</span></span></span></span> class to enable
  use with the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Intensional›</span></span></span></span> theory.
›</span></span>

<span class="keyword1"><span class="command">typedecl</span></span> state

<span class="keyword1"><span class="command">instance</span></span> state <span class="main">::</span> <span class="quoted">world</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> statefun <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>state<span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> stfun"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> statepred  <span class="main">=</span> <span class="quoted"><span class="quoted">"bool statefun"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> tempfun <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>state<span class="main">,</span><span class="tfree">'a</span><span class="main">)</span> formfun"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> temporal <span class="main">=</span> <span class="quoted"><span class="quoted">"state formula"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Formalizing type state would require formulas to be tagged with
  their underlying state space and would result in a system that is
  much harder to use. (Unlike Hoare logic or Unity, TLA has quantification
  over state variables, and therefore one usually works with different
  state spaces within a single specification.) Instead, state is just
  an anonymous type whose only purpose is to provide Skolem constants.
  Moreover, we do not define a type of state variables separate from that
  of arbitrary state functions, again in order to simplify the definition
  of flexible quantification later on. Nevertheless, we need to distinguish
  state variables, mainly to define the enabledness of actions. The user
  identifies (tuples of) ``base'' state variables in a specification via the
  ``meta predicate'' <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>basevars›</span></span></span></span>, which is defined here.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stvars</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> statefun <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> basevars_def<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">stvars</span> <span class="main">≡</span> surj"</span></span> 

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"PRED"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>                          <span class="main">(</span><span class="quoted">"<span class="keyword1">PRED</span> _"</span><span class="main">)</span>
  <span class="quoted">"_stvars"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"lift <span class="main">⇒</span> bool"</span></span>                        <span class="main">(</span><span class="quoted">"<span class="keyword1">basevars</span> _"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1">PRED</span> P"</span>   <span class="main">⇀</span>  <span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">::</span>state <span class="main">=&gt;</span> <span class="main">_</span><span class="main">)</span>"</span>
  <span class="quoted">"_stvars"</span>  <span class="main">⇌</span>  <span class="quoted">"<span class="keyword1">CONST</span> stvars"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Base variables may be assigned arbitrary (type-correct) values.
  In the following lemma, note that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vs›</span></span></span></span> may be a tuple of variables.
  The correct identification of base variables is up to the user who must
  take care not to introduce an inconsistency. For example, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">basevars</span></span> <span class="main"><span class="main">(</span></span>x<span class="main"><span class="main">,</span></span>x<span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  would definitely be inconsistent.
›</span></span>

<span class="keyword1" id="State-basevars"><span class="command">lemma</span></span> basevars<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">basevars</span> vs <span class="main">⟹</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="free">vs</span> <span class="bound">u</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> basevars_def surj_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">vs</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="free">vs</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="free">vs</span> <span class="bound">u</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="State-baseE"><span class="command">lemma</span></span> baseE<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> H1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">basevars</span> v"</span></span> <span class="keyword2"><span class="keyword">and</span></span> H2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">v</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H1<span class="main">[</span><span class="operator">THEN</span> basevars<span class="main">]</span> H2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A variant written for sequences rather than single states.›</span></span>
<span class="keyword1" id="State-first_baseE"><span class="command">lemma</span></span> first_baseE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> H1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">basevars</span> v"</span></span> <span class="keyword2"><span class="keyword">and</span></span> H2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">v</span> <span class="main">(</span>first <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> H1<span class="main">[</span><span class="operator">THEN</span> basevars<span class="main">]</span> H2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> first_def<span class="main">)</span>

<span class="keyword1" id="State-base_pair1"><span class="command">lemma</span></span> base_pair1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">basevars</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">basevars</span> x"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> basevars_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
  <span class="keyword1"><span class="command">from</span></span> h<span class="main">[</span><span class="operator">THEN</span> basevars<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIFT</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="free">arbitrary</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> range <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="State-base_pair2"><span class="command">lemma</span></span> base_pair2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">basevars</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">basevars</span> y"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> basevars_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
  <span class="keyword1"><span class="command">from</span></span> h<span class="main">[</span><span class="operator">THEN</span> basevars<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LIFT</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">arbitrary</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> range <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="State-base_pair"><span class="command">lemma</span></span> base_pair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">basevars</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">basevars</span> x <span class="main">∧</span> <span class="keyword1">basevars</span> y"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> base_pair1 base_pair2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Since the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">unit</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> type has just one value, any state function of unit type
  satisfies the predicate <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>basevars›</span></span></span></span>. The following theorem can sometimes
  be useful because it gives a trivial solution for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>basevars›</span></span></span></span> premises.
›</span></span>

<span class="keyword1" id="State-unit_base"><span class="command">lemma</span></span> unit_base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">basevars</span> <span class="main">(</span>v<span class="main">::</span>state <span class="main">⇒</span> unit<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> basevars_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A pair of the form <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(x,x)›</span></span></span></span> will generally not satisfy the predicate
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>basevars›</span></span></span></span> -- except for pathological cases such as <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x::unit›</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">basevars</span> <span class="main">(</span>x<span class="main">,</span>x<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LIFT</span> <span class="main">(</span>x<span class="main">,</span>x<span class="main">)</span><span class="main">)</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">(</span>False<span class="main">,</span>True<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> basevars<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">basevars</span> <span class="main">(</span>x<span class="main">,</span>x<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LIFT</span> <span class="main">(</span>x<span class="main">,</span>x<span class="main">)</span><span class="main">)</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> basevars<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following theorem reduces the reasoning about the existence of a
  state sequence satisfiyng an enabledness predicate to finding a suitable
  value <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c›</span></span></span></span> at the successor state for the base variables of the 
  specification. This rule is intended for reasoning about standard TLA
  specifications, where <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Enabled›</span></span></span></span> is applied to actions, not arbitrary
  pre-formulas.
›</span></span>
<span class="keyword1" id="State-base_enabled"><span class="command">lemma</span></span> base_enabled<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">basevars</span> vs"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="free">vs</span> <span class="main">(</span>first <span class="bound">u</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>first <span class="free">s</span><span class="main">)</span> <span class="main">##</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> F"</span></span>
<span class="keyword1"><span class="command">using</span></span> h1 <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> first_baseE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">(</span>first <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>first <span class="free">s</span><span class="main">)</span> <span class="main">##</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">⊨</span> F"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> h2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> F"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> enabled_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Temporal Quantifiers"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In \cite{Lamport94}, Lamport gives a stuttering invariant definition
  of quantification over (flexible) variables. It relies on similarity
  of two sequences (as supported in our <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="Sequence.html"></a><a href="Sequence.html">TLA.Sequence</a><span class="antiquote"><span class="antiquote">}</span></span></span></span> theory), and
  equivalence of two sequences up to a variable (the bound variable).
  However, sequence equaivalence up to a variable, requires state
  equaivalence up to a variable. Our state representation above does not
  support this, hence we cannot encode Lamport's definition in our theory.
  Thus, we need to axiomatise quantification over (flexible) variables.
  Note that with a state representation supporting this, our theory should
  allow such an encoding.
›</span></span>

<span class="keyword1"><span class="command">consts</span></span>
  EEx        <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> statefun <span class="main">⇒</span> temporal<span class="main">)</span> <span class="main">⇒</span> temporal"</span></span>       <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span> <span class="quoted">"<span class="keyword1">Eex</span> "</span> 10<span class="main">)</span>
  AAll       <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> statefun <span class="main">⇒</span> temporal<span class="main">)</span> <span class="main">⇒</span> temporal"</span></span>       <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span> <span class="quoted">"<span class="keyword1">Aall</span> "</span> 10<span class="main">)</span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_EEx"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>idts<span class="main">,</span> lift<span class="main">]</span> <span class="main">=&gt;</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">∃∃</span> _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_AAll"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>idts<span class="main">,</span> lift<span class="main">]</span> <span class="main">=&gt;</span> lift"</span></span>                <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">∀∀</span> _<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>10<span class="main">]</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_EEx <span class="free">v</span> <span class="free">A</span>"</span>  <span class="main">==</span>   <span class="quoted">"<span class="keyword1">Eex</span> <span class="free">v</span><span class="main">.</span> <span class="free">A</span>"</span>
  <span class="quoted">"_AAll <span class="free">v</span> <span class="free">A</span>"</span> <span class="main">==</span>   <span class="quoted">"<span class="keyword1">Aall</span> <span class="free">v</span><span class="main">.</span> <span class="free">A</span>"</span>


<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     eexI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> F <span class="free">x</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃∃</span> <span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>  eexE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">⊨</span> <span class="main">(</span><span class="main">∃∃</span> <span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span> <span class="main">;</span> <span class="keyword1">basevars</span> vs<span class="main">;</span> <span class="main">(</span><span class="main">!!</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span> <span class="keyword1">basevars</span> <span class="main">(</span>x<span class="main">,</span>vs<span class="main">)</span><span class="main">;</span> <span class="free">s</span> <span class="main">⊨</span> F <span class="bound">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">⊨</span> G<span class="main">)</span><span class="main">⟧</span>
            <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span> <span class="main">⊨</span> G<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>  all_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">∀∀</span> <span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="main">∃∃</span> <span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>F <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>  eexSTUT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> F <span class="free">x</span> <span class="main">⟹</span> <span class="keyword1">STUTINV</span> <span class="main">(</span><span class="main">∃∃</span> <span class="bound">x</span><span class="main">.</span> F <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>  history<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span>I <span class="main">∧</span> <span class="main">□[</span>A<span class="main">]_</span>v<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃∃</span> <span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="main">$</span>h <span class="main">=</span> ha<span class="main">)</span> <span class="main">∧</span> I <span class="main">∧</span> <span class="main">□[</span>A <span class="main">∧</span> h<span class="main">$</span><span class="main">=</span>hb<span class="main">]_</span><span class="main">(</span>h<span class="main">,</span>v<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> eexI_unl <span class="main">=</span> eexI<span class="main">[</span><span class="operator">unlift_rule</span><span class="main">]</span> <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"w ⊨ F x ⟹ w ⊨ (∃∃ x. F x)"</span><span class="antiquote">}</span></span>›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tla_defs›</span></span></span></span> can be used to unfold TLA definitions into lowest predicate level.
  This is particularly useful for reasoning about enabledness of formulas.
›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> tla_defs <span class="main">=</span> unch_def before_def after_def first_def second_def suffix_def 
                  tail_def nexts_def app_def angle_actrans_def actrans_def


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Even">
<div class="head">
<h1>Theory Even</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       A Definitional Encoding of TLA in Isabelle/HOL
    Authors:     Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
                 Stephan Merz &lt;Stephan.Merz at loria.fr&gt;
    Year:        2011
    Maintainer:  Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹A simple illustrative example›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Even
<span class="keyword2"><span class="keyword">imports</span></span> <a href="State.html">State</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  A trivial example illustrating invariant proofs in the logic, and how
  Isabelle/HOL can help with specification. It proves that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> is
  always even in a program where <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> is initialized as 0 and
  always incremented by 2.
›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span>
  <span class="entity">Even</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  even_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">Even</span>"</span></span>
<span class="main">|</span> even_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∈</span> <span class="free">Even</span> <span class="main">⟹</span> Suc <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">Even</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> Program <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">init</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">act</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">phi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">init</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">$</span>x <span class="main">=</span> <span class="main">#</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">act</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> x<span class="main">`</span> <span class="main">=</span> Suc<span class="main">&lt;</span>Suc<span class="main">&lt;</span><span class="main">$</span>x<span class="main">&gt;</span><span class="main">&gt;</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> init <span class="main">∧</span> <span class="main">□[</span>act<span class="main">]_</span>x"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Program<span class="main">)</span> stutinvprog<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> phi"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phi_def init_def act_def stutinvs nstutinvs<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Program<span class="main">)</span> inveven<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> phi <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>x <span class="main">∈</span> <span class="main">#</span> Even<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> phi_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> invmono<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> init <span class="main">⟶</span> <span class="main">$</span>x <span class="main">∈</span> <span class="main">#</span>Even"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> init_def even_zero<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>x <span class="main">∈</span> <span class="main">#</span>Even <span class="main">∧</span> <span class="main">[</span>act<span class="main">]_</span>x <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>x <span class="main">∈</span> <span class="main">#</span>Even<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> act_def even_step tla_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Inc">
<div class="head">
<h1>Theory Inc</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       A Definitional Encoding of TLA in Isabelle/HOL
    Authors:     Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
                 Stephan Merz &lt;Stephan.Merz at loria.fr&gt;
    Year:        2011
    Maintainer:  Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Lamport's Inc example›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Inc
<span class="keyword2"><span class="keyword">imports</span></span> <a href="State.html">State</a>   
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  This example illustrates use of the embedding by mechanising
  the running example of Lamports original TLA paper \cite{Lamport94}.
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> pcount <span class="main">=</span> a <span class="main">|</span> b <span class="main">|</span> g

<span class="keyword1"><span class="command">locale</span></span> Firstprogram <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">init</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">m1</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">m2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">phi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Live</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">init</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">$</span>x <span class="main">=</span> <span class="main">#</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">$</span>y <span class="main">=</span> <span class="main">#</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> x<span class="main">`</span> <span class="main">=</span> Suc<span class="main">&lt;</span><span class="main">$</span>x<span class="main">&gt;</span> <span class="main">∧</span> y<span class="main">`</span> <span class="main">=</span> <span class="main">$</span>y"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m2</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> y<span class="main">`</span> <span class="main">=</span> Suc<span class="main">&lt;</span><span class="main">$</span>y<span class="main">&gt;</span> <span class="main">∧</span> x<span class="main">`</span> <span class="main">=</span> <span class="main">$</span>x"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Live</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="keyword1">WF(</span>m1<span class="main">)_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span> <span class="main">∧</span> <span class="keyword1">WF(</span>m2<span class="main">)_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">(</span>init <span class="main">∧</span> <span class="main">□[</span>m1 <span class="main">∨</span> m2<span class="main">]_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span> <span class="main">∧</span> Live<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bvar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">basevars</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Firstprogram<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> phi"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> phi_def init_def m1_def m2_def Live_def stutinvs nstutinvs livestutinv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Firstprogram<span class="main">)</span> enabled_m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>m1<span class="main">⟩_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>m1<span class="main">⟩_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> base_enabled<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bvar<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> m1_def tla_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Firstprogram<span class="main">)</span> enabled_m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>m2<span class="main">⟩_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>m2<span class="main">⟩_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> base_enabled<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bvar<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> m2_def tla_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> Secondprogram <span class="main">=</span> Firstprogram <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">sem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> nat"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">pc1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> pcount"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">pc2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> pcount"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">vars</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">initPsi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alpha1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">alpha2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">beta1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">beta2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">gamma1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">gamma2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Live2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">psi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"temporal"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">vars</span> <span class="main">≡</span> <span class="keyword1">LIFT</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">,</span>sem<span class="main">,</span>pc1<span class="main">,</span>pc2<span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">initPsi</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span> a <span class="main">∧</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span> a <span class="main">∧</span> <span class="main">$</span>x <span class="main">=</span> <span class="main">#</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">$</span>y <span class="main">=</span> <span class="main">#</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">$</span>sem <span class="main">=</span> <span class="main">#</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">alpha1</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">$</span>pc1 <span class="main">=</span><span class="main">#</span>a <span class="main">∧</span> <span class="main">#</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">$</span>sem <span class="main">∧</span> pc1<span class="main">$</span> <span class="main">=</span> <span class="main">#</span>b <span class="main">∧</span> sem<span class="main">$</span> <span class="main">=</span> <span class="main">$</span>sem <span class="main">-</span> <span class="main">#</span> <span class="main">1</span> <span class="main">∧</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">,</span>pc2<span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">alpha2</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">$</span>pc2 <span class="main">=</span><span class="main">#</span>a <span class="main">∧</span> <span class="main">#</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">$</span>sem <span class="main">∧</span> pc2<span class="main">`</span> <span class="main">=</span> <span class="main">#</span>b <span class="main">∧</span> sem<span class="main">$</span> <span class="main">=</span> <span class="main">$</span>sem <span class="main">-</span> <span class="main">#</span> <span class="main">1</span> <span class="main">∧</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">,</span>pc1<span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">beta1</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">$</span>pc1 <span class="main">=</span><span class="main">#</span>b <span class="main">∧</span> pc1<span class="main">`</span> <span class="main">=</span> <span class="main">#</span>g <span class="main">∧</span> x<span class="main">`</span> <span class="main">=</span> Suc<span class="main">&lt;</span><span class="main">$</span>x<span class="main">&gt;</span> <span class="main">∧</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>y<span class="main">,</span>sem<span class="main">,</span>pc2<span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">beta2</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">$</span>pc2 <span class="main">=</span><span class="main">#</span>b <span class="main">∧</span> pc2<span class="main">`</span> <span class="main">=</span> <span class="main">#</span>g <span class="main">∧</span> y<span class="main">`</span> <span class="main">=</span> Suc<span class="main">&lt;</span><span class="main">$</span>y<span class="main">&gt;</span> <span class="main">∧</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>x<span class="main">,</span>sem<span class="main">,</span>pc1<span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">gamma1</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">$</span>pc1 <span class="main">=</span><span class="main">#</span>g <span class="main">∧</span> pc1<span class="main">`</span> <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> sem<span class="main">`</span> <span class="main">=</span> Suc<span class="main">&lt;</span><span class="main">$</span>sem<span class="main">&gt;</span> <span class="main">∧</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">,</span>pc2<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">gamma2</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">$</span>pc2 <span class="main">=</span><span class="main">#</span>g <span class="main">∧</span> pc2<span class="main">`</span> <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> sem<span class="main">`</span> <span class="main">=</span> Suc<span class="main">&lt;</span><span class="main">$</span>sem<span class="main">&gt;</span> <span class="main">∧</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>x<span class="main">,</span>y<span class="main">,</span>pc1<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">(</span>alpha1 <span class="main">∨</span> beta1 <span class="main">∨</span> gamma1<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">(</span>alpha2 <span class="main">∨</span> beta2 <span class="main">∨</span> gamma2<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Live2</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="keyword1">SF(</span>n1<span class="main">)_</span>vars <span class="main">∧</span> <span class="keyword1">SF(</span>n2<span class="main">)_</span>vars"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">psi</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">(</span>initPsi <span class="main">∧</span> <span class="main">□[</span>n1 <span class="main">∨</span> n2<span class="main">]_</span>vars <span class="main">∧</span> Live2<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">(</span><span class="main">$</span>sem <span class="main">=</span> <span class="main">#</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span> a<span class="main">)</span>
               <span class="main">∨</span>   <span class="main">(</span><span class="main">$</span>sem <span class="main">=</span> <span class="main">#</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> <span class="main">$</span>pc2 <span class="main">∈</span> <span class="main">{</span><span class="main">#</span>b <span class="main">,</span> <span class="main">#</span>g<span class="main">}</span><span class="main">)</span> 
                                <span class="main">∨</span> <span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> <span class="main">$</span>pc1 <span class="main">∈</span> <span class="main">{</span><span class="main">#</span>b <span class="main">,</span> <span class="main">#</span>g<span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bvar2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">basevars</span> vars"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> Sact2_defs <span class="main">=</span> n1_def n2_def alpha1_def beta1_def gamma1_def alpha2_def beta2_def gamma2_def

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Proving invariants is the basis of every effort of system verification.
  We show that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>I›</span></span></span></span> is an inductive invariant of specification <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>psi›</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> psiI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> psi <span class="main">⟶</span> <span class="main">□</span>I"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> initPsi <span class="main">⟶</span> I"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> initPsi_def I_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> I <span class="main">∧</span> <span class="keyword1">Unchanged</span> vars <span class="main">⟶</span> <span class="main">○</span>I"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def vars_def tla_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> I <span class="main">∧</span> n1 <span class="main">⟶</span> <span class="main">○</span>I"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def Sact2_defs tla_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> I <span class="main">∧</span> n2 <span class="main">⟶</span> <span class="main">○</span>I"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def Sact2_defs tla_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> I <span class="main">∧</span> <span class="main">[</span>n1 <span class="main">∨</span> n2<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">○</span>I"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> actrans_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> init step <span class="keyword1"><span class="command">have</span></span> goal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> initPsi <span class="main">∧</span> <span class="main">□[</span>n1 <span class="main">∨</span> n2<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">□</span>I"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> invmono<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> initPsi <span class="main">∧</span> <span class="main">□[</span>n1 <span class="main">∨</span> n2<span class="main">]_</span>vars <span class="main">∧</span> Live2 <span class="main">==&gt;</span> <span class="main">⊢</span> initPsi <span class="main">∧</span> <span class="main">□[</span>n1 <span class="main">∨</span> n2<span class="main">]_</span>vars"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> goal <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Using this invariant we now prove step simulation, i.e. the safety part of
  the refinement proof.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> step_simulation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> psi <span class="main">⟶</span> init <span class="main">∧</span> <span class="main">□[</span>m1 <span class="main">∨</span> m2<span class="main">]_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> initPsi <span class="main">∧</span> <span class="main">□</span>I <span class="main">∧</span> <span class="main">□[</span>n1 <span class="main">∨</span> n2<span class="main">]_</span>vars <span class="main">⟶</span> init <span class="main">∧</span> <span class="main">□[</span>m1 <span class="main">∨</span> m2<span class="main">]_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> refinement1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> initPsi <span class="main">⟶</span> init"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> initPsi_def init_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> I <span class="main">∧</span> <span class="main">○</span>I <span class="main">∧</span> <span class="main">[</span>n1 <span class="main">∨</span> n2<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">[</span>m1 <span class="main">∨</span> m2<span class="main">]_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def m1_def m2_def vars_def Sact2_defs tla_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> psiI <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Liveness proofs require computing the enabledness conditions of actions.
  The first lemma below shows that all steps are visible, i.e. they change
  at least one variable.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> n1_ch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars <span class="main">=</span> n1"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> n1 <span class="main">⟶</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs tla_defs vars_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> angle_actrans_sem<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> enab_alpha1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">⟶</span> <span class="main">#</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">$</span>sem <span class="main">⟶</span> <span class="keyword1">Enabled</span> alpha1"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state seq"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> a"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">sem</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> alpha1"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> base_enabled<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bvar2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs tla_defs vars_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> enab_beta1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">⟶</span> <span class="keyword1">Enabled</span> beta1"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state seq"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> b"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> beta1"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> base_enabled<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bvar2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs tla_defs vars_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> enab_gamma1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g <span class="main">⟶</span> <span class="keyword1">Enabled</span> gamma1"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state seq"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> g"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> gamma1"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> base_enabled<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bvar2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs tla_defs vars_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> enab_n1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars <span class="main">=</span> <span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">⟶</span> <span class="main">#</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">$</span>sem<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> n1_ch<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> int_iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> n1 <span class="main">⟶</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">⟶</span> <span class="main">#</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">$</span>sem"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> enabledE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs tla_defs<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">⟶</span> <span class="main">#</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">$</span>sem<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Enabled</span> n1"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state seq"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> a <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">sem</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> n1"</span></span>
      <span class="keyword1"><span class="command">using</span></span> enab_alpha1<span class="main">[</span><span class="operator">unlift_rule</span><span class="main">]</span>
            enab_beta1<span class="main">[</span><span class="operator">unlift_rule</span><span class="main">]</span>
            enab_gamma1<span class="main">[</span><span class="operator">unlift_rule</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">pc1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n1_def Enabled_disj<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> tla_defs<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The analogous properties for the second process are obtained by copy and paste.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> n2_ch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars <span class="main">=</span> n2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> n2 <span class="main">⟶</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs tla_defs vars_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> angle_actrans_sem<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> enab_alpha2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">⟶</span> <span class="main">#</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">$</span>sem <span class="main">⟶</span> <span class="keyword1">Enabled</span> alpha2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state seq"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc2</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> a"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">sem</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> alpha2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> base_enabled<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bvar2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs tla_defs vars_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> enab_beta2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">⟶</span> <span class="keyword1">Enabled</span> beta2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state seq"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc2</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> b"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> beta2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> base_enabled<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bvar2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs tla_defs vars_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> enab_gamma2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g <span class="main">⟶</span> <span class="keyword1">Enabled</span> gamma2"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state seq"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc2</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> g"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> gamma2"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> base_enabled<span class="main"><span class="main">[</span></span><span class="operator">OF</span> bvar2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs tla_defs vars_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> enab_n2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars <span class="main">=</span> <span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">⟶</span> <span class="main">#</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">$</span>sem<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> n2_ch<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> int_iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> n2 <span class="main">⟶</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">⟶</span> <span class="main">#</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">$</span>sem"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> enabledE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs tla_defs<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">⟶</span> <span class="main">#</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="main">$</span>sem<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Enabled</span> n2"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state seq"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc2</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> a <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">sem</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊨</span> <span class="keyword1">Enabled</span> n2"</span></span>
      <span class="keyword1"><span class="command">using</span></span> enab_alpha2<span class="main">[</span><span class="operator">unlift_rule</span><span class="main">]</span>
            enab_beta2<span class="main">[</span><span class="operator">unlift_rule</span><span class="main">]</span>
            enab_gamma2<span class="main">[</span><span class="operator">unlift_rule</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">pc2</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n2_def Enabled_disj<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> tla_defs<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We use rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SF2›</span></span></span></span> to prove that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>psi›</span></span></span></span> implements strong fairness
  for the abstract action <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>m1›</span></span></span></span>. Since strong fairness implies weak fairness,
  it follows that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>psi›</span></span></span></span> refines the liveness condition of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>phi›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> psi_fair_m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> psi <span class="main">⟶</span> <span class="keyword1">SF(</span>m1<span class="main">)_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>n1 <span class="main">∨</span> n2<span class="main">]_</span>vars <span class="main">∧</span> <span class="keyword1">SF(</span>n1<span class="main">)_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span>I <span class="main">∧</span> <span class="keyword1">SF(</span>n2<span class="main">)_</span>vars<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">SF(</span>m1<span class="main">)_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SF2<span class="main">)</span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹
      Rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SF2›</span></span></span></span> requires us to choose a helpful action (whose effect implies
      <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⟨m1⟩_(x,y)›</span></span></span></span>) and a persistent condition, which will eventually remain
      true if the helpful action is never executed. In our case, the helpful action
      is <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>beta1›</span></span></span></span> and the persistent condition is <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc1 = b›</span></span></span></span>.
›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> beta1<span class="main">⟩_</span>vars <span class="main">⟶</span> <span class="main">⟨</span>m1<span class="main">⟩_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> beta1_def m1_def vars_def tla_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">∧</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span> <span class="main">∧</span> <span class="main">⟨</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> n1<span class="main">⟩_</span>vars <span class="main">⟶</span> beta1"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n1_def alpha1_def beta1_def gamma1_def tla_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">∧</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>m1<span class="main">⟩_</span><span class="main">(</span>x<span class="main">,</span> y<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> enab_n1<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹
      The difficult part of the proof is showing that the persistent condition
      will eventually always be true if the helpful action is never executed.
      We show that (1) whenever the condition becomes true it remains so and
      (2) eventually the condition must be true.
›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta1<span class="main">]_</span>vars
            <span class="main">∧</span> <span class="keyword1">SF(</span>n1<span class="main">)_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span>I <span class="main">∧</span> <span class="keyword1">SF(</span>n2<span class="main">)_</span>vars<span class="main">)</span> <span class="main">∧</span> <span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>m1<span class="main">⟩_</span><span class="main">(</span>x<span class="main">,</span> y<span class="main">)</span>
            <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta1<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">∧</span> <span class="main">[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta1<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs vars_def tla_defs<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> INV1<span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta1<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta1<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> E31<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta1<span class="main">]_</span>vars <span class="main">∧</span> <span class="keyword1">SF(</span>n1<span class="main">)_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span>I <span class="main">∧</span> <span class="keyword1">SF(</span>n2<span class="main">)_</span>vars<span class="main">)</span>
              <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹
          The plan of the proof is to show that from any state where <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc1 = g›</span></span></span></span>
          one eventually reaches <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc1 = a›</span></span></span></span>, from where one eventually reaches
          <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc1 = b›</span></span></span></span>. The result follows by combining leadsto properties.
›</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIFT</span> <span class="main">(</span><span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta1<span class="main">]_</span>vars <span class="main">∧</span> <span class="keyword1">SF(</span>n1<span class="main">)_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span>I <span class="main">∧</span> <span class="keyword1">SF(</span>n2<span class="main">)_</span>vars<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹
          Showing that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc1 = g›</span></span></span></span> leads to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc1 = a›</span></span></span></span> is a simple
          application of rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SF1›</span></span></span></span> because the first process completely
          controls this transition.
›</span></span>
        <span class="keyword1"><span class="command">have</span></span> ga<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?F <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g <span class="main">↝</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SF1<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g <span class="main">∧</span> <span class="main">[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta1<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">∨</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs vars_def tla_defs<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g <span class="main">∧</span> <span class="main">⟨</span><span class="main">(</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta1<span class="main">)</span> <span class="main">∧</span> n1<span class="main">⟩_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs vars_def tla_defs<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g <span class="main">∧</span> <span class="keyword1">Unchanged</span> vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def tla_defs<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> enab_n1<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ax1<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ E3<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">∧</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta1<span class="main">]_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span>I <span class="main">∧</span> <span class="keyword1">SF(</span>n2<span class="main">)_</span>vars<span class="main">)</span>
                  <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹
          The proof that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc1 = a›</span></span></span></span> leads to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc1 = b›</span></span></span></span> follows
          the same basic schema. However, showing that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n1›</span></span></span></span> is eventually
          enabled requires reasoning about the second process, which must liberate
          the critical section.
›</span></span>
        <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?F <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">↝</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SF1<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> <span class="main">[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta1<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span> <span class="main">∨</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs vars_def tla_defs<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> <span class="main">⟨</span><span class="main">(</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta1<span class="main">)</span> <span class="main">∧</span> n1<span class="main">⟩_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs vars_def tla_defs<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> <span class="keyword1">Unchanged</span> vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def tla_defs<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹We establish a suitable leadsto-chain.›</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIFT</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta1<span class="main">]_</span>vars <span class="main">∧</span> <span class="keyword1">SF(</span>n2<span class="main">)_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> I<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?G <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> I<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SF1›</span></span></span></span> takes us from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc2 = b›</span></span></span></span> to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc2 = g›</span></span></span></span>.›</span></span>
            <span class="keyword1"><span class="command">have</span></span> bg2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?G <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">↝</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SF1<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">∧</span> <span class="main">[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>beta1<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span> <span class="main">∨</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs vars_def tla_defs<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">∧</span> <span class="main">⟨</span><span class="main">(</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>beta1<span class="main">)</span> <span class="main">∧</span> n2<span class="main">⟩_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs vars_def tla_defs<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">∧</span> <span class="keyword1">Unchanged</span> vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def tla_defs<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> enab_n2<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ax1<span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ E3<span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span> <span class="main">∧</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>beta1<span class="main">]_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> I<span class="main">)</span>
                      <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Similarly, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc2 = b›</span></span></span></span> leads to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc2 = g›</span></span></span></span>.›</span></span>
            <span class="keyword1"><span class="command">have</span></span> ga2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?G <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g <span class="main">↝</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SF1<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g <span class="main">∧</span> <span class="main">[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>beta1<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">∨</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs vars_def tla_defs<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g <span class="main">∧</span> <span class="main">⟨</span><span class="main">(</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>beta1<span class="main">)</span> <span class="main">∧</span> n2<span class="main">⟩_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n2_def alpha2_def beta2_def gamma2_def vars_def tla_defs<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g <span class="main">∧</span> <span class="keyword1">Unchanged</span> vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def tla_defs<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> enab_n2<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ax1<span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ E3<span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">∧</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>beta1<span class="main">]_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> I<span class="main">)</span>
                      <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">with</span></span> bg2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?G <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">↝</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> LT13<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> ga2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?G <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∨</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">∨</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">↝</span> <span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> LT17<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> LT1<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∨</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">∨</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state seq"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc2</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> a"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc2</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> g"</span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc2</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> b"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">pc2</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∨</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">∨</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">↝</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fmp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ LT4<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?G <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SE3<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> I<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> enab_n1<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4_eve<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def tla_defs<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span> <span class="main">∧</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta1<span class="main">]_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span>I <span class="main">∧</span> <span class="keyword1">SF(</span>n2<span class="main">)_</span>vars<span class="main">)</span>
                  <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> ga ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?F <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g <span class="main">↝</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> LT13<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?F <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∨</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">∨</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">↝</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> LT17<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> LT1<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∨</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">∨</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state seq"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> a"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> g"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> b"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">pc1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∨</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">∨</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">↝</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fmp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ LT4<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> psiI <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psi_def Live2_def STL5<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In the same way we prove that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>psi›</span></span></span></span> implements strong fairness
  for the abstract action <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>m1›</span></span></span></span>. The proof is obtained by copy and paste
  from the previous one.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> psi_fair_m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> psi <span class="main">⟶</span> <span class="keyword1">SF(</span>m2<span class="main">)_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>n1 <span class="main">∨</span> n2<span class="main">]_</span>vars <span class="main">∧</span> <span class="keyword1">SF(</span>n2<span class="main">)_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span>I <span class="main">∧</span> <span class="keyword1">SF(</span>n1<span class="main">)_</span>vars<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">SF(</span>m2<span class="main">)_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SF2<span class="main">)</span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹
      Rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SF2›</span></span></span></span> requires us to choose a helpful action (whose effect implies
      <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⟨m2⟩_(x,y)›</span></span></span></span>) and a persistent condition, which will eventually remain
      true if the helpful action is never executed. In our case, the helpful action
      is <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>beta2›</span></span></span></span> and the persistent condition is <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc2 = b›</span></span></span></span>.
›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> beta2<span class="main">⟩_</span>vars <span class="main">⟶</span> <span class="main">⟨</span>m2<span class="main">⟩_</span><span class="main">(</span>x<span class="main">,</span>y<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> beta2_def m2_def vars_def tla_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">∧</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span> <span class="main">∧</span> <span class="main">⟨</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> n2<span class="main">⟩_</span>vars <span class="main">⟶</span> beta2"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n2_def alpha2_def beta2_def gamma2_def tla_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">∧</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>m2<span class="main">⟩_</span><span class="main">(</span>x<span class="main">,</span> y<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> enab_n2<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹
      The difficult part of the proof is showing that the persistent condition
      will eventually always be true if the helpful action is never executed.
      We show that (1) whenever the condition becomes true it remains so and
      (2) eventually the condition must be true.
›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta2<span class="main">]_</span>vars
            <span class="main">∧</span> <span class="keyword1">SF(</span>n2<span class="main">)_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span>I <span class="main">∧</span> <span class="keyword1">SF(</span>n1<span class="main">)_</span>vars<span class="main">)</span> <span class="main">∧</span> <span class="main">□</span><span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>m2<span class="main">⟩_</span><span class="main">(</span>x<span class="main">,</span> y<span class="main">)</span>
            <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta2<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">∧</span> <span class="main">[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta2<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs vars_def tla_defs<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> INV1<span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta2<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta2<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> E31<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta2<span class="main">]_</span>vars <span class="main">∧</span> <span class="keyword1">SF(</span>n2<span class="main">)_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span>I <span class="main">∧</span> <span class="keyword1">SF(</span>n1<span class="main">)_</span>vars<span class="main">)</span>
              <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹
          The plan of the proof is to show that from any state where <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc2 = g›</span></span></span></span>
          one eventually reaches <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc2 = a›</span></span></span></span>, from where one eventually reaches
          <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc2 = b›</span></span></span></span>. The result follows by combining leadsto properties.
›</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIFT</span> <span class="main">(</span><span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta2<span class="main">]_</span>vars <span class="main">∧</span> <span class="keyword1">SF(</span>n2<span class="main">)_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span>I <span class="main">∧</span> <span class="keyword1">SF(</span>n1<span class="main">)_</span>vars<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹
          Showing that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc2 = g›</span></span></span></span> leads to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc2 = a›</span></span></span></span> is a simple
          application of rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SF1›</span></span></span></span> because the second process completely
          controls this transition.
›</span></span>
        <span class="keyword1"><span class="command">have</span></span> ga<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?F <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g <span class="main">↝</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SF1<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g <span class="main">∧</span> <span class="main">[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta2<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">∨</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs vars_def tla_defs<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g <span class="main">∧</span> <span class="main">⟨</span><span class="main">(</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta2<span class="main">)</span> <span class="main">∧</span> n2<span class="main">⟩_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n2_def alpha2_def beta2_def gamma2_def vars_def tla_defs<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g <span class="main">∧</span> <span class="keyword1">Unchanged</span> vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def tla_defs<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> enab_n2<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ax1<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ E3<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">∧</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta2<span class="main">]_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span>I <span class="main">∧</span> <span class="keyword1">SF(</span>n1<span class="main">)_</span>vars<span class="main">)</span>
                  <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹
          The proof that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc2 = a›</span></span></span></span> leads to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc2 = b›</span></span></span></span> follows
          the same basic schema. However, showing that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n2›</span></span></span></span> is eventually
          enabled requires reasoning about the second process, which must liberate
          the critical section.
›</span></span>
        <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?F <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">↝</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SF1<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> <span class="main">[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta2<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span> <span class="main">∨</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs vars_def tla_defs<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> <span class="main">⟨</span><span class="main">(</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta2<span class="main">)</span> <span class="main">∧</span> n2<span class="main">⟩_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n2_def alpha2_def beta2_def gamma2_def vars_def tla_defs<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> <span class="keyword1">Unchanged</span> vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def tla_defs<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹We establish a suitable leadsto-chain.›</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIFT</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta2<span class="main">]_</span>vars <span class="main">∧</span> <span class="keyword1">SF(</span>n1<span class="main">)_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> I<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?G <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> I<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SF1›</span></span></span></span> takes us from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc1 = b›</span></span></span></span> to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc1 = g›</span></span></span></span>.›</span></span>
            <span class="keyword1"><span class="command">have</span></span> bg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?G <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">↝</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SF1<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">∧</span> <span class="main">[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>beta2<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span> <span class="main">∨</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs vars_def tla_defs<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">∧</span> <span class="main">⟨</span><span class="main">(</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>beta2<span class="main">)</span> <span class="main">∧</span> n1<span class="main">⟩_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n1_def alpha1_def beta1_def gamma1_def vars_def tla_defs<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">∧</span> <span class="keyword1">Unchanged</span> vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def tla_defs<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> enab_n1<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ax1<span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ E3<span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span> <span class="main">∧</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>beta2<span class="main">]_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> I<span class="main">)</span>
                      <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Similarly, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc1 = b›</span></span></span></span> leads to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pc1 = g›</span></span></span></span>.›</span></span>
            <span class="keyword1"><span class="command">have</span></span> ga1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?G <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g <span class="main">↝</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SF1<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g <span class="main">∧</span> <span class="main">[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>beta2<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">∨</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sact2_defs vars_def tla_defs<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g <span class="main">∧</span> <span class="main">⟨</span><span class="main">(</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>beta2<span class="main">)</span> <span class="main">∧</span> n1<span class="main">⟩_</span>vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n1_def alpha1_def beta1_def gamma1_def vars_def tla_defs<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g <span class="main">∧</span> <span class="keyword1">Unchanged</span> vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def tla_defs<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> enab_n1<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ax1<span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ E3<span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">∧</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>beta2<span class="main">]_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> I<span class="main">)</span>
                      <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n1<span class="main">⟩_</span>vars"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">with</span></span> bg1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?G <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">↝</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> LT13<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> ga1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?G <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∨</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">∨</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">↝</span> <span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> LT17<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> LT1<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∨</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">∨</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state seq"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> a"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> g"</span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> b"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">pc1</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∨</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>b <span class="main">∨</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">↝</span> <span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fmp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ LT4<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?G <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SE3<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>pc1 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∧</span> I<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> enab_n2<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> STL4_eve<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def tla_defs<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a<span class="main">)</span> <span class="main">∧</span> <span class="main">□[</span><span class="main">(</span>n1 <span class="main">∨</span> n2<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> beta2<span class="main">]_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="main">(</span>I <span class="main">∧</span> <span class="keyword1">SF(</span>n1<span class="main">)_</span>vars<span class="main">)</span>
                  <span class="main">⟶</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>n2<span class="main">⟩_</span>vars"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> STL5<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> ga ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?F <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g <span class="main">↝</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> LT13<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?F <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∨</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">∨</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">↝</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> LT17<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> LT1<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∨</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">∨</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state seq"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc2</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> a"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc2</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> g"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc2</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> b"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">pc2</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>a <span class="main">∨</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b <span class="main">∨</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>g<span class="main">)</span> <span class="main">↝</span> <span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>pc2 <span class="main">=</span> <span class="main">#</span>b<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fmp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ LT4<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> psiI <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> psi_def Live2_def STL5<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now prove the main theorem, which states that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>psi›</span></span></span></span>
  implements <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>phi›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Secondprogram<span class="main">)</span> impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> psi <span class="main">⟶</span> phi"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> phi_def Live_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> step_simulation<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span>
                 lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> psi_fair_m1 SF_imp_WF<span class="main"><span class="main">,</span></span> <span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span>
                 lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> psi_fair_m2 SF_imp_WF<span class="main"><span class="main">,</span></span> <span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Buffer">
<div class="head">
<h1>Theory Buffer</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       A Definitional Encoding of TLA in Isabelle/HOL
    Authors:     Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
                 Stephan Merz &lt;Stephan.Merz at loria.fr&gt;
    Year:        2011
    Maintainer:  Gudmund Grov &lt;ggrov at inf.ed.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Refining a Buffer Specification›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Buffer
<span class="keyword2"><span class="keyword">imports</span></span> <a href="State.html">State</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We specify a simple FIFO buffer and prove that two FIFO buffers
  in a row implement a FIFO buffer.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Buffer specification"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following definitions all take three parameters: a state function
  representing the input channel of the FIFO buffer, another representing
  the internal queue, and a third one representing the output channel.
  These parameters will be instantiated later in the definition of the
  double FIFO.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BInit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> statefun <span class="main">⇒</span> <span class="tfree">'a</span> list statefun <span class="main">⇒</span> <span class="tfree">'a</span> statefun <span class="main">⇒</span> temporal"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">BInit</span> <span class="free"><span class="bound"><span class="entity">ic</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">oc</span></span></span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">$</span>q <span class="main">=</span> <span class="main">#</span><span class="main">[]</span>
                          <span class="main">∧</span> <span class="main">$</span>ic <span class="main">=</span> <span class="main">$</span>oc"</span></span>   <span class="comment1">― ‹initial condition of buffer›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Enq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> statefun <span class="main">⇒</span> <span class="tfree">'a</span> list statefun <span class="main">⇒</span> <span class="tfree">'a</span> statefun <span class="main">⇒</span> temporal"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Enq</span> <span class="free"><span class="bound"><span class="entity">ic</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">oc</span></span></span> <span class="main">≡</span> <span class="keyword1">TEMP</span> ic<span class="main">$</span> <span class="main">≠</span> <span class="main">$</span>ic
                        <span class="main">∧</span> q<span class="main">$</span> <span class="main">=</span> <span class="main">$</span>q <span class="main">@</span> <span class="main">[</span> ic<span class="main">$</span> <span class="main">]</span>
                        <span class="main">∧</span> oc<span class="main">$</span> <span class="main">=</span> <span class="main">$</span>oc"</span></span>     <span class="comment1">― ‹enqueue a new value›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Deq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> statefun <span class="main">⇒</span> <span class="tfree">'a</span> list statefun <span class="main">⇒</span> <span class="tfree">'a</span> statefun <span class="main">⇒</span> temporal"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Deq</span> <span class="free"><span class="bound"><span class="entity">ic</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">oc</span></span></span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">#</span> <span class="main">0</span> <span class="main">&lt;</span> length<span class="main">&lt;</span><span class="main">$</span>q<span class="main">&gt;</span>
                        <span class="main">∧</span> oc<span class="main">$</span> <span class="main">=</span> hd<span class="main">&lt;</span><span class="main">$</span>q<span class="main">&gt;</span>
                        <span class="main">∧</span> q<span class="main">$</span> <span class="main">=</span> tl<span class="main">&lt;</span><span class="main">$</span>q<span class="main">&gt;</span>
                        <span class="main">∧</span> ic<span class="main">$</span> <span class="main">=</span> <span class="main">$</span>ic"</span></span>     <span class="comment1">― ‹dequeue value at front›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Nxt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> statefun <span class="main">⇒</span> <span class="tfree">'a</span> list statefun <span class="main">⇒</span> <span class="tfree">'a</span> statefun <span class="main">⇒</span> temporal"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Nxt</span> <span class="free"><span class="bound"><span class="entity">ic</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">oc</span></span></span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">(</span>Enq <span class="free"><span class="bound"><span class="entity">ic</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">oc</span></span></span> <span class="main">∨</span> Deq <span class="free"><span class="bound"><span class="entity">ic</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">oc</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹internal specification with buffer visible›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ISpec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> statefun <span class="main">⇒</span> <span class="tfree">'a</span> list statefun <span class="main">⇒</span> <span class="tfree">'a</span> statefun <span class="main">⇒</span> temporal"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ISpec</span> <span class="free"><span class="bound"><span class="entity">ic</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">oc</span></span></span> <span class="main">≡</span> <span class="keyword1">TEMP</span> BInit <span class="free"><span class="bound"><span class="entity">ic</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">oc</span></span></span>
                          <span class="main">∧</span> <span class="main">□[</span>Nxt <span class="free"><span class="bound"><span class="entity">ic</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">oc</span></span></span><span class="main">]_</span><span class="main">(</span>ic<span class="main">,</span>q<span class="main">,</span>oc<span class="main">)</span>
                          <span class="main">∧</span> <span class="keyword1">WF(</span>Deq <span class="free"><span class="bound"><span class="entity">ic</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">oc</span></span></span><span class="main">)_</span><span class="main">(</span>ic<span class="main">,</span>q<span class="main">,</span>oc<span class="main">)</span>"</span></span>

<span class="comment1">― ‹external specification: buffer hidden›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Spec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> statefun <span class="main">⇒</span> <span class="tfree">'a</span> statefun <span class="main">⇒</span> temporal"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Spec</span> <span class="free"><span class="bound"><span class="entity">ic</span></span></span> <span class="free"><span class="bound"><span class="entity">oc</span></span></span> <span class="main">==</span> <span class="keyword1">TEMP</span> <span class="main">(</span><span class="main">∃∃</span> <span class="bound">q</span><span class="main">.</span> ISpec <span class="free"><span class="bound"><span class="entity">ic</span></span></span> <span class="bound">q</span> <span class="free"><span class="bound"><span class="entity">oc</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Properties of the buffer"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The buffer never enqueues the same element twice. We therefore
  have the following invariant:
  \begin{itemize}
  \item any two subsequent elements in the queue are different, and
    the last element in the queue is different from the value of the
    output channel,
  \item if the queue is non-empty then the last element in the queue
    is the value that appears on the input channel,
  \item if the queue is empty then the values on the output and input
    channels are equal.
  \end{itemize}

  The following auxiliary predicate <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>noreps›</span></span></span></span> is true if no
  two subsequent elements in a list are identical.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">noreps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">noreps</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">!</span><span class="bound">i</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">!</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BInv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> statefun <span class="main">⇒</span> <span class="tfree">'a</span> list statefun <span class="main">⇒</span> <span class="tfree">'a</span> statefun <span class="main">⇒</span> temporal"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">BInv</span> <span class="free"><span class="bound"><span class="entity">ic</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">oc</span></span></span> <span class="main">≡</span> <span class="keyword1">TEMP</span> List.last<span class="main">&lt;</span><span class="main">$</span>oc <span class="main">#</span> <span class="main">$</span>q<span class="main">&gt;</span> <span class="main">=</span> <span class="main">$</span>ic <span class="main">∧</span> noreps<span class="main">&lt;</span><span class="main">$</span>oc <span class="main">#</span> <span class="main">$</span>q<span class="main">&gt;</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> buffer_defs <span class="main">=</span> BInit_def Enq_def Deq_def Nxt_def 
                     ISpec_def Spec_def BInv_def

<span class="keyword1" id="Buffer-ISpec_stutinv"><span class="command">lemma</span></span> ISpec_stutinv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> <span class="main">(</span>ISpec <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> buffer_defs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bothstutinvs livestutinv<span class="main">)</span>

<span class="keyword1" id="Buffer-Spec_stutinv"><span class="command">lemma</span></span> Spec_stutinv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> Spec <span class="free">ic</span> <span class="free">oc</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> buffer_defs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bothstutinvs livestutinv eexSTUT<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A lemma about lists that is useful in the following›</span></span>
<span class="keyword1" id="Buffer-tl_self_iff_empty"><span class="command">lemma</span></span> tl_self_iff_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"tl <span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> neq_Nil_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Buffer-tl_self_iff_empty'"><span class="command">lemma</span></span> tl_self_iff_empty'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">=</span> tl <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> tl <span class="free">xs</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> neq_Nil_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Buffer-Deq_visible"><span class="command">lemma</span></span> Deq_visible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Unchanged</span> v <span class="main">⟶</span> <span class="keyword1">Unchanged</span> q"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">&lt;</span>Deq <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span><span class="main">&gt;_</span>v <span class="main">=</span> Deq <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> deq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊨</span> Deq <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> unch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> unch v<span class="main">[</span><span class="operator">unlifted</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> deq <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Deq_def tla_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Buffer-Deq_enabledE"><span class="command">lemma</span></span> Deq_enabledE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> <span class="main">&lt;</span>Deq <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span><span class="main">&gt;_</span><span class="main">(</span>ic<span class="main">,</span>q<span class="main">,</span>oc<span class="main">)</span> <span class="main">⟶</span> <span class="main">$</span>q <span class="main">~=</span> <span class="main">#</span><span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> enabledE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Deq_def tla_defs<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now prove that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>BInv›</span></span></span></span> is an invariant of the Buffer
  specification.

  We need several lemmas about <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>noreps›</span></span></span></span> that are used in the
  invariant proof.
›</span></span>

<span class="keyword1" id="Buffer-noreps_empty"><span class="command">lemma</span></span> noreps_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"noreps <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_def<span class="main">)</span>

<span class="keyword1" id="Buffer-noreps_singleton"><span class="command">lemma</span></span> noreps_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"noreps <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span>  <span class="comment1">― ‹special case of following lemma›</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_def<span class="main">)</span>

<span class="keyword1" id="Buffer-noreps_cons"><span class="command">lemma</span></span> noreps_cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"noreps <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>noreps <span class="free">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">≠</span> hd <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_singleton<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> cons<span class="main">:</span> <span class="quoted"><span class="quoted">"noreps <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"noreps <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">xs</span><span class="main">!</span><span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">note</span></span> cons
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"noreps <span class="main">(</span>hd <span class="free">xs</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">xxs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xxs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"noreps <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> hd <span class="free">xs</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"noreps <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">xs</span><span class="main">!</span><span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> eq 2 xs <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
      <span class="keyword3"><span class="command">assume</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> i eq xs 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Buffer-noreps_append"><span class="command">lemma</span></span> noreps_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"noreps <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> 
   <span class="main">(</span>noreps <span class="free">xs</span> <span class="main">∧</span> noreps <span class="free">ys</span> <span class="main">∧</span> <span class="main">(</span><span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> List.last <span class="free">xs</span> <span class="main">≠</span> hd <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"noreps <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"noreps <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">xs</span><span class="main">!</span><span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> i eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> 1
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"noreps <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"noreps <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ys</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ys</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">ys</span><span class="main">!</span><span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">+</span> length <span class="free">xs</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> i eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> length <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> 1
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"noreps <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"List.last <span class="free">xs</span> <span class="main">=</span> hd <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">xxs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xxs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">yys</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">yys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> xs ys <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">xxs</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 4 xs ys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>length <span class="skolem">xxs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xxs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append last_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 5 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"noreps <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"noreps <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"List.last <span class="free">xs</span> <span class="main">≠</span> hd <span class="free">ys</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"noreps <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">xxs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xxs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> False <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">yys</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">yys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_def<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">+</span> length <span class="free">ys</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">xxs</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xxs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> xsi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xxs</span><span class="main">)</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xxs</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> nth_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xxs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="skolem">xxs</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> True xsi eq 1 xs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">xxs</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> length <span class="skolem">xxs</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> xs <span class="keyword1"><span class="command">have</span></span> xsi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> List.last <span class="free">xs</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append last_conv_nth<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> True xs ys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> 3 ys eq xsi <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> i2 xs <span class="keyword1"><span class="command">have</span></span> xsi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">ys</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> length <span class="free">xs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">from</span></span> xsi <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">-</span> length <span class="free">xs</span> <span class="main">=</span> Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> length <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> xsi <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">ys</span><span class="main">!</span><span class="main">(</span>Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> length <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">from</span></span> i xsi <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> length <span class="free">xs</span> <span class="main">&lt;</span> length <span class="free">ys</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> length <span class="free">xs</span><span class="main">)</span> <span class="main">≠</span> <span class="free">ys</span><span class="main">!</span><span class="main">(</span>Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> length <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> noreps_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">note</span></span> eq
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Buffer-ISpec_BInv_lemma"><span class="command">lemma</span></span> ISpec_BInv_lemma<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢</span> BInit <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span> <span class="main">∧</span> <span class="main">□[</span>Nxt <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span><span class="main">]_</span><span class="main">(</span>ic<span class="main">,</span>q<span class="main">,</span>oc<span class="main">)</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span>BInv <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> invmono<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> BInit <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span> <span class="main">⟶</span> BInv <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BInit_def BInv_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> enq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> Enq <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span> <span class="main">⟶</span> BInv <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span> <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span>BInv <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Enq_def BInv_def tla_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> deq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> Deq <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span> <span class="main">⟶</span> BInv <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span> <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span>BInv <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Deq_def BInv_def tla_defs neq_Nil_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> unch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>ic<span class="main">,</span>q<span class="main">,</span>oc<span class="main">)</span> <span class="main">⟶</span> BInv <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span> <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span>BInv <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BInv_def tla_defs<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> BInv <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span> <span class="main">∧</span> <span class="main">[</span>Nxt <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span><span class="main">]_</span><span class="main">(</span>ic<span class="main">,</span> q<span class="main">,</span> oc<span class="main">)</span> <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span>BInv <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Nxt_def actrans_def 
             <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> enq<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span> deq<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span> unch<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ISpec_BInv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ISpec <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span>BInv <span class="free">ic</span> <span class="free">q</span> <span class="free">oc</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ISpec_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ISpec_BInv_lemma<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Two FIFO buffers in a row implement a buffer"</span></span>

<span class="keyword1"><span class="command">locale</span></span> DBuffer <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">inp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> statefun"</span></span>       <span class="comment1">― ‹input channel for double FIFO›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">mid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> statefun"</span></span>       <span class="comment1">― ‹channel linking the two buffers›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">out</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> statefun"</span></span>       <span class="comment1">― ‹output channel for double FIFO›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">q1</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list statefun"</span></span>  <span class="comment1">― ‹inner queue of first FIFO›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">q2</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list statefun"</span></span>  <span class="comment1">― ‹inner queue of second FIFO›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">vars</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">vars</span> <span class="main">≡</span> <span class="keyword1">LIFT</span> <span class="main">(</span>inp<span class="main">,</span>mid<span class="main">,</span>out<span class="main">,</span>q1<span class="main">,</span>q2<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> DB_base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">basevars</span> vars"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We need to specify the behavior of two FIFO buffers in a row.
    Intuitively, that specification is just the conjunction of
    two buffer specifications, where the first buffer has input
    channel <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>inp›</span></span></span></span> and output channel <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>mid›</span></span></span></span> whereas
    the second one receives from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>mid›</span></span></span></span> and outputs on <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>out›</span></span></span></span>.
    However, this conjunction allows a simultaneous enqueue action
    of the first buffer and dequeue of the second one. It would not
    implement the previous buffer specification, which excludes such
    simultaneous enqueueing and dequeueing (it is written in
    ``interleaving style''). We could relax the specification of
    the FIFO buffer above, which is esthetically pleasant, but
    non-interleaving specifications are usually hard to get right
    and to understand. We therefore impose an interleaving constraint
    on the specification of the double buffer, which requires that
    enqueueing and dequeueing do not happen simultaneously.
›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">DBSpec</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">DBSpec</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> ISpec <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span>
                     <span class="main">∧</span> ISpec <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span>
                     <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span><span class="main">(</span>Enq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span> <span class="main">∧</span> Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span><span class="main">]_</span>vars"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    The proof rules of TLA are geared towards specifications of the
    form <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Init ∧ □[Next]_vars ∧ L›</span></span></span></span>, and we prove that
    <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>DBSpec›</span></span></span></span> corresponds to a specification in this form,
    which we now define.
›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">FullInit</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">FullInit</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">(</span>BInit <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span> <span class="main">∧</span> BInit <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">FullNxt</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">FullNxt</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> <span class="main">(</span>Enq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span> <span class="main">∧</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>q2<span class="main">,</span>out<span class="main">)</span>
                       <span class="main">∨</span> Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span> <span class="main">∧</span> Enq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span>
                       <span class="main">∨</span> Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span> <span class="main">∧</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>inp<span class="main">,</span>q1<span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">FullSpec</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">FullSpec</span> <span class="main">≡</span> <span class="keyword1">TEMP</span> FullInit
                       <span class="main">∧</span> <span class="main">□[</span>FullNxt<span class="main">]_</span>vars
                       <span class="main">∧</span> <span class="keyword1">WF(</span>Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">)_</span>vars
                       <span class="main">∧</span> <span class="keyword1">WF(</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)_</span>vars"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    The concatenation of the two queues will serve as the refinement mapping.
›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">qc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list statefun"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">qc</span> <span class="main">≡</span> <span class="keyword1">LIFT</span> <span class="main">(</span>q2 <span class="main">@</span> q1<span class="main">)</span>"</span></span>


  <span class="keyword1"><span class="command">lemmas</span></span> db_defs <span class="main">=</span> buffer_defs DBSpec_def FullInit_def FullNxt_def FullSpec_def
                   qc_def vars_def

  <span class="keyword1" id="Buffer-DBSpec_stutinv"><span class="command">lemma</span></span> DBSpec_stutinv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> DBSpec"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> db_defs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bothstutinvs livestutinv<span class="main">)</span>

  <span class="keyword1" id="Buffer-FullSpec_stutinv"><span class="command">lemma</span></span> FullSpec_stutinv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">STUTINV</span> FullSpec"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> db_defs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bothstutinvs livestutinv<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We prove that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>DBSpec›</span></span></span></span> implies <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>FullSpec›</span></span></span></span>. (The converse
    implication also holds but is not needed for our implementation proof.)
›</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    The following lemma is somewhat more bureaucratic than we'd like
    it to be. It shows that the conjunction of the next-state relations,
    together with the invariant for the first queue, implies the full
    next-state relation of the combined queues.
›</span></span>
  <span class="keyword1" id="Buffer-DBNxt_then_FullNxt"><span class="command">lemma</span></span> DBNxt_then_FullNxt<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>BInv <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span>
        <span class="main">∧</span> <span class="main">□[</span>Nxt <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">]_</span><span class="main">(</span>inp<span class="main">,</span>q1<span class="main">,</span>mid<span class="main">)</span> 
        <span class="main">∧</span> <span class="main">□[</span>Nxt <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">]_</span><span class="main">(</span>mid<span class="main">,</span>q2<span class="main">,</span>out<span class="main">)</span>
        <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span><span class="main">(</span>Enq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span> <span class="main">∧</span> Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span><span class="main">]_</span>vars
        <span class="main">⟶</span> <span class="main">□[</span>FullNxt<span class="main">]_</span>vars"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>?inv <span class="main">∧</span> ?nxts <span class="main">⟶</span> <span class="main">□[</span>FullNxt<span class="main">]_</span>vars"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>Nxt <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">]_</span><span class="main">(</span>inp<span class="main">,</span>q1<span class="main">,</span>mid<span class="main">)</span>
          <span class="main">∧</span> <span class="main">□[</span>Nxt <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">]_</span><span class="main">(</span>mid<span class="main">,</span>q2<span class="main">,</span>out<span class="main">)</span>
          <span class="main">⟶</span> <span class="main">□[</span>  <span class="main">[</span>Nxt <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">]_</span><span class="main">(</span>inp<span class="main">,</span>q1<span class="main">,</span>mid<span class="main">)</span> 
               <span class="main">∧</span> <span class="main">[</span>Nxt <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">]_</span><span class="main">(</span>mid<span class="main">,</span>q2<span class="main">,</span>out<span class="main">)</span><span class="main">]_</span><span class="main">(</span><span class="main">(</span>inp<span class="main">,</span>q1<span class="main">,</span>mid<span class="main">)</span><span class="main">,</span><span class="main">(</span>mid<span class="main">,</span>q2<span class="main">,</span>out<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?tmp <span class="main">⟶</span> <span class="main">□[</span>?b1b2<span class="main">]_</span>?vs"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M12<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>?b1b2<span class="main">]_</span>?vs <span class="main">⟶</span> <span class="main">□[</span>?b1b2<span class="main">]_</span>vars"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def tla_defs<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>Nxt <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">]_</span><span class="main">(</span>inp<span class="main">,</span>q1<span class="main">,</span>mid<span class="main">)</span>
             <span class="main">∧</span> <span class="main">□[</span>Nxt <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">]_</span><span class="main">(</span>mid<span class="main">,</span>q2<span class="main">,</span>out<span class="main">)</span>
             <span class="main">⟶</span> <span class="main">□[</span>  <span class="main">[</span>Nxt <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">]_</span><span class="main">(</span>inp<span class="main">,</span>q1<span class="main">,</span>mid<span class="main">)</span> 
                   <span class="main">∧</span> <span class="main">[</span>Nxt <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">]_</span><span class="main">(</span>mid<span class="main">,</span>q2<span class="main">,</span>out<span class="main">)</span> <span class="main">]_</span>vars"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>?b1b2<span class="main">]_</span>vars <span class="main">∧</span> <span class="main">□[</span><span class="main">¬</span><span class="main">(</span>Enq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span> <span class="main">∧</span> Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span><span class="main">]_</span>vars
               <span class="main">⟶</span> <span class="main">□[</span>?b1b2 <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>Enq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span> <span class="main">∧</span> Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span><span class="main">]_</span>vars"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?tmp2 <span class="main">⟶</span> <span class="main">□[</span>?mid<span class="main">]_</span>vars"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M8<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> ?inv <span class="main">⟶</span> <span class="main">#</span>True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> ?inv <span class="main">∧</span> <span class="main">○</span>?inv <span class="main">∧</span> <span class="main">[</span>?mid<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">[</span>FullNxt<span class="main">]_</span>vars"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> ?inv <span class="main">∧</span> ?mid <span class="main">⟶</span> <span class="main">[</span>FullNxt<span class="main">]_</span>vars"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> Nxt <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span>
                    <span class="main">⟶</span> <span class="main">[</span>Nxt <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">]_</span><span class="main">(</span>mid<span class="main">,</span>q2<span class="main">,</span>out<span class="main">)</span>
                    <span class="main">⟶</span> <span class="main">¬</span><span class="main">(</span>Enq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span> <span class="main">∧</span> Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span>
                    <span class="main">⟶</span> ?inv
                    <span class="main">⟶</span> FullNxt"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> enq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> Enq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span>
                        <span class="main">∧</span> <span class="main">[</span>Nxt <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">]_</span><span class="main">(</span>mid<span class="main">,</span>q2<span class="main">,</span>out<span class="main">)</span>
                        <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span>
                        <span class="main">⟶</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>q2<span class="main">,</span>out<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> db_defs tla_defs<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> deq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span> <span class="main">⟶</span> ?inv <span class="main">⟶</span> mid<span class="main">$</span> <span class="main">≠</span> <span class="main">$</span>mid"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Deq_def BInv_def<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> deq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span> <span class="main">⟶</span> mid<span class="main">$</span> <span class="main">=</span> <span class="main">$</span>mid"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Deq_def<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> deq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span>
                        <span class="main">∧</span> <span class="main">[</span>Nxt <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">]_</span><span class="main">(</span>mid<span class="main">,</span>q2<span class="main">,</span>out<span class="main">)</span>
                        <span class="main">∧</span> ?inv
                        <span class="main">⟶</span> Enq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Nxt_def tla_defs
                      <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> deq1<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span> deq2<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> enq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Nxt_def FullNxt_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> Nxt <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span>
                    <span class="main">⟶</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>inp<span class="main">,</span>q1<span class="main">,</span>mid<span class="main">)</span>
                    <span class="main">⟶</span> FullNxt"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> db_defs tla_defs<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>inp<span class="main">,</span>q1<span class="main">,</span>mid<span class="main">)</span> 
                <span class="main">⟶</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>mid<span class="main">,</span>q2<span class="main">,</span>out<span class="main">)</span>
                <span class="main">⟶</span> <span class="keyword1">Unchanged</span> vars"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def tla_defs<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> actrans_def 
                    <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span> B<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span> C<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span>?inv <span class="main">∧</span> <span class="main">□[</span>?mid<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">□</span><span class="main">#</span>True <span class="main">∧</span> <span class="main">□[</span>FullNxt<span class="main">]_</span>vars"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> TLA2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    It is now easy to show that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>DBSpec›</span></span></span></span> refines <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>FullSpec›</span></span></span></span>.
›</span></span>
  <span class="keyword1"><span class="command">theorem</span></span> DBSpec_impl_FullSpec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> DBSpec <span class="main">⟶</span> FullSpec"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> DBSpec <span class="main">⟶</span> FullInit"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DBSpec_def FullInit_def ISpec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> DBSpec <span class="main">⟶</span> <span class="main">□[</span>FullNxt<span class="main">]_</span>vars"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> DBSpec <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span>BInv <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DBSpec_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ISpec_BInv<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> DBSpec <span class="main">∧</span> <span class="main">□</span><span class="main">(</span>BInv <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">□[</span>FullNxt<span class="main">]_</span>vars"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DBSpec_def ISpec_def
                 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> DBNxt_then_FullNxt<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> DBSpec <span class="main">⟶</span> <span class="keyword1">WF(</span>Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">)_</span>vars"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> 31<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Unchanged</span> vars <span class="main">⟶</span> <span class="keyword1">Unchanged</span> q1"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def tla_defs<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>inp<span class="main">,</span>q1<span class="main">,</span>mid<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Unchanged</span> q1"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> deq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span>Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">⟩_</span>vars <span class="main">=</span> <span class="main">⟨</span>Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">⟩_</span><span class="main">(</span>inp<span class="main">,</span>q1<span class="main">,</span>mid<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Deq_visible<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 31<span class="main"><span class="main">,</span></span> <span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> 
                      Deq_visible<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 32<span class="main"><span class="main">,</span></span> <span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DBSpec_def ISpec_def WeakF_def 
                       deq<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> deq<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> AA26<span class="main"><span class="main">,</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> DBSpec <span class="main">⟶</span> <span class="keyword1">WF(</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)_</span>vars"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> 41<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Unchanged</span> vars <span class="main">⟶</span> <span class="keyword1">Unchanged</span> q2"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def tla_defs<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 42<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Unchanged</span> <span class="main">(</span>mid<span class="main">,</span>q2<span class="main">,</span>out<span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">Unchanged</span> q2"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> deq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">⟩_</span>vars <span class="main">=</span> <span class="main">⟨</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">⟩_</span><span class="main">(</span>mid<span class="main">,</span>q2<span class="main">,</span>out<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Deq_visible<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 41<span class="main"><span class="main">,</span></span> <span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> 
                      Deq_visible<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 42<span class="main"><span class="main">,</span></span> <span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DBSpec_def ISpec_def WeakF_def 
                       deq<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> deq<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> AA26<span class="main"><span class="main">,</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FullSpec_def 
               <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> 1<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span> 2<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span> 3<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span> 
                     4<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We now prove that two FIFO buffers in a row (as specified by formula
    <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>FullSpec›</span></span></span></span>) implement a FIFO buffer whose internal queue is the
    concatenation of the two buffers. We start by proving step simulation.
›</span></span>  

  <span class="keyword1" id="Buffer-FullInit"><span class="command">lemma</span></span> FullInit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> FullInit <span class="main">⟶</span> BInit <span class="free">inp</span> qc <span class="free">out</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> db_defs tla_defs<span class="main">)</span>

  <span class="keyword1" id="Buffer-Full_step_simulation"><span class="command">lemma</span></span> Full_step_simulation<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">[</span>FullNxt<span class="main">]_</span>vars <span class="main">⟶</span> <span class="main">[</span>Nxt <span class="free">inp</span> qc <span class="free">out</span><span class="main">]_</span><span class="main">(</span>inp<span class="main">,</span>qc<span class="main">,</span>out<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> db_defs tla_defs<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    The liveness condition requires that the combined buffer
    eventually performs a <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Deq›</span></span></span></span> action on the output channel
    if it contains some element. The idea is to use the
    fairness hypothesis for the first buffer to prove that in that
    case, eventually the queue of the second buffer will be
    non-empty, and that it must therefore eventually dequeue
    some element.

    The first step is to establish the enabledness conditions
    for the two <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Deq›</span></span></span></span> actions of the implementation.
›</span></span>

  <span class="keyword1" id="Buffer-Deq1_enabled"><span class="command">lemma</span></span> Deq1_enabled<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">⟩_</span>vars <span class="main">=</span> <span class="main">(</span><span class="main">$</span>q1 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span>Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">⟩_</span>vars <span class="main">=</span> Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Deq_visible<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def tla_defs<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> <span class="main">(</span>Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span>q1 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Deq_def tla_defs vars_def
                <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> base_enabled<span class="main"><span class="main">[</span></span><span class="operator">OF</span> DB_base<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> enabledE<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Buffer-Deq2_enabled"><span class="command">lemma</span></span> Deq2_enabled<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">⟩_</span>vars <span class="main">=</span> <span class="main">(</span><span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">⟩_</span>vars <span class="main">=</span> Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Deq_visible<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def tla_defs<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> <span class="main">(</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Deq_def tla_defs vars_def
                <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> base_enabled<span class="main"><span class="main">[</span></span><span class="operator">OF</span> DB_base<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> enabledE<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We now use rule <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>WF2›</span></span></span></span> to prove that the combined buffer
    (behaving according to specification <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>FullSpec›</span></span></span></span>)
    implements the fairness condition of the single buffer under
    the refinement mapping.
›</span></span>
  <span class="keyword1" id="Buffer-Full_fairness"><span class="command">lemma</span></span> Full_fairness<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>FullNxt<span class="main">]_</span>vars <span class="main">∧</span> <span class="keyword1">WF(</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)_</span>vars <span class="main">∧</span> <span class="main">□</span><span class="keyword1">WF(</span>Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">)_</span>vars
       <span class="main">⟶</span> <span class="keyword1">WF(</span>Deq <span class="free">inp</span> qc <span class="free">out</span><span class="main">)_</span><span class="main">(</span>inp<span class="main">,</span>qc<span class="main">,</span>out<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> WF2<span class="main">)</span>
    <span class="comment1">― ‹the helpful action is the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">Deq</span><span class="antiquote">}</span></span> action of the second queue›</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">⟨</span>FullNxt <span class="main">∧</span> Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">⟩_</span>vars <span class="main">⟶</span> <span class="main">⟨</span>Deq <span class="free">inp</span> qc <span class="free">out</span><span class="main">⟩_</span><span class="main">(</span>inp<span class="main">,</span>qc<span class="main">,</span>out<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> db_defs tla_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="comment1">― ‹the helpful condition is the second queue being non-empty›</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">(</span><span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> <span class="main">⟨</span>FullNxt <span class="main">∧</span> Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">⟩_</span>vars 
             <span class="main">⟶</span> Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tla_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span> <span class="main">∧</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>Deq <span class="free">inp</span> qc <span class="free">out</span><span class="main">⟩_</span><span class="main">(</span>inp<span class="main">,</span> qc<span class="main">,</span> out<span class="main">)</span>
             <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">⟩_</span>vars"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Deq2_enabled<span class="main">[</span><span class="operator">int_rewrite</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹
      The difficult part of the proof is to show that the helpful
      condition will eventually always be true provided that the
      combined dequeue action is eventually always enabled and that
      the helpful action is never executed. We prove that (1) the
      helpful condition persists and (2) that it must eventually
      become true.
›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□</span><span class="main">□[</span>FullNxt <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span><span class="main">]_</span>vars
            <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> STL4<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span> <span class="main">∧</span> <span class="main">[</span>FullNxt <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span><span class="main">]_</span>vars
               <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> db_defs tla_defs<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> INV1<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>FullNxt <span class="main">∧</span> <span class="main">¬</span> Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">]_</span>vars
              <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span> <span class="main">⟶</span> <span class="main">□</span><span class="main">(</span><span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>FullNxt <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span><span class="main">]_</span>vars
                <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span><span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> E31<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>FullNxt <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span><span class="main">]_</span>vars
               <span class="main">∧</span> <span class="keyword1">WF(</span>Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">)_</span>vars
               <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>Deq <span class="free">inp</span> qc <span class="free">out</span><span class="main">⟩_</span><span class="main">(</span>inp<span class="main">,</span> qc<span class="main">,</span> out<span class="main">)</span> <span class="main">↝</span> <span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> qc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">(</span><span class="main">$</span>qc <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span>q1 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span> <span class="main">∨</span> <span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qc_def tla_defs<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>FullNxt <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span><span class="main">]_</span>vars <span class="main">∧</span> <span class="keyword1">WF(</span>Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">)_</span>vars
              <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>q1 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span> <span class="main">↝</span> <span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> WF1<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>q1 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span> <span class="main">∧</span> <span class="main">[</span>FullNxt <span class="main">∧</span> <span class="main">¬</span> Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">]_</span>vars
                 <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>q1 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span> <span class="main">∨</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> db_defs tla_defs<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>q1 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span> 
                 <span class="main">∧</span> <span class="main">⟨</span><span class="main">(</span>FullNxt <span class="main">∧</span> <span class="main">¬</span> Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span> <span class="main">∧</span> Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">⟩_</span>vars <span class="main">⟶</span>
                 <span class="main">○</span><span class="main">(</span><span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> db_defs tla_defs<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">$</span>q1 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span> <span class="main">⟶</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">⟩_</span>vars"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Deq1_enabled<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|~</span> <span class="main">$</span>q1 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span> <span class="main">∧</span> <span class="keyword1">Unchanged</span> vars <span class="main">⟶</span> <span class="main">○</span><span class="main">(</span><span class="main">$</span>q1 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_def tla_defs<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>FullNxt <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span><span class="main">]_</span>vars 
                  <span class="main">∧</span> <span class="keyword1">WF(</span>Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">)_</span>vars
                  <span class="main">⟶</span> <span class="main">(</span><span class="main">$</span>qc <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span> <span class="main">↝</span> <span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qc<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> LT17<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span> LT1<span class="main"><span class="main">[</span></span><span class="operator">int_rewrite</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>Deq <span class="free">inp</span> qc <span class="free">out</span><span class="main">⟩_</span><span class="main">(</span>inp<span class="main">,</span> qc<span class="main">,</span> out<span class="main">)</span> <span class="main">↝</span> <span class="main">$</span>qc <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Deq_enabledE<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> LT3<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> LT13<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> LT6 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>FullNxt <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span><span class="main">]_</span>vars
             <span class="main">∧</span> <span class="keyword1">WF(</span>Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">)_</span>vars
             <span class="main">∧</span> <span class="main">◇</span><span class="keyword1">Enabled</span> <span class="main">⟨</span>Deq <span class="free">inp</span> qc <span class="free">out</span><span class="main">⟩_</span><span class="main">(</span>inp<span class="main">,</span> qc<span class="main">,</span> out<span class="main">)</span>
             <span class="main">⟶</span> <span class="main">◇</span><span class="main">(</span><span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">with</span></span> 1 E16
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> <span class="main">□[</span>FullNxt <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)</span><span class="main">]_</span>vars
            <span class="main">∧</span> <span class="keyword1">WF(</span>Deq <span class="free">mid</span> <span class="free">q2</span> <span class="free">out</span><span class="main">)_</span>vars
            <span class="main">∧</span> <span class="main">□</span><span class="keyword1">WF(</span>Deq <span class="free">inp</span> <span class="free">q1</span> <span class="free">mid</span><span class="main">)_</span>vars
            <span class="main">∧</span> <span class="main">◇</span><span class="main">□</span> <span class="keyword1">Enabled</span> <span class="main">⟨</span>Deq <span class="free">inp</span> qc <span class="free">out</span><span class="main">⟩_</span><span class="main">(</span>inp<span class="main">,</span> qc<span class="main">,</span> out<span class="main">)</span>
            <span class="main">⟶</span> <span class="main">◇</span><span class="main">□</span><span class="main">(</span><span class="main">$</span>q2 <span class="main">≠</span> <span class="main">#</span><span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    Putting everything together, we obtain that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>FullSpec›</span></span></span></span> refines
    the Buffer specification under the refinement mapping.
›</span></span>
  <span class="keyword1"><span class="command">theorem</span></span> FullSpec_impl_ISpec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> FullSpec <span class="main">⟶</span> ISpec <span class="free">inp</span> qc <span class="free">out</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> FullSpec_def ISpec_def
    <span class="keyword1"><span class="command">using</span></span> FullInit Full_step_simulation<span class="main">[</span><span class="operator">THEN</span> M11<span class="main">]</span> Full_fairness
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">theorem</span></span> FullSpec_impl_Spec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> FullSpec <span class="main">⟶</span> Spec <span class="free">inp</span> <span class="free">out</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Spec_def <span class="keyword1"><span class="command">using</span></span> FullSpec_impl_ISpec
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eexI<span class="main"><span class="main">[</span></span><span class="operator">unlift_rule</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    By transitivity, two buffers in a row also implement a single buffer.
›</span></span>
  <span class="keyword1"><span class="command">theorem</span></span> DBSpec_impl_Spec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢</span> DBSpec <span class="main">⟶</span> Spec <span class="free">inp</span> <span class="free">out</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lift_imp_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> DBSpec_impl_FullSpec FullSpec_impl_Spec<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹locale DBuffer›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>