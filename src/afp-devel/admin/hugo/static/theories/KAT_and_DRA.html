<div id="Test_Dioid">
<div class="head">
<h1>Theory Test_Dioid</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Kleene algebra with tests
   Author:     Alasdair Armstrong, Victor B. F. Gomes, Georg Struth
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Test Dioids›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Test_Dioid
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Kleene_Algebra/Dioid.html">Kleene_Algebra.Dioid</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Tests are embedded in a weak dioid, a dioid without the right annihilation and left distributivity axioms, using an 
  operator $t$ defined by a complementation operator. This allows us to use tests in weak settings, such as Probabilistic Kleene Algebra and Demonic Refinement Algebra.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Test Monoids›</span></span>

<span class="keyword1"><span class="command">class</span></span> n_op <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">n_op</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">n</span></span></span> _"</span> <span class="main">[</span>90<span class="main">]</span> 91<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> test_monoid <span class="main">=</span> monoid_mult <span class="main">+</span> n_op <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tm1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> tm2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> tm3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="comment1">(*no_notation zero_class.zero ("0")*)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">a_zero</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">o</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">o</span></span> <span class="main">≡</span> <span class="keyword1">n</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">n_add_op</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊕</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⊕</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">1</span>"</span></span>
<span class="comment1">(*nitpick*)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">1</span>"</span></span>
<span class="comment1">(*nitpick*)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">1</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">1</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">1</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>  "</span></span>
<span class="comment1">(*nitpick*)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Test_Dioid-n_t_closed"><span class="command">lemma</span></span> n_t_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">n</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="main">(</span>t <span class="main">(</span><span class="keyword1">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⋅</span> t <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> t <span class="main">(</span><span class="keyword1">n</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.tm3<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.mult_1_right local.tm1 local.tm2 local.tm3 mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-mult_t_closed"><span class="command">lemma</span></span> mult_t_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_1_right local.tm1 local.tm2 local.tm3 n_t_closed<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_comm_var"><span class="command">lemma</span></span> n_comm_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_1_left local.tm1 local.tm3 n_t_closed<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_comm"><span class="command">lemma</span></span> n_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_t_closed n_comm_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Test_Dioid-huntington1"><span class="command">lemma</span></span> huntington1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_1_right local.tm1 local.tm2 local.tm3<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-huntington2"><span class="command">lemma</span></span> huntington2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-add_assoc"><span class="command">lemma</span></span> add_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-t_mult_closure"><span class="command">lemma</span></span> t_mult_closure<span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> t <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> t <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_t_closed<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_t_compl"><span class="command">lemma</span></span> n_t_compl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> t <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_add_op_def local.tm1 local.tm2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1" id="Test_Dioid-zero_least1"><span class="command">lemma</span></span> zero_least1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">o</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_zero_def n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-zero_least2"><span class="command">lemma</span></span> zero_least2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">o</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">o</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_zero_def local.tm2 local.tm3 mult_assoc mult_t_closed zero_least1<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-zero_least3"><span class="command">lemma</span></span> zero_least3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">o</span>  <span class="main">=</span> <span class="keyword1">o</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_zero_def n_comm zero_least2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Test_Dioid-one_greatest1"><span class="command">lemma</span></span> one_greatest1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> a_zero_def local.tm1 n_add_op_def n_comm_var zero_least3<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-one_greatest2"><span class="command">lemma</span></span> one_greatest2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n_add_op_def n_comm_var one_greatest1<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_add_idem"><span class="command">lemma</span></span> n_add_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> huntington1 local.mult_1_right n_t_closed n_t_compl n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_mult_idem"><span class="command">lemma</span></span> n_mult_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_t_closed n_add_idem n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_preserve"><span class="command">lemma</span></span> n_preserve <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc n_comm n_mult_idem<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_preserve2"><span class="command">lemma</span></span> n_preserve2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">x</span> <span class="main">=</span> <span class="keyword1">o</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_zero_def local.tm2 mult_assoc n_comm zero_least3<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-de_morgan1"><span class="command">lemma</span></span> de_morgan1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> t <span class="free">x</span> <span class="main">⊕</span> t <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-de_morgan4"><span class="command">lemma</span></span> de_morgan4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">(</span>t <span class="free">x</span> <span class="main">⊕</span> t <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_add_op_def mult_t_closed n_t_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1" id="Test_Dioid-n_absorb1"><span class="command">lemma</span></span> n_absorb1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_1_right local.tm1 local.tm3 one_greatest2 n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_absorb2"><span class="command">lemma</span></span> n_absorb2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_t_closed n_absorb1 n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_distrib1"><span class="command">lemma</span></span> n_distrib1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.tm3 n_comm_var  n_add_op_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1" id="Test_Dioid-n_distrib1_opp"><span class="command">lemma</span></span> n_distrib1_opp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>  <span class="main">=</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_add_op_def n_comm n_distrib1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1" id="Test_Dioid-n_distrib2"><span class="command">lemma</span></span> n_distrib2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_t_closed n_distrib1 n_mult_idem  n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_distrib2_opp"><span class="command">lemma</span></span> n_distrib2_opp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> de_morgan1 mult_t_closed n_distrib1_opp n_add_op_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ts_ord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⊑</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Test_Dioid-ts_ord_alt"><span class="command">lemma</span></span> ts_ord_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_t_closed n_t_closed ts_ord_def n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-ts_ord_refl"><span class="command">lemma</span></span> ts_ord_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_ord_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-ts_ord_trans"><span class="command">lemma</span></span> ts_ord_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc ts_ord_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-ts_ord_antisym"><span class="command">lemma</span></span> ts_ord_antisym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n_add_idem n_comm ts_ord_def n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-ts_ord_mult_isol"><span class="command">lemma</span></span> ts_ord_mult_isol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_t_closed n_add_idem n_distrib1 ts_ord_def n_add_op_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_t_closed ts_ord_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-ts_ord_mult_isor"><span class="command">lemma</span></span> ts_ord_mult_isor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_comm ts_ord_mult_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-ts_ord_add_isol"><span class="command">lemma</span></span> ts_ord_add_isol<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_t_closed n_mult_idem ts_ord_def n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-ts_ord_add_isor"><span class="command">lemma</span></span> ts_ord_add_isor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_add_op_def n_comm ts_ord_add_isol <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1" id="Test_Dioid-ts_ord_anti"><span class="command">lemma</span></span> ts_ord_anti<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟹</span> t <span class="free">y</span> <span class="main">⊑</span> t <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n_absorb2 n_add_idem n_comm ts_ord_def n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-ts_ord_anti_iff"><span class="command">lemma</span></span> ts_ord_anti_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟷</span> t <span class="free">y</span> <span class="main">⊑</span> t <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ts_ord_anti <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Test_Dioid-zero_ts_ord"><span class="command">lemma</span></span> zero_ts_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">o</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_zero_def ts_ord_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_subid"><span class="command">lemma</span></span> n_subid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a_zero_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> ts_ord_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_mult_lb1"><span class="command">lemma</span></span> n_mult_lb1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.mult_1_right local.tm1 n_comm n_subid ts_ord_mult_isor<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_mult_lb2"><span class="command">lemma</span></span> n_mult_lb2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n_comm n_mult_lb1<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_mult_glbI"><span class="command">lemma</span></span> n_mult_glbI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⟹</span>  <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n_t_closed ts_ord_anti_iff ts_ord_def ts_ord_mult_isol<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_mult_glb"><span class="command">lemma</span></span> n_mult_glb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">∧</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_t_closed n_mult_glbI n_mult_lb1 n_mult_lb2 ts_ord_trans<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_add_ub1"><span class="command">lemma</span></span> n_add_ub1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> n_absorb2 n_mult_lb2 n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_add_ub2"><span class="command">lemma</span></span> n_add_ub2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n_add_ub1 n_comm_var n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_add_lubI"><span class="command">lemma</span></span> n_add_lubI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ts_ord_add_isol ts_ord_alt<span class="main">)</span> 

<span class="keyword1" id="Test_Dioid-n_add_lub"><span class="command">lemma</span></span> n_add_lub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">∧</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n_add_lubI n_add_op_def n_add_ub1 n_add_ub2 ts_ord_trans<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_galois1"><span class="command">lemma</span></span> n_galois1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">y</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">y</span> <span class="main">⊑</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">)</span> <span class="main">⋅</span> t <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n_add_op_def ts_ord_mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> t <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_add_op_def local.tm3 n_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>    
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> t <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_zero_def local.tm2 n_distrib2 zero_least1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">y</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_t_closed n_mult_glb<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">y</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">=</span> t <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> t <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.mult_1_right n_t_closed n_t_compl <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> t <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_distrib1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  <span class="main">⊑</span> t <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation local.mult_1_right mult_t_closed n_add_op_def n_add_ub2 n_distrib2 n_t_compl<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> a mult_t_closed ts_ord_add_isol ts_ord_trans n_add_op_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-n_galois2"><span class="command">lemma</span></span> n_galois2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> t <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> n_galois1 n_t_closed<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_distrib_alt"><span class="command">lemma</span></span> n_distrib_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_absorb1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_distrib2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_add_op_def b n_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a b n_distrib1 n_distrib2 n_mult_idem<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_absorb2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-n_dist_var1"><span class="command">lemma</span></span> n_dist_var1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>t <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>t <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">x</span> <span class="main">⊕</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> n_add_op_def n_distrib1 n_distrib1_opp <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊕</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> t <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> t <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_add_op_def local.mult_1_left local.tm1 local.tm2 n_comm n_t_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊕</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊕</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc mult_t_closed n_distrib1_opp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>t <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span> <span class="bound">ab</span><span class="main">.</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="bound">aa</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="bound">ab</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="bound">a</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="bound">aa</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="bound">ab</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> mult_t_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">aa</span> <span class="bound">ab</span><span class="main">.</span> <span class="keyword1">n</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="bound">aa</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="bound">ab</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="bound">aa</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="bound">ab</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc n_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_t_closed n_add_op_def n_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>t <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> t <span class="main">(</span>t <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⊕</span> t <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_assoc mult_t_closed n_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>t <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_zero_def n_add_op_def local.mult_1_right local.tm1 mult_t_closed n_absorb1 zero_least2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-n_dist_var2"><span class="command">lemma</span></span> n_dist_var2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">y</span> <span class="main">⊕</span> t <span class="free">x</span> <span class="main">⋅</span> t <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> n_add_op_def n_dist_var1 n_t_closed<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Test Near-Semirings›</span></span>
 
<span class="keyword1"><span class="command">class</span></span> test_near_semiring_zerol <span class="main">=</span> ab_near_semiring_one_zerol <span class="main">+</span> n_op <span class="main">+</span> plus_ord <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> test_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> test_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> test_mult_comp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> test_de_morgan <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>  

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Test_Dioid-n_zero"><span class="command">lemma</span></span> n_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">0</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="main">1</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.test_mult_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-n_one"><span class="command">lemma</span></span> n_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">1</span> <span class="main">⋅</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">1</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> test_mult_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-one_idem"><span class="command">lemma</span></span> one_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">1</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.test_de_morgan <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">(</span><span class="main">0</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subclass</span></span> near_dioid_one_zerol
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.distrib_right' local.mult_onel <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⋅</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-t_n_closed"><span class="command">lemma</span></span> t_n_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.test_de_morgan <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-t_de_morgan_var1"><span class="command">lemma</span></span> t_de_morgan_var1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.test_de_morgan t_n_closed<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_mult_comm"><span class="command">lemma</span></span> n_mult_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.test_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.test_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Test_Dioid-tm3'"><span class="command">lemma</span></span> tm3'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_mult_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.test_mult n_mult_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> t_de_morgan_var1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subclass</span></span> test_monoid
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="keyword1">n</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">n</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="bound">x</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">⋀</span><span class="bound">x</span> <span class="bound">z</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">n</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="keyword1">n</span> <span class="bound">z</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="bound">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tm3' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-ord_transl"><span class="command">lemma</span></span> ord_transl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.join.sup.absorb_iff2 local.n_add_op_def local.ts_ord_alt<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-add_transl"><span class="command">lemma</span></span> add_transl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.n_add_op_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-zero_trans"><span class="command">lemma</span></span> zero_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="keyword1">o</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.a_zero_def n_one<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">test</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">test</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> t <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span> n_op <span class="main">(</span><span class="quoted">"<span class="keyword1">!</span>_"</span> <span class="main">[</span>101<span class="main">]</span> 100<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_prop"><span class="command">lemma</span></span> test_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> test <span class="bound">x</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>t <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> test_def t_n_closed<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_propI"><span class="command">lemma</span></span> test_propI<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>t <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> test_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_propE"><span class="command">lemma</span></span> test_propE <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>t <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> test_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_comp_closed"><span class="command">lemma</span></span> test_comp_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="main">(</span><span class="main">!</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> test_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_double_comp_var"><span class="command">lemma</span></span> test_double_comp_var<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">=</span> <span class="main">!</span><span class="main">(</span><span class="main">!</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-test_mult_closed"><span class="command">lemma</span></span> test_mult_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> test <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.test_mult test_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-t_add_closed"><span class="command">lemma</span></span> t_add_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.test_de_morgan t_n_closed<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_add_closed"><span class="command">lemma</span></span> test_add_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> test <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> t_add_closed test_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_mult_comm_var"><span class="command">lemma</span></span> test_mult_comm_var<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_mult_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-t_zero"><span class="command">lemma</span></span> t_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Test_Dioid-test_zero_var"><span class="command">lemma</span></span> test_zero_var<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> test_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_one_var"><span class="command">lemma</span></span> test_one_var<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> test_def<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_preserve"><span class="command">lemma</span></span> test_preserve<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-test_preserve2"><span class="command">lemma</span></span> test_preserve2<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.a_zero_def local.n_preserve2 n_one test_double_comp_var<span class="main">)</span>

 
<span class="keyword1" id="Test_Dioid-n_subid'"><span class="command">lemma</span></span> n_subid'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.n_subid n_zero ord_transl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Test_Dioid-test_subid"><span class="command">lemma</span></span> test_subid<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_subid' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-test_mult_idem_var"><span class="command">lemma</span></span> test_mult_idem_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_add_comp"><span class="command">lemma</span></span> n_add_comp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> t <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Test_Dioid-n_add_comp_var"><span class="command">lemma</span></span> n_add_comp_var <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_commute<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_add_comp"><span class="command">lemma</span></span> test_add_comp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_add_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
 
<span class="keyword1" id="Test_Dioid-test_comp_mult1"><span class="command">lemma</span></span> test_comp_mult1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-test_comp_mult2"><span class="command">lemma</span></span> test_comp_mult2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.test_mult_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Test_Dioid-test_comp"><span class="command">lemma</span></span> test_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">q</span><span class="main">.</span> test <span class="bound">q</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">+</span> <span class="bound">q</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">⋅</span> <span class="bound">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> test_add_comp test_comp_closed test_comp_mult2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Test_Dioid-n_absorb1'"><span class="command">lemma</span></span> n_absorb1' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_transl local.de_morgan4 local.n_absorb1<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_absorb1"><span class="command">lemma</span></span> test_absorb1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">+</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_absorb2'"><span class="command">lemma</span></span> n_absorb2' <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Test_Dioid-test_absorb2"><span class="command">lemma</span></span> test_absorb2<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_distrib_left"><span class="command">lemma</span></span> n_distrib_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> add_transl local.de_morgan4 local.n_distrib1<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_distrib_left"><span class="command">lemma</span></span> test_distrib_left<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span>  test <span class="free">q</span> <span class="main">⟹</span> test <span class="free">r</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">+</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-de_morgan1'"><span class="command">lemma</span></span> de_morgan1'<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">!</span><span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_de_morgan_var2"><span class="command">lemma</span></span> n_de_morgan_var2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> t <span class="free">x</span> <span class="main">⋅</span> t <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.test_de_morgan local.test_mult<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_de_morgan_var3"><span class="command">lemma</span></span> n_de_morgan_var3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">(</span>t <span class="free">x</span> <span class="main">+</span> t <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Test_Dioid-de_morgan2"><span class="command">lemma</span></span> de_morgan2<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">!</span><span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-de_morgan3"><span class="command">lemma</span></span> de_morgan3<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="main">!</span><span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.de_morgan1' local.t_mult_closure test_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  

<span class="keyword1" id="Test_Dioid-de_morgan4'"><span class="command">lemma</span></span> de_morgan4'<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="main">!</span><span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">+</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_add_distr"><span class="command">lemma</span></span> n_add_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_transl local.n_distrib2 n_de_morgan_var3<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_add_distr"><span class="command">lemma</span></span> test_add_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> test <span class="free">r</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">+</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_add_distr <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Test_Dioid-n_add_distl"><span class="command">lemma</span></span> n_add_distl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_commute n_add_distr<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_add_distl_var"><span class="command">lemma</span></span> test_add_distl_var<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> test <span class="free">r</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">+</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_commute test_add_distr<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_ord_def_alt"><span class="command">lemma</span></span> n_ord_def_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.join.sup.absorb_iff2 local.n_absorb2' local.n_mult_lb2 ord_transl<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_leq_mult_def_var"><span class="command">lemma</span></span> test_leq_mult_def_var<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_ord_def_alt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_anti"><span class="command">lemma</span></span> n_anti<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟹</span> t <span class="free">y</span> <span class="main">≤</span> t <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.ts_ord_anti ord_transl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Test_Dioid-n_anti_iff"><span class="command">lemma</span></span> n_anti_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟷</span> t <span class="free">y</span> <span class="main">≤</span> t <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_anti <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Test_Dioid-test_comp_anti_iff"><span class="command">lemma</span></span> test_comp_anti_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⟷</span> <span class="main">!</span><span class="free">q</span> <span class="main">≤</span> <span class="main">!</span><span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_anti_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_restrictl"><span class="command">lemma</span></span> n_restrictl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.mult_isor n_subid' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Test_Dioid-test_restrictl"><span class="command">lemma</span></span> test_restrictl<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_restrictl<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_mult_lb1'"><span class="command">lemma</span></span> n_mult_lb1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.join.sup.orderI<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_mult_lb1"><span class="command">lemma</span></span> test_mult_lb1<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_mult_lb1'<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_mult_lb2'"><span class="command">lemma</span></span> n_mult_lb2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> local.n_restrictl<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_mult_lb2"><span class="command">lemma</span></span> test_mult_lb2<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">≤</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> test_restrictl<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_mult_glbI'"><span class="command">lemma</span></span> n_mult_glbI'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⟹</span>  <span class="keyword1">n</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isor n_ord_def_alt<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_mult_glbI"><span class="command">lemma</span></span> test_mult_glbI<span class="main">:</span>  <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> test <span class="free">r</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.mult_isor test_leq_mult_def_var<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_mult_glb'"><span class="command">lemma</span></span> n_mult_glb'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">∧</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.order_trans n_mult_glbI' n_mult_lb1' n_mult_lb2' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Test_Dioid-test_mult_glb"><span class="command">lemma</span></span> test_mult_glb<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> test <span class="free">r</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.n_mult_glb' <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Test_Dioid-n_galois1'"><span class="command">lemma</span></span> n_galois1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⊕</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.test_de_morgan ord_transl n_add_op_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">y</span> <span class="main">⊑</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.n_galois1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.test_mult ord_transl<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-test_galois1"><span class="command">lemma</span></span> test_galois1<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> test <span class="free">r</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">+</span> <span class="free">r</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">≤</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_galois1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_galois2'"><span class="command">lemma</span></span> n_galois2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">≤</span> t <span class="free">y</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.n_galois1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-test_galois2"><span class="command">lemma</span></span> test_galois2<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> test <span class="free">r</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">!</span><span class="free">q</span> <span class="main">+</span> <span class="free">r</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">≤</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> test_galois1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_huntington2"><span class="command">lemma</span></span> n_huntington2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> t <span class="free">y</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Test_Dioid-test_huntington2"><span class="command">lemma</span></span> test_huntington2<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="main">!</span><span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">!</span><span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">!</span><span class="main">(</span><span class="main">!</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 test_double_comp_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> n_huntington2 test_double_comp_var<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-n_kat_1_opp"><span class="command">lemma</span></span> n_kat_1_opp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟷</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"t <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" t <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_mult_comm<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.add_zerol local.distrib_right' n_add_comp t_n_closed<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-test_eq4"><span class="command">lemma</span></span> test_eq4<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_kat_1_opp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_kat_1_var"><span class="command">lemma</span></span> n_kat_1_var<span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_kat_1_opp<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_kat_1"><span class="command">lemma</span></span> test_kat_1<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⟷</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_kat_1_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_kat_21_opp"><span class="command">lemma</span></span> n_kat_21_opp<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.join.sup_absorb2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.add_zeror local.distrib_right' local.n_mult_idem mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.add_zeror local.distrib_right' local.join.sup_absorb2 local.join.sup_left_commute local.mult_onel local.n_subid'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-test_kat_21_opp"><span class="command">lemma</span></span> test_kat_21_opp<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_kat_21_opp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span>  <span class="quoted"><span class="quoted">" <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="comment1">(*nitpick*)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Test_Dioid-n_distrib_alt'"><span class="command">lemma</span></span> n_distrib_alt'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.n_distrib_alt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-test_distrib_alt"><span class="command">lemma</span></span> test_distrib_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> test <span class="free">r</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">r</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">r</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">+</span> <span class="free">r</span> <span class="main">=</span> <span class="free">q</span> <span class="main">+</span> <span class="free">r</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_distrib_alt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_eq1"><span class="command">lemma</span></span> n_eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">∧</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">∧</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> t <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.distrib_right' <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-test_eq1"><span class="command">lemma</span></span> test_eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_eq1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_dist_var1'"><span class="command">lemma</span></span> n_dist_var1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>t <span class="free">x</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_transl local.n_dist_var1 local.test_mult<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_dist_var1"><span class="command">lemma</span></span> test_dist_var1<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> test <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">+</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_dist_var1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Test_Dioid-n_dist_var2'"><span class="command">lemma</span></span> n_dist_var2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">+</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">y</span> <span class="main">+</span> t <span class="free">x</span> <span class="main">⋅</span> t <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">y</span> <span class="main">=</span> <span class="main">!</span><span class="main">(</span><span class="main">!</span><span class="main">(</span><span class="main">!</span><span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_de_morgan_var3 t_de_morgan_var1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">!</span><span class="main">(</span><span class="main">!</span><span class="main">(</span><span class="main">!</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">!</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> n_de_morgan_var3 n_dist_var1' t_de_morgan_var1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-test_dist_var2"><span class="command">lemma</span></span> test_dist_var2<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> test <span class="free">r</span> <span class="main">⟹</span> <span class="main">!</span><span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_dist_var2' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-test_restrictr"><span class="command">lemma</span></span> test_restrictr<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Test_Dioid-test_eq2"><span class="command">lemma</span></span> test_eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Test_Dioid-test_eq3"><span class="command">lemma</span></span> test_eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Test_Dioid-test1"><span class="command">lemma</span></span> test1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">;</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">;</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Test_Dioid-comm_add"><span class="command">lemma</span></span> comm_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">⋅</span><span class="free">p</span><span class="main">;</span> <span class="free">p</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="free">y</span><span class="main">⋅</span><span class="free">p</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span><span class="main">⋅</span><span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">⋅</span><span class="free">p</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Test_Dioid-comm_add_var"><span class="command">lemma</span></span> comm_add_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">;</span> test <span class="free">r</span><span class="main">;</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">⋅</span><span class="free">p</span><span class="main">;</span> <span class="free">p</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="free">y</span><span class="main">⋅</span><span class="free">p</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span><span class="main">⋅</span><span class="main">(</span><span class="free">q</span><span class="main">⋅</span><span class="free">x</span> <span class="main">+</span> <span class="free">r</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span><span class="main">⋅</span><span class="free">x</span> <span class="main">+</span> <span class="free">r</span><span class="main">⋅</span><span class="free">y</span><span class="main">)</span><span class="main">⋅</span><span class="free">p</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">∧</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> "</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="Test_Dioid-test_distrib"><span class="command">lemma</span></span> test_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">q</span><span class="main">⋅</span><span class="free">y</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span><span class="main">⋅</span><span class="free">y</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span><span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Test Near Semirings with Distributive Tests›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now make the assumption that tests distribute over finite sums of arbitrary elements from the left.
  This can be justified in models such as multirelations and probabilistic predicate transformers.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> test_near_semiring_zerol_distrib <span class="main">=</span> test_near_semiring_zerol  <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n_left_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Test_Dioid-n_left_distrib_var"><span class="command">lemma</span></span> n_left_distrib_var<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_left_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_mult_left_iso"><span class="command">lemma</span></span> n_mult_left_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.join.sup.absorb_iff1 local.n_left_distrib<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_mult_isol"><span class="command">lemma</span></span> test_mult_isol<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_mult_left_iso <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">;</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">;</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next, we study tests with commutativity conditions.›</span></span>

<span class="keyword1" id="Test_Dioid-comm_add"><span class="command">lemma</span></span> comm_add<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span>  <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⟹</span>  <span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_left_distrib_var<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-comm_add_var"><span class="command">lemma</span></span> comm_add_var<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> test <span class="free">r</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">q</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">r</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 a1 local.test_mult_comm_var mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a4 a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.test_mult_comm_var mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f6 a5 a3 a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc n_left_distrib_var<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-test_distrib"><span class="command">lemma</span></span> test_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.add.assoc local.distrib_right' mult_assoc n_left_distrib_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a b local.test_mult_comm_var<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_commute local.add.assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a local.join.sup.absorb2 local.test_subid<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Test Predioids›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following class is relevant for probabilistic Kleene algebras.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> test_pre_dioid_zerol <span class="main">=</span> test_near_semiring_zerol_distrib <span class="main">+</span> pre_dioid

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Test_Dioid-n_restrictr"><span class="command">lemma</span></span> n_restrictr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.mult_isol local.n_subid' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Test_Dioid-test_restrictr"><span class="command">lemma</span></span> test_restrictr<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_restrictr <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Test_Dioid-n_kat_2"><span class="command">lemma</span></span> n_kat_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc n_restrictl<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>  <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.mult_isol local.n_mult_idem mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>  <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.order.antisym n_restrictr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-test_kat_2"><span class="command">lemma</span></span> test_kat_2<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_kat_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_kat_2_opp"><span class="command">lemma</span></span> n_kat_2_opp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.n_kat_21_opp n_restrictr<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_kat_2_opp"><span class="command">lemma</span></span> test_kat_2_opp<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>  <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.test_kat_21_opp test_restrictr<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">;</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">q</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">;</span> <span class="free">x</span><span class="main">⋅</span><span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">!</span><span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">q</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">+</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following class is relevant for Demonic Refinement Algebras.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> test_semiring_zerol <span class="main">=</span> test_near_semiring_zerol <span class="main">+</span> semiring_one_zerol

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> dioid_one_zerol <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">subclass</span></span> test_pre_dioid_zerol
<span class="keyword1"><span class="command">proof</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">!</span><span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">!</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">+</span> <span class="main">!</span><span class="bound">x</span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.distrib_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-n_kat_31"><span class="command">lemma</span></span> n_kat_31<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">z</span> <span class="main">+</span> t <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">+</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.distrib_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Test_Dioid-test_kat_31"><span class="command">lemma</span></span> test_kat_31<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.test_double_comp_var n_kat_31<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_kat_var"><span class="command">lemma</span></span> n_kat_var<span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">z</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.n_kat_1_var n_kat_31 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Test_Dioid-test1_var"><span class="command">lemma</span></span> test1_var<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.test_eq4 test_kat_31<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">;</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">;</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">⋅</span><span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">!</span><span class="free">q</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">;</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">;</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">;</span> <span class="free">x</span><span class="main">⋅</span><span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">!</span><span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">;</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">q</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">;</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">⋅</span><span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">!</span><span class="free">q</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">;</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">∧</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Test Semirings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following class is relevant for Kleene Algebra with Tests.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> test_semiring <span class="main">=</span> test_semiring_zerol <span class="main">+</span> semiring_one_zero

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Test_Dioid-n_kat_1"><span class="command">lemma</span></span> n_kat_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.annir local.n_kat_31 local.test_mult_comp mult_assoc<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_kat_1'"><span class="command">lemma</span></span> test_kat_1'<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span>  <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.test_double_comp_var n_kat_1<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_kat_3"><span class="command">lemma</span></span> n_kat_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.n_kat_2 n_kat_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Test_Dioid-test_kat_3"><span class="command">lemma</span></span> test_kat_3<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span>  <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_kat_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Test_Dioid-n_kat_prop"><span class="command">lemma</span></span> n_kat_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⟷</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> t <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.annir local.n_kat_1_opp local.n_kat_var local.t_n_closed local.test_mult_comp mult_assoc<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-test_kat_prop"><span class="command">lemma</span></span> test_kat_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span>  <span class="main">⟹</span>  <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>  <span class="main">⟷</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.annir local.test1_var local.test_comp_mult2 local.test_eq4 mult_assoc<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-n_kat_3_opp"><span class="command">lemma</span></span> n_kat_3_opp<span class="main">:</span> <span class="quoted"><span class="quoted">"t <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.n_kat_1_var local.n_kat_2_opp local.t_n_closed<span class="main">)</span>

<span class="keyword1" id="Test_Dioid-kat_1_var"><span class="command">lemma</span></span> kat_1_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.n_kat_2_opp <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
 
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">∨</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">=</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
<span class="comment1">(*nitpick*)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Conway_Tests">
<div class="head">
<h1>Theory Conway_Tests</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Kleene algebra with tests
   Author:     Alasdair Armstrong, Victor B. F. Gomes, Georg Struth
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Pre-Conway Algebra with Tests›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Conway_Tests
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Kleene_Algebra/Conway.html">Kleene_Algebra.Conway</a> <a href="Test_Dioid.html">Test_Dioid</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">class</span></span> near_conway_zerol_tests <span class="main">=</span> near_conway_zerol <span class="main">+</span> test_near_semiring_zerol_distrib

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Conway_Tests-n_preserve1_var"><span class="command">lemma</span></span> n_preserve1_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.add_zeror local.annil local.n_left_distrib local.n_mult_idem local.test_mult_comp mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> t <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.dagger_simr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Conway_Tests-test_preserve1_var"><span class="command">lemma</span></span> test_preserve1_var<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.test_double_comp_var n_preserve1_var<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> test_pre_conway <span class="main">=</span> pre_conway <span class="main">+</span> test_pre_dioid_zerol

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> near_conway_zerol_tests
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1" id="Conway_Tests-test_preserve"><span class="command">lemma</span></span> test_preserve<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span>  <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span>  <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.preservation1_eq local.test_restrictr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Conway_Tests-test_preserve1"><span class="command">lemma</span></span> test_preserve1<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.add_0_right local.annil local.n_left_distrib_var local.test_comp_mult2 local.test_mult_idem_var mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.dagger_simr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dagger_slide local.test_mult_idem_var mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a b local.order.antisym local.test_restrictr<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a local.dagger_iso local.test_mult_isol<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Conway_Tests-test_preserve2"><span class="command">lemma</span></span> test_preserve2<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.eq_refl local.test_restrictl test_preserve test_preserve1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="KAT">
<div class="head">
<h1>Theory KAT</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Kleene algebra with tests
   Author:     Alasdair Armstrong, Victor B. F. Gomes, Georg Struth
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Kleene Algebra with Tests›</span></span>

<span class="keyword1"><span class="command">theory</span></span> KAT
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Kleene_Algebra/Kleene_Algebra.html">Kleene_Algebra.Kleene_Algebra</a> <a href="Conway_Tests.html">Conway_Tests</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  First, we study left Kleene algebras with tests which also have only a left zero.
  These structures can be expanded to demonic refinement algebras.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> left_kat_zerol <span class="main">=</span>  left_kleene_algebra_zerol <span class="main">+</span> test_semiring_zerol
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="KAT-star_n_export1"><span class="command">lemma</span></span> star_n_export1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.n_restrictr local.star_sim1<span class="main">)</span>

<span class="keyword1" id="KAT-star_test_export1"><span class="command">lemma</span></span> star_test_export1<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> star_n_export1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="KAT-star_n_export2"><span class="command">lemma</span></span> star_n_export2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.mult_isor local.n_restrictl local.star_iso<span class="main">)</span>

<span class="keyword1" id="KAT-star_test_export2"><span class="command">lemma</span></span> star_test_export2<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> star_n_export2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="KAT-star_n_export_left"><span class="command">lemma</span></span> star_n_export_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.n_kat_2_opp<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.star_sim1 mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> local.star_slide star_n_export2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="KAT-star_test_export_left"><span class="command">lemma</span></span> star_test_export_left<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> star_n_export_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="KAT-star_n_export_right"><span class="command">lemma</span></span> star_n_export_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.star_slide star_n_export_left<span class="main">)</span>

<span class="keyword1" id="KAT-star_test_export_right"><span class="command">lemma</span></span> star_test_export_right<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> star_n_export_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="KAT-star_n_folk"><span class="command">lemma</span></span> star_n_folk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> t <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> t <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> t <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.comm_add_var local.t_n_closed local.test_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> t <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> t <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.order_refl star_n_export_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">+</span> t <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> t <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a b mult_assoc<span class="main">)</span>
 <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">0</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.n_mult_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> t <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="KAT-star_test_folk"><span class="command">lemma</span></span> star_test_folk<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> star_n_folk <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> kat_zerol <span class="main">=</span> kleene_algebra_zerol <span class="main">+</span> test_semiring_zerol
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> conway<span class="main">:</span> near_conway_zerol_tests <span class="quoted">star</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="KAT-n_star_sim_right"><span class="command">lemma</span></span> n_star_sim_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.n_mult_idem local.star_sim3 mult_assoc<span class="main">)</span>

<span class="keyword1" id="KAT-star_sim_right"><span class="command">lemma</span></span> star_sim_right<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_star_sim_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="KAT-n_star_sim_left"><span class="command">lemma</span></span> n_star_sim_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.star_slide n_star_sim_right<span class="main">)</span>

<span class="keyword1" id="KAT-star_sim_left"><span class="command">lemma</span></span> star_sim_left<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_star_sim_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="KAT-n_comm_star"><span class="command">lemma</span></span> n_comm_star<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟹</span>  <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⟹</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_assoc n_star_sim_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1" id="KAT-comm_star"><span class="command">lemma</span></span> comm_star<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⟶</span>  <span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_comm_star <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="KAT-n_star_sim_right_var"><span class="command">lemma</span></span> n_star_sim_right_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">=</span> <span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.star_sim3 n_star_sim_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="KAT-star_sim_right_var"><span class="command">lemma</span></span> star_sim_right_var<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⟶</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> n_star_sim_right_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally, we define Kleene algebra with tests.›</span></span>

<span class="keyword1"><span class="command">class</span></span> kat <span class="main">=</span> kleene_algebra <span class="main">+</span> test_semiring

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> conway<span class="main">:</span> test_pre_conway <span class="quoted">star</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DRAT">
<div class="head">
<h1>Theory DRAT</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Demonic refinement algebra
   Author:     Alasdair Armstrong, Victor B. F. Gomes, Georg Struth
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Demonic Refinement Algebra with Tests›</span></span>

<span class="keyword1"><span class="command">theory</span></span> DRAT
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="KAT.html">KAT</a> <a href="../Kleene_Algebra/DRA.html">Kleene_Algebra.DRA</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we define demonic refinement algebras with tests and prove the most important theorems from
  the literature. In this context, tests are also known as guards.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> drat <span class="main">=</span> dra <span class="main">+</span> test_semiring_zerol
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> kat_zerol <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  An assertion is a mapping from a guard to a subset similar to tests, but it aborts if the predicate does
  not hold.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">assertion</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>o</sup></span>"</span> <span class="main">[</span>101<span class="main">]</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"test <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="keyword1"><span class="free"><span class="hidden">⇧</span><sup>o</sup></span></span> <span class="main">=</span> <span class="main">!</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="main">⊤</span> <span class="main">+</span> <span class="main">1</span>"</span></span>

<span class="keyword1" id="DRAT-asg"><span class="command">lemma</span></span> asg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">q</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>o</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assertion_def local.test_subid<span class="main">)</span>

<span class="keyword1" id="DRAT-assertion_isol"><span class="command">lemma</span></span> assertion_isol<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>o</sup></span><span class="main">⋅</span><span class="free">x</span> <span class="main">⟷</span> <span class="free">p</span><span class="main">⋅</span><span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>o</sup></span><span class="main">⋅</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">⋅</span><span class="free">y</span> <span class="main">≤</span> <span class="free">p</span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="main">⊤</span><span class="main">⋅</span><span class="free">x</span> <span class="main">+</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_commute assertion_def local.distrib_left local.iteration_prod_unfold local.iteration_unfoldl_distr local.mult_isol local.top_mult_annil mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> local.test_restrictl<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">⋅</span><span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">⋅</span><span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>o</sup></span><span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="free">y</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="main">⊤</span><span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="free">y</span> <span class="main">+</span> <span class="free">p</span><span class="main">⋅</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assertion_def distrib_right' mult_1_left mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="main">⊤</span> <span class="main">+</span> <span class="free">p</span><span class="main">⋅</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc top_mult_annil<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>o</sup></span><span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="free">y</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>o</sup></span><span class="main">⋅</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult.assoc mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">y</span> <span class="main">+</span> <span class="free">p</span><span class="main">⋅</span><span class="free">y</span> <span class="main">≤</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="main">⊤</span> <span class="main">+</span> <span class="free">p</span><span class="main">⋅</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.add_iso local.top_elim <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>o</sup></span><span class="main">⋅</span><span class="free">x</span>"</span></span>    
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> distrib_right' mult_1_left order_trans test_add_comp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DRAT-assertion_isor"><span class="command">lemma</span></span> assertion_isor<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">⋅</span><span class="free">p</span> <span class="main">⟷</span> <span class="free">y</span><span class="main">⋅</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>o</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">⋅</span><span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">⋅</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>o</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="main">⊤</span> <span class="main">+</span> <span class="free">x</span><span class="main">⋅</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isor assertion_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> distrib_left mult_1_right mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> local.iteration_idep local.join.sup.absorb_iff1 local.join.sup_commute local.join.sup_ge2 local.mult_1_right local.mult_isol_var local.mult_isor local.mult_onel local.test_add_comp local.test_comp_mult2 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">⋅</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>o</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">⋅</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>o</sup></span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">y</span><span class="main">⋅</span><span class="main">(</span><span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="main">⊤</span> <span class="main">+</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> join.sup_mono mult_isol order_refl order_refl top_elim add.commute assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_1_right test_add_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span><span class="main">⋅</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>o</sup></span><span class="main">⋅</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assertion_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> distrib_right' mult_1_left mult.assoc top_mult_annil<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">⋅</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult_isor order_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DRAT-assertion_iso"><span class="command">lemma</span></span> assertion_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">⋅</span><span class="free">q</span><span class="keyword1"><span class="hidden">⇧</span><sup>o</sup></span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>o</sup></span><span class="main">⋅</span><span class="free">x</span> <span class="main">⟷</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main">⋅</span><span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assertion_isol assertion_isor mult.assoc<span class="main">)</span>

<span class="keyword1" id="DRAT-total_correctness"><span class="command">lemma</span></span> total_correctness<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">⋅</span><span class="main">!</span><span class="free">q</span> <span class="main">≤</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> local.test_eq4 local.top_elim mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil antisym test_comp_mult2 join.bot_least mult_assoc mult_isol<span class="main">)</span>

<span class="keyword1" id="DRAT-test_iteration_sim"><span class="command">lemma</span></span> test_iteration_sim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main">⋅</span><span class="free">p</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iteration_sim<span class="main">)</span>

<span class="keyword1" id="DRAT-test_iteration_annir"><span class="command">lemma</span></span> test_iteration_annir<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil test_comp_mult1 iteration_idep mult.assoc<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we give an example of a program transformation from von Wright~\cite{Wright02}.›</span></span>

<span class="keyword1" id="DRAT-loop_refinement"><span class="command">lemma</span></span> loop_refinement<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>test <span class="free">p</span><span class="main">;</span> test <span class="free">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">!</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"test <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">!</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.test_mult_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iteration_unfoldr_distr mult.assoc iteration_unfold_eq distrib_left mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms less_eq_def test_preserve2 join.bot_least<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">≤</span> <span class="free">p</span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> local.eq_iff local.test_mult_comm_var local.test_preserve mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coinduction add.commute mult.assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally, we prove different versions of Back's atomicity refinement theorem for action systems.›</span></span>

<span class="keyword1" id="DRAT-atom_step1"><span class="command">lemma</span></span> atom_step1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">⋅</span><span class="free">b</span> <span class="main">≤</span> <span class="free">b</span><span class="main">⋅</span><span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> iteration_sep mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_assoc' add.commute iteration_denest<span class="main">)</span>

 
<span class="keyword1" id="DRAT-atom_step2"><span class="command">lemma</span></span> atom_step2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">s</span><span class="main">⋅</span><span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">⋅</span><span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">⋅</span><span class="free">q</span> <span class="main">≤</span> <span class="free">q</span><span class="main">⋅</span><span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="quoted"><span class="quoted">"test <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> star_sim1 mult.assoc mult_isol iteration_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>6<span class="main">)</span> local.mult_isor local.test_restrictr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> iteration_sim mult.assoc mult_double_iso mult_double_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> join.bot_least iteration_sim mult.assoc mult_double_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> mult.assoc mult_isol test_restrictl iteration_idem mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DRAT-atom_step3"><span class="command">lemma</span></span> atom_step3<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">+</span> <span class="free">l</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">l</span><span class="main">⋅</span><span class="free">q</span> <span class="main">+</span> <span class="free">l</span><span class="main">⋅</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right join.sup_mono assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> mult.assoc mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">a</span><span class="main">⋅</span><span class="free">l</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">+</span> <span class="free">l</span><span class="main">⋅</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> star_sim1 add_iso mult.assoc mult_double_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_iso assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult_isor distrib_left mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute mult.assoc iteration_denest<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add.left_commute iteration_sep<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This is Back's atomicity refinement theorem, as specified by von Wright~\cite {Wright02}.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> atom_ref_back<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">s</span><span class="main">⋅</span><span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">q</span><span class="main">⋅</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">⋅</span><span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">⋅</span><span class="free">b</span> <span class="main">≤</span> <span class="free">b</span><span class="main">⋅</span><span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">⋅</span><span class="free">q</span> <span class="main">≤</span> <span class="free">q</span><span class="main">⋅</span><span class="free">r</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="free">q</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="quoted"><span class="quoted">"test <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> join.sup_mono distrib_right' assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">⋅</span><span class="main">(</span><span class="free">l</span> <span class="main">+</span> <span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">=</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add.left_commute mult.assoc iteration_sep<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>10<span class="main"><span class="main">,</span></span>11<span class="main"><span class="main">)</span></span> atom_step1 iteration_slide eq_refl mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> atom_step2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">+</span> <span class="free">l</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> atom_step3 eq_refl mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add.left_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This variant is due to H\"ofner, Struth and Sutcliffe~\cite{HofnerSS09}.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> atom_ref_back_struth<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">q</span><span class="main">⋅</span><span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">⋅</span><span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">⋅</span><span class="free">b</span> <span class="main">≤</span> <span class="free">b</span><span class="main">⋅</span><span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">⋅</span><span class="free">q</span> <span class="main">≤</span> <span class="free">q</span><span class="main">⋅</span><span class="free">r</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="free">q</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">=</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add.left_commute assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> iteration_sep mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_assoc' add.commute iteration_denest add.commute mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> iteration_sep mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">q</span><span class="main">⋅</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> iteration_iso mult_isol_var eq_refl order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iteration_slide mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> iteration_sim mult.assoc mult_double_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> iteration_idep mult.assoc order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> eq_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> iteration_iso mult.assoc mult_isol star_sim1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> mult_1_right mult_double_iso mult_isor<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span><span class="main">⋅</span><span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> mult_1_right mult_double_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">s</span><span class="main">⋅</span><span class="free">l</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute mult.assoc iteration_denest<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">s</span><span class="main">⋅</span><span class="main">(</span><span class="free">a</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="free">q</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute iteration_subdenest mult.assoc mult_isol<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
    

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally, we prove Cohen's~\cite{Cohen00} variation of the atomicity refinement theorem.›</span></span>

<span class="keyword1" id="DRAT-atom_ref_cohen"><span class="command">lemma</span></span> atom_ref_cohen<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="free">y</span> <span class="main">≤</span> <span class="free">y</span><span class="main">⋅</span><span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="free">r</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">⋅</span><span class="free">r</span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">⋅</span><span class="free">l</span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span><span class="main">⋅</span><span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">⋅</span><span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span> <span class="main">+</span> <span class="free">r</span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">r</span><span class="main">⋅</span><span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>    
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⋅</span><span class="free">y</span> <span class="main">+</span> <span class="free">l</span><span class="main">⋅</span><span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right' join.sup_mono assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> stepA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> distrib_left distrib_right' mult_1_left mult_isol order_trans star_ext test_add_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> subStepB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span> <span class="main">+</span> <span class="free">y</span> <span class="main">+</span> <span class="free">p</span><span class="main">⋅</span><span class="free">r</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span> <span class="main">+</span> <span class="free">y</span> <span class="main">+</span> <span class="free">r</span><span class="main">⋅</span><span class="free">p</span> <span class="main">+</span> <span class="free">r</span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_assoc' annil assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> distrib_left distrib_right' star_slide star_subid test_add_comp join.bot_least<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">r</span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span><span class="main">⋅</span><span class="main">(</span><span class="free">r</span><span class="main">⋅</span><span class="free">p</span> <span class="main">+</span> <span class="free">r</span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span> distrib_left add_0_left add.commute annil mult.assoc test_comp_mult2 distrib_left mult_oner test_add_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">r</span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">r</span><span class="main">⋅</span><span class="free">p</span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">r</span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.eq_refl local.join.sup_ge1 local.join.sup_ge2 local.join.sup_mono local.mult_isol_var local.order_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">⋅</span><span class="free">p</span><span class="main">⋅</span><span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">r</span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">r</span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span><span class="main">)</span><span class="main">⋅</span><span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">r</span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span> <span class="main">+</span> <span class="free">r</span><span class="main">⋅</span><span class="free">p</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> stepB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span> <span class="main">+</span> <span class="free">y</span> <span class="main">+</span> <span class="free">p</span><span class="main">⋅</span><span class="free">r</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span> <span class="main">+</span> <span class="free">r</span><span class="main">⋅</span><span class="main">!</span><span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="free">r</span><span class="main">⋅</span><span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subStepB iteration_sep3<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">r</span></span></span><span class="main"><span class="main"><span class="main">⋅</span></span></span><span class="free"><span class="free"><span class="free">p</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">y</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="free"><span class="free"><span class="free">r</span></span></span><span class="main"><span class="main"><span class="main">⋅</span></span></span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="free"><span class="free"><span class="free">p</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="main"><span class="main"><span class="main">!</span></span></span><span class="free"><span class="free"><span class="free">p</span></span></span><span class="main"><span class="main"><span class="main">⋅</span></span></span><span class="free"><span class="free"><span class="free">l</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span>  add_assoc' add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span> <span class="main">+</span> <span class="free">y</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_comm add.left_commute assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> distrib_right' mult_onel test_add_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span> <span class="main">+</span> <span class="free">y</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> stepA
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>6-8<span class="main"><span class="main">)</span></span> annil add.assoc add_0_left distrib_right' add.commute mult.assoc iteration_sep4<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">y</span></span></span><span class="main"><span class="main"><span class="main">+</span></span></span><span class="free"><span class="free"><span class="free">r</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">!</span></span></span><span class="free"><span class="free"><span class="free">p</span></span></span><span class="main"><span class="main"><span class="main">⋅</span></span></span><span class="free"><span class="free"><span class="free">l</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">p</span></span></span><span class="main"><span class="main"><span class="main">⋅</span></span></span><span class="free"><span class="free"><span class="free">l</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span><span class="main">(</span><span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">l</span> <span class="main">+</span> <span class="free">y</span> <span class="main">+</span> <span class="free">p</span><span class="main">⋅</span><span class="free">r</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span><span class="main">⋅</span><span class="free">r</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> combine_common_factor mult_1_left test_add_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> stepB
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DRA_Models">
<div class="head">
<h1>Theory DRA_Models</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Demonic refinement algebra
   Author:     Alasdair Armstrong, Victor B. F. Gomes, Georg Struth
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Models for Demonic Refinement Algebra with Tests›</span></span>

<span class="keyword1"><span class="command">theory</span></span> DRA_Models
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="DRAT.html">DRAT</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We formalise the predicate transformer model of demonic refinement algebra.
  Predicate transformers are formalised as strict and additive functions over a field of sets,
  or alternatively as costrict and multiplicative functions. 
  In the future, this should be merged with Preoteasa's more abstract formalisation~\cite{Preoteasa11}.
›</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> 
  plus <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> 
  less_eq  <span class="main">(</span><span class="quoted">"<span class="keyword1">'(≤')</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  less_eq  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">≤</span> _<span class="keyword3">)</span>"</span>  <span class="main">[</span>51<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> comp <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 55<span class="main">)</span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> bfun <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Definitions of signature:
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">top</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bfun"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">top</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> UNIV"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bfun"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bot</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">adjoint</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bfun <span class="main">⇒</span> <span class="tfree">'a</span> bfun"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">adjoint</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="main">-</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fun_inter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bfun <span class="main">⇒</span> <span class="tfree">'a</span> bfun <span class="main">⇒</span> <span class="tfree">'a</span> bfun"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 51<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">⊓</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">p</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">p</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fun_union</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bfun <span class="main">⇒</span> <span class="tfree">'a</span> bfun <span class="main">⇒</span> <span class="tfree">'a</span> bfun"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 52<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">+</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">p</span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">p</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fun_order</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bfun <span class="main">⇒</span> <span class="tfree">'a</span> bfun <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≤</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">≤</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">p</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">p</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fun_strict_order</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bfun <span class="main">⇒</span> <span class="tfree">'a</span> bfun <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">&lt;.</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">&lt;.</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bfun <span class="main">⇒</span> <span class="tfree">'a</span> bfun"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>adjoint <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">o</span> bot<span class="main">)</span> <span class="main">⊓</span> id<span class="main">)</span>"</span></span>

<span class="keyword1" id="DRA_Models-top_max"><span class="command">lemma</span></span> top_max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≤</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> top_def fun_order_def<span class="main">)</span>

<span class="keyword1" id="DRA_Models-bot_min"><span class="command">lemma</span></span> bot_min<span class="main">:</span> <span class="quoted"><span class="quoted">"bot <span class="main">≤</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bot_def fun_order_def<span class="main">)</span>

<span class="keyword1" id="DRA_Models-oder_def"><span class="command">lemma</span></span> oder_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⊓</span> <span class="free">g</span> <span class="main">=</span> <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">≤</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fun_inter_def fun_order_def le_iff_inf<span class="main">)</span>

<span class="keyword1" id="DRA_Models-order_def_var"><span class="command">lemma</span></span> order_def_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≤</span> <span class="free">g</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">⊓</span> <span class="free">g</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_inter_def fun_order_def<span class="main">)</span>

<span class="keyword1" id="DRA_Models-adjoint_idem"><span class="command">lemma</span></span> adjoint_idem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"adjoint <span class="main">(</span>adjoint <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoint_def<span class="main">)</span>

<span class="keyword1" id="DRA_Models-adjoint_prop1"><span class="command">lemma</span></span> adjoint_prop1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> top<span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>adjoint <span class="free">f</span> <span class="keyword1">o</span> bot<span class="main">)</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_inter_def adjoint_def bot_def top_def<span class="main">)</span>

<span class="keyword1" id="DRA_Models-adjoint_prop2"><span class="command">lemma</span></span> adjoint_prop2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> top<span class="main">)</span> <span class="main">+</span> <span class="main">(</span>adjoint <span class="free">f</span> <span class="keyword1">o</span> bot<span class="main">)</span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_union_def adjoint_def bot_def top_def<span class="main">)</span>

<span class="keyword1" id="DRA_Models-adjoint_mult"><span class="command">lemma</span></span> adjoint_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"adjoint <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> adjoint <span class="free">f</span> <span class="keyword1">o</span> adjoint <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoint_def<span class="main">)</span>

<span class="keyword1" id="DRA_Models-adjoint_top"><span class="command">lemma</span></span> adjoint_top<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"adjoint top <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> adjoint_def bot_def top_def<span class="main">)</span>

<span class="keyword1" id="DRA_Models-N_comp1"><span class="command">lemma</span></span> N_comp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>N <span class="main">(</span>N <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> N <span class="free">f</span> <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_union_def N_def fun_inter_def adjoint_def bot_def<span class="main">)</span>

<span class="keyword1" id="DRA_Models-N_comp2"><span class="command">lemma</span></span> N_comp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>N <span class="main">(</span>N <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> N <span class="free">f</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def fun_inter_def adjoint_def bot_def<span class="main">)</span>

<span class="keyword1" id="DRA_Models-N_comp3"><span class="command">lemma</span></span> N_comp3<span class="main">:</span> <span class="quoted"><span class="quoted">"N <span class="free">f</span> <span class="keyword1">o</span> <span class="main">(</span>N <span class="main">(</span>N <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def fun_inter_def adjoint_def bot_def<span class="main">)</span>

<span class="keyword1" id="DRA_Models-N_de_morgan"><span class="command">lemma</span></span> N_de_morgan<span class="main">:</span> <span class="quoted"><span class="quoted">"N <span class="main">(</span>N <span class="free">f</span><span class="main">)</span> <span class="keyword1">o</span> N <span class="main">(</span>N <span class="free">g</span><span class="main">)</span> <span class="main">=</span> N <span class="main">(</span>N <span class="free">f</span><span class="main">)</span> <span class="main">⊓</span> N <span class="main">(</span>N <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_union_def N_def fun_inter_def adjoint_def bot_def<span class="main">)</span>

<span class="keyword1" id="DRA_Models-conj_pred_aux"><span class="command">lemma</span></span> conj_pred_aux <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free">x</span> <span class="bound">p</span> <span class="main">∪</span> <span class="free">y</span> <span class="bound">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="free">x</span> <span class="bound">p</span> <span class="main">⊆</span> <span class="free">y</span> <span class="bound">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_upper1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we define a type for conjuctive or multiplicative predicate transformers.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'a</span> bool_op <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span> bfun<span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">g</span> <span class="bound">h</span><span class="main">.</span> mono <span class="bound">f</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∘</span> <span class="bound">g</span> <span class="main">+</span> <span class="bound">f</span> <span class="main">∘</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">∘</span> <span class="main">(</span><span class="bound">g</span> <span class="main">+</span> <span class="bound">h</span><span class="main">)</span> <span class="main">∧</span> bot <span class="keyword1">o</span> <span class="bound">f</span> <span class="main">=</span> bot<span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> monoI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_order_def fun_union_def<span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_bool_op

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Conjuctive predicate transformers form a dioid with tests without right annihilator.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> bool_op <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">dioid_one_zerol</span> 
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_bool_op</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_op <span class="main">⇒</span> <span class="tfree">'a</span> bool_op <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">fun_order</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_bool_op</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_op <span class="main">⇒</span> <span class="tfree">'a</span> bool_op <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;.)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">zero_bool_op</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_op"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bot_def fun_union_def fun_order_def mono_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">one_bool_op</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_op"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"id"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_union_def fun_order_def mono_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">times_bool_op</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_op <span class="main">⇒</span> <span class="tfree">'a</span> bool_op <span class="main">⇒</span> <span class="tfree">'a</span> bool_op"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(o)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def fun_union_def fun_order_def bot_def mono_def<span class="main">)</span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">plus_bool_op</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_op <span class="main">⇒</span> <span class="tfree">'a</span> bool_op <span class="main">⇒</span> <span class="tfree">'a</span> bool_op"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def fun_union_def fun_order_def bot_def mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> semilattice_sup_class.sup.assoc semilattice_sup_class.sup.left_commute<span class="main">)</span>

  <span class="keyword1"><span class="command">instance</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_order_def fun_strict_order_def fun_union_def bot_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> bool_op <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">test_semiring_zerol</span> 
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">n_op_bool_op</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_op <span class="main">⇒</span> <span class="tfree">'a</span> bool_op"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"N"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> N_def fun_inter_def adjoint_def bot_def fun_union_def mono_def<span class="main">)</span>

  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_def adjoint_def bot_def id_def comp_def fun_inter_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_def adjoint_def bot_def id_def comp_def fun_inter_def fun_union_def mono_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_def adjoint_def bot_def comp_def mono_def fun_union_def fun_inter_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> N_def adjoint_def bot_def comp_def mono_def fun_union_def fun_inter_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fun_star</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bfun <span class="main">⇒</span> <span class="tfree">'a</span> bfun"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fun_star</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> lfp <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">o</span> <span class="bound">r</span> <span class="main">+</span> id<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fun_iteration</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bfun <span class="main">⇒</span> <span class="tfree">'a</span> bfun"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fun_iteration</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> gfp <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">o</span> <span class="bound">g</span> <span class="main">+</span> id<span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Verifying the iteration laws is left for future work. This could be obtained by integrating
  Preoteasa's approach~\cite{Preoteasa11}.
›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="KAT_Models">
<div class="head">
<h1>Theory KAT_Models</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Kleene algebra with tests
   Author:     Alasdair Armstrong, Victor B. F. Gomes, Georg Struth
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Models for Kleene Algebra with Tests›</span></span>

<span class="keyword1"><span class="command">theory</span></span> KAT_Models
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Kleene_Algebra/Kleene_Algebra_Models.html">Kleene_Algebra.Kleene_Algebra_Models</a> <a href="KAT.html">KAT</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We show that binary relations under the obvious definitions form a Kleene algebra with tests.
›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_dioid_tests<span class="main">:</span> test_semiring <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(O)</span>"</span></span> <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Id <span class="main">∩</span> <span class="main">(</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> rel_kat<span class="main">:</span> kat <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(O)</span>"</span></span> <span class="quoted">Id</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="quoted">rtrancl</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Id <span class="main">∩</span> <span class="main">(</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>


<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'a</span> relation <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV<span class="main">::</span><span class="tfree">'a</span> rel set"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_relation

<span class="keyword1"><span class="command">instantiation</span></span> relation <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">kat</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">n_op_relation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> relation <span class="main">⇒</span> <span class="tfree">'a</span> relation"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Id <span class="main">∩</span> <span class="main">(</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">zero_relation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> relation"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">star_relation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> relation <span class="main">⇒</span> <span class="tfree">'a</span> relation"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"rtrancl"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_relation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> relation <span class="main">⇒</span> <span class="tfree">'a</span> relation <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊆)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_relation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> relation <span class="main">⇒</span> <span class="tfree">'a</span> relation <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(⊂)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">one_relation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> relation"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Id"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">times_relation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> relation <span class="main">⇒</span> <span class="tfree">'a</span> relation <span class="main">⇒</span> <span class="tfree">'a</span> relation"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">(O)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">plus_relation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> relation <span class="main">⇒</span> <span class="tfree">'a</span> relation <span class="main">⇒</span> <span class="tfree">'a</span> relation"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∪)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_commute<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_dioid.mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_dioid.less_eq_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_dioid.less_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_kleene_algebra.star_inductl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_kleene_algebra.star_inductr<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FolkTheorem">
<div class="head">
<h1>Theory FolkTheorem</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Kleene algebra with tests
   Author:     Alasdair Armstrong, Victor B. F. Gomes, Georg Struth
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Transformation Theorem for while Loops›</span></span>

<span class="keyword1"><span class="command">theory</span></span> FolkTheorem
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Conway_Tests.html">Conway_Tests</a> <a href="KAT.html">KAT</a> <a href="DRAT.html">DRAT</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We prove Kozen's transformation theorem for while loops \cite{Kozen97} in a weak setting that unifies
  previous proofs in Kleene algebra with tests, demonic refinement algebras and a variant of probabilistic
  Kleene algebra.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> test_pre_conway
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pres</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pres</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1" id="FolkTheorem-pres_comp"><span class="command">lemma</span></span> pres_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"pres <span class="free">y</span> <span class="free">z</span> <span class="main">⟹</span> pres <span class="free">x</span> <span class="free">z</span> <span class="main">⟹</span> pres <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc<span class="main">)</span>

<span class="keyword1" id="FolkTheorem-test_pres1"><span class="command">lemma</span></span> test_pres1<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> pres <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.test_mult_comm_var mult_assoc<span class="main">)</span>

<span class="keyword1" id="FolkTheorem-test_pres2"><span class="command">lemma</span></span> test_pres2<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span> pres <span class="free">x</span> <span class="free">q</span> <span class="main">⟹</span> pres <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pres_comp test_pres1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="FolkTheorem-cond_helper1"><span class="command">lemma</span></span> cond_helper1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pres <span class="free">x</span> <span class="free">p</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> local.add_zerol local.annil local.join.sup_commute local.n_left_distrib_var local.test_comp_mult2 local.test_mult_idem_var mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> local.test_preserve1 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> local.test_preserve mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FolkTheorem-cond_helper2"><span class="command">lemma</span></span> cond_helper2<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pres <span class="free">y</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span><span class="main">)</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="main">!</span><span class="main">(</span><span class="main">!</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">w</span> <span class="main">+</span> <span class="main">!</span><span class="main">(</span><span class="main">!</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> local.test_comp_closed assms<span class="main">(</span>2<span class="main">)</span> cond_helper1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> add_commute assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FolkTheorem-cond_distr_var"><span class="command">lemma</span></span> cond_distr_var<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">+</span> <span class="free">r</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">r</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">+</span> <span class="free">r</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">r</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">r</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> local.distrib_right' local.join.sup_assoc local.n_left_distrib_var local.test_comp_closed mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">r</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">r</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span>  <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> local.add_zerol local.annil local.join.sup_commute local.test_mult_comm_var local.test_zero_var<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FolkTheorem-cond_distr"><span class="command">lemma</span></span> cond_distr<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">r</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">r</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span>  assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> local.test_mult_comm_var assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> cond_distr_var local.test_mult_comm_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> conditional<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">r1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">r2</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pres <span class="free">x1</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pres <span class="free">y1</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pres <span class="free">x2</span> <span class="main">(</span><span class="main">!</span><span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pres <span class="free">y2</span> <span class="main">(</span><span class="main">!</span><span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x2</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r2</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r2</span><span class="main">)</span> <span class="main">=</span>     
<span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">r1</span> <span class="main">⋅</span> <span class="free">y1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">r1</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x2</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">r2</span> <span class="main">⋅</span> <span class="free">y2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">r2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">x1</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r1</span> <span class="main">⋅</span> <span class="free">y1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r2</span> <span class="main">⋅</span> <span class="free">y2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">r1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">r2</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">x1</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">r1</span> <span class="main">⋅</span> <span class="free">y1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">r1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span>  assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> cond_helper1 mult_assoc test_pres2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r1</span> <span class="main">⋅</span> <span class="free">y1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r2</span> <span class="main">⋅</span> <span class="free">y2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">r1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">r2</span><span class="main">)</span> <span class="main">=</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">r2</span> <span class="main">⋅</span> <span class="free">y2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> local.test_comp_closed cond_helper2 mult_assoc test_pres2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x2</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r2</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r2</span><span class="main">)</span> <span class="main">=</span>
        <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">x1</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r1</span> <span class="main">⋅</span> <span class="free">y1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r2</span> <span class="main">⋅</span> <span class="free">y2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">r1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">r2</span><span class="main">)</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x2</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r1</span> <span class="main">⋅</span> <span class="free">y1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">r2</span> <span class="main">⋅</span> <span class="free">y2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">r1</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">r2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> assms<span class="main">(</span>5<span class="main">)</span> assms<span class="main">(</span>7<span class="main">)</span> cond_distr cond_distr_var local.test_dist_var2 mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">x1</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">r1</span> <span class="main">⋅</span> <span class="free">y1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">r1</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span>  <span class="free">x2</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">r2</span> <span class="main">⋅</span> <span class="free">y2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> b mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> cond_distr mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> nested_loops<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> local.dagger_denest2 local.test_distrib mult_assoc test_mult_comm_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span>  <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">+</span> <span class="main">!</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dagger_slide mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> add_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FolkTheorem-postcomputation"><span class="command">lemma</span></span> postcomputation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pres <span class="free">y</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dagger_prod_unfold mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">p</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> local.mult_oner local.n_left_distrib_var mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">+</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> local.annil local.test_comp_mult1 mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span>  <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span>  <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">0</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc add.commute dagger_denest2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.add_zeror local.annil local.dagger_prod_unfold local.dagger_slide local.mult_oner mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dagger_unfoldl_distr mult.assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FolkTheorem-composition_helper"><span class="command">lemma</span></span> composition_helper<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pres <span class="free">x</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> local.test_restrictr<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> local.test_kat_2 mult_assoc test_pres2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.dagger_simr mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> local.eq_iff local.test_comp_closed local.test_kat_2 local.test_mult_comm_var mult_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> composition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">q</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pres <span class="free">y</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pres <span class="free">y</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">+</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="main">!</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">q</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">+</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> composition_helper local.test_comp_closed mult_assoc postcomputation<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Kleene algebras with tests form pre-Conway algebras, therefore the transformation theorem is valid for KAT as well.
›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> kat <span class="main">⊆</span> pre_conway <span class="quoted">star</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Demonic refinement algebras form pre-Conway algebras, therefore the transformation theorem is valid for DRA as well.
›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> drat <span class="main">⊆</span> pre_conway <span class="quoted">strong_iteration</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.iteration_denest local.iteration_slide<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> local.iteration_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.iteration_sim<span class="main">)</span>
 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We do not currently consider an expansion of probabilistic Kleene algebra.
›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="PHL_KAT">
<div class="head">
<h1>Theory PHL_KAT</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Kleene algebra with tests
   Author:     Alasdair Armstrong, Victor B. F. Gomes, Georg Struth
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Propositional Hoare Logic›</span></span>

<span class="keyword1"><span class="command">theory</span></span> PHL_KAT
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="KAT.html">KAT</a> <a href="../Kleene_Algebra/PHL_KA.html">Kleene_Algebra.PHL_KA</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define a class of pre-dioids with notions of assertions, tests and iteration. The above rules of PHL are derivable in that class.›</span></span>

<span class="keyword1"><span class="command">class</span></span> at_pre_dioid <span class="main">=</span> pre_dioid_one <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">alpha</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">α</span></span></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free"><span class="free"><span class="free">tau</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">τ</span></span></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> at_pres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1"><span class="free">τ</span></span> <span class="free">y</span> <span class="main">≤</span> <span class="keyword1"><span class="free">τ</span></span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1"><span class="free">τ</span></span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> as_left_supdistl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">+</span> <span class="keyword1"><span class="free">α</span></span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Only the conditional and the iteration rule need to be considered (in addition to the export laws. 
In this context, they no longer depend on external assumptions. The other ones do not depend on any assumptions anyway.›</span></span>

<span class="keyword1" id="PHL_KAT-at_phl_cond"><span class="command">lemma</span></span> at_phl_cond<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">α</span> <span class="free">u</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">v</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">α</span> <span class="free">u</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">w</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">α</span> <span class="free">u</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">τ</span> <span class="free">v</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">w</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">τ</span> <span class="free">v</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">w</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms as_left_supdistl at_pres phl_cond <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="PHL_KAT-ht_at_phl_cond"><span class="command">lemma</span></span> ht_at_phl_cond<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1">α</span> <span class="free">u</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">v</span><span class="main">⦄</span> <span class="free">x</span> <span class="main">⦃</span><span class="free">z</span><span class="main">⦄</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1">α</span> <span class="free">u</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">w</span><span class="main">⦄</span> <span class="free">y</span> <span class="main">⦃</span><span class="free">z</span><span class="main">⦄</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1">α</span> <span class="free">u</span><span class="main">⦄</span> <span class="main">(</span><span class="keyword1">τ</span> <span class="free">v</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="keyword1">τ</span> <span class="free">w</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⦃</span><span class="free">z</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> at_phl_cond<span class="main">)</span>

<span class="keyword1" id="PHL_KAT-ht_at_phl_export1"><span class="command">lemma</span></span>  ht_at_phl_export1<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1">α</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">y</span><span class="main">⦄</span> <span class="free">z</span> <span class="main">⦃</span><span class="free">w</span><span class="main">⦄</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1">α</span> <span class="free">x</span><span class="main">⦄</span> <span class="keyword1">τ</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span> <span class="main">⦃</span><span class="free">w</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms at_pres ht_phl_export1<span class="main">)</span>

<span class="keyword1" id="PHL_KAT-ht_at_phl_export2"><span class="command">lemma</span></span> ht_at_phl_export2<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">x</span><span class="main">⦄</span> <span class="free">y</span> <span class="main">⦃</span><span class="keyword1">α</span> <span class="free">z</span><span class="main">⦄</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">x</span><span class="main">⦄</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">w</span> <span class="main">⦃</span><span class="keyword1">α</span> <span class="free">z</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">w</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms at_pres ht_phl_export2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> at_it_pre_dioid <span class="main">=</span> at_pre_dioid <span class="main">+</span> it_pre_dioid
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="PHL_KAT-at_phl_while"><span class="command">lemma</span></span> at_phl_while<span class="main">:</span>  
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">α</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">s</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1">α</span> <span class="free">p</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">α</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span>it <span class="main">(</span><span class="keyword1">τ</span> <span class="free">s</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">w</span><span class="main">)</span>  <span class="main">≤</span> it <span class="main">(</span><span class="keyword1">τ</span> <span class="free">s</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">w</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">α</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms at_pres it_simr phl_while<span class="main">)</span>

<span class="keyword1" id="PHL_KAT-ht_at_phl_while"><span class="command">lemma</span></span> ht_at_phl_while<span class="main">:</span>  
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1">α</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">s</span><span class="main">⦄</span> <span class="free">x</span> <span class="main">⦃</span><span class="keyword1">α</span> <span class="free">p</span><span class="main">⦄</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1">α</span> <span class="free">p</span><span class="main">⦄</span> it <span class="main">(</span><span class="keyword1">τ</span> <span class="free">s</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">w</span> <span class="main">⦃</span><span class="keyword1">α</span> <span class="free">p</span> <span class="main">⋅</span> <span class="keyword1">τ</span> <span class="free">w</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> at_phl_while<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following statements show that pre-Conway algebras, Kleene algebras with tests
and demonic refinement algebras form pre-dioids with test and assertions. This automatically
generates propositional Hoare logics for these structures.›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> test_pre_dioid_zerol <span class="main">&lt;</span> phl<span class="main">:</span> at_pre_dioid <span class="keyword2"><span class="keyword">where</span></span> alpha <span class="main">=</span> <span class="quoted">t</span> <span class="keyword2"><span class="keyword">and</span></span> tau <span class="main">=</span> <span class="quoted">t</span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> t <span class="bound">x</span> <span class="main">⋅</span> t <span class="bound">y</span> <span class="main">≤</span> t <span class="bound">y</span> <span class="main">⋅</span> t <span class="bound">x</span> <span class="main">⋅</span> t <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_mult_comm mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> t <span class="bound">x</span> <span class="main">⋅</span> <span class="main">(</span><span class="bound">y</span> <span class="main">+</span> <span class="bound">z</span><span class="main">)</span> <span class="main">≤</span> t <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">y</span> <span class="main">+</span> t <span class="bound">x</span> <span class="main">⋅</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_left_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> test_pre_conway <span class="main">&lt;</span> phl<span class="main">:</span> at_it_pre_dioid <span class="keyword2"><span class="keyword">where</span></span> alpha <span class="main">=</span> <span class="quoted">t</span> <span class="keyword2"><span class="keyword">and</span></span> tau <span class="main">=</span> <span class="quoted">t</span> <span class="keyword2"><span class="keyword">and</span></span> it <span class="main">=</span> <span class="quoted">dagger</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> kat_zerol <span class="main">&lt;</span> phl<span class="main">:</span> at_it_pre_dioid <span class="keyword2"><span class="keyword">where</span></span> alpha <span class="main">=</span> <span class="quoted">t</span> <span class="keyword2"><span class="keyword">and</span></span> tau <span class="main">=</span> <span class="quoted">t</span> <span class="keyword2"><span class="keyword">and</span></span> it <span class="main">=</span> <span class="quoted">star</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">context</span></span> test_pre_dioid_zerol <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">if_then_else</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">if</span> _ <span class="keyword1">then</span> _ <span class="keyword1">else</span> _ <span class="keyword1">fi</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">if</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">then</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">else</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1"><span class="free">fi</span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="main">!</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
 
<span class="keyword1" id="PHL_KAT-phl_n_cond"><span class="command">lemma</span></span> phl_n_cond<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1">n</span> <span class="free">v</span> <span class="main">⋅</span> <span class="keyword1">n</span> <span class="free">w</span><span class="main">⦄</span> <span class="free">x</span> <span class="main">⦃</span><span class="free">z</span><span class="main">⦄</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="keyword1">n</span> <span class="free">v</span> <span class="main">⋅</span> t <span class="free">w</span><span class="main">⦄</span> <span class="free">y</span> <span class="main">⦃</span><span class="free">z</span><span class="main">⦄</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="keyword1">n</span> <span class="free">v</span><span class="main">⦄</span> <span class="keyword1">n</span> <span class="free">w</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> t <span class="free">w</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⦃</span><span class="free">z</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> phl.ht_at_phl_cond t_n_closed<span class="main">)</span>

<span class="keyword1" id="PHL_KAT-phl_test_cond"><span class="command">lemma</span></span> phl_test_cond<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">b</span><span class="main">⦄</span> <span class="free">x</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span><span class="main">⦄</span> <span class="free">y</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span> <span class="free">b</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms local.test_double_comp_var phl_n_cond<span class="main">)</span>

<span class="keyword1" id="PHL_KAT-phl_cond_syntax"><span class="command">lemma</span></span> phl_cond_syntax<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">b</span><span class="main">⦄</span> <span class="free">x</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span><span class="main">⦄</span> <span class="free">y</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> phl_test_cond<span class="main">)</span>

<span class="keyword1" id="PHL_KAT-phl_cond_syntax_iff"><span class="command">lemma</span></span> phl_cond_syntax_iff<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">b</span><span class="main">⦄</span> <span class="free">x</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span> <span class="main">∧</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span><span class="main">⦄</span> <span class="free">y</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span> <span class="main">⟷</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">b</span><span class="main">⦄</span> <span class="free">x</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span> <span class="main">∧</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span><span class="main">⦄</span> <span class="free">y</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> phl_test_cond <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span> <span class="keyword1">fi</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="free">b</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> local.mult.assoc local.subdistl local.test_preserve<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a local.mult_isol mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">b</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">b</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> local.n_left_distrib_var mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">b</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="free">b</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> local.order_trans local.test_restrictl mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">=</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> local.test_preserve<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.mult_isol mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a local.mult_isol mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">b</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.n_left_distrib mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.dual_order.trans local.n_restrictl mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">b</span><span class="main">⦄</span> <span class="free">x</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span> <span class="main">∧</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span><span class="main">⦄</span> <span class="free">y</span> <span class="main">⦃</span><span class="free">q</span><span class="main">⦄</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> test_pre_conway
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="PHL_KAT-phl_n_while"><span class="command">lemma</span></span>  phl_n_while<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span>  <span class="keyword1">n</span> <span class="free">y</span><span class="main">⦄</span> <span class="free">z</span> <span class="main">⦃</span><span class="keyword1">n</span> <span class="free">x</span><span class="main">⦄</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1">n</span> <span class="free">x</span><span class="main">⦄</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>†</sup></span> <span class="main">⋅</span> t <span class="free">y</span> <span class="main">⦃</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">y</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms phl.ht_at_phl_while t_n_closed<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> kat_zerol
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">while</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">while</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1"><span class="free">do</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">od</span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1" id="PHL_KAT-phl_n_while"><span class="command">lemma</span></span>  phl_n_while<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span>  <span class="keyword1">n</span> <span class="free">y</span><span class="main">⦄</span> <span class="free">z</span> <span class="main">⦃</span><span class="keyword1">n</span> <span class="free">x</span><span class="main">⦄</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1">n</span> <span class="free">x</span><span class="main">⦄</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> t <span class="free">y</span> <span class="main">⦃</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">y</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms phl.ht_at_phl_while t_n_closed<span class="main">)</span>

<span class="keyword1" id="PHL_KAT-phl_test_while"><span class="command">lemma</span></span> phl_test_while<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">b</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">b</span><span class="main">⦄</span> <span class="free">x</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span> <span class="main">(</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms phl_n_while test_double_comp_var<span class="main">)</span>

<span class="keyword1" id="PHL_KAT-phl_while_syntax"><span class="command">lemma</span></span> phl_while_syntax<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">b</span><span class="main">⦄</span> <span class="free">x</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span> <span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms phl_test_while<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> kat<span class="main">)</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> kat<span class="main">)</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">b</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span> <span class="main">≤</span> <span class="main">(</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">b</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> kat<span class="main">)</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span>  <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">q</span> <span class="main">⟹</span><span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> test <span class="bound">r</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">⋅</span> <span class="free">y</span>  <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="comment1">(* nitpick *)</span>  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> kat<span class="main">)</span> <span class="quoted"><span class="quoted">"test <span class="free">p</span> <span class="main">⟹</span> test <span class="free">q</span> <span class="main">⟹</span>  <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span><span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> test <span class="bound">r</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="bound">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following facts should be moved. They show that the rules of Hoare logic based on Tarlecki triples are invertible.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> near_dioid<span class="main">)</span> <span class="entity">tt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⦇</span>_<span class="keyword1">⦈</span>_<span class="keyword1">⦇</span>_<span class="keyword1">⦈</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">⦈</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main"><span class="free">⦇</span></span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main"><span class="free">⦈</span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> near_dioid_one<span class="main">)</span> tt_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span> <span class="main">1</span> <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> near_dioid<span class="main">)</span> tt_cons1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">q'</span><span class="main">.</span> <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span> <span class="free">x</span> <span class="main">⦇</span><span class="bound">q'</span><span class="main">⦈</span> <span class="main">∧</span> <span class="bound">q'</span><span class="main">≤</span> <span class="free">q</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span> <span class="free">x</span> <span class="main">⦇</span><span class="free">q</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> near_dioid<span class="main">)</span> tt_cons2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p'</span><span class="main">.</span> <span class="main">⦇</span><span class="bound">p'</span><span class="main">⦈</span> <span class="free">x</span> <span class="main">⦇</span><span class="free">q</span><span class="main">⦈</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≤</span> <span class="bound">p'</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span> <span class="free">x</span> <span class="main">⦇</span><span class="free">q</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.dual_order.trans local.mult_isor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> near_dioid<span class="main">)</span> tt_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span> <span class="free">x</span> <span class="main">⦇</span><span class="bound">r</span><span class="main">⦈</span> <span class="main">∧</span> <span class="main">⦇</span><span class="bound">r</span><span class="main">⦈</span> <span class="free">y</span> <span class="main">⦇</span><span class="free">q</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⦇</span><span class="free">q</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.tt_cons2 mult_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> dioid<span class="main">)</span> tt_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">v</span><span class="main">⦈</span> <span class="free">x</span> <span class="main">⦇</span><span class="free">q</span><span class="main">⦈</span> <span class="main">∧</span> <span class="main">⦇</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">w</span><span class="main">⦈</span> <span class="free">y</span> <span class="main">⦇</span><span class="free">q</span><span class="main">⦈</span> <span class="main">⟷</span> <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span> <span class="main">(</span><span class="free">v</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">+</span> <span class="free">w</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span><span class="main">⦇</span><span class="free">q</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.distrib_left mult_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> kleene_algebra<span class="main">)</span> tt_while<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">⦇</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">v</span><span class="main">⦈</span> <span class="free">x</span> <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span> <span class="main">⟹</span> <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span> <span class="main">(</span><span class="free">v</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="free">w</span> <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.star_inductr_var_equiv local.star_subid local.tt_seq local.tt_skip mult_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The converse implication can be refuted. The situation is similar to the ht case.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> kat<span class="main">)</span> tt_while<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">v</span> <span class="main">⟹</span>  <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span> <span class="main">(</span><span class="free">v</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">v</span> <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span> <span class="main">⟹</span> <span class="main">⦇</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">v</span><span class="main">⦈</span> <span class="free">x</span> <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span>"</span></span>
  <span class="comment1">(* nitpick *)</span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> kat<span class="main">)</span> tt_while<span class="main">:</span> <span class="quoted"><span class="quoted">"test <span class="free">v</span> <span class="main">⟹</span>  <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span> <span class="main">(</span><span class="free">v</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>  <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span> <span class="main">⟹</span> <span class="main">⦇</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">v</span><span class="main">⦈</span> <span class="free">x</span> <span class="main">⦇</span><span class="free">p</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.star_inductr_var_equiv mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Perhaps this holds with possibly infinite loops in DRA...›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹wlp in KAT›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> kat<span class="main">)</span> <span class="quoted"><span class="quoted">"test <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> test <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">⋅</span> <span class="free">x</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.annil local.test_zero_var<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>                                                                                             

</pre>
</div><div id="PHL_DRAT">
<div class="head">
<h1>Theory PHL_DRAT</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Kleene algebra with tests
   Author:     Alasdair Armstrong, Victor B. F. Gomes, Georg Struth
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Propositional Hoare Logic›</span></span>

<span class="keyword1"><span class="command">theory</span></span> PHL_DRAT
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="DRAT.html">DRAT</a> <a href="../Kleene_Algebra/PHL_DRA.html">Kleene_Algebra.PHL_DRA</a> <a href="PHL_KAT.html">PHL_KAT</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> drat <span class="main">&lt;</span> phl<span class="main">:</span> at_it_pre_dioid <span class="keyword2"><span class="keyword">where</span></span> alpha <span class="main">=</span> <span class="quoted">t</span> <span class="keyword2"><span class="keyword">and</span></span> tau <span class="main">=</span> <span class="quoted">t</span> <span class="keyword2"><span class="keyword">and</span></span> it <span class="main">=</span> <span class="quoted">strong_iteration</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">context</span></span> drat
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> while <span class="main">(</span><span class="quoted">"<span class="keyword1">while</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">while</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">while</span> _ <span class="keyword1">do</span> _ <span class="keyword1">od</span>"</span> <span class="main">[</span>64<span class="main">,</span>64<span class="main">]</span> 63<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">while</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1"><span class="free">do</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">od</span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1" id="PHL_DRAT-phl_n_while"><span class="command">lemma</span></span>  phl_n_while<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span>  <span class="keyword1">n</span> <span class="free">y</span><span class="main">⦄</span> <span class="free">z</span> <span class="main">⦃</span><span class="keyword1">n</span> <span class="free">x</span><span class="main">⦄</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1">n</span> <span class="free">x</span><span class="main">⦄</span> <span class="main">(</span><span class="keyword1">n</span> <span class="free">y</span> <span class="main">⋅</span> <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">⋅</span> t <span class="free">y</span> <span class="main">⦃</span><span class="keyword1">n</span> <span class="free">x</span> <span class="main">⋅</span> t <span class="free">y</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms phl.ht_at_phl_while t_n_closed<span class="main">)</span>

<span class="keyword1" id="PHL_DRAT-phl_test_while"><span class="command">lemma</span></span> phl_test_while<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">b</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">b</span><span class="main">⦄</span> <span class="free">x</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span> <span class="main">(</span><span class="free">b</span> <span class="main">⋅</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms phl_n_while test_double_comp_var<span class="main">)</span>

<span class="keyword1" id="PHL_DRAT-phl_while_syntax"><span class="command">lemma</span></span> phl_while_syntax<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"test <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="free">b</span><span class="main">⦄</span> <span class="free">x</span> <span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">p</span><span class="main">⦄</span> <span class="keyword1">while</span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">x</span> <span class="keyword1">od</span> <span class="main">⦃</span><span class="free">p</span> <span class="main">⋅</span> <span class="main">!</span><span class="free">b</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms phl_test_while<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="KAT2">
<div class="head">
<h1>Theory KAT2</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Kleene Algebra with Tests
   Author:     Alasdair Armstrong, Victor B. F. Gomes, Georg Struth
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Two sorted Kleene Algebra with Tests›</span></span>

<span class="keyword1"><span class="command">theory</span></span> KAT2
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Kleene_Algebra/Kleene_Algebra.html">Kleene_Algebra.Kleene_Algebra</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  As an alternative to the one-sorted implementation of tests, we provide a two-sorted, more 
  conventional one. In this setting, Isabelle's Boolean algebra theory can be used.
  This alternative can be developed further along the lines of the one-sorted implementation.
›</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="quoted">"_kat"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">`</span>_<span class="keyword1">`</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">kat_test_vars</span> <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">"p"</span><span class="main">,</span><span class="inner_quoted">"q"</span><span class="main">,</span><span class="inner_quoted">"r"</span><span class="main">,</span><span class="inner_quoted">"s"</span><span class="main">,</span><span class="inner_quoted">"t"</span><span class="main">,</span><span class="inner_quoted">"p'"</span><span class="main">,</span><span class="inner_quoted">"q'"</span><span class="main">,</span><span class="inner_quoted">"r'"</span><span class="main">,</span><span class="inner_quoted">"s'"</span><span class="main">,</span><span class="inner_quoted">"t'"</span><span class="main">,</span><span class="inner_quoted">"p''"</span><span class="main">,</span><span class="inner_quoted">"q''"</span><span class="main">,</span><span class="inner_quoted">"r''"</span><span class="main">,</span><span class="inner_quoted">"s''"</span><span class="main">,</span><span class="inner_quoted">"t''"</span><span class="main">]</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">map_ast_variables</span> <span class="entity">ast</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">ast</span> <span class="keyword2"><span class="keyword">of</span></span>
    <span class="main">(</span>Ast.Variable <span class="entity">v</span><span class="main">)</span> <span class="main">=&gt;</span>
      <span class="keyword2"><span class="keyword">if</span></span> exists <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">tv</span> <span class="main">=&gt;</span> <span class="entity">tv</span> <span class="main">=</span> <span class="entity">v</span><span class="main">)</span> <span class="entity">kat_test_vars</span>
      <span class="keyword2"><span class="keyword">then</span></span> Ast.Appl <span class="main">[</span>Ast.Variable <span class="inner_quoted">"test"</span><span class="main">,</span> Ast.Variable <span class="entity">v</span><span class="main">]</span>
      <span class="keyword2"><span class="keyword">else</span></span> Ast.Variable <span class="entity">v</span>
  <span class="main">|</span> <span class="main">(</span>Ast.Constant <span class="entity">c</span><span class="main">)</span> <span class="main">=&gt;</span> Ast.Constant <span class="entity">c</span>
  <span class="main">|</span> <span class="main">(</span>Ast.Appl <span class="main">[</span><span class="main">]</span><span class="main">)</span> <span class="main">=&gt;</span> Ast.Appl <span class="main">[</span><span class="main">]</span>
  <span class="main">|</span> <span class="main">(</span>Ast.Appl <span class="main">(</span><span class="entity">f</span> :: <span class="entity">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> Ast.Appl <span class="main">(</span><span class="entity">f</span> :: map <span class="entity">map_ast_variables</span> <span class="entity">xs</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">KATHomRules</span> <span class="main">=</span> <span class="entity">Named_Thms</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">val</span></span> <span class="entity">name</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">binding</span> "kat_hom"<span class="antiquote">}</span></span></span>
   <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">description</span> <span class="main">=</span> <span class="inner_quoted">"KAT test homomorphism rules"</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">kat_hom_tac</span> <span class="entity">ctxt</span> <span class="entity">n</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">rev_rules</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">thm</span> <span class="main">=&gt;</span> <span class="entity">thm</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> sym<span class="antiquote">}</span></span></span><span class="main">)</span> <span class="main">(</span><span class="entity">KATHomRules.get</span> <span class="entity">ctxt</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">asm_full_simp_tac</span> <span class="main">(</span>put_simpset <span class="entity">HOL_basic_ss</span> <span class="entity">ctxt</span> addsimps <span class="entity">rev_rules</span><span class="main">)</span> <span class="entity">n</span>
  <span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹<span class="entity">KATHomRules.setup</span>›</span>

<span class="keyword1"><span class="command">method_setup</span></span> kat_hom <span class="main">=</span> <span class="quoted">‹
Scan.succeed <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="entity">SIMPLE_METHOD</span> <span class="main">(</span>CHANGED <span class="main">(</span><span class="entity">kat_hom_tac</span> <span class="entity">ctxt</span> <span class="inner_numeral">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">parse_ast_translation</span></span> <span class="quoted">‹
<span class="keyword2"><span class="keyword">let</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">kat_tr</span> <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">t</span><span class="main">]</span> <span class="main">=</span> <span class="entity">map_ast_variables</span> <span class="entity">t</span>
<span class="keyword2"><span class="keyword">in</span></span> <span class="main">[</span><span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_kat"<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">kat_tr</span><span class="main">)</span><span class="main">]</span> <span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">VCGRules</span> <span class="main">=</span> <span class="entity">Named_Thms</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">val</span></span> <span class="entity">name</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">binding</span> "vcg"<span class="antiquote">}</span></span></span>
   <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">description</span> <span class="main">=</span> <span class="inner_quoted">"verification condition generator rules"</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">vcg_tac</span> <span class="entity">ctxt</span> <span class="entity">n</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">vcg'</span> <span class="main">[</span><span class="main">]</span> <span class="main">=</span> no_tac
      <span class="main">|</span> <span class="entity">vcg'</span> <span class="main">(</span><span class="entity">r</span> :: <span class="entity">rs</span><span class="main">)</span> <span class="main">=</span> resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">r</span><span class="main">]</span> <span class="entity">n</span> ORELSE <span class="entity">vcg'</span> <span class="entity">rs</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span> REPEAT <span class="main">(</span>CHANGED
       <span class="main">(</span><span class="entity">kat_hom_tac</span> <span class="entity">ctxt</span> <span class="entity">n</span>
        THEN REPEAT <span class="main">(</span><span class="entity">vcg'</span> <span class="main">(</span><span class="entity">VCGRules.get</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span>
        THEN <span class="entity">kat_hom_tac</span> <span class="entity">ctxt</span> <span class="entity">n</span>
        THEN TRY <span class="main">(</span>resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> order_refl<span class="antiquote">}</span></span></span> <span class="entity">n</span> ORELSE <span class="entity">asm_full_simp_tac</span> <span class="main">(</span>put_simpset <span class="entity">HOL_basic_ss</span> <span class="entity">ctxt</span><span class="main">)</span> <span class="entity">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">method_setup</span></span> vcg <span class="main">=</span> <span class="quoted">‹
Scan.succeed <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="entity">SIMPLE_METHOD</span> <span class="main">(</span>CHANGED <span class="main">(</span><span class="entity">vcg_tac</span> <span class="entity">ctxt</span> <span class="inner_numeral">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹<span class="entity">VCGRules.setup</span>›</span>

<span class="keyword1"><span class="command">locale</span></span> dioid_tests <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">test</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>boolean_algebra <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>dioid_one_zerol"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">not</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>dioid_one_zerol <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>dioid_one_zerol"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">-</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> test_sup <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">kat_hom</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">test</span> <span class="main">(</span>sup <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">`</span>p <span class="main">+</span> q<span class="main">`</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> test_inf <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">kat_hom</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">test</span> <span class="main">(</span>inf <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">`</span>p <span class="main">⋅</span> q<span class="main">`</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> test_top <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">kat_hom</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">test</span> top <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> test_bot <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">kat_hom</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">test</span> bot <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> test_not <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">kat_hom</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">test</span> <span class="main">(</span><span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">`</span><span class="main"><span class="free">-</span></span>p<span class="main">`</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> test_iso_eq <span class="main">[</span><span class="operator">kat_hom</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⟷</span> <span class="main">`</span>p <span class="main">≤</span> q<span class="main">`</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> <span class="free">test</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">ι</span>"</span><span class="main">)</span>

<span class="keyword1" id="KAT2-test_eq"><span class="command">lemma</span></span> test_eq <span class="main">[</span><span class="operator">kat_hom</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⟷</span> <span class="main">`</span>p <span class="main">=</span> q<span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_iff test_iso_eq<span class="main">)</span>

<span class="keyword1"><span class="command">ML_val</span></span> <span class="quoted">‹map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">thm</span> <span class="main">=&gt;</span> <span class="entity">thm</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> sym<span class="antiquote">}</span></span></span><span class="main">)</span> <span class="main">(</span><span class="entity">KATHomRules.get</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span><span class="main">)</span>›</span>

<span class="keyword1" id="KAT2-test_iso"><span class="command">lemma</span></span> test_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⟹</span> <span class="main">`</span>p <span class="main">≤</span> q<span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> test_iso_eq<span class="main">)</span>

<span class="comment1">(* Import lemmas and modify them to fit KAT syntax *)</span>

<span class="keyword1" id="KAT2-test_meet_comm"><span class="command">lemma</span></span> test_meet_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p <span class="main">⋅</span> q <span class="main">=</span> q <span class="main">⋅</span> p<span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">kat_hom</span> <span class="main">(</span><span class="operator">fact</span> inf_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> test_one_top<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> test_iso<span class="main">[</span><span class="operator">OF</span> top_greatest<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main"><span class="free">-</span></span>p <span class="main">+</span> p <span class="main">=</span> <span class="main">1</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">kat_hom</span> <span class="main">(</span><span class="operator">metis</span> compl_sup_top<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p <span class="main">+</span> <span class="main">(</span><span class="main"><span class="free">-</span></span>p<span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">kat_hom</span> <span class="main">(</span><span class="operator">metis</span> sup_compl_top<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main">(</span><span class="main"><span class="free">-</span></span>p<span class="main">)</span> <span class="main">⋅</span> p <span class="main">=</span> <span class="main">0</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf_compl_bot test_bot test_inf test_not<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p <span class="main">⋅</span> <span class="main">(</span><span class="main"><span class="free">-</span></span>p<span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_compl_bot test_bot test_inf test_not<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> kat <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">test</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>boolean_algebra <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>kleene_algebra"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">not</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>kleene_algebra <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>kleene_algebra"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">!</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_dioid_tests<span class="main">:</span> <span class="quoted"><span class="quoted">"dioid_tests <span class="free">test</span> <span class="free">not</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> kat <span class="main">⊆</span> dioid_tests <span class="keyword1"><span class="command">using</span></span> is_dioid_tests <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">context</span></span> kat
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> <span class="free">test</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">ι</span>"</span><span class="main">)</span>

<span class="keyword1" id="KAT2-test_eq"><span class="command">lemma</span></span> test_eq <span class="main">[</span><span class="operator">kat_hom</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⟷</span> <span class="main">`</span>p <span class="main">=</span> q<span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_iff test_iso_eq<span class="main">)</span>

<span class="keyword1"><span class="command">ML_val</span></span> <span class="quoted">‹map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">thm</span> <span class="main">=&gt;</span> <span class="entity">thm</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> sym<span class="antiquote">}</span></span></span><span class="main">)</span> <span class="main">(</span><span class="entity">KATHomRules.get</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span><span class="main">)</span>›</span>

<span class="keyword1" id="KAT2-test_iso"><span class="command">lemma</span></span> test_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⟹</span> <span class="main">`</span>p <span class="main">≤</span> q<span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> test_iso_eq<span class="main">)</span>

<span class="comment1">(* Import lemmas and modify them to fit KAT syntax *)</span>

<span class="keyword1" id="KAT2-test_meet_comm"><span class="command">lemma</span></span> test_meet_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p <span class="main">⋅</span> q <span class="main">=</span> q <span class="main">⋅</span> p<span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">kat_hom</span> <span class="main">(</span><span class="operator">fact</span> inf_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> test_one_top<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> test_iso<span class="main">[</span><span class="operator">OF</span> top_greatest<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="KAT2-test_star"><span class="command">lemma</span></span> test_star <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_subid test_iso test_top top_greatest<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">kat_hom</span><span class="main">]</span> <span class="main">=</span> test_star<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main"><span class="free">!</span></span>p <span class="main">+</span> p <span class="main">=</span> <span class="main">1</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">kat_hom</span> <span class="main">(</span><span class="operator">metis</span> compl_sup_top<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p <span class="main">+</span> <span class="main"><span class="free">!</span></span>p <span class="main">=</span> <span class="main">1</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">kat_hom</span> <span class="main">(</span><span class="operator">metis</span> sup_compl_top<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main"><span class="free">!</span></span>p <span class="main">⋅</span> p <span class="main">=</span> <span class="main">0</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf_compl_bot test_bot test_inf test_not<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p <span class="main">⋅</span> <span class="main"><span class="free">!</span></span>p <span class="main">=</span> <span class="main">0</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_compl_bot test_bot test_inf test_not<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hoare_triple</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⦃</span>_<span class="keyword1">⦄</span> _ <span class="keyword1">⦃</span>_<span class="keyword1">⦄</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⦃</span></span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">⦄</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">⦃</span></span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main"><span class="free">⦄</span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> hoare_triple_def<span class="main">[</span><span class="operator">iff</span><span class="main">]</span>

<span class="keyword1" id="KAT2-hoare_triple_def_var"><span class="command">lemma</span></span> hoare_triple_def_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p<span class="main">⋅</span><span class="free">c</span> <span class="main">≤</span> <span class="free">c</span><span class="main">⋅</span>q <span class="main">⟷</span> p<span class="main">⋅</span><span class="free">c</span><span class="main">⋅</span><span class="main"><span class="free">!</span></span>q <span class="main">=</span> <span class="main">0</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> iffI antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">`</span></span><span class="free"><span class="free">c</span></span> <span class="main"><span class="main">⋅</span></span> q <span class="main"><span class="main">⋅</span></span> <span class="main"><span class="free"><span class="main"><span class="free">!</span></span></span></span>q<span class="main"><span class="main">`</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_isor<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">`</span></span>p<span class="main"><span class="main">⋅</span></span><span class="free"><span class="free">c</span></span><span class="main"><span class="main">⋅</span></span><span class="main"><span class="main">(</span></span><span class="main"><span class="free"><span class="main"><span class="free">!</span></span></span></span>q <span class="main"><span class="main">+</span></span> q<span class="main"><span class="main">)</span></span><span class="main"><span class="main">`</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> distrib_left add_zerol<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">`</span></span><span class="main"><span class="main">1</span></span> <span class="main"><span class="main">⋅</span></span> <span class="free"><span class="free">c</span></span> <span class="main"><span class="main">⋅</span></span> q<span class="main"><span class="main">`</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_isor<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span> <span class="main">=</span> star_sim2<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1" id="KAT2-hoare_weakening"><span class="command">lemma</span></span> hoare_weakening<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">p'</span> <span class="main">⟹</span> <span class="free">q'</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⟹</span> <span class="main">`</span><span class="main">⦃</span>p'<span class="main">⦄</span> <span class="free">c</span> <span class="main">⦃</span>q'<span class="main">⦄</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="main">⦃</span>p<span class="main">⦄</span> <span class="free">c</span> <span class="main">⦃</span>q<span class="main">⦄</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> mult_isol mult_isor order_trans test_iso<span class="main">)</span>

<span class="keyword1" id="KAT2-hoare_star"><span class="command">lemma</span></span> hoare_star<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main">⦃</span>p<span class="main">⦄</span> <span class="free">c</span> <span class="main">⦃</span>p<span class="main">⦄</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="main">⦃</span>p<span class="main">⦄</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⦃</span>p<span class="main">⦄</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">vcg</span><span class="main">]</span> <span class="main">=</span> hoare_weakening<span class="main">[</span><span class="operator">OF</span> order_refl _ hoare_star<span class="main">]</span>

<span class="keyword1" id="KAT2-hoare_test"><span class="command">lemma</span></span> hoare_test <span class="main">[</span><span class="operator">vcg</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p <span class="main">⋅</span> t <span class="main">≤</span> q<span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="main">⦃</span>p<span class="main">⦄</span> t <span class="main">⦃</span>q<span class="main">⦄</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> inf_le2 le_inf_iff test_inf test_iso_eq<span class="main">)</span>

<span class="keyword1" id="KAT2-hoare_mult"><span class="command">lemma</span></span> hoare_mult <span class="main">[</span><span class="operator">vcg</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main">⦃</span>p<span class="main">⦄</span> <span class="free">x</span> <span class="main">⦃</span>r<span class="main">⦄</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="main">⦃</span>r<span class="main">⦄</span> <span class="free">y</span> <span class="main">⦃</span>q<span class="main">⦄</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="main">⦃</span>p<span class="main">⦄</span> <span class="free">x</span><span class="main">⋅</span><span class="free">y</span> <span class="main">⦃</span>q<span class="main">⦄</span><span class="main">`</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p <span class="main">⋅</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> r<span class="main">`</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>r <span class="main">⋅</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⋅</span> q<span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> r <span class="main">⋅</span> <span class="free">y</span><span class="main">`</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mult_isor<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> q<span class="main">`</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mult_isol<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="free">y</span> <span class="main">⋅</span> q<span class="main">`</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main"><span class="free">!</span></span>p <span class="main">⋅</span> <span class="main"><span class="free">!</span></span>p <span class="main">=</span> <span class="main"><span class="free">!</span></span>p<span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.idem test_inf test_not<span class="main">)</span>

<span class="keyword1" id="KAT2-hoare_plus"><span class="command">lemma</span></span> hoare_plus <span class="main">[</span><span class="operator">vcg</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main">⦃</span>p<span class="main">⦄</span> <span class="free">x</span> <span class="main">⦃</span>q<span class="main">⦄</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="main">⦃</span>p<span class="main">⦄</span> <span class="free">y</span> <span class="main">⦃</span>q<span class="main">⦄</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="main">⦃</span>p<span class="main">⦄</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⦃</span>q<span class="main">⦄</span><span class="main">`</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1"><span class="free">ι</span></span> <span class="free">p</span><span class="main">⦄</span> <span class="free">x</span> <span class="main">⦃</span><span class="keyword1"><span class="free">ι</span></span> <span class="free">q</span><span class="main">⦄</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="keyword1"><span class="free">ι</span></span> <span class="free">p</span><span class="main">⦄</span> <span class="free">y</span> <span class="main">⦃</span><span class="keyword1"><span class="free">ι</span></span> <span class="free">q</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">ι</span></span> <span class="free">p</span> <span class="main">⋅</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⋅</span> <span class="keyword1"><span class="free">ι</span></span> <span class="free">q</span> <span class="main">+</span> <span class="free">y</span> <span class="main">⋅</span> <span class="keyword1"><span class="free">ι</span></span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> distrib_left hoare_triple_def join.sup.mono<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">While</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">While</span> _ <span class="keyword1">Do</span> _ <span class="keyword1">End</span>"</span> <span class="main">[</span>50<span class="main">,</span>50<span class="main">]</span> 51<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">While</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1"><span class="free">Do</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1"><span class="free">End</span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">⋅</span><span class="main"><span class="free">!</span></span><span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1" id="KAT2-hoare_while"><span class="command">lemma</span></span> hoare_while<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main">⦃</span>p <span class="main">⋅</span> t<span class="main">⦄</span> <span class="free">c</span> <span class="main">⦃</span>p<span class="main">⦄</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="main">⦃</span>p<span class="main">⦄</span> <span class="keyword1">While</span> t <span class="keyword1">Do</span> <span class="free">c</span> <span class="keyword1">End</span> <span class="main">⦃</span><span class="main"><span class="free">!</span></span>t <span class="main">⋅</span> p<span class="main">⦄</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> While_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vcg</span> <span class="main">(</span><span class="operator">metis</span> inf_commute order_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">vcg</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main">⦃</span>p <span class="main">⋅</span> t<span class="main">⦄</span> <span class="free">c</span> <span class="main">⦃</span>p<span class="main">⦄</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="main"><span class="free">!</span></span>t <span class="main">⋅</span> p <span class="main">≤</span> q<span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="main">⦃</span>p<span class="main">⦄</span> <span class="keyword1">While</span> t <span class="keyword1">Do</span> <span class="free">c</span> <span class="keyword1">End</span> <span class="main">⦃</span>q<span class="main">⦄</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hoare_weakening hoare_while order_refl test_inf test_iso_eq test_not<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">If</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">If</span> _ <span class="keyword1">Then</span> _ <span class="keyword1">Else</span> _"</span> <span class="main">[</span>50<span class="main">,</span>50<span class="main">,</span>50<span class="main">]</span> 51<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">If</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">Then</span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1"><span class="free">Else</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">+</span> <span class="main"><span class="free">!</span></span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">⋅</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span>

<span class="keyword1" id="KAT2-hoare_if"><span class="command">lemma</span></span> hoare_if <span class="main">[</span><span class="operator">vcg</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main">⦃</span>p <span class="main">⋅</span> t<span class="main">⦄</span> <span class="free">c1</span> <span class="main">⦃</span>q<span class="main">⦄</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="main">⦃</span>p <span class="main">⋅</span> <span class="main"><span class="free">!</span></span>t<span class="main">⦄</span> <span class="free">c2</span> <span class="main">⦃</span>q<span class="main">⦄</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span><span class="main">⦃</span>p<span class="main">⦄</span> <span class="keyword1">If</span> t <span class="keyword1">Then</span> <span class="free">c1</span> <span class="keyword1">Else</span> <span class="free">c2</span> <span class="main">⦃</span>q<span class="main">⦄</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> If_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">vcg</span> <span class="operator">assumption</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DRAT2">
<div class="head">
<h1>Theory DRAT2</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Demonic refinement algebra
   Author:     Alasdair Armstrong, Victor B. F. Gomes, Georg Struth
   Maintainer: Georg Struth &lt;g.struth at sheffield.ac.uk&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Two sorted Demonic Refinement Algebras›</span></span>

<span class="keyword1"><span class="command">theory</span></span> DRAT2
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Kleene_Algebra/DRA.html">Kleene_Algebra.DRA</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  As an alternative to the one-sorted implementation of demonic refinement algebra with tests, 
  we provide a two-sorted, more conventional one.
  This alternative can be developed further along the lines of the one-sorted implementation.
›</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="quoted">"_dra"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">`</span>_<span class="keyword1">`</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">dra_test_vars</span> <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">"p"</span><span class="main">,</span><span class="inner_quoted">"q"</span><span class="main">,</span><span class="inner_quoted">"r"</span><span class="main">,</span><span class="inner_quoted">"s"</span><span class="main">,</span><span class="inner_quoted">"t"</span><span class="main">,</span><span class="inner_quoted">"p'"</span><span class="main">,</span><span class="inner_quoted">"q'"</span><span class="main">,</span><span class="inner_quoted">"r'"</span><span class="main">,</span><span class="inner_quoted">"s'"</span><span class="main">,</span><span class="inner_quoted">"t'"</span><span class="main">,</span><span class="inner_quoted">"p''"</span><span class="main">,</span><span class="inner_quoted">"q''"</span><span class="main">,</span><span class="inner_quoted">"r''"</span><span class="main">,</span><span class="inner_quoted">"s''"</span><span class="main">,</span><span class="inner_quoted">"t''"</span><span class="main">]</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">map_ast_variables</span> <span class="entity">ast</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">ast</span> <span class="keyword2"><span class="keyword">of</span></span>
    <span class="main">(</span>Ast.Variable <span class="entity">v</span><span class="main">)</span> <span class="main">=&gt;</span>
      <span class="keyword2"><span class="keyword">if</span></span> exists <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">tv</span> <span class="main">=&gt;</span> <span class="entity">tv</span> <span class="main">=</span> <span class="entity">v</span><span class="main">)</span> <span class="entity">dra_test_vars</span>
      <span class="keyword2"><span class="keyword">then</span></span> Ast.Appl <span class="main">[</span>Ast.Variable <span class="inner_quoted">"test"</span><span class="main">,</span> Ast.Variable <span class="entity">v</span><span class="main">]</span>
      <span class="keyword2"><span class="keyword">else</span></span> Ast.Variable <span class="entity">v</span>
  <span class="main">|</span> <span class="main">(</span>Ast.Constant <span class="entity">c</span><span class="main">)</span> <span class="main">=&gt;</span> Ast.Constant <span class="entity">c</span>
  <span class="main">|</span> <span class="main">(</span>Ast.Appl <span class="main">[</span><span class="main">]</span><span class="main">)</span> <span class="main">=&gt;</span> Ast.Appl <span class="main">[</span><span class="main">]</span>
  <span class="main">|</span> <span class="main">(</span>Ast.Appl <span class="main">(</span><span class="entity">f</span> :: <span class="entity">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> Ast.Appl <span class="main">(</span><span class="entity">f</span> :: map <span class="entity">map_ast_variables</span> <span class="entity">xs</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">DRAHomRules</span> <span class="main">=</span> <span class="entity">Named_Thms</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">val</span></span> <span class="entity">name</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">binding</span> "kat_hom"<span class="antiquote">}</span></span></span>
   <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">description</span> <span class="main">=</span> <span class="inner_quoted">"KAT test homomorphism rules"</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">dra_hom_tac</span> <span class="entity">ctxt</span> <span class="entity">n</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">rev_rules</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">thm</span> <span class="main">=&gt;</span> <span class="entity">thm</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> sym<span class="antiquote">}</span></span></span><span class="main">)</span> <span class="main">(</span><span class="entity">DRAHomRules.get</span> <span class="entity">ctxt</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">asm_full_simp_tac</span> <span class="main">(</span>put_simpset <span class="entity">HOL_basic_ss</span> <span class="entity">ctxt</span> addsimps <span class="entity">rev_rules</span><span class="main">)</span> <span class="entity">n</span>
  <span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹<span class="entity">DRAHomRules.setup</span>›</span>

<span class="keyword1"><span class="command">method_setup</span></span> kat_hom <span class="main">=</span> <span class="quoted">‹
  Scan.succeed <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="entity">SIMPLE_METHOD</span> <span class="main">(</span>CHANGED <span class="main">(</span><span class="entity">dra_hom_tac</span> <span class="entity">ctxt</span> <span class="inner_numeral">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">parse_ast_translation</span></span> <span class="quoted">‹
<span class="keyword2"><span class="keyword">let</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">dra_tr</span> <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">t</span><span class="main">]</span> <span class="main">=</span> <span class="entity">map_ast_variables</span> <span class="entity">t</span>
<span class="keyword2"><span class="keyword">in</span></span> <span class="main">[</span><span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_dra"<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">dra_tr</span><span class="main">)</span><span class="main">]</span> <span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">VCGRules</span> <span class="main">=</span> <span class="entity">Named_Thms</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">val</span></span> <span class="entity">name</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">binding</span> "vcg"<span class="antiquote">}</span></span></span>
   <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">description</span> <span class="main">=</span> <span class="inner_quoted">"verification condition generator rules"</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">vcg_tac</span> <span class="entity">ctxt</span> <span class="entity">n</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">vcg'</span> <span class="main">[</span><span class="main">]</span> <span class="main">=</span> no_tac
      <span class="main">|</span> <span class="entity">vcg'</span> <span class="main">(</span><span class="entity">r</span> :: <span class="entity">rs</span><span class="main">)</span> <span class="main">=</span> resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">r</span><span class="main">]</span> <span class="entity">n</span> ORELSE <span class="entity">vcg'</span> <span class="entity">rs</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span> REPEAT <span class="main">(</span>CHANGED
       <span class="main">(</span><span class="entity">dra_hom_tac</span> <span class="entity">ctxt</span> <span class="entity">n</span>
        THEN REPEAT <span class="main">(</span><span class="entity">vcg'</span> <span class="main">(</span><span class="entity">VCGRules.get</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span>
        THEN <span class="entity">dra_hom_tac</span> <span class="entity">ctxt</span> <span class="entity">n</span>
        THEN TRY <span class="main">(</span>resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> order_refl<span class="antiquote">}</span></span></span> <span class="entity">n</span> ORELSE <span class="entity">asm_full_simp_tac</span> <span class="main">(</span>put_simpset <span class="entity">HOL_basic_ss</span> <span class="entity">ctxt</span><span class="main">)</span> <span class="entity">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">method_setup</span></span> vcg <span class="main">=</span> <span class="quoted">‹
  Scan.succeed <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="entity">SIMPLE_METHOD</span> <span class="main">(</span>CHANGED <span class="main">(</span><span class="entity">vcg_tac</span> <span class="entity">ctxt</span> <span class="inner_numeral">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹<span class="entity">VCGRules.setup</span>›</span>

<span class="keyword1"><span class="command">locale</span></span> drat <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">test</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>boolean_algebra <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>dra"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">not</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>dra <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>dra"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">!</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> test_sup <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">kat_hom</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">test</span> <span class="main">(</span>sup <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">`</span>p <span class="main">+</span> q<span class="main">`</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> test_inf <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">kat_hom</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">test</span> <span class="main">(</span>inf <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">`</span>p <span class="main">⋅</span> q<span class="main">`</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> test_top <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">kat_hom</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">test</span> top <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> test_bot <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">kat_hom</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">test</span> bot <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> test_not <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">kat_hom</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">test</span> <span class="main">(</span><span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">`</span><span class="main"><span class="free">!</span></span>p<span class="main">`</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> test_iso_eq <span class="main">[</span><span class="operator">kat_hom</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⟷</span> <span class="main">`</span>p <span class="main">≤</span> q<span class="main">`</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> <span class="free">test</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">ι</span>"</span><span class="main">)</span>

<span class="keyword1" id="DRAT2-test_eq"><span class="command">lemma</span></span> test_eq <span class="main">[</span><span class="operator">kat_hom</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⟷</span> <span class="main">`</span>p <span class="main">=</span> q<span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_iff test_iso_eq<span class="main">)</span>

<span class="keyword1"><span class="command">ML_val</span></span> <span class="quoted">‹map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">thm</span> <span class="main">=&gt;</span> <span class="entity">thm</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> sym<span class="antiquote">}</span></span></span><span class="main">)</span> <span class="main">(</span><span class="entity">DRAHomRules.get</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span><span class="main">)</span>›</span>

<span class="keyword1" id="DRAT2-test_iso"><span class="command">lemma</span></span> test_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⟹</span> <span class="main">`</span>p <span class="main">≤</span> q<span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> test_iso_eq<span class="main">)</span>

<span class="keyword1" id="DRAT2-test_meet_comm"><span class="command">lemma</span></span> test_meet_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p <span class="main">⋅</span> q <span class="main">=</span> q <span class="main">⋅</span> p<span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">kat_hom</span> <span class="main">(</span><span class="operator">fact</span> inf_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> test_one_top<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> test_iso<span class="main">[</span><span class="operator">OF</span> top_greatest<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="DRAT2-test_star"><span class="command">lemma</span></span> test_star <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">1</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star_subid test_iso test_top top_greatest<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">kat_hom</span><span class="main">]</span> <span class="main">=</span> test_star<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1" id="DRAT2-test_comp_add1"><span class="command">lemma</span></span> test_comp_add1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main"><span class="free">!</span></span>p <span class="main">+</span> p <span class="main">=</span> <span class="main">1</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">kat_hom</span> <span class="main">(</span><span class="operator">metis</span> compl_sup_top<span class="main">)</span>

<span class="keyword1" id="DRAT2-test_comp_add2"><span class="command">lemma</span></span> test_comp_add2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p <span class="main">+</span> <span class="main"><span class="free">!</span></span>p <span class="main">=</span> <span class="main">1</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">kat_hom</span> <span class="main">(</span><span class="operator">metis</span> sup_compl_top<span class="main">)</span>

<span class="keyword1" id="DRAT2-test_comp_mult1"><span class="command">lemma</span></span> test_comp_mult1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main"><span class="free">!</span></span>p <span class="main">⋅</span> p <span class="main">=</span> <span class="main">0</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf_compl_bot test_bot test_inf test_not<span class="main">)</span>

<span class="keyword1" id="DRAT2-test_comp_mult2"><span class="command">lemma</span></span> test_comp_mult2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p <span class="main">⋅</span> <span class="main"><span class="free">!</span></span>p <span class="main">=</span> <span class="main">0</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_compl_bot test_bot test_inf test_not<span class="main">)</span>

<span class="keyword1" id="DRAT2-test_eq1"><span class="command">lemma</span></span> test_eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">`</span> <span class="main">⟷</span> <span class="main">`</span>p<span class="main">⋅</span><span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">`</span> <span class="main">∧</span> <span class="main">`</span><span class="main"><span class="free">!</span></span>p<span class="main">⋅</span><span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mult_isol_var mult_onel test_not test_one_top<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main">(</span>p <span class="main">+</span> <span class="main"><span class="free">!</span></span>p<span class="main">)</span><span class="main">⋅</span><span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">`</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mult_onel sup_compl_top test_not test_sup test_top<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distrib_right' join.sup.bounded_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p<span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> p<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span>q<span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span>p<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main"><span class="free">!</span></span>q <span class="main">=</span> <span class="main">0</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">nitpick</span></span> <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="DRAT2-test1"><span class="command">lemma</span></span> test1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main"><span class="free">!</span></span>q <span class="main">=</span> <span class="main">0</span><span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span>p<span class="main">⋅</span><span class="free">x</span> <span class="main">=</span> p<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span>q<span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_0_left distrib_left mult_oner test_comp_add1<span class="main">)</span>

<span class="keyword1" id="DRAT2-test2"><span class="command">lemma</span></span> test2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p<span class="main">⋅</span>q<span class="main">⋅</span>p <span class="main">=</span> p<span class="main">⋅</span>q<span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf.left_idem test_inf<span class="main">)</span>

<span class="keyword1" id="DRAT2-test3"><span class="command">lemma</span></span> test3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p<span class="main">⋅</span>q<span class="main">⋅</span><span class="main"><span class="free">!</span></span>p <span class="main">=</span> <span class="main">0</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.assoc inf.idem inf.left_commute inf_compl_bot test_bot test_inf test_not<span class="main">)</span>

<span class="keyword1" id="DRAT2-test4"><span class="command">lemma</span></span> test4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main"><span class="free">!</span></span>p<span class="main">⋅</span>q<span class="main">⋅</span>p <span class="main">=</span> <span class="main">0</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> double_compl test3 test_not<span class="main">)</span>

<span class="keyword1" id="DRAT2-total_correctness"><span class="command">lemma</span></span> total_correctness<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p<span class="main">⋅</span><span class="free">x</span><span class="main">⋅</span><span class="main"><span class="free">!</span></span>q <span class="main">=</span> <span class="main">0</span><span class="main">`</span> <span class="main">⟷</span> <span class="main">`</span><span class="free">x</span><span class="main">⋅</span><span class="main"><span class="free">!</span></span>q <span class="main">≤</span> <span class="main"><span class="free">!</span></span>p<span class="main">⋅</span><span class="main">⊤</span><span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> join.bot.extremum mult.assoc test_eq1 top_elim<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add_zeror annil less_eq_def mult.assoc mult_isol test_comp_mult2<span class="main">)</span>

<span class="keyword1" id="DRAT2-test_iteration_sim"><span class="command">lemma</span></span> test_iteration_sim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span>p<span class="main">⋅</span><span class="free">x</span> <span class="main">≤</span> <span class="free">x</span><span class="main">⋅</span>p<span class="main">`</span> <span class="main">⟹</span> <span class="main">`</span>p<span class="main">⋅</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">⋅</span>p<span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iteration_sim<span class="main">)</span>

<span class="keyword1" id="DRAT2-test_iteration_annir"><span class="command">lemma</span></span> test_iteration_annir<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">`</span><span class="main"><span class="free">!</span></span>p<span class="main">⋅</span><span class="main">(</span>p<span class="main">⋅</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="main"><span class="free">!</span></span>p<span class="main">`</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> annil iteration_idep mult.assoc test_comp_mult1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>