<div id="PermutationLemmas">
<div class="head">
<h1>Theory PermutationLemmas</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Permutation Lemmas"</span></span>

<span class="keyword1"><span class="command">theory</span></span> PermutationLemmas
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Library/List_Permutation.html">HOL-Library.List_Permutation</a>"</span> <span class="quoted">"<a href="../../HOL/HOL-Library/Multiset.html">HOL-Library.Multiset</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="comment1">― ‹following function is very close to that in multisets- now we can make the connection that x &lt;~~&gt; y iff the multiset of x is the same as that of y›</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"perm, count equivalence"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">count</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">count</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">count</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="free">count</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>

<span class="keyword1" id="PermutationLemmas-perm_count"><span class="command">lemma</span></span> perm_count<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">&lt;~~&gt;</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> count <span class="bound">x</span> <span class="free">A</span> <span class="main">=</span> count <span class="bound">x</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> perm<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="PermutationLemmas-count_0"><span class="command">lemma</span></span> count_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="bound">x</span> <span class="free">B</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">B</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="PermutationLemmas-count_Suc"><span class="command">lemma</span></span> count_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"count <span class="free">a</span> <span class="free">B</span> <span class="main">=</span> Suc <span class="free">m</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">:</span> set <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">B</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="improper">aa</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="PermutationLemmas-count_append"><span class="command">lemma</span></span> count_append<span class="main">:</span> <span class="quoted"><span class="quoted">"count <span class="free">a</span> <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span> <span class="main">=</span> count <span class="free">a</span> <span class="free">xs</span> <span class="main">+</span> count <span class="free">a</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="PermutationLemmas-count_perm"><span class="command">lemma</span></span> count_perm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> count <span class="bound">x</span> <span class="free">A</span> <span class="main">=</span> count <span class="bound">x</span> <span class="bound">B</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">&lt;~~&gt;</span> <span class="bound">B</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_0<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">list</span> <span class="skolem">B</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">B</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="bound">x</span> <span class="skolem">list</span> <span class="main">=</span> count <span class="bound">x</span> <span class="bound">B</span> <span class="main">⟹</span> <span class="skolem">list</span> <span class="main">&lt;~~&gt;</span> <span class="bound">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="bound">x</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">=</span> count <span class="bound">x</span> <span class="skolem">B</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">:</span> set <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> count_Suc<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">from</span></span> split_list<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="skolem">xs</span><span class="main">@</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">@</span><span class="skolem">ys</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> count <span class="bound">x</span> <span class="skolem">list</span> <span class="main">=</span> count <span class="bound">x</span> <span class="var">?B'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_append B<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span> <span class="main">&lt;~~&gt;</span> <span class="skolem">xs</span><span class="main">@</span><span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span> <span class="main">&lt;~~&gt;</span> <span class="skolem">a</span><span class="main">#</span><span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">&lt;~~&gt;</span> <span class="skolem">xs</span><span class="main">@</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> perm_append_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="main">(</span>perm.trans<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> B<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span> <span class="main">&lt;~~&gt;</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="PermutationLemmas-perm_count_conv"><span class="command">lemma</span></span> perm_count_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">&lt;~~&gt;</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> count <span class="bound">x</span> <span class="free">A</span> <span class="main">=</span> count <span class="bound">x</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> perm_count count_perm<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Properties closed under Perm and Contr hold for x iff hold for remdups x"</span></span>

<span class="keyword1" id="PermutationLemmas-remdups_append"><span class="command">lemma</span></span> remdups_append<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">:</span> set <span class="free">ys</span> <span class="main">--&gt;</span> remdups <span class="main">(</span><span class="free">ws</span><span class="main">@</span><span class="free">y</span><span class="main">#</span><span class="free">ys</span><span class="main">)</span> <span class="main">=</span> remdups <span class="main">(</span><span class="free">ws</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ws</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="improper">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="PermutationLemmas-perm_contr'"><span class="command">lemma</span></span> perm_contr'<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> perm<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">&lt;~~&gt;</span> <span class="bound">ys</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="free">P</span> <span class="bound">xs</span> <span class="main">=</span> <span class="free">P</span> <span class="bound">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> contr'<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">xs</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="free">P</span> <span class="bound">xs</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>remdups <span class="bound">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&lt;</span>length <span class="skolem">xs</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ys</span><span class="main">.</span> length <span class="bound">ys</span> <span class="main">=</span> <span class="bound">m</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">ys</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>remdups <span class="bound">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>remdups <span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">xs</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>distinct_remdups_id<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> not_distinct_decomp<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ws</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">ws</span><span class="main">@</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">@</span><span class="skolem">ys</span><span class="main">@</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">@</span><span class="skolem">zs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span><span class="main">@</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">@</span><span class="skolem">ys</span><span class="main">@</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">@</span><span class="skolem">zs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xs<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="main">[</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">y</span><span class="main">]</span><span class="main">@</span><span class="skolem">ws</span><span class="main">@</span><span class="skolem">ys</span><span class="main">@</span><span class="skolem">zs</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> perm<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffD2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> perm_count_conv<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">@</span><span class="skolem">ws</span><span class="main">@</span><span class="skolem">ys</span><span class="main">@</span><span class="skolem">zs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> contr'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">ws</span><span class="main">@</span><span class="skolem">ys</span><span class="main">@</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">@</span><span class="skolem">zs</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> perm<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffD2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> perm_count_conv<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>remdups <span class="main">(</span><span class="skolem">ws</span><span class="main">@</span><span class="skolem">ys</span><span class="main">@</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">@</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> a<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xs<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>remdups <span class="main">(</span><span class="skolem">ws</span><span class="main">@</span><span class="skolem">ys</span><span class="main">@</span><span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">@</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>remdups <span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xs remdups_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>remdups <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="PermutationLemmas-perm_contr"><span class="command">lemma</span></span> perm_contr<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> perm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">&lt;~~&gt;</span> <span class="bound">ys</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="free">P</span> <span class="bound">xs</span> <span class="main">=</span> <span class="free">P</span> <span class="bound">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> contr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>remdups <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> perm_contr'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> perm contr'<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"List properties closed under Perm, Weak and Contr are monotonic in the set of the list"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">rem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> list <span class="main">=&gt;</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rem</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> filter <span class="main">(</span><span class="main">%</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">~=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1" id="PermutationLemmas-rem"><span class="command">lemma</span></span> rem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">~:</span> set <span class="main">(</span>rem <span class="free">x</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rem_def<span class="main">)</span>

<span class="keyword1" id="PermutationLemmas-length_rem"><span class="command">lemma</span></span> length_rem<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>rem <span class="free">x</span> <span class="free">xs</span><span class="main">)</span> <span class="main">&lt;=</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rem_def<span class="main">)</span>

<span class="keyword1" id="PermutationLemmas-rem_notin"><span class="command">lemma</span></span> rem_notin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">~:</span> set <span class="free">xs</span> <span class="main">==&gt;</span> rem <span class="free">x</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rem_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> filter_True<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="PermutationLemmas-perm_weak_filter'"><span class="command">lemma</span></span> perm_weak_filter'<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> perm<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">&lt;~~&gt;</span> <span class="bound">ys</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="free">P</span> <span class="bound">xs</span> <span class="main">=</span> <span class="free">P</span> <span class="bound">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> weak<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">xs</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">ys</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ys</span><span class="main">@</span>filter <span class="free">Q</span> <span class="free">xs</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ys</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="improper">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ys</span><span class="main">@</span><span class="main">[</span><span class="improper">a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ys</span><span class="main">@</span><span class="main">[</span><span class="improper">a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">ys</span> <span class="main">@</span> <span class="improper">a</span> <span class="main">#</span> filter <span class="free">Q</span> <span class="improper">xs</span><span class="main">)</span> <span class="main">&lt;~~&gt;</span> <span class="improper">a</span><span class="main">#</span><span class="improper">ys</span><span class="main">@</span>filter <span class="free">Q</span> <span class="improper">xs</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perm<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weak<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> perm_sym<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> perm_append_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="PermutationLemmas-perm_weak_filter"><span class="command">lemma</span></span> perm_weak_filter<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> perm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">&lt;~~&gt;</span> <span class="bound">ys</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="free">P</span> <span class="bound">xs</span> <span class="main">=</span> <span class="free">P</span> <span class="bound">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> weak<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">xs</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="free">xs</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> perm_weak_filter'<span class="main">[</span><span class="operator">OF</span> perm weak<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="comment1">― ‹right, now in a position to prove that in presence of perm, contr and weak, set x leq set y and x : ded implies y : ded›</span>

<span class="keyword1" id="PermutationLemmas-perm_weak_contr_mono"><span class="command">lemma</span></span> perm_weak_contr_mono<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> perm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">&lt;~~&gt;</span> <span class="bound">ys</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="free">P</span> <span class="bound">xs</span> <span class="main">=</span> <span class="free">P</span> <span class="bound">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> contr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> weak<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="free">P</span> <span class="bound">xs</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">x</span> <span class="main">&lt;=</span> set <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> Px <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> contr weak <span class="keyword1"><span class="command">have</span></span> contr'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">%</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">:</span> set <span class="free">x</span><span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> xy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">x</span> <span class="main">=</span> set <span class="skolem">y'</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y'_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">hence</span></span> rxry'<span class="main">:</span> <span class="quoted"><span class="quoted">"remdups <span class="free">x</span> <span class="main">&lt;~~&gt;</span> remdups <span class="skolem">y'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perm_remdups_iff_eq_set<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> Px perm_contr<span class="main">[</span><span class="operator">OF</span> perm contr'<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> Prx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>remdups <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> rxry' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>remdups <span class="skolem">y'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perm<span class="main">)</span>
  
  <span class="keyword1"><span class="command">with</span></span> perm_contr<span class="main">[</span><span class="operator">OF</span> perm contr'<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">y'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y'_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> perm_weak_filter<span class="main"><span class="main">[</span></span><span class="operator">OF</span> perm weak<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* No, not used
subsection "Following used in Soundness"

primrec multiset_of_list :: "'a list ⇒ 'a multiset"
where
  "multiset_of_list [] = {#}"
| "multiset_of_list (x#xs) = {#x#} + multiset_of_list xs"

lemma count_count[symmetric]: "count x A = Multiset.count (multiset_of_list A) x"
  by (induct A) simp_all

lemma perm_multiset: "A &lt;~~&gt; B = (multiset_of_list A = multiset_of_list B)"
  apply(simp add: perm_count_conv)
  apply(simp add: multiset_eq_iff)
  apply(simp add: count_count)
  done

lemma set_of_multiset_of_list: "set_of (multiset_of_list A) = set A"
  by (induct A) auto
*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Base">
<div class="head">
<h1>Theory Base</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Base"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Base
<span class="keyword2"><span class="keyword">imports</span></span> <a href="PermutationLemmas.html">PermutationLemmas</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Integrate with Isabelle libraries?"</span></span>

    <span class="comment1">― ‹Misc›</span>

  <span class="comment1">― ‹FIXME added by tjr, forms basis of a lot of proofs of existence of inf sets›</span>
  <span class="comment1">― ‹something like this should be in FiniteSet, asserting nats are not finite›</span>
<span class="keyword1" id="Base-natset_finite_max"><span class="command">lemma</span></span> natset_finite_max<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Max <span class="free">A</span><span class="main">)</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Max <span class="free">A</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≤</span> Max <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

    <span class="comment1">― ‹not used›</span>
<span class="keyword1" id="Base-not_finite_univ"><span class="command">lemma</span></span> not_finite_univ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> finite <span class="main">(</span>UNIV<span class="main">::</span>nat set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> natset_finite_max<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="comment1">― ‹FIXME should be in main lib›</span>
<span class="keyword1" id="Base-LeastI_ex"><span class="command">lemma</span></span> LeastI_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>wellorder<span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> LeastI<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Summation"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">summation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">summation</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">summation</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="free">summation</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Termination Measure"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">exp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat<span class="main">,</span>nat<span class="main">]</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">exp</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span>       <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">exp</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free">exp</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">sumList</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sumList</span> <span class="main">[]</span>     <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sumList</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free">sumList</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Functions"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">preImage</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">preImage</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">pre</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">equalOn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> set<span class="main">,</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'b</span><span class="main">,</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'b</span><span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">equalOn</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">!</span><span class="bound">x</span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>    

<span class="keyword1" id="Base-preImage_insert"><span class="command">lemma</span></span> preImage_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"preImage <span class="free">f</span> <span class="main">(</span>insert <span class="free">a</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> pre <span class="free">f</span> <span class="free">a</span> <span class="keyword1">Un</span> preImage <span class="free">f</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> preImage_def pre_def<span class="main">)</span>

<span class="keyword1" id="Base-preImageI"><span class="command">lemma</span></span> preImageI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">:</span> <span class="free">A</span> <span class="main">==&gt;</span> <span class="free">x</span> <span class="main">:</span> preImage <span class="free">f</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> preImage_def<span class="main">)</span>
    
<span class="keyword1" id="Base-preImageE"><span class="command">lemma</span></span> preImageE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">:</span> preImage <span class="free">f</span> <span class="free">A</span> <span class="main">==&gt;</span> <span class="free">f</span> <span class="free">x</span> <span class="main">:</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> preImage_def<span class="main">)</span>

<span class="keyword1" id="Base-equalOn_Un"><span class="command">lemma</span></span> equalOn_Un<span class="main">:</span>  <span class="quoted"><span class="quoted">"equalOn <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span>equalOn <span class="free">A</span> <span class="free">f</span> <span class="free">g</span> <span class="main">∧</span> equalOn <span class="free">B</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equalOn_def<span class="main">)</span> 

<span class="keyword1" id="Base-equalOnD"><span class="command">lemma</span></span> equalOnD<span class="main">:</span> <span class="quoted"><span class="quoted">"equalOn <span class="free">A</span> <span class="free">f</span> <span class="free">g</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equalOn_def<span class="main">)</span>

<span class="keyword1" id="Base-equalOnI"><span class="command">lemma</span></span> equalOnI<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> equalOn <span class="free">A</span> <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equalOn_def<span class="main">)</span>

<span class="keyword1" id="Base-equalOn_UnD"><span class="command">lemma</span></span> equalOn_UnD<span class="main">:</span> <span class="quoted"><span class="quoted">"equalOn <span class="main">(</span><span class="free">A</span> <span class="keyword1">Un</span> <span class="free">B</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span> <span class="main">==&gt;</span> equalOn <span class="free">A</span> <span class="free">f</span> <span class="free">g</span> <span class="main">&amp;</span> equalOn <span class="free">B</span> <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> equalOn_def<span class="main">)</span>


    <span class="comment1">― ‹FIXME move following elsewhere?›</span>
<span class="keyword1" id="Base-inj_inv_singleton"><span class="command">lemma</span></span> inj_inv_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> inj <span class="free">f</span><span class="main">;</span> <span class="free">f</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">z</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Base-finite_pre"><span class="command">lemma</span></span> finite_pre<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span> <span class="main">⟹</span> finite <span class="main">(</span>pre <span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pre_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Base-finite_preImage"><span class="command">lemma</span></span> finite_preImage<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> finite <span class="free">A</span><span class="main">;</span> inj <span class="free">f</span> <span class="main">⟧</span> <span class="main">⟹</span> finite <span class="main">(</span>preImage <span class="free">f</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> preImage_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> preImage_insert<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Formula">
<div class="head">
<h1>Theory Formula</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Formula"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Formula
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Base.html">Base</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Variables"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> vbl <span class="main">=</span> X <span class="quoted">nat</span>
  <span class="comment1">― ‹FIXME there's a lot of stuff about this datatype that is
  really just a lifting from nat (what else could it be). Makes me
  wonder whether things wouldn't be clearer is we just identified vbls
  with nats›</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">deX</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vbl <span class="main">=&gt;</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">deX</span> <span class="main">(</span>X <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1" id="Formula-X_deX"><span class="command">lemma</span></span> X_deX<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"X <span class="main">(</span>deX <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">zeroX</span> <span class="main">=</span> X <span class="main">0</span>"</span></span>


<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">nextX</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vbl <span class="main">=&gt;</span> vbl"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nextX</span> <span class="main">(</span>X <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> X <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">vblcase</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span>vbl <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">,</span>vbl<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vblcase</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">@</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">=</span>zeroX <span class="main">⟶</span> <span class="bound">z</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">!</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">=</span>nextX <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">z</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">case_translation</span> <span class="quoted">vblcase</span> <span class="quoted">zeroX</span> <span class="quoted">nextX</span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">freshVar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vbl set <span class="main">=&gt;</span> vbl"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">freshVar</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span> X <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∉</span> deX <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span>"</span></span>
    
<span class="keyword1" id="Formula-nextX_nextX"><span class="command">lemma</span></span> nextX_nextX<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nextX <span class="free">x</span> <span class="main">=</span> nextX <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span>  <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Formula-inj_nextX"><span class="command">lemma</span></span> inj_nextX<span class="main">:</span> <span class="quoted"><span class="quoted">"inj nextX"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>

<span class="keyword1" id="Formula-ind'"><span class="command">lemma</span></span> ind'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> zeroX <span class="main">==&gt;</span> <span class="main">(</span><span class="main">!</span> <span class="bound">v</span> <span class="main">.</span> <span class="free">P</span> <span class="bound">v</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="main">(</span>nextX <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="free">v'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">v'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> nat<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">nat</span></span></span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeroX_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> n<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"X <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Formula-ind"><span class="command">lemma</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">P</span> zeroX<span class="main">;</span> <span class="main">⋀</span> <span class="bound">v</span><span class="main">.</span> <span class="free">P</span> <span class="bound">v</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>nextX <span class="bound">v</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">v'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ind'<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Formula-zeroX_nextX"><span class="command">lemma</span></span> zeroX_nextX<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"zeroX <span class="main">~=</span> nextX <span class="free">a</span>"</span></span> <span class="comment1">― ‹FIXME iff?›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeroX_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> nextX_zeroX<span class="main">[</span><span class="operator">iff</span><span class="main">]</span> <span class="main">=</span> not_sym<span class="main">[</span><span class="operator">OF</span> zeroX_nextX<span class="main">]</span>

<span class="keyword1" id="Formula-nextX"><span class="command">lemma</span></span> nextX<span class="main">:</span> <span class="quoted"><span class="quoted">"nextX <span class="main">(</span>X <span class="free">n</span><span class="main">)</span> <span class="main">=</span> X <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Formula-vblcase_zeroX"><span class="command">lemma</span></span> vblcase_zeroX<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vblcase <span class="free">a</span> <span class="free">b</span> zeroX <span class="main">=</span> <span class="free">a</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vblcase_def<span class="main">)</span>

<span class="keyword1" id="Formula-vblcase_nextX"><span class="command">lemma</span></span> vblcase_nextX<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vblcase <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>nextX <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="free">n</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vblcase_def<span class="main">)</span>

<span class="keyword1" id="Formula-vbl_cases"><span class="command">lemma</span></span> vbl_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> zeroX <span class="main">|</span> <span class="main">(</span><span class="main">?</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">x</span> <span class="main">=</span> nextX <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> m<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">m</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zeroX_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"X <span class="improper">nat</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Formula-vbl_casesE"><span class="command">lemma</span></span> vbl_casesE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">=</span> zeroX <span class="main">⟹</span> <span class="free">P</span><span class="main">;</span> <span class="main">⋀</span> <span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> nextX <span class="bound">y</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> vbl_cases<span class="main"><span class="main">[</span></span><span class="operator">elim_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Formula-comp_vblcase"><span class="command">lemma</span></span> comp_vblcase<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">o</span> vblcase <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> vblcase <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> vbl_casesE<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vblcase_zeroX vblcase_nextX<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Formula-equalOn_vblcaseI'"><span class="command">lemma</span></span> equalOn_vblcaseI'<span class="main">:</span> <span class="quoted"><span class="quoted">"equalOn <span class="main">(</span>preImage nextX <span class="free">A</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span> <span class="main">==&gt;</span> equalOn <span class="free">A</span> <span class="main">(</span>vblcase <span class="free">x</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>vblcase <span class="free">x</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equalOn_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xa</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vbl_casesE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> preImage_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
    
<span class="keyword1" id="Formula-equalOn_vblcaseI"><span class="command">lemma</span></span> equalOn_vblcaseI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>zeroX <span class="main">:</span> <span class="free">A</span> <span class="main">--&gt;</span> <span class="free">x</span><span class="main">=</span><span class="free">y</span><span class="main">)</span> <span class="main">==&gt;</span> equalOn <span class="main">(</span>preImage nextX <span class="free">A</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span> <span class="main">==&gt;</span> equalOn <span class="free">A</span> <span class="main">(</span>vblcase <span class="free">x</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>vblcase <span class="free">y</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalOnI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xa</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vbl_casesE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> preImage_def equalOn_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Formula-X_deX_connection"><span class="command">lemma</span></span> X_deX_connection<span class="main">:</span> <span class="quoted"><span class="quoted">"X <span class="free">n</span> <span class="main">:</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">:</span> <span class="main">(</span>deX <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Formula-finiteFreshVar"><span class="command">lemma</span></span> finiteFreshVar<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">==&gt;</span> freshVar <span class="free">A</span> <span class="main">~:</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> freshVar_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_deX_connection<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> LeastI_ex<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="main">(</span>Max <span class="main">(</span>deX <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> natset_finite_max<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Formula-freshVarI"><span class="command">lemma</span></span> freshVarI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> finite <span class="free">A</span><span class="main">;</span> <span class="free">B</span> <span class="main">&lt;=</span> <span class="free">A</span> <span class="main">|]</span> <span class="main">==&gt;</span> freshVar <span class="free">A</span> <span class="main">~:</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finiteFreshVar<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Formula-freshVarI2"><span class="command">lemma</span></span> freshVarI2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">==&gt;</span> <span class="main">!</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">~:</span> <span class="free">A</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="main">(</span>freshVar <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finiteFreshVar<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> vblsimps <span class="main">=</span> vblcase_zeroX vblcase_nextX zeroX_nextX
  nextX_zeroX nextX_nextX comp_vblcase


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Predicates"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> predicate <span class="main">=</span> Predicate <span class="quoted">nat</span>

<span class="keyword1"><span class="command">datatype</span></span> signs <span class="main">=</span> Pos <span class="main">|</span> Neg

<span class="keyword1" id="Formula-signsE"><span class="command">lemma</span></span> signsE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">signs</span> <span class="main">=</span> Neg <span class="main">⟹</span> <span class="free">P</span><span class="main">;</span> <span class="free">signs</span> <span class="main">=</span> Pos <span class="main">⟹</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">signs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Formula-expand_case_signs"><span class="command">lemma</span></span> expand_case_signs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">(</span>case_signs <span class="free">vpos</span> <span class="free">vneg</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> 
  <span class="main">(</span><span class="free">F</span> <span class="main">=</span> Pos <span class="main">--&gt;</span> <span class="free">Q</span> <span class="main">(</span><span class="free">vpos</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> 
  <span class="main">(</span><span class="free">F</span> <span class="main">=</span> Neg <span class="main">--&gt;</span> <span class="free">Q</span> <span class="main">(</span><span class="free">vneg</span><span class="main">)</span><span class="main">)</span> 
 <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">sign</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"signs <span class="main">⇒</span> bool <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sign</span> Pos <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sign</span> Neg <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Formula-sign_arg_cong"><span class="command">lemma</span></span> sign_arg_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">==&gt;</span> sign <span class="free">z</span> <span class="free">x</span> <span class="main">=</span> sign <span class="free">z</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">invSign</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"signs <span class="main">⇒</span> signs"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">invSign</span> Pos <span class="main">=</span> Neg"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">invSign</span> Neg <span class="main">=</span> Pos"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Formulas"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> formula <span class="main">=</span>
    FAtom <span class="quoted">signs</span> <span class="quoted">predicate</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vbl list<span class="main">)</span>"</span></span>
  <span class="main">|</span> FConj <span class="quoted">signs</span> <span class="quoted">formula</span> <span class="quoted">formula</span>
  <span class="main">|</span> FAll  <span class="quoted">signs</span> <span class="quoted">formula</span>  


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"formula signs induct, formula signs cases"</span></span>

<span class="keyword1" id="Formula-formula_signs_induct"><span class="command">lemma</span></span> formula_signs_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span>
  <span class="main">!</span> <span class="bound">p</span> <span class="bound">vs</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>FAtom Pos <span class="bound">p</span> <span class="bound">vs</span><span class="main">)</span><span class="main">;</span>
  <span class="main">!</span> <span class="bound">p</span> <span class="bound">vs</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>FAtom Neg <span class="bound">p</span> <span class="bound">vs</span><span class="main">)</span><span class="main">;</span>
  <span class="main">!!</span> <span class="bound">A</span> <span class="bound">B</span>  <span class="main">.</span> <span class="main">[|</span> <span class="free">P</span> <span class="bound">A</span><span class="main">;</span> <span class="free">P</span> <span class="bound">B</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="main">(</span>FConj Pos <span class="bound">A</span> <span class="bound">B</span><span class="main">)</span><span class="main">;</span>
  <span class="main">!!</span> <span class="bound">A</span> <span class="bound">B</span>  <span class="main">.</span> <span class="main">[|</span> <span class="free">P</span> <span class="bound">A</span><span class="main">;</span> <span class="free">P</span> <span class="bound">B</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="main">(</span>FConj Neg <span class="bound">A</span> <span class="bound">B</span><span class="main">)</span><span class="main">;</span>
  <span class="main">!!</span> <span class="bound">A</span>    <span class="main">.</span> <span class="main">[|</span> <span class="free">P</span> <span class="bound">A</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="main">(</span>FAll  Pos <span class="bound">A</span><span class="main">)</span><span class="main">;</span> 
  <span class="main">!!</span> <span class="bound">A</span>    <span class="main">.</span> <span class="main">[|</span> <span class="free">P</span> <span class="bound">A</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="main">(</span>FAll  Neg <span class="bound">A</span><span class="main">)</span> 
  <span class="main">|]</span>
  <span class="main">==&gt;</span> <span class="free">P</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> signs.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Formula-formula_signs_cases"><span class="command">lemma</span></span> formula_signs_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">P</span><span class="main">.</span> 
  <span class="main">[|</span> <span class="main">!!</span> <span class="bound">p</span> <span class="bound">vs</span> <span class="main">.</span> <span class="bound">P</span> <span class="main">(</span>FAtom Pos <span class="bound">p</span> <span class="bound">vs</span><span class="main">)</span><span class="main">;</span> 
  <span class="main">!!</span> <span class="bound">p</span> <span class="bound">vs</span> <span class="main">.</span> <span class="bound">P</span> <span class="main">(</span>FAtom Neg <span class="bound">p</span> <span class="bound">vs</span><span class="main">)</span><span class="main">;</span> 
  <span class="main">!!</span> <span class="bound">f1</span> <span class="bound">f2</span>  <span class="main">.</span> <span class="bound">P</span> <span class="main">(</span>FConj Pos <span class="bound">f1</span> <span class="bound">f2</span><span class="main">)</span><span class="main">;</span> 
  <span class="main">!!</span> <span class="bound">f1</span> <span class="bound">f2</span>  <span class="main">.</span> <span class="bound">P</span> <span class="main">(</span>FConj Neg <span class="bound">f1</span> <span class="bound">f2</span><span class="main">)</span><span class="main">;</span> 
  <span class="main">!!</span> <span class="bound">f1</span>    <span class="main">.</span> <span class="bound">P</span> <span class="main">(</span>FAll  Pos <span class="bound">f1</span><span class="main">)</span><span class="main">;</span> 
  <span class="main">!!</span> <span class="bound">f1</span>    <span class="main">.</span> <span class="bound">P</span> <span class="main">(</span>FAll  Neg <span class="bound">f1</span><span class="main">)</span> <span class="main">|]</span> 
  <span class="main">==&gt;</span> <span class="bound">P</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> signs.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="comment1">― ‹induction using nat induction, not wellfounded induction›</span>
<span class="keyword1" id="Formula-strong_formula_induct'"><span class="command">lemma</span></span> strong_formula_induct'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="main">!</span> <span class="bound">B</span><span class="main">.</span> size <span class="bound">B</span> <span class="main">&lt;</span> size <span class="bound">A</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="bound">B</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="bound">A</span> <span class="main">==&gt;</span> <span class="main">!</span> <span class="bound">A</span><span class="main">.</span> size <span class="bound">A</span> <span class="main">=</span> <span class="free">n</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="main">(</span><span class="bound">A</span><span class="main">::</span>formula<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span> 

<span class="keyword1" id="Formula-strong_formula_induct"><span class="command">lemma</span></span> strong_formula_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">!</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="main">!</span> <span class="bound">B</span><span class="main">.</span> size <span class="bound">B</span> <span class="main">&lt;</span> size <span class="bound">A</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="bound">B</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="bound">A</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="main">(</span><span class="free">A</span><span class="main">::</span>formula<span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> strong_formula_induct'<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> 

<span class="keyword1" id="Formula-sizelemmas"><span class="command">lemma</span></span> sizelemmas<span class="main">:</span> <span class="quoted"><span class="quoted">"size <span class="free">A</span> <span class="main">&lt;</span> size <span class="main">(</span>FConj <span class="free">z</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"size <span class="free">B</span> <span class="main">&lt;</span> size <span class="main">(</span>FConj <span class="free">z</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"size <span class="free">A</span> <span class="main">&lt;</span> size <span class="main">(</span>FAll  <span class="free">z</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Formula-expand_case_formula"><span class="command">lemma</span></span> expand_case_formula<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">(</span>case_formula <span class="free">fatom</span> <span class="free">fconj</span> <span class="free">fall</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> 
  <span class="main">(</span><span class="main">!</span> <span class="bound">z</span> <span class="bound">P</span> <span class="bound">vs</span>  <span class="main">.</span> <span class="free">F</span> <span class="main">=</span> FAtom <span class="bound">z</span> <span class="bound">P</span> <span class="bound">vs</span>  <span class="main">--&gt;</span> <span class="free">Q</span> <span class="main">(</span><span class="free">fatom</span> <span class="bound">z</span> <span class="bound">P</span> <span class="bound">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> 
  <span class="main">(</span><span class="main">!</span> <span class="bound">z</span> <span class="bound">A0</span> <span class="bound">A1</span> <span class="main">.</span> <span class="free">F</span> <span class="main">=</span> FConj <span class="bound">z</span> <span class="bound">A0</span> <span class="bound">A1</span> <span class="main">--&gt;</span> <span class="free">Q</span> <span class="main">(</span><span class="free">fconj</span> <span class="bound">z</span> <span class="bound">A0</span> <span class="bound">A1</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> 
  <span class="main">(</span><span class="main">!</span> <span class="bound">z</span> <span class="bound">A</span>     <span class="main">.</span> <span class="free">F</span> <span class="main">=</span> FAll  <span class="bound">z</span> <span class="bound">A</span>     <span class="main">--&gt;</span> <span class="free">Q</span> <span class="main">(</span><span class="free">fall</span>  <span class="bound">z</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span> 
 <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">FNot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"formula <span class="main">=&gt;</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  FNot_FAtom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FNot</span> <span class="main">(</span>FAtom <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span>  <span class="main">=</span> FAtom <span class="main">(</span>invSign <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span>"</span></span>
<span class="main">|</span> FNot_FConj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FNot</span> <span class="main">(</span>FConj <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">A0</span></span></span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span> <span class="main">=</span> FConj <span class="main">(</span>invSign <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">FNot</span> <span class="free"><span class="bound"><span class="entity">A0</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">FNot</span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span>"</span></span>    
<span class="main">|</span> FNot_FAll<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">FNot</span> <span class="main">(</span>FAll  <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>  <span class="main">=</span> FAll  <span class="main">(</span>invSign <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">FNot</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">neg</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"signs <span class="main">=&gt;</span> signs"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">neg</span> Pos <span class="main">=</span> Neg"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">neg</span> Neg <span class="main">=</span> Pos"</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">dual</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span>signs <span class="main">=&gt;</span> signs<span class="main">)</span><span class="main">,</span><span class="main">(</span>signs <span class="main">=&gt;</span> signs<span class="main">)</span><span class="main">,</span><span class="main">(</span>signs <span class="main">=&gt;</span> signs<span class="main">)</span><span class="main">]</span> <span class="main">=&gt;</span> formula <span class="main">=&gt;</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  dual_FAtom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dual</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>FAtom <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span>  <span class="main">=</span> FAtom <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span>"</span></span>
<span class="main">|</span> dual_FConj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dual</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>FConj <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">A0</span></span></span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span> <span class="main">=</span> FConj <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">dual</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">A0</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">dual</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> dual_FAll<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">dual</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>FAll  <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>  <span class="main">=</span> FAll  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">dual</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Formula-dualCompose"><span class="command">lemma</span></span> dualCompose<span class="main">:</span> <span class="quoted"><span class="quoted">"dual <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="keyword1">o</span> dual <span class="free">P</span> <span class="free">Q</span> <span class="free">R</span> <span class="main">=</span> dual <span class="main">(</span><span class="free">p</span> <span class="keyword1">o</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="free">q</span> <span class="keyword1">o</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="free">r</span> <span class="keyword1">o</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Formula-dualFNot'"><span class="command">lemma</span></span> dualFNot'<span class="main">:</span> <span class="quoted"><span class="quoted">"dual invSign invSign invSign <span class="main">=</span> FNot"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x</span></span></span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Formula-dualFNot"><span class="command">lemma</span></span> dualFNot<span class="main">:</span> <span class="quoted"><span class="quoted">"dual invSign id id <span class="main">(</span>FNot <span class="free">A</span><span class="main">)</span> <span class="main">=</span> FNot <span class="main">(</span>dual invSign id id <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> id_def<span class="main">)</span>

<span class="keyword1" id="Formula-dualId"><span class="command">lemma</span></span> dualId<span class="main">:</span> <span class="quoted"><span class="quoted">"dual id id id <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> id_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Frees"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">freeVarsF</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"formula <span class="main">=&gt;</span> vbl set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  freeVarsFAtom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">freeVarsF</span> <span class="main">(</span>FAtom <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span>  <span class="main">=</span> set <span class="free"><span class="bound"><span class="entity">vs</span></span></span>"</span></span>
<span class="main">|</span> freeVarsFConj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">freeVarsF</span> <span class="main">(</span>FConj <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">A0</span></span></span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">freeVarsF</span> <span class="free"><span class="bound"><span class="entity">A0</span></span></span><span class="main">)</span> <span class="keyword1">Un</span> <span class="main">(</span><span class="free">freeVarsF</span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span>"</span></span>    
<span class="main">|</span> freeVarsFAll<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">freeVarsF</span> <span class="main">(</span>FAll  <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>  <span class="main">=</span> preImage nextX <span class="main">(</span><span class="free">freeVarsF</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">freeVarsFL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"formula list <span class="main">=&gt;</span> vbl set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">freeVarsFL</span> <span class="free"><span class="bound"><span class="entity">gamma</span></span></span> <span class="main">=</span> Union <span class="main">(</span>freeVarsF <span class="main">`</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">gamma</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Formula-freeVarsF_FNot"><span class="command">lemma</span></span> freeVarsF_FNot<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"freeVarsF <span class="main">(</span>FNot <span class="free">A</span><span class="main">)</span> <span class="main">=</span> freeVarsF <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Formula-finite_freeVarsF"><span class="command">lemma</span></span> finite_freeVarsF<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>freeVarsF <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_nextX finite_preImage<span class="main">)</span> 

<span class="keyword1" id="Formula-freeVarsFL_nil"><span class="command">lemma</span></span> freeVarsFL_nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"freeVarsFL <span class="main">(</span><span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> freeVarsFL_def<span class="main">)</span>

<span class="keyword1" id="Formula-freeVarsFL_cons"><span class="command">lemma</span></span> freeVarsFL_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"freeVarsFL <span class="main">(</span><span class="free">A</span><span class="main">#</span><span class="free">Gamma</span><span class="main">)</span> <span class="main">=</span> freeVarsF <span class="free">A</span> <span class="main">∪</span> freeVarsFL <span class="free">Gamma</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> freeVarsFL_def<span class="main">)</span>
    <span class="comment1">― ‹FIXME not simp, since simp stops some later lemmas because the simpset isn't confluent›</span>

<span class="keyword1" id="Formula-finite_freeVarsFL"><span class="command">lemma</span></span> finite_freeVarsFL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>freeVarsFL <span class="free">gamma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">gamma</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> freeVarsFL_cons<span class="main">)</span>

<span class="keyword1" id="Formula-freeVarsDual"><span class="command">lemma</span></span> freeVarsDual<span class="main">:</span> <span class="quoted"><span class="quoted">"freeVarsF <span class="main">(</span>dual <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> freeVarsF <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Substitutions"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">subF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>vbl <span class="main">=&gt;</span> vbl<span class="main">,</span>formula<span class="main">]</span> <span class="main">=&gt;</span> formula"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  subFAtom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subF</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="main">(</span>FAtom <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span>  <span class="main">=</span> FAtom <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> subFConj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subF</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="main">(</span>FConj <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">A0</span></span></span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span> <span class="main">=</span> FConj <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">(</span><span class="free">subF</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="free"><span class="bound"><span class="entity">A0</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">subF</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> subFAll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subF</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="main">(</span>FAll <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>  <span class="main">=</span> 
  FAll  <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">(</span><span class="free">subF</span> <span class="main">(</span><span class="main">%</span> <span class="bound">v</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">v</span> <span class="keyword1">of</span> zeroX <span class="main">=&gt;</span> zeroX <span class="main">|</span> nextX <span class="bound">v</span> <span class="main">=&gt;</span> nextX <span class="main">(</span><span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Formula-size_subF"><span class="command">lemma</span></span> size_subF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">theta</span><span class="main">.</span> size <span class="main">(</span>subF <span class="bound">theta</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> size <span class="main">(</span><span class="free">A</span><span class="main">::</span>formula<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Formula-subFNot"><span class="command">lemma</span></span> subFNot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">theta</span><span class="main">.</span> subF <span class="bound">theta</span> <span class="main">(</span>FNot <span class="free">A</span><span class="main">)</span> <span class="main">=</span> FNot <span class="main">(</span>subF <span class="bound">theta</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Formula-subFDual"><span class="command">lemma</span></span> subFDual<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">theta</span><span class="main">.</span> subF <span class="bound">theta</span> <span class="main">(</span>dual <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> dual <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="main">(</span>subF <span class="bound">theta</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">instanceF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>vbl<span class="main">,</span>formula<span class="main">]</span> <span class="main">=&gt;</span> formula"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">instanceF</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span> <span class="main">=</span> subF <span class="main">(</span><span class="main">%</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">v</span> <span class="keyword1">of</span> zeroX <span class="main">=&gt;</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">|</span> nextX <span class="bound">v</span> <span class="main">=&gt;</span> <span class="bound">v</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span>"</span></span>

<span class="keyword1" id="Formula-size_instance"><span class="command">lemma</span></span> size_instance<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">v</span><span class="main">.</span> size <span class="main">(</span>instanceF <span class="bound">v</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> size <span class="main">(</span><span class="free">A</span><span class="main">::</span>formula<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> instanceF_def size_subF<span class="main">)</span>

<span class="keyword1" id="Formula-instanceFDual"><span class="command">lemma</span></span> instanceFDual<span class="main">:</span> <span class="quoted"><span class="quoted">"instanceF <span class="free">u</span> <span class="main">(</span>dual <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> dual <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="main">(</span>instanceF <span class="free">u</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> instanceF_def subFDual<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Models"</span></span>

<span class="keyword1"><span class="command">typedecl</span></span>
  object

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="free">obj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> object"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> inj_obj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="free">obj</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"model, non empty set and positive atom valuation"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">model</span> <span class="main">=</span> <span class="main">{</span><span class="bound">z</span> <span class="main">::</span> <span class="main">(</span>object set <span class="main">*</span> <span class="main">(</span><span class="main">[</span>predicate<span class="main">,</span>object list<span class="main">]</span> <span class="main">=&gt;</span> bool<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">z</span> <span class="main">~=</span> <span class="main">{}</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> model <span class="main">=</span> <span class="quoted">model</span>
  <span class="keyword1"><span class="command">unfolding</span></span> model_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">objects</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"model <span class="main">=&gt;</span> object set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">objects</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> fst <span class="main">(</span>Rep_model <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">evalP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"model <span class="main">=&gt;</span> predicate <span class="main">=&gt;</span> object list <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">evalP</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> snd <span class="main">(</span>Rep_model <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1" id="Formula-evalP_arg2_cong"><span class="command">lemma</span></span> evalP_arg2_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">==&gt;</span> evalP <span class="free">M</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> evalP <span class="free">M</span> <span class="free">p</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Formula-objectsNonEmpty"><span class="command">lemma</span></span> objectsNonEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"objects <span class="free">M</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_model<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> objects_def model_def<span class="main">)</span>

<span class="keyword1" id="Formula-modelsNonEmptyI"><span class="command">lemma</span></span> modelsNonEmptyI<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Rep_model <span class="free">M</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_model<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> objects_def model_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Validity"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">evalF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>model<span class="main">,</span>vbl <span class="main">=&gt;</span> object<span class="main">,</span>formula<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  evalFAtom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">evalF</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="main">(</span>FAtom <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span>  <span class="main">=</span> sign <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">(</span>evalP <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> evalFConj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">evalF</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="main">(</span>FConj <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">A0</span></span></span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span> <span class="main">=</span> sign <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">(</span>sign <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">(</span><span class="free">evalF</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">A0</span></span></span><span class="main">)</span> <span class="main">&amp;</span> sign <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">(</span><span class="free">evalF</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> evalFAll<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">evalF</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="main">(</span>FAll  <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span>  <span class="main">=</span> sign <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">(</span><span class="main">!</span><span class="bound">x</span><span class="main">:</span> <span class="main">(</span>objects <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span><span class="main">.</span>
                                                       sign <span class="free"><span class="bound"><span class="entity">z</span></span></span>
                                                            <span class="main">(</span><span class="free">evalF</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span><span class="main">%</span><span class="bound">v</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">v</span> <span class="keyword1">of</span>
                                                                                zeroX   <span class="main">=&gt;</span> <span class="bound">x</span>
                                                                              <span class="main">|</span> nextX <span class="bound">v</span> <span class="main">=&gt;</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">body</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"formula <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">valid</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">M</span> <span class="bound">phi</span><span class="main">.</span> evalF <span class="bound">M</span> <span class="bound">phi</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> True<span class="main">)</span>"</span></span>


<span class="keyword1" id="Formula-evalF_FAll"><span class="command">lemma</span></span> evalF_FAll<span class="main">:</span> <span class="quoted"><span class="quoted">"evalF <span class="free">M</span> <span class="free">phi</span> <span class="main">(</span>FAll Pos <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">!</span><span class="bound">x</span><span class="main">:</span> <span class="main">(</span>objects <span class="free">M</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>evalF <span class="free">M</span> <span class="main">(</span>vblcase <span class="bound">x</span> <span class="main">(</span><span class="main">%</span><span class="bound">v</span> <span class="main">.</span><span class="free">phi</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
<span class="keyword1" id="Formula-evalF_FEx"><span class="command">lemma</span></span> evalF_FEx<span class="main">:</span> <span class="quoted"><span class="quoted">"evalF <span class="free">M</span> <span class="free">phi</span> <span class="main">(</span>FAll Neg <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> <span class="main">?</span> <span class="bound">x</span><span class="main">:</span><span class="main">(</span>objects <span class="free">M</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>evalF <span class="free">M</span> <span class="main">(</span>vblcase <span class="bound">x</span> <span class="main">(</span><span class="main">%</span><span class="bound">v</span><span class="main">.</span> <span class="free">phi</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Formula-evalF_arg2_cong"><span class="command">lemma</span></span> evalF_arg2_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">==&gt;</span> evalF <span class="free">M</span> <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> evalF <span class="free">M</span> <span class="free">p</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Formula-evalF_FNot"><span class="command">lemma</span></span> evalF_FNot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">phi</span><span class="main">.</span> evalF <span class="free">M</span> <span class="bound">phi</span> <span class="main">(</span>FNot <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> evalF <span class="free">M</span> <span class="bound">phi</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> formula_signs_induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Formula-evalF_equiv"><span class="command">lemma</span></span> evalF_equiv<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="main">(</span>equalOn <span class="main">(</span>freeVarsF <span class="free">A</span><span class="main">)</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>evalF <span class="free">M</span> <span class="bound">f</span> <span class="free">A</span> <span class="main">=</span> evalF <span class="free">M</span> <span class="bound">g</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>equalOn_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> map_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> equalOn_UnD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> signs A f g<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"sign <span class="improper">signs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ball_cong<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"sign <span class="improper">signs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> equalOn_vblcaseI'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="comment1">― ‹FIXME tricky to automate cong args convincingly?›</span>

    <span class="comment1">― ‹composition of substitutions›</span>
<span class="keyword1" id="Formula-evalF_subF_eq"><span class="command">lemma</span></span> evalF_subF_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span><span class="bound">phi</span> <span class="bound">theta</span><span class="main">.</span> evalF <span class="free">M</span> <span class="bound">phi</span> <span class="main">(</span>subF <span class="bound">theta</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> evalF <span class="free">M</span> <span class="main">(</span><span class="bound">phi</span> <span class="keyword1">o</span> <span class="bound">theta</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> o_apply<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> o_apply<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> o_apply<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> signs phi0 phi theta<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"sign <span class="improper">signs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ball_cong<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"sign <span class="improper">signs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> arg_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vblcase <span class="improper">x</span> <span class="improper">phi</span> <span class="main">∘</span> vblcase zeroX <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> nextX <span class="main">(</span><span class="improper">theta</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vblcase <span class="improper">x</span> <span class="main">(</span><span class="improper">phi</span> <span class="main">∘</span> <span class="improper">theta</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> o_apply<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xa</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vbl_casesE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Formula-o_id'"><span class="command">lemma</span></span> o_id'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">o</span> <span class="main">(</span><span class="main">%</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> id_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Formula-evalF_instance"><span class="command">lemma</span></span> evalF_instance<span class="main">:</span> <span class="quoted"><span class="quoted">"evalF <span class="free">M</span> <span class="free">phi</span> <span class="main">(</span>instanceF <span class="free">u</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> evalF <span class="free">M</span> <span class="main">(</span>vblcase <span class="main">(</span><span class="free">phi</span> <span class="free">u</span><span class="main">)</span> <span class="free">phi</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> instanceF_def evalF_subF_eq vblsimps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">― ‹FIXME move›</span>

<span class="keyword1" id="Formula-s"><span class="command">lemma</span></span> s<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">" FConj <span class="free">signs</span> <span class="free">formula1</span> <span class="free">formula2</span> <span class="main">≠</span> <span class="free">formula1</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">formula1</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Formula-s'"><span class="command">lemma</span></span> s'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">" FConj <span class="free">signs</span> <span class="free">formula1</span> <span class="free">formula2</span> <span class="main">≠</span> <span class="free">formula2</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">formula2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Formula-instanceF_E"><span class="command">lemma</span></span> instanceF_E<span class="main">:</span> <span class="quoted"><span class="quoted">"instanceF <span class="free">g</span> <span class="free">formula</span> <span class="main">≠</span> FAll <span class="free">signs</span> <span class="free">formula</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>size <span class="main">(</span>instanceF <span class="free">g</span> <span class="free">formula</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>size <span class="main">(</span>FAll <span class="free">signs</span> <span class="free">formula</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> size_instance<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Sequents">
<div class="head">
<h1>Theory Sequents</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Sequents"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Sequents
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Formula.html">Formula</a>
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">type_synonym</span></span> sequent <span class="main">=</span> <span class="quoted"><span class="quoted">"formula list"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">evalS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>model<span class="main">,</span>vbl <span class="main">=&gt;</span> object<span class="main">,</span>formula list<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">evalS</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">?</span> <span class="bound">f</span> <span class="main">:</span> set <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">.</span> evalF <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="bound">f</span> <span class="main">=</span> True<span class="main">)</span>"</span></span>

<span class="keyword1" id="Sequents-evalS_nil"><span class="command">lemma</span></span> evalS_nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"evalS <span class="free">M</span> <span class="free">phi</span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> evalS_def<span class="main">)</span>

<span class="keyword1" id="Sequents-evalS_cons"><span class="command">lemma</span></span> evalS_cons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"evalS <span class="free">M</span> <span class="free">phi</span> <span class="main">(</span><span class="free">A</span> <span class="main">#</span> <span class="free">Gamma</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>evalF <span class="free">M</span> <span class="free">phi</span> <span class="free">A</span> <span class="main">|</span> evalS <span class="free">M</span> <span class="free">phi</span> <span class="free">Gamma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> evalS_def<span class="main">)</span>

<span class="keyword1" id="Sequents-evalS_append"><span class="command">lemma</span></span> evalS_append<span class="main">:</span> <span class="quoted"><span class="quoted">"evalS <span class="free">M</span> <span class="free">phi</span> <span class="main">(</span><span class="free">Gamma</span> <span class="main">@</span> <span class="free">Delta</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>evalS <span class="free">M</span> <span class="free">phi</span> <span class="free">Gamma</span> <span class="main">|</span> evalS <span class="free">M</span> <span class="free">phi</span> <span class="free">Delta</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> evalS_def<span class="main">)</span>

<span class="keyword1" id="Sequents-evalS_equiv"><span class="command">lemma</span></span> evalS_equiv<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>equalOn <span class="main">(</span>freeVarsFL <span class="free">Gamma</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="main">(</span>evalS <span class="free">M</span> <span class="free">f</span> <span class="free">Gamma</span> <span class="main">=</span> evalS <span class="free">M</span> <span class="free">g</span> <span class="free">Gamma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">Gamma</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> freeVarsFL_cons<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> equalOn_UnD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> evalF_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">modelAssigns</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>model<span class="main">]</span> <span class="main">=&gt;</span> <span class="main">(</span>vbl <span class="main">=&gt;</span> object<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">modelAssigns</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">phi</span> <span class="main">.</span> range <span class="bound">phi</span> <span class="main">&lt;=</span> objects <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">}</span>"</span></span>

<span class="keyword1" id="Sequents-modelAssignsI"><span class="command">lemma</span></span> modelAssignsI<span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="free">f</span> <span class="main">&lt;=</span> objects <span class="free">M</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">:</span> modelAssigns <span class="free">M</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> modelAssigns_def<span class="main">)</span>

<span class="keyword1" id="Sequents-modelAssignsD"><span class="command">lemma</span></span> modelAssignsD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">:</span> modelAssigns <span class="free">M</span> <span class="main">⟹</span> range <span class="free">f</span> <span class="main">&lt;=</span> objects <span class="free">M</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> modelAssigns_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">validS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"formula list <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">validS</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">!</span> <span class="bound">M</span> <span class="main">.</span> <span class="main">!</span> <span class="bound">phi</span> <span class="main">:</span> modelAssigns <span class="bound">M</span> <span class="main">.</span> evalS <span class="bound">M</span> <span class="bound">phi</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">=</span> True<span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Rules"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> rule <span class="main">=</span> <span class="quoted"><span class="quoted">"sequent <span class="main">*</span> <span class="main">(</span>sequent set<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">concR</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rule <span class="main">=&gt;</span> sequent"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">concR</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">conc</span><span class="main">,</span><span class="bound">prems</span><span class="main">)</span><span class="main">.</span> <span class="bound">conc</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">premsR</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rule <span class="main">=&gt;</span> sequent set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">premsR</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">conc</span><span class="main">,</span><span class="bound">prems</span><span class="main">)</span><span class="main">.</span> <span class="bound">prems</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">mapRule</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>formula <span class="main">=&gt;</span> formula<span class="main">)</span> <span class="main">=&gt;</span> rule <span class="main">=&gt;</span> rule"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mapRule</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">f</span> <span class="main">(</span><span class="bound">conc</span><span class="main">,</span><span class="bound">prems</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span>map <span class="bound">f</span> <span class="bound">conc</span><span class="main">,</span><span class="main">(</span>map <span class="bound">f</span><span class="main">)</span> <span class="main">`</span> <span class="bound">prems</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Sequents-mapRuleI"><span class="command">lemma</span></span> mapRuleI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">A</span> <span class="main">=</span> map <span class="free">f</span> <span class="free">a</span><span class="main">;</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span>map <span class="free">f</span><span class="main">)</span> <span class="main">`</span> <span class="free">b</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">)</span> <span class="main">=</span> mapRule <span class="free">f</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mapRule_def<span class="main">)</span>
    <span class="comment1">― ‹FIXME tjr would like symmetric›</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Deductions"</span></span>

<span class="comment1">(*FIXME. I don't see why plain Pow_mono is rejected.*)</span>
<span class="keyword1"><span class="command">lemmas</span></span> Powp_mono <span class="main">[</span><span class="operator">mono</span><span class="main">]</span> <span class="main">=</span> Pow_mono <span class="main">[</span><span class="operator">to_pred</span> pred_subset_eq<span class="main">]</span>

<span class="keyword1"><span class="command">inductive_set</span></span>
  <span class="entity">deductions</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"rule set <span class="main">=&gt;</span> formula list set"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">rules</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rule set"</span></span>
  <span class="comment1">(******
   * Given a set of rules,
   *   1. Given a rule conc/prem(i) in rules,
   *       and the prem(i) are deductions from rules,
   *       then conc is a deduction from rules.
   *   2. can derive permutation of any deducible formula list.
   *      (supposed to be multisets not lists).
   ******)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    inferI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">conc</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">prems</span></span></span><span class="main">)</span> <span class="main">:</span> <span class="free">rules</span><span class="main">;</span>
               <span class="free"><span class="bound"><span class="entity">prems</span></span></span> <span class="main">:</span> Pow<span class="main">(</span><span class="free">deductions</span><span class="main">(</span><span class="free">rules</span><span class="main">)</span><span class="main">)</span>
            <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free"><span class="bound"><span class="entity">conc</span></span></span> <span class="main">:</span> <span class="free">deductions</span><span class="main">(</span><span class="free">rules</span><span class="main">)</span>"</span></span>
<span class="comment1">(*
    perms   "[| permutation conc' conc;
                conc' : deductions(rules)
             |] ==&gt; conc : deductions(rules)"
*)</span>
 
<span class="keyword1" id="Sequents-mono_deductions"><span class="command">lemma</span></span> mono_deductions<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">A</span> <span class="main">&lt;=</span> <span class="free">B</span> <span class="main">|]</span> <span class="main">==&gt;</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span> <span class="main">&lt;=</span> deductions<span class="main">(</span><span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">best</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> deductions.inferI <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> deductions.induct<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="comment1">(*lemmas deductionsMono = mono_deductions*)</span>

<span class="comment1">(*
-- "tjr following should be subsetD?"
lemmas deductionSubsetI = mono_deductions[THEN subsetD]
thm deductionSubsetI
*)</span>

<span class="comment1">(******
 * (f : formula -&gt; formula) extended structurally over rules, deductions etc...
 * (((If f maps rules into themselves then can consider mapping derivation trees.)))
 * (((Is the asm necessary - think not?)))
 * The mapped deductions from the rules are same as
 * the deductions from the mapped rules.
 *
 * WHY:
 *
 * map f `` deductions rules &lt;= deductions (mapRule f `` rules)     (this thm)
 *                           &lt;= deductions rules                    (closed)
 *
 * If rules are closed under f then so are deductions.
 * Can take f = (subst u v) and have application to exercise #1.
 *
 * Q: maybe also make f dual mapping, (what about quantifier side conditions...?).
 ******)</span>

<span class="comment1">(*
lemma map_deductions: "map f ` deductions rules &lt;= deductions (mapRule f ` rules)"
  apply(rule subsetI)
  apply (erule_tac imageE, simp)
  apply(erule deductions.induct)
  apply(blast intro: deductions.inferI mapRuleI)
  done

lemma deductionsCloseRules: "! (conc,prems) : S . prems &lt;= deductions R --&gt; conc : deductions R ==&gt; deductions (R Un S) = deductions R"
  apply(rule equalityI)
  prefer 2
  apply(rule mono_deductions) apply blast
  apply(rule subsetI)
  apply (erule_tac deductions.induct, simp) apply(erule conjE) apply(thin_tac "prems ⊆ deductions (R ∪ S)")
  apply(erule disjE)
  apply(rule inferI) apply assumption apply force
  apply blast
  done
*)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Basic Rule sets"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Axioms</span>  <span class="main">=</span> <span class="main">{</span> <span class="bound">z</span><span class="main">.</span> <span class="main">?</span> <span class="bound">p</span> <span class="bound">vs</span><span class="main">.</span>              <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span>FAtom Pos <span class="bound">p</span> <span class="bound">vs</span><span class="main">,</span>FAtom Neg <span class="bound">p</span> <span class="bound">vs</span><span class="main">]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Conjs</span>   <span class="main">=</span> <span class="main">{</span> <span class="bound">z</span><span class="main">.</span> <span class="main">?</span> <span class="bound">A0</span> <span class="bound">A1</span> <span class="bound">Delta</span> <span class="bound">Gamma</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span>FConj Pos <span class="bound">A0</span> <span class="bound">A1</span><span class="main">#</span><span class="bound">Gamma</span> <span class="main">@</span> <span class="bound">Delta</span><span class="main">,</span><span class="main">{</span><span class="bound">A0</span><span class="main">#</span><span class="bound">Gamma</span><span class="main">,</span><span class="bound">A1</span><span class="main">#</span><span class="bound">Delta</span><span class="main">}</span><span class="main">)</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Disjs</span>   <span class="main">=</span> <span class="main">{</span> <span class="bound">z</span><span class="main">.</span> <span class="main">?</span> <span class="bound">A0</span> <span class="bound">A1</span>       <span class="bound">Gamma</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span>FConj Neg <span class="bound">A0</span> <span class="bound">A1</span><span class="main">#</span><span class="bound">Gamma</span><span class="main">,</span><span class="main">{</span><span class="bound">A0</span><span class="main">#</span><span class="bound">A1</span><span class="main">#</span><span class="bound">Gamma</span><span class="main">}</span><span class="main">)</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Alls</span>    <span class="main">=</span> <span class="main">{</span> <span class="bound">z</span><span class="main">.</span> <span class="main">?</span> <span class="bound">A</span> <span class="bound">x</span>         <span class="bound">Gamma</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span>FAll Pos <span class="bound">A</span><span class="main">#</span><span class="bound">Gamma</span><span class="main">,</span><span class="main">{</span>instanceF <span class="bound">x</span> <span class="bound">A</span><span class="main">#</span><span class="bound">Gamma</span><span class="main">}</span><span class="main">)</span> <span class="main">&amp;</span> <span class="bound">x</span> <span class="main">~:</span> freeVarsFL <span class="main">(</span>FAll Pos <span class="bound">A</span><span class="main">#</span><span class="bound">Gamma</span><span class="main">)</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Exs</span>     <span class="main">=</span> <span class="main">{</span> <span class="bound">z</span><span class="main">.</span> <span class="main">?</span> <span class="bound">A</span> <span class="bound">x</span>         <span class="bound">Gamma</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span>FAll Neg <span class="bound">A</span><span class="main">#</span><span class="bound">Gamma</span><span class="main">,</span><span class="main">{</span>instanceF <span class="bound">x</span> <span class="bound">A</span><span class="main">#</span><span class="bound">Gamma</span><span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Weaks</span>   <span class="main">=</span> <span class="main">{</span> <span class="bound">z</span><span class="main">.</span> <span class="main">?</span> <span class="bound">A</span>           <span class="bound">Gamma</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="bound">A</span><span class="main">#</span><span class="bound">Gamma</span><span class="main">,</span><span class="main">{</span><span class="bound">Gamma</span><span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Contrs</span>  <span class="main">=</span> <span class="main">{</span> <span class="bound">z</span><span class="main">.</span> <span class="main">?</span> <span class="bound">A</span>           <span class="bound">Gamma</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="bound">A</span><span class="main">#</span><span class="bound">Gamma</span><span class="main">,</span><span class="main">{</span><span class="bound">A</span><span class="main">#</span><span class="bound">A</span><span class="main">#</span><span class="bound">Gamma</span><span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Cuts</span>    <span class="main">=</span> <span class="main">{</span> <span class="bound">z</span><span class="main">.</span> <span class="main">?</span> <span class="bound">C</span> <span class="bound">Delta</span>     <span class="bound">Gamma</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="bound">Gamma</span> <span class="main">@</span> <span class="bound">Delta</span><span class="main">,</span><span class="main">{</span><span class="bound">C</span><span class="main">#</span><span class="bound">Gamma</span><span class="main">,</span>FNot <span class="bound">C</span><span class="main">#</span><span class="bound">Delta</span><span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Perms</span>   <span class="main">=</span> <span class="main">{</span> <span class="bound">z</span><span class="main">.</span> <span class="main">?</span> <span class="bound">Gamma</span> <span class="bound">Gamma'</span>     <span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="bound">Gamma</span><span class="main">,</span><span class="main">{</span><span class="bound">Gamma'</span><span class="main">}</span><span class="main">)</span> <span class="main">&amp;</span> <span class="bound">Gamma</span> <span class="main">&lt;~~&gt;</span> <span class="bound">Gamma'</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">DAxioms</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">z</span><span class="main">.</span> <span class="main">?</span> <span class="bound">p</span> <span class="bound">vs</span><span class="main">.</span>              <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span>FAtom Neg <span class="bound">p</span> <span class="bound">vs</span><span class="main">,</span>FAtom Pos <span class="bound">p</span> <span class="bound">vs</span><span class="main">]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">}</span>"</span></span>


<span class="keyword1" id="Sequents-AxiomI"><span class="command">lemma</span></span> AxiomI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> Axioms <span class="main">&lt;=</span> <span class="free">A</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">[</span>FAtom Pos <span class="free">p</span> <span class="free">vs</span><span class="main">,</span>FAtom Neg <span class="free">p</span> <span class="free">vs</span><span class="main">]</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> deductions.inferI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Axioms_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sequents-DAxiomsI"><span class="command">lemma</span></span> DAxiomsI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> DAxioms <span class="main">&lt;=</span> <span class="free">A</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">[</span>FAtom Neg <span class="free">p</span> <span class="free">vs</span><span class="main">,</span>FAtom Pos <span class="free">p</span> <span class="free">vs</span><span class="main">]</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> deductions.inferI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DAxioms_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sequents-DisjI"><span class="command">lemma</span></span> DisjI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">A0</span><span class="main">#</span><span class="free">A1</span><span class="main">#</span><span class="free">Gamma</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">;</span> Disjs <span class="main">&lt;=</span> <span class="free">A</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">(</span>FConj Neg <span class="free">A0</span> <span class="free">A1</span><span class="main">#</span><span class="free">Gamma</span><span class="main">)</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> deductions.inferI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Disjs_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sequents-ConjI"><span class="command">lemma</span></span> ConjI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="main">(</span><span class="free">A0</span><span class="main">#</span><span class="free">Gamma</span><span class="main">)</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="free">A1</span><span class="main">#</span><span class="free">Delta</span><span class="main">)</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">;</span> Conjs <span class="main">&lt;=</span> <span class="free">A</span> <span class="main">|]</span> <span class="main">==&gt;</span> FConj Pos <span class="free">A0</span> <span class="free">A1</span><span class="main">#</span><span class="free">Gamma</span> <span class="main">@</span> <span class="free">Delta</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> prems<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">A0</span><span class="main">#</span><span class="free">Gamma</span><span class="main">,</span><span class="free">A1</span><span class="main">#</span><span class="free">Delta</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> deductions.inferI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Conjs_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sequents-AllI"><span class="command">lemma</span></span> AllI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> instanceF <span class="free">w</span> <span class="free">A</span><span class="main">#</span><span class="free">Gamma</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">R</span><span class="main">)</span><span class="main">;</span> <span class="free">w</span> <span class="main">~:</span> freeVarsFL <span class="main">(</span>FAll Pos <span class="free">A</span><span class="main">#</span><span class="free">Gamma</span><span class="main">)</span><span class="main">;</span> Alls <span class="main">&lt;=</span> <span class="free">R</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">(</span>FAll Pos <span class="free">A</span><span class="main">#</span><span class="free">Gamma</span><span class="main">)</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> prems<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span>instanceF <span class="free">w</span> <span class="free">A</span><span class="main">#</span><span class="free">Gamma</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> deductions.inferI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Alls_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sequents-ExI"><span class="command">lemma</span></span> ExI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> instanceF <span class="free">w</span> <span class="free">A</span><span class="main">#</span><span class="free">Gamma</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">R</span><span class="main">)</span><span class="main">;</span> Exs <span class="main">&lt;=</span> <span class="free">R</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">(</span>FAll Neg <span class="free">A</span><span class="main">#</span><span class="free">Gamma</span><span class="main">)</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> prems <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>instanceF <span class="free">w</span> <span class="free">A</span><span class="main">#</span><span class="free">Gamma</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> deductions.inferI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Exs_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sequents-WeakI"><span class="command">lemma</span></span> WeakI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">Gamma</span> <span class="main">:</span> deductions <span class="free">R</span><span class="main">;</span> Weaks <span class="main">&lt;=</span> <span class="free">R</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">A</span><span class="main">#</span><span class="free">Gamma</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> prems<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">Gamma</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> deductions.inferI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Weaks_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sequents-ContrI"><span class="command">lemma</span></span> ContrI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">A</span><span class="main">#</span><span class="free">A</span><span class="main">#</span><span class="free">Gamma</span> <span class="main">:</span> deductions <span class="free">R</span><span class="main">;</span> Contrs <span class="main">&lt;=</span> <span class="free">R</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">A</span><span class="main">#</span><span class="free">Gamma</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> prems<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">A</span><span class="main">#</span><span class="free">A</span><span class="main">#</span><span class="free">Gamma</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> deductions.inferI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Contrs_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sequents-PermI"><span class="command">lemma</span></span> PermI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">Gamma'</span> <span class="main">:</span> deductions <span class="free">R</span><span class="main">;</span> <span class="free">Gamma</span> <span class="main">&lt;~~&gt;</span> <span class="free">Gamma'</span><span class="main">;</span> Perms <span class="main">&lt;=</span> <span class="free">R</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">Gamma</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> prems<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">Gamma'</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> deductions.inferI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Perms_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Derived Rules"</span></span>

<span class="keyword1" id="Sequents-WeakI1"><span class="command">lemma</span></span> WeakI1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">Gamma</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">;</span> Weaks <span class="main">&lt;=</span> <span class="free">A</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="free">Delta</span> <span class="main">@</span> <span class="free">Gamma</span><span class="main">)</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">Delta</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> WeakI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sequents-WeakI2"><span class="command">lemma</span></span> WeakI2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">Gamma</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">;</span> Perms <span class="main">&lt;=</span> <span class="free">A</span><span class="main">;</span> Weaks <span class="main">&lt;=</span> <span class="free">A</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="free">Gamma</span> <span class="main">@</span> <span class="free">Delta</span><span class="main">)</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> PermI perm_append_swap WeakI1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sequents-SATAxiomI"><span class="command">lemma</span></span> SATAxiomI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> Axioms <span class="main">&lt;=</span> <span class="free">A</span><span class="main">;</span> Weaks <span class="main">&lt;=</span> <span class="free">A</span><span class="main">;</span> Perms <span class="main">&lt;=</span> <span class="free">A</span><span class="main">;</span> <span class="free">forms</span> <span class="main">=</span> <span class="main">[</span>FAtom Pos <span class="free">n</span> <span class="free">vs</span><span class="main">,</span>FAtom Neg <span class="free">n</span> <span class="free">vs</span><span class="main">]</span> <span class="main">@</span> <span class="free">Gamma</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">forms</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> WeakI2 AxiomI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="Sequents-DisjI1"><span class="command">lemma</span></span> DisjI1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="main">(</span><span class="free">A1</span><span class="main">#</span><span class="free">Gamma</span><span class="main">)</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">;</span> Disjs <span class="main">&lt;=</span> <span class="free">A</span><span class="main">;</span> Weaks <span class="main">&lt;=</span> <span class="free">A</span> <span class="main">|]</span> <span class="main">==&gt;</span> FConj Neg <span class="free">A0</span> <span class="free">A1</span><span class="main">#</span><span class="free">Gamma</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> DisjI WeakI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sequents-DisjI2"><span class="command">lemma</span></span> DisjI2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">A</span><span class="main">.</span> <span class="main">[|</span> <span class="main">(</span><span class="free">A0</span><span class="main">#</span><span class="free">Gamma</span><span class="main">)</span> <span class="main">:</span> deductions<span class="main">(</span><span class="bound">A</span><span class="main">)</span><span class="main">;</span> Disjs <span class="main">&lt;=</span> <span class="bound">A</span><span class="main">;</span> Weaks <span class="main">&lt;=</span> <span class="bound">A</span><span class="main">;</span> Perms <span class="main">&lt;=</span> <span class="bound">A</span> <span class="main">|]</span> <span class="main">==&gt;</span> FConj Neg <span class="free">A0</span> <span class="free">A1</span><span class="main">#</span><span class="free">Gamma</span> <span class="main">:</span> deductions<span class="main">(</span><span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> DisjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> PermI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ perm.swap<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> WeakI<span class="main">)</span>
  <span class="keyword1"><span class="command">.</span></span>

    <span class="comment1">― ‹FIXME the following 4 lemmas could all be proved for the standard rule sets using monotonicity as below›</span>
    <span class="comment1">― ‹we keep proofs as in original, but they are slightly ugly, and do not state what is intuitively happening›</span>
<span class="keyword1" id="Sequents-perm_tmp4"><span class="command">lemma</span></span> perm_tmp4<span class="main">:</span> <span class="quoted"><span class="quoted">"Perms <span class="main">⊆</span> <span class="free">R</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">@</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span> <span class="main">:</span> deductions <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">a</span> <span class="main">#</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="free">list</span> <span class="main">@</span> <span class="free">list</span> <span class="main">:</span> deductions <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> PermI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perm_count_conv count_append<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sequents-weaken_append"><span class="command">lemma</span></span> weaken_append<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Contrs <span class="main">&lt;=</span> <span class="free">R</span> <span class="main">==&gt;</span> Perms <span class="main">&lt;=</span> <span class="free">R</span> <span class="main">==&gt;</span> <span class="main">!</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">@</span> <span class="free">Gamma</span> <span class="main">@</span> <span class="free">Gamma</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">R</span><span class="main">)</span> <span class="main">--&gt;</span>  <span class="bound">A</span> <span class="main">@</span> <span class="free">Gamma</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Gamma</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">#</span><span class="improper">a</span><span class="main">#</span><span class="improper">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> impE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> perm_tmp4<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">A</span> <span class="main">@</span> <span class="main">(</span><span class="improper">a</span> <span class="main">#</span> <span class="improper">list</span><span class="main">)</span> <span class="main">@</span> <span class="improper">a</span> <span class="main">#</span> <span class="improper">list</span> <span class="main">∈</span> deductions <span class="free">R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> ContrI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span> <span class="main">#</span> <span class="improper">a</span> <span class="main">#</span> <span class="improper">A</span> <span class="main">@</span> <span class="improper">list</span> <span class="main">∈</span> deductions <span class="free">R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> PermI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perm_count_conv count_append<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="comment1">― ‹FIXME horrible›</span>

<span class="keyword1" id="Sequents-ListWeakI"><span class="command">lemma</span></span> ListWeakI<span class="main">:</span> <span class="quoted"><span class="quoted">"Perms <span class="main">&lt;=</span> <span class="free">R</span> <span class="main">==&gt;</span> Contrs <span class="main">&lt;=</span> <span class="free">R</span> <span class="main">==&gt;</span> <span class="free">x</span> <span class="main">#</span> <span class="free">Gamma</span> <span class="main">@</span> <span class="free">Gamma</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">R</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="free">x</span> <span class="main">#</span> <span class="free">Gamma</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> weaken_append<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">R</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[</span></span></span><span class="free"><span class="free"><span class="free">x</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">Gamma</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    
<span class="keyword1" id="Sequents-ConjI'"><span class="command">lemma</span></span> ConjI'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="main">(</span><span class="free">A0</span><span class="main">#</span><span class="free">Gamma</span><span class="main">)</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">;</span>  <span class="main">(</span><span class="free">A1</span><span class="main">#</span><span class="free">Gamma</span><span class="main">)</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span><span class="main">;</span> Contrs <span class="main">&lt;=</span> <span class="free">A</span><span class="main">;</span> Conjs <span class="main">&lt;=</span> <span class="free">A</span><span class="main">;</span> Perms <span class="main">&lt;=</span> <span class="free">A</span> <span class="main">|]</span> <span class="main">==&gt;</span> FConj Pos <span class="free">A0</span> <span class="free">A1</span><span class="main">#</span><span class="free">Gamma</span> <span class="main">:</span> deductions<span class="main">(</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ListWeakI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ConjI<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Standard Rule Sets For Predicate Calculus"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">PC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rule set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PC</span> <span class="main">=</span> Union <span class="main">{</span>Perms<span class="main">,</span>Axioms<span class="main">,</span>Conjs<span class="main">,</span>Disjs<span class="main">,</span>Alls<span class="main">,</span>Exs<span class="main">,</span>Weaks<span class="main">,</span>Contrs<span class="main">,</span>Cuts<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">CutFreePC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"rule set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">CutFreePC</span> <span class="main">=</span> Union <span class="main">{</span>Perms<span class="main">,</span>Axioms<span class="main">,</span>Conjs<span class="main">,</span>Disjs<span class="main">,</span>Alls<span class="main">,</span>Exs<span class="main">,</span>Weaks<span class="main">,</span>Contrs<span class="main">}</span>"</span></span>

<span class="keyword1" id="Sequents-rulesInPCs"><span class="command">lemma</span></span> rulesInPCs<span class="main">:</span> <span class="quoted"><span class="quoted">"Axioms <span class="main">&lt;=</span> PC"</span></span> <span class="quoted"><span class="quoted">"Axioms <span class="main">&lt;=</span> CutFreePC"</span></span>
  <span class="quoted"><span class="quoted">"Conjs  <span class="main">&lt;=</span> PC"</span></span> <span class="quoted"><span class="quoted">"Conjs  <span class="main">&lt;=</span> CutFreePC"</span></span>
  <span class="quoted"><span class="quoted">"Disjs  <span class="main">&lt;=</span> PC"</span></span> <span class="quoted"><span class="quoted">"Disjs  <span class="main">&lt;=</span> CutFreePC"</span></span>
  <span class="quoted"><span class="quoted">"Alls   <span class="main">&lt;=</span> PC"</span></span> <span class="quoted"><span class="quoted">"Alls   <span class="main">&lt;=</span> CutFreePC"</span></span>
  <span class="quoted"><span class="quoted">"Exs    <span class="main">&lt;=</span> PC"</span></span> <span class="quoted"><span class="quoted">"Exs    <span class="main">&lt;=</span> CutFreePC"</span></span>
  <span class="quoted"><span class="quoted">"Weaks  <span class="main">&lt;=</span> PC"</span></span> <span class="quoted"><span class="quoted">"Weaks  <span class="main">&lt;=</span> CutFreePC"</span></span>
  <span class="quoted"><span class="quoted">"Contrs <span class="main">&lt;=</span> PC"</span></span> <span class="quoted"><span class="quoted">"Contrs <span class="main">&lt;=</span> CutFreePC"</span></span>
  <span class="quoted"><span class="quoted">"Perms  <span class="main">&lt;=</span> PC"</span></span> <span class="quoted"><span class="quoted">"Perms  <span class="main">&lt;=</span> CutFreePC"</span></span>
  <span class="quoted"><span class="quoted">"Cuts   <span class="main">&lt;=</span> PC"</span></span>
  <span class="quoted"><span class="quoted">"CutFreePC <span class="main">&lt;=</span> PC"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PC_def CutFreePC_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Monotonicity for CutFreePC deductions"</span></span>

  <span class="comment1">― ‹these lemmas can be used to replace complicated permutation reasoning above›</span>
  <span class="comment1">― ‹essentially if x is a deduction, and set x subset set y, then y is a deduction›</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">inDed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"formula list <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inDed</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">:</span> deductions CutFreePC"</span></span>

<span class="keyword1" id="Sequents-perm"><span class="command">lemma</span></span> perm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">&lt;~~&gt;</span> <span class="bound">ys</span> <span class="main">--&gt;</span> <span class="main">(</span>inDed <span class="bound">xs</span> <span class="main">=</span> inDed <span class="bound">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">&lt;~~&gt;</span> <span class="bound">ys</span> <span class="main">--&gt;</span> inDed <span class="bound">xs</span> <span class="main">--&gt;</span> inDed <span class="bound">ys</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> perm_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inDed_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> PermI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> perm_sym<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rulesInPCs<span class="main">)</span>

<span class="keyword1" id="Sequents-contr"><span class="command">lemma</span></span> contr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> inDed <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span> <span class="main">--&gt;</span> inDed <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inDed_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ContrI rulesInPCs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sequents-weak"><span class="command">lemma</span></span> weak<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> inDed <span class="bound">xs</span> <span class="main">--&gt;</span> inDed <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inDed_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> WeakI rulesInPCs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sequents-inDed_mono'"><span class="command">lemma</span></span> inDed_mono'<span class="main">[</span><span class="operator">simplified</span> inDed_def<span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">x</span> <span class="main">&lt;=</span> set <span class="free">y</span> <span class="main">==&gt;</span> inDed <span class="free">x</span> <span class="main">==&gt;</span> inDed <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> perm_weak_contr_mono<span class="main">[</span><span class="operator">OF</span> perm contr weak<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Sequents-inDed_mono"><span class="command">lemma</span></span> inDed_mono<span class="main">[</span><span class="operator">simplified</span> inDed_def<span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inDed <span class="free">x</span> <span class="main">==&gt;</span> set <span class="free">x</span> <span class="main">&lt;=</span> set <span class="free">y</span> <span class="main">==&gt;</span> inDed <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> perm_weak_contr_mono<span class="main">[</span><span class="operator">OF</span> perm contr weak<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Tree">
<div class="head">
<h1>Theory Tree</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Tree <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Tree"</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span>
  <span class="entity">tree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> set<span class="main">,</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">=&gt;</span> <span class="main">(</span>nat <span class="main">*</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">subs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">gamma</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="comment1">(******
   * This set represents the nodes in a tree which may represent a proof of gamma.
   * Only storing the annotation and its level.
   * NOTE: could parameterize on subs
   ******)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    tree0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">gamma</span><span class="main">)</span> <span class="main">:</span> <span class="free">tree</span> <span class="free">subs</span> <span class="free">gamma</span>"</span></span>

  <span class="main">|</span> tree1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">delta</span></span></span><span class="main">)</span> <span class="main">:</span> <span class="free">tree</span> <span class="free">subs</span> <span class="free">gamma</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">sigma</span></span></span> <span class="main">:</span> <span class="free">subs</span> <span class="free"><span class="bound"><span class="entity">delta</span></span></span> <span class="main">|]</span>
            <span class="main">==&gt;</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">sigma</span></span></span><span class="main">)</span> <span class="main">:</span> <span class="free">tree</span> <span class="free">subs</span> <span class="free">gamma</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> tree.cases <span class="main">[</span><span class="operator">elim</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> tree.intros <span class="main">[</span><span class="operator">intro</span><span class="main">]</span>

<span class="keyword1" id="Tree-tree0Eq"><span class="command">lemma</span></span> tree0Eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">:</span> tree <span class="free">subs</span> <span class="free">gamma</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">=</span> <span class="free">gamma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> tree.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-tree1Eq"><span class="command">lemma</span></span> tree1Eq <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">Y</span><span class="main">.</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">,</span><span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> tree <span class="free">subs</span> <span class="free">gamma</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">sigma</span> <span class="main">∈</span> <span class="free">subs</span> <span class="free">gamma</span> <span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> tree <span class="free">subs</span> <span class="bound">sigma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="comment1">― ‹moving down a tree›</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">incLevel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">*</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> nat <span class="main">*</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">incLevel</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Tree-injIncLevel"><span class="command">lemma</span></span> injIncLevel<span class="main">:</span> <span class="quoted"><span class="quoted">"inj incLevel"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> incLevel_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-treeEquation"><span class="command">lemma</span></span> treeEquation<span class="main">:</span> <span class="quoted"><span class="quoted">"tree <span class="free">subs</span> <span class="free">gamma</span> <span class="main">=</span> insert <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">gamma</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">UN</span> <span class="bound">delta</span><span class="main">:</span><span class="free">subs</span> <span class="free">gamma</span> <span class="main">.</span> incLevel <span class="main">`</span> tree <span class="free">subs</span> <span class="bound">delta</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_paired_all<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tree0Eq incLevel_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tree1Eq incLevel_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">fans</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> set<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fans</span> <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">!</span><span class="bound">x</span><span class="main">.</span> finite <span class="main">(</span><span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Tree-fansD"><span class="command">lemma</span></span> fansD<span class="main">:</span> <span class="quoted"><span class="quoted">"fans <span class="free">subs</span> <span class="main">==&gt;</span> finite <span class="main">(</span><span class="free">subs</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fans_def<span class="main">)</span>

<span class="keyword1" id="Tree-fansI"><span class="command">lemma</span></span> fansI<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">!</span><span class="bound">A</span><span class="main">.</span> finite <span class="main">(</span><span class="free">subs</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> fans <span class="free">subs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fans_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Terminal"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">terminal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> set<span class="main">,</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">terminal</span> <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="free"><span class="bound"><span class="entity">delta</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">subs</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">delta</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1" id="Tree-terminalD"><span class="command">lemma</span></span> terminalD<span class="main">:</span> <span class="quoted"><span class="quoted">"terminal <span class="free">subs</span> <span class="free">Gamma</span> <span class="main">==&gt;</span> <span class="free">x</span> <span class="main">~:</span> <span class="free">subs</span> <span class="free">Gamma</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> terminal_def<span class="main">)</span>
  <span class="comment1">― ‹not a good dest rule›</span>

<span class="keyword1" id="Tree-terminalI"><span class="command">lemma</span></span> terminalI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">subs</span> <span class="free">Gamma</span> <span class="main">==&gt;</span> <span class="main">~</span> terminal <span class="free">subs</span> <span class="free">Gamma</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> terminal_def<span class="main">)</span>
  <span class="comment1">― ‹not a good intro rule›</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Inherited"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">inherited</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> set<span class="main">,</span><span class="main">(</span>nat <span class="main">*</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">=&gt;</span> bool<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inherited</span> <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">!</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">A</span> <span class="main">&amp;</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">B</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">A</span> <span class="keyword1">Un</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">&amp;</span> <span class="main">(</span><span class="main">!</span><span class="bound">A</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">A</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span>incLevel <span class="main">`</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">&amp;</span> <span class="main">(</span><span class="main">!</span><span class="bound">n</span> <span class="bound">Gamma</span> <span class="bound">A</span><span class="main">.</span> <span class="main">~</span><span class="main">(</span>terminal <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="bound">Gamma</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">A</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span>insert <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">Gamma</span><span class="main">)</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">&amp;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">{}</span><span class="main">)</span>"</span></span>

    <span class="comment1">(******
     inherited properties:
        - preserved under: dividing into 2, join 2 parts
                           moving up/down levels
                           inserting non terminal nodes
        - hold on empty node set
     ******)</span>

  <span class="comment1">― ‹FIXME tjr why does it have to be invariant under inserting nonterminal nodes?›</span>

<span class="keyword1" id="Tree-inheritedUn"><span class="command">lemma</span></span> inheritedUn<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"inherited <span class="free">subs</span> <span class="free">P</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="free">A</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="free">B</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">Un</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inherited_def<span class="main">)</span>

<span class="keyword1" id="Tree-inheritedIncLevel"><span class="command">lemma</span></span> inheritedIncLevel<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inherited <span class="free">subs</span> <span class="free">P</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="free">A</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="main">(</span>incLevel <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inherited_def<span class="main">)</span>

<span class="keyword1" id="Tree-inheritedEmpty"><span class="command">lemma</span></span> inheritedEmpty<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inherited <span class="free">subs</span> <span class="free">P</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inherited_def<span class="main">)</span>

<span class="keyword1" id="Tree-inheritedInsert"><span class="command">lemma</span></span> inheritedInsert<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"inherited <span class="free">subs</span> <span class="free">P</span> <span class="main">--&gt;</span> <span class="main">~</span><span class="main">(</span>terminal <span class="free">subs</span> <span class="free">Gamma</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="free">A</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">Gamma</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inherited_def<span class="main">)</span>

<span class="keyword1" id="Tree-inheritedI"><span class="command">lemma</span></span> inheritedI<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="main">∀</span><span class="bound">A</span> <span class="bound">B</span> <span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">A</span> <span class="main">&amp;</span> <span class="free">P</span> <span class="bound">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="bound">A</span> <span class="keyword1">Un</span> <span class="bound">B</span><span class="main">)</span><span class="main">;</span>
  <span class="main">∀</span><span class="bound">A</span> <span class="main">.</span> <span class="free">P</span> <span class="bound">A</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>incLevel <span class="main">`</span> <span class="bound">A</span><span class="main">)</span><span class="main">;</span>
  <span class="main">∀</span><span class="bound">n</span> <span class="bound">Gamma</span> <span class="bound">A</span> <span class="main">.</span> <span class="main">~</span><span class="main">(</span>terminal <span class="free">subs</span> <span class="bound">Gamma</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="bound">A</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>insert <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">Gamma</span><span class="main">)</span> <span class="bound">A</span><span class="main">)</span><span class="main">;</span>
  <span class="free">P</span> <span class="main">{}</span> <span class="main">|]</span> <span class="main">==&gt;</span> inherited <span class="free">subs</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inherited_def<span class="main">)</span>

<span class="comment1">(* These only for inherited join, and a few more places... *)</span>
<span class="keyword1" id="Tree-inheritedUnEq"><span class="command">lemma</span></span> inheritedUnEq<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inherited <span class="free">subs</span> <span class="free">P</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="free">P</span> <span class="free">A</span> <span class="main">&amp;</span> <span class="free">P</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">Un</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inherited_def<span class="main">)</span>

<span class="keyword1" id="Tree-inheritedIncLevelEq"><span class="command">lemma</span></span> inheritedIncLevelEq<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inherited <span class="free">subs</span> <span class="free">P</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="free">A</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>incLevel <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inherited_def<span class="main">)</span>

<span class="keyword1" id="Tree-inheritedInsertEq"><span class="command">lemma</span></span> inheritedInsertEq<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inherited <span class="free">subs</span> <span class="free">P</span> <span class="main">--&gt;</span> <span class="main">~</span><span class="main">(</span>terminal <span class="free">subs</span> <span class="free">Gamma</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="free">A</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">Gamma</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inherited_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> inheritedUnD <span class="main">=</span> iffD1<span class="main">[</span><span class="operator">OF</span> inheritedUnEq<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> inheritedInsertD <span class="main">=</span> inheritedInsertEq<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> inheritedIncLevelD <span class="main">=</span> inheritedIncLevelEq<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">]</span>

<span class="keyword1" id="Tree-inheritedUNEq"><span class="command">lemma</span></span> inheritedUNEq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">--&gt;</span> inherited <span class="free">subs</span> <span class="free">P</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="main">!</span><span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="keyword1">UN</span> <span class="bound">a</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="free">B</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> finite_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inheritedEmpty<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> inheritedUnEq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> inheritedUN  <span class="main">=</span> inheritedUNEq<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> inheritedUND<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span> <span class="main">=</span> inheritedUNEq<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">]</span>

<span class="keyword1" id="Tree-inheritedPropagateEq"><span class="command">lemma</span></span> inheritedPropagateEq<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"inherited <span class="free">subs</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"fans <span class="free">subs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span>terminal <span class="free">subs</span> <span class="free">delta</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span>tree <span class="free">subs</span> <span class="free">delta</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">!</span><span class="bound">sigma</span><span class="main">:</span><span class="free">subs</span> <span class="free">delta</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span>tree <span class="free">subs</span> <span class="bound">sigma</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> fansD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> b<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> treeEquation <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">delta</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inheritedInsertEq inheritedUNEq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> inheritedIncLevelEq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-inheritedPropagate"><span class="command">lemma</span></span> inheritedPropagate<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="main">~</span><span class="free">P</span><span class="main">(</span>tree <span class="free">subs</span> <span class="free">delta</span><span class="main">)</span><span class="main">;</span> inherited <span class="free">subs</span> <span class="free">P</span><span class="main">;</span> fans <span class="free">subs</span><span class="main">;</span> <span class="main">~</span><span class="main">(</span>terminal <span class="free">subs</span> <span class="free">delta</span><span class="main">)</span><span class="main">|]</span>
  <span class="main">==&gt;</span> <span class="main">∃</span><span class="bound">sigma</span> <span class="main">∈</span> <span class="free">subs</span> <span class="free">delta</span> <span class="main">.</span> <span class="main">~</span><span class="free">P</span><span class="main">(</span>tree <span class="free">subs</span> <span class="bound">sigma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inheritedPropagateEq<span class="main">)</span>

<span class="keyword1" id="Tree-inheritedViaSub"><span class="command">lemma</span></span> inheritedViaSub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> inherited <span class="free">subs</span> <span class="free">P</span><span class="main">;</span> fans <span class="free">subs</span><span class="main">;</span> <span class="free">P</span><span class="main">(</span>tree <span class="free">subs</span> <span class="free">delta</span><span class="main">)</span><span class="main">;</span> <span class="free">sigma</span> <span class="main">∈</span> <span class="free">subs</span> <span class="free">delta</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> <span class="free">P</span><span class="main">(</span>tree <span class="free">subs</span> <span class="free">sigma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> terminalI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inheritedPropagateEq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-inheritedJoin"><span class="command">lemma</span></span> inheritedJoin<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>inherited <span class="free">subs</span> <span class="free">P</span> <span class="main">&amp;</span> inherited <span class="free">subs</span> <span class="free">Q</span><span class="main">)</span> <span class="main">--&gt;</span> inherited <span class="free">subs</span> <span class="main">(</span><span class="main">%</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">&amp;</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inheritedI
     <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> inheritedUnEq inheritedIncLevelEq inheritedInsertEq inheritedEmpty<span class="main">)</span>

<span class="keyword1" id="Tree-inheritedJoinI"><span class="command">lemma</span></span> inheritedJoinI<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> inherited <span class="free">subs</span> <span class="free">P</span><span class="main">;</span> inherited <span class="free">subs</span> <span class="free">Q</span><span class="main">;</span> <span class="free">R</span> <span class="main">=</span> <span class="main">(</span> <span class="main">%</span> <span class="bound">x</span> <span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">&amp;</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|]</span> <span class="main">==&gt;</span> inherited <span class="free">subs</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>inheritedI <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> inheritedUnEq inheritedIncLevelEq inheritedInsertEq inheritedEmpty<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"bounded, boundedBy"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">boundedBy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">=&gt;</span> <span class="main">(</span>nat <span class="main">*</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">boundedBy</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">delta</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bounded</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">*</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bounded</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">N</span> <span class="main">.</span> boundedBy <span class="bound">N</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Tree-boundedByEmpty"><span class="command">lemma</span></span> boundedByEmpty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"boundedBy <span class="free">N</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedBy_def<span class="main">)</span>

<span class="keyword1" id="Tree-boundedByInsert"><span class="command">lemma</span></span> boundedByInsert<span class="main">:</span> <span class="quoted"><span class="quoted">"boundedBy <span class="free">N</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">delta</span><span class="main">)</span> <span class="free">B</span><span class="main">)</span>     <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">&lt;</span> <span class="free">N</span> <span class="main">&amp;</span> boundedBy <span class="free">N</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedBy_def<span class="main">)</span>

<span class="keyword1" id="Tree-boundedByUn"><span class="command">lemma</span></span> boundedByUn<span class="main">:</span> <span class="quoted"><span class="quoted">"boundedBy <span class="free">N</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">Un</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>boundedBy <span class="free">N</span> <span class="free">A</span> <span class="main">&amp;</span> boundedBy <span class="free">N</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedBy_def<span class="main">)</span>

<span class="keyword1" id="Tree-boundedByIncLevel'"><span class="command">lemma</span></span> boundedByIncLevel'<span class="main">:</span> <span class="quoted"><span class="quoted">"boundedBy <span class="main">(</span>Suc <span class="free">N</span><span class="main">)</span> <span class="main">(</span>incLevel <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> boundedBy <span class="free">N</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> incLevel_def boundedBy_def<span class="main">)</span>

<span class="keyword1" id="Tree-boundedByAdd1"><span class="command">lemma</span></span> boundedByAdd1<span class="main">:</span> <span class="quoted"><span class="quoted">"boundedBy <span class="free">N</span> <span class="free">B</span> <span class="main">⟹</span> boundedBy <span class="main">(</span><span class="free">N</span><span class="main">+</span><span class="free">M</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedBy_def<span class="main">)</span>

<span class="keyword1" id="Tree-boundedByAdd2"><span class="command">lemma</span></span> boundedByAdd2<span class="main">:</span> <span class="quoted"><span class="quoted">"boundedBy <span class="free">M</span> <span class="free">B</span> <span class="main">⟹</span> boundedBy <span class="main">(</span><span class="free">N</span><span class="main">+</span><span class="free">M</span><span class="main">)</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedBy_def<span class="main">)</span>

<span class="keyword1" id="Tree-boundedByMono"><span class="command">lemma</span></span> boundedByMono<span class="main">:</span> <span class="quoted"><span class="quoted">"boundedBy <span class="free">m</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="free">M</span> <span class="main">⟹</span> boundedBy <span class="free">M</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> boundedBy_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> boundedByMonoD  <span class="main">=</span> boundedByMono

<span class="keyword1" id="Tree-boundedBy0"><span class="command">lemma</span></span> boundedBy0<span class="main">:</span> <span class="quoted"><span class="quoted">"boundedBy <span class="main">0</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedBy_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedBy_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-boundedBySuc'"><span class="command">lemma</span></span> boundedBySuc'<span class="main">:</span> <span class="quoted"><span class="quoted">"boundedBy <span class="free">N</span> <span class="free">A</span> <span class="main">⟹</span> boundedBy <span class="main">(</span>Suc <span class="free">N</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedBy_def<span class="main">)</span>

<span class="keyword1" id="Tree-boundedByIncLevel"><span class="command">lemma</span></span> boundedByIncLevel<span class="main">:</span> <span class="quoted"><span class="quoted">"boundedBy <span class="free">n</span> <span class="main">(</span>incLevel <span class="main">`</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="free">gamma</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span> <span class="main">∃</span><span class="bound">m</span> <span class="main">.</span> <span class="free">n</span> <span class="main">=</span> Suc <span class="bound">m</span> <span class="main">&amp;</span> boundedBy <span class="bound">m</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="free">gamma</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedBy0 tree0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> treeEquation <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">gamma</span></span><span class="main"><span class="main">]</span></span> incLevel_def boundedBy_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-boundedByUN"><span class="command">lemma</span></span> boundedByUN<span class="main">:</span> <span class="quoted"><span class="quoted">"boundedBy <span class="free">N</span> <span class="main">(</span><span class="keyword1">UN</span> <span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">!</span><span class="bound">x</span><span class="main">:</span><span class="free">A</span><span class="main">.</span> boundedBy <span class="free">N</span> <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedBy_def<span class="main">)</span>

<span class="keyword1" id="Tree-boundedBySuc"><span class="command">lemma</span></span> boundedBySuc<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sigma</span> <span class="main">∈</span> <span class="free">subs</span> <span class="free">Gamma</span> <span class="main">⟹</span> boundedBy <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="free">Gamma</span><span class="main">)</span> <span class="main">⟶</span> boundedBy <span class="free">n</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="free">sigma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> treeEquation <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Gamma</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedByInsert<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedByUN<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">sigma</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedByIncLevel<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Inherited Properties- bounded"</span></span>

<span class="keyword1" id="Tree-boundedEmpty"><span class="command">lemma</span></span> boundedEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bounded_def<span class="main">)</span>

<span class="keyword1" id="Tree-boundedUn"><span class="command">lemma</span></span> boundedUn<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="free">A</span> <span class="keyword1">Un</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>bounded <span class="free">A</span> <span class="main">&amp;</span> bounded <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bounded_def boundedByUn<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">N</span><span class="main">+</span><span class="improper">Na</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> boundedByAdd1 boundedByAdd2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-boundedIncLevel"><span class="command">lemma</span></span> boundedIncLevel<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span>incLevel<span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>bounded <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bounded_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">N</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedBy_def incLevel_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">N</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedBy_def incLevel_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-boundedInsert"><span class="command">lemma</span></span> boundedInsert<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span>insert <span class="free">a</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>bounded <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bounded_def boundedByInsert<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc<span class="main">(</span><span class="improper">aa</span><span class="main">+</span><span class="improper">N</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>boundedByMono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-inheritedBounded"><span class="command">lemma</span></span> inheritedBounded<span class="main">:</span> <span class="quoted"><span class="quoted">"inherited <span class="free">subs</span> bounded"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inheritedI boundedUn<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> boundedIncLevel<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
    boundedInsert<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> boundedEmpty<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"founded"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">founded</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> set<span class="main">,</span><span class="tfree">'a</span> <span class="main">=&gt;</span> bool<span class="main">,</span><span class="main">(</span>nat <span class="main">*</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">founded</span> <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="free"><span class="bound"><span class="entity">Pred</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">A</span><span class="main">.</span> <span class="main">!</span><span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">delta</span><span class="main">)</span><span class="main">:</span><span class="bound">A</span><span class="main">.</span> terminal <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="bound">delta</span> <span class="main">--&gt;</span> <span class="free"><span class="bound"><span class="entity">Pred</span></span></span> <span class="bound">delta</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Tree-foundedD"><span class="command">lemma</span></span> foundedD<span class="main">:</span> <span class="quoted"><span class="quoted">"founded <span class="free">subs</span> <span class="free">P</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="free">delta</span><span class="main">)</span> <span class="main">==&gt;</span> terminal <span class="free">subs</span> <span class="free">delta</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="free">delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> treeEquation <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">delta</span></span><span class="main"><span class="main">]</span></span> founded_def<span class="main">)</span>

<span class="keyword1" id="Tree-foundedMono"><span class="command">lemma</span></span> foundedMono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> founded <span class="free">subs</span> <span class="free">P</span> <span class="free">A</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">--&gt;</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">|]</span> <span class="main">==&gt;</span> founded <span class="free">subs</span> <span class="free">Q</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> founded_def<span class="main">)</span>

<span class="keyword1" id="Tree-foundedSubs"><span class="command">lemma</span></span> foundedSubs<span class="main">:</span> <span class="quoted"><span class="quoted">"founded <span class="free">subs</span> <span class="free">P</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="free">Gamma</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">sigma</span> <span class="main">∈</span> <span class="free">subs</span> <span class="free">Gamma</span> <span class="main">⟹</span> founded <span class="free">subs</span> <span class="free">P</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="free">sigma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> founded_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> ballI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="improper">a</span><span class="main">,</span> <span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> treeEquation<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> incLevel_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Inherited Properties- founded"</span></span>

<span class="keyword1" id="Tree-foundedInsert"><span class="command">lemma</span></span> foundedInsert<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> terminal <span class="free">subs</span> <span class="free">delta</span> <span class="main">--&gt;</span> founded <span class="free">subs</span> <span class="free">P</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">delta</span><span class="main">)</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>founded <span class="free">subs</span> <span class="free">P</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> terminal_def founded_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-foundedUn"><span class="command">lemma</span></span> foundedUn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>founded <span class="free">subs</span> <span class="free">P</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">Un</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>founded <span class="free">subs</span> <span class="free">P</span> <span class="free">A</span> <span class="main">&amp;</span> founded <span class="free">subs</span> <span class="free">P</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> founded_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Tree-foundedIncLevel"><span class="command">lemma</span></span> foundedIncLevel<span class="main">:</span> <span class="quoted"><span class="quoted">"founded <span class="free">subs</span> <span class="free">P</span> <span class="main">(</span>incLevel <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>founded <span class="free">subs</span> <span class="free">P</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> founded_def incLevel_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-foundedEmpty"><span class="command">lemma</span></span> foundedEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"founded <span class="free">subs</span> <span class="free">P</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> founded_def<span class="main">)</span>

<span class="keyword1" id="Tree-inheritedFounded"><span class="command">lemma</span></span> inheritedFounded<span class="main">:</span> <span class="quoted"><span class="quoted">"inherited <span class="free">subs</span> <span class="main">(</span>founded <span class="free">subs</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inheritedI foundedUn<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> foundedIncLevel<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
    foundedInsert<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> foundedEmpty<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Inherited Properties- finite"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> finiteInsert <span class="main">=</span> finite_insert

<span class="keyword1" id="Tree-finiteUn"><span class="command">lemma</span></span> finiteUn<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span> <span class="keyword1">Un</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>finite <span class="free">A</span> <span class="main">&amp;</span> finite <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-finiteIncLevel"><span class="command">lemma</span></span> finiteIncLevel<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>incLevel <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> finite <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> injIncLevel<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> finite_imageD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subset_inj_on<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="comment1">― ‹FIXME often have injOn f A, finite f ` A, to show A finite›</span>

<span class="keyword1" id="Tree-finiteEmpty"><span class="command">lemma</span></span> finiteEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Tree-inheritedFinite"><span class="command">lemma</span></span> inheritedFinite<span class="main">:</span> <span class="quoted"><span class="quoted">"inherited <span class="free">subs</span> <span class="main">(</span><span class="main">%</span><span class="bound">A</span><span class="main">.</span> finite <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> inheritedI finiteUn<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> finiteIncLevel<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> finiteInsert<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> finiteEmpty<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"path: follows a failing inherited property through tree"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">failingSub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> set<span class="main">,</span><span class="main">(</span>nat <span class="main">*</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">=&gt;</span> bool<span class="main">,</span><span class="tfree">'a</span><span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">failingSub</span> <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">gamma</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">sigma</span><span class="main">.</span> <span class="main">(</span><span class="bound">sigma</span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="free"><span class="bound"><span class="entity">gamma</span></span></span> <span class="main">&amp;</span> <span class="main">~</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">(</span>tree <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="bound">sigma</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Tree-failingSubProps"><span class="command">lemma</span></span> failingSubProps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> inherited <span class="free">subs</span> <span class="free">P</span><span class="main">;</span> <span class="main">~</span><span class="free">P</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="free">gamma</span><span class="main">)</span><span class="main">;</span> <span class="main">~</span><span class="main">(</span>terminal <span class="free">subs</span> <span class="free">gamma</span><span class="main">)</span><span class="main">;</span> fans <span class="free">subs</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> failingSub <span class="free">subs</span> <span class="free">P</span> <span class="free">gamma</span> <span class="main">∈</span> <span class="free">subs</span> <span class="free">gamma</span> <span class="main">&amp;</span> <span class="main">~</span><span class="main">(</span><span class="free">P</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="main">(</span>failingSub <span class="free">subs</span> <span class="free">P</span> <span class="free">gamma</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> failingSub_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> inheritedPropagate<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> bexE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> someI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-failingSubFailsI"><span class="command">lemma</span></span> failingSubFailsI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> inherited <span class="free">subs</span> <span class="free">P</span><span class="main">;</span> <span class="main">~</span><span class="free">P</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="free">gamma</span><span class="main">)</span><span class="main">;</span> <span class="main">~</span><span class="main">(</span>terminal <span class="free">subs</span> <span class="free">gamma</span><span class="main">)</span><span class="main">;</span> fans <span class="free">subs</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> <span class="main">~</span><span class="main">(</span><span class="free">P</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="main">(</span>failingSub <span class="free">subs</span> <span class="free">P</span> <span class="free">gamma</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjunct2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> failingSubProps<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> failingSubFailsE <span class="main">=</span> failingSubFailsI<span class="main">[</span><span class="operator">THEN</span> notE<span class="main">]</span>

<span class="keyword1" id="Tree-failingSubSubs"><span class="command">lemma</span></span> failingSubSubs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> inherited <span class="free">subs</span> <span class="free">P</span><span class="main">;</span> <span class="main">~</span><span class="free">P</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="free">gamma</span><span class="main">)</span><span class="main">;</span> <span class="main">~</span><span class="main">(</span>terminal <span class="free">subs</span> <span class="free">gamma</span><span class="main">)</span><span class="main">;</span> fans <span class="free">subs</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> failingSub <span class="free">subs</span> <span class="free">P</span> <span class="free">gamma</span> <span class="main">∈</span> <span class="free">subs</span> <span class="free">gamma</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjunct1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> failingSubProps<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> set<span class="main">,</span><span class="tfree">'a</span><span class="main">,</span><span class="main">(</span>nat <span class="main">*</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">=&gt;</span> bool<span class="main">,</span>nat<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  path0<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">path</span> <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="free"><span class="bound"><span class="entity">gamma</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">0</span>       <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">gamma</span></span></span>"</span></span>
<span class="main">|</span> pathSuc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">path</span> <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="free"><span class="bound"><span class="entity">gamma</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> terminal <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="main">(</span><span class="free">path</span> <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="free"><span class="bound"><span class="entity">gamma</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>
                                          <span class="keyword1">then</span> <span class="free">path</span> <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="free"><span class="bound"><span class="entity">gamma</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>
                                          <span class="keyword1">else</span> failingSub <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="free">path</span> <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="free"><span class="bound"><span class="entity">gamma</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Tree-pathFailsP"><span class="command">lemma</span></span> pathFailsP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> inherited <span class="free">subs</span> <span class="free">P</span><span class="main">;</span> fans <span class="free">subs</span><span class="main">;</span> <span class="main">~</span><span class="free">P</span><span class="main">(</span>tree <span class="free">subs</span> <span class="free">gamma</span><span class="main">)</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> <span class="main">~</span><span class="main">(</span><span class="free">P</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="main">(</span>path <span class="free">subs</span> <span class="free">gamma</span> <span class="free">P</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> failingSubFailsI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> PpathE <span class="main">=</span> pathFailsP<span class="main">[</span><span class="operator">THEN</span> notE<span class="main">]</span>

<span class="keyword1" id="Tree-pathTerminal"><span class="command">lemma</span></span> pathTerminal<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> inherited <span class="free">subs</span> <span class="free">P</span><span class="main">;</span> fans <span class="free">subs</span><span class="main">;</span> terminal <span class="free">subs</span> <span class="free">gamma</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> terminal <span class="free">subs</span> <span class="main">(</span>path <span class="free">subs</span> <span class="free">gamma</span> <span class="free">P</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-pathStarts"><span class="command">lemma</span></span> pathStarts<span class="main">:</span>  <span class="quoted"><span class="quoted">"path <span class="free">subs</span> <span class="free">gamma</span> <span class="free">P</span> <span class="main">0</span> <span class="main">=</span> <span class="free">gamma</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Tree-pathSubs"><span class="command">lemma</span></span> pathSubs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> inherited <span class="free">subs</span> <span class="free">P</span><span class="main">;</span> fans <span class="free">subs</span><span class="main">;</span> <span class="main">~</span><span class="free">P</span><span class="main">(</span>tree <span class="free">subs</span> <span class="free">gamma</span><span class="main">)</span><span class="main">;</span> <span class="main">~</span> <span class="main">(</span>terminal <span class="free">subs</span> <span class="main">(</span>path <span class="free">subs</span> <span class="free">gamma</span> <span class="free">P</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> path <span class="free">subs</span> <span class="free">gamma</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">subs</span> <span class="main">(</span>path <span class="free">subs</span> <span class="free">gamma</span> <span class="free">P</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> failingSubSubs<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> pathFailsP<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-pathStops"><span class="command">lemma</span></span> pathStops<span class="main">:</span> <span class="quoted"><span class="quoted">"terminal <span class="free">subs</span> <span class="main">(</span>path <span class="free">subs</span> <span class="free">gamma</span> <span class="free">P</span> <span class="free">n</span><span class="main">)</span> <span class="main">==&gt;</span> path <span class="free">subs</span> <span class="free">gamma</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> path <span class="free">subs</span> <span class="free">gamma</span> <span class="free">P</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Branch"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">branch</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> set<span class="main">,</span><span class="tfree">'a</span><span class="main">,</span>nat <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">branch</span> <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="free"><span class="bound"><span class="entity">Gamma</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Gamma</span></span></span>
    <span class="main">&amp;</span> <span class="main">(</span><span class="main">!</span><span class="bound">n</span> <span class="main">.</span> terminal <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span>
    <span class="main">&amp;</span> <span class="main">(</span><span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> terminal <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Tree-branch0"><span class="command">lemma</span></span> branch0<span class="main">:</span> <span class="quoted"><span class="quoted">"branch <span class="free">subs</span> <span class="free">Gamma</span> <span class="free">f</span> <span class="main">==&gt;</span> <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">Gamma</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> branch_def<span class="main">)</span>

<span class="keyword1" id="Tree-branchStops"><span class="command">lemma</span></span> branchStops<span class="main">:</span> <span class="quoted"><span class="quoted">"branch <span class="free">subs</span> <span class="free">Gamma</span> <span class="free">f</span> <span class="main">==&gt;</span> terminal <span class="free">subs</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> branch_def<span class="main">)</span>

<span class="keyword1" id="Tree-branchSubs"><span class="command">lemma</span></span> branchSubs<span class="main">:</span> <span class="quoted"><span class="quoted">"branch <span class="free">subs</span> <span class="free">Gamma</span> <span class="free">f</span> <span class="main">==&gt;</span> <span class="main">~</span> terminal <span class="free">subs</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">subs</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> branch_def<span class="main">)</span>

<span class="keyword1" id="Tree-branchI"><span class="command">lemma</span></span> branchI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="main">(</span><span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">Gamma</span><span class="main">)</span><span class="main">;</span>
  <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> terminal <span class="free">subs</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">n</span><span class="main">;</span>
  <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> terminal <span class="free">subs</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">subs</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">|]</span> <span class="main">==&gt;</span> branch <span class="free">subs</span> <span class="free">Gamma</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> branch_def<span class="main">)</span>

<span class="keyword1" id="Tree-branchTerminalPropagates"><span class="command">lemma</span></span> branchTerminalPropagates<span class="main">:</span> <span class="quoted"><span class="quoted">"branch <span class="free">subs</span> <span class="free">Gamma</span> <span class="free">f</span> <span class="main">==&gt;</span> terminal <span class="free">subs</span> <span class="main">(</span><span class="free">f</span> <span class="free">m</span><span class="main">)</span> <span class="main">==&gt;</span> terminal <span class="free">subs</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> branchStops<span class="main">)</span>

<span class="keyword1" id="Tree-branchTerminalMono"><span class="command">lemma</span></span> branchTerminalMono<span class="main">:</span> <span class="quoted"><span class="quoted">"branch <span class="free">subs</span> <span class="free">Gamma</span> <span class="free">f</span> <span class="main">==&gt;</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">==&gt;</span> terminal <span class="free">subs</span> <span class="main">(</span><span class="free">f</span> <span class="free">m</span><span class="main">)</span> <span class="main">==&gt;</span> terminal <span class="free">subs</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"terminal <span class="free">subs</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> branchTerminalPropagates<span class="main">)</span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Tree-branchPath"><span class="command">lemma</span></span> branchPath<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">[|</span> inherited <span class="free">subs</span> <span class="free">P</span><span class="main">;</span> fans <span class="free">subs</span><span class="main">;</span> <span class="main">~</span><span class="free">P</span><span class="main">(</span>tree <span class="free">subs</span> <span class="free">gamma</span><span class="main">)</span> <span class="main">|]</span>
       <span class="main">==&gt;</span> branch <span class="free">subs</span> <span class="free">gamma</span> <span class="main">(</span>path <span class="free">subs</span> <span class="free">gamma</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> branchI pathStarts pathSubs pathStops<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"failing branch property: abstracts path defn"</span></span>

<span class="keyword1" id="Tree-failingBranchExistence"><span class="command">lemma</span></span> failingBranchExistence<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">subs</span><span class="main">.</span>
  <span class="main">[|</span> inherited <span class="bound">subs</span> <span class="free">P</span><span class="main">;</span> fans <span class="bound">subs</span><span class="main">;</span> <span class="main">~</span><span class="free">P</span><span class="main">(</span>tree <span class="bound">subs</span> <span class="free">gamma</span><span class="main">)</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> <span class="main">∃</span><span class="bound">f</span> <span class="main">.</span> branch <span class="bound">subs</span> <span class="free">gamma</span> <span class="bound">f</span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span><span class="free">P</span><span class="main">(</span>tree <span class="bound">subs</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"path <span class="improper">subs</span> <span class="free">gamma</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> branchPath<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> pathFailsP<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">infBranch</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> set<span class="main">,</span><span class="tfree">'a</span><span class="main">,</span>nat <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">infBranch</span> <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="free"><span class="bound"><span class="entity">Gamma</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Gamma</span></span></span> <span class="main">&amp;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">subs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Tree-infBranchI"><span class="command">lemma</span></span> infBranchI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="main">(</span><span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">Gamma</span><span class="main">)</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">subs</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">|]</span> <span class="main">==&gt;</span> infBranch <span class="free">subs</span> <span class="free">Gamma</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infBranch_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Tree induction principles"</span></span>

  <span class="comment1">― ‹we work hard to use nothing fancier that induction over naturals›</span>

<span class="keyword1" id="Tree-boundedTreeInduction'"><span class="command">lemma</span></span> boundedTreeInduction'<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> fans <span class="free">subs</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">delta</span><span class="main">.</span> <span class="main">~</span> terminal <span class="free">subs</span> <span class="bound">delta</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">sigma</span> <span class="main">∈</span> <span class="free">subs</span> <span class="bound">delta</span><span class="main">.</span> <span class="free">P</span> <span class="bound">sigma</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="bound">delta</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">∀</span><span class="bound">Gamma</span><span class="main">.</span> boundedBy <span class="free">m</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="bound">Gamma</span><span class="main">)</span> <span class="main">⟶</span>  founded <span class="free">subs</span> <span class="free">P</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="bound">Gamma</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">Gamma</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI allI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedBy0<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="improper">Gamma</span><span class="main">)</span> <span class="main">∈</span> tree <span class="free">subs</span> <span class="improper">Gamma</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> tree0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">Gamma</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"terminal <span class="free">subs</span> <span class="improper">Gamma</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> foundedD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">sigma</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> boundedBySuc<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> foundedSubs<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="comment1">― ‹tjr tidied and introduced new lemmas›</span>

<span class="keyword1" id="Tree-boundedTreeInduction"><span class="command">lemma</span></span> boundedTreeInduction<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span>fans <span class="free">subs</span><span class="main">;</span>
     bounded <span class="main">(</span>tree <span class="free">subs</span> <span class="free">Gamma</span><span class="main">)</span><span class="main">;</span> founded <span class="free">subs</span> <span class="free">P</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="free">Gamma</span><span class="main">)</span><span class="main">;</span>
  <span class="main">∀</span><span class="bound">delta</span><span class="main">.</span> <span class="main">~</span> terminal <span class="free">subs</span> <span class="bound">delta</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">sigma</span> <span class="main">∈</span> <span class="free">subs</span> <span class="bound">delta</span><span class="main">.</span> <span class="free">P</span> <span class="bound">sigma</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="bound">delta</span>
  <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">Gamma</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> bounded_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> boundedTreeInduction'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-boundedTreeInduction2'"><span class="command">lemma</span></span> boundedTreeInduction2'<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[|</span> fans <span class="free">subs</span><span class="main">;</span>
    <span class="main">∀</span><span class="bound">delta</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">sigma</span> <span class="main">∈</span> <span class="free">subs</span> <span class="bound">delta</span><span class="main">.</span> <span class="free">P</span> <span class="bound">sigma</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="bound">delta</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> <span class="main">∀</span><span class="bound">Gamma</span><span class="main">.</span> boundedBy <span class="free">m</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="bound">Gamma</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">Gamma</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI allI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedBy0<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="improper">Gamma</span><span class="main">)</span> <span class="main">∈</span> tree <span class="free">subs</span> <span class="improper">Gamma</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> tree0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">Gamma</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">sigma</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> boundedBySuc<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Tree-boundedTreeInduction2"><span class="command">lemma</span></span> boundedTreeInduction2<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="main">[|</span> fans <span class="free">subs</span><span class="main">;</span> boundedBy <span class="free">m</span> <span class="main">(</span>tree <span class="free">subs</span> <span class="free">Gamma</span><span class="main">)</span><span class="main">;</span>
          <span class="main">∀</span><span class="bound">delta</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">sigma</span> <span class="main">∈</span> <span class="free">subs</span> <span class="bound">delta</span><span class="main">.</span> <span class="free">P</span> <span class="bound">sigma</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="bound">delta</span> <span class="main">|]</span>
      <span class="main">==&gt;</span> <span class="free">P</span> <span class="free">Gamma</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule_tac</span> boundedTreeInduction2'<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Completeness">
<div class="head">
<h1>Theory Completeness</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Completeness"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Completeness
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Tree.html">Tree</a> <a href="Sequents.html">Sequents</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"pseq: type represents a processed sequent"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="quoted">"atom"</span>  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>signs <span class="main">*</span> predicate <span class="main">*</span> vbl list<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> nform <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">*</span> formula<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> pseq  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>atom list <span class="main">*</span> nform list<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">sequent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pseq <span class="main">=&gt;</span> formula list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sequent</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">atoms</span><span class="main">,</span><span class="bound">nforms</span><span class="main">)</span> <span class="main">.</span> map snd <span class="bound">nforms</span> <span class="main">@</span> map <span class="main">(</span><span class="main">%</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">p</span><span class="main">,</span><span class="bound">vs</span><span class="main">)</span> <span class="main">.</span> FAtom <span class="bound">z</span> <span class="bound">p</span> <span class="bound">vs</span><span class="main">)</span> <span class="bound">atoms</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">pseq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"formula list <span class="main">=&gt;</span> pseq"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pseq</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span>map <span class="main">(</span><span class="main">%</span><span class="bound">f</span><span class="main">.</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">atoms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pseq <span class="main">=&gt;</span> atom list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">atoms</span> <span class="main">=</span> fst"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nforms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pseq <span class="main">=&gt;</span> nform list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nforms</span> <span class="main">=</span> snd"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"subs: SATAxiom"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">SATAxiom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"formula list <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SATAxiom</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">?</span> <span class="bound">n</span> <span class="bound">vs</span> <span class="main">.</span> FAtom Pos <span class="bound">n</span> <span class="bound">vs</span> <span class="main">:</span> set <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">&amp;</span> FAtom Neg <span class="bound">n</span> <span class="bound">vs</span> <span class="main">:</span> set <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"subs: a CutFreePC justifiable backwards proof step"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">subsFAtom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>atom list<span class="main">,</span><span class="main">(</span>nat <span class="main">*</span> formula<span class="main">)</span> list<span class="main">,</span>signs<span class="main">,</span>predicate<span class="main">,</span>vbl list<span class="main">]</span> <span class="main">=&gt;</span> pseq set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subsFAtom</span> <span class="free"><span class="bound"><span class="entity">atms</span></span></span> <span class="free"><span class="bound"><span class="entity">nAs</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">atms</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">nAs</span></span></span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">subsFConj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>atom list<span class="main">,</span><span class="main">(</span>nat <span class="main">*</span> formula<span class="main">)</span> list<span class="main">,</span>signs<span class="main">,</span>formula<span class="main">,</span>formula<span class="main">]</span> <span class="main">=&gt;</span> pseq set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subsFConj</span> <span class="free"><span class="bound"><span class="entity">atms</span></span></span> <span class="free"><span class="bound"><span class="entity">nAs</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">A0</span></span></span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="keyword1">of</span>
      Pos <span class="main">=&gt;</span> <span class="main">{</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">atms</span></span></span><span class="main">,</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">A0</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">nAs</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">atms</span></span></span><span class="main">,</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">nAs</span></span></span><span class="main">)</span> <span class="main">}</span>
    <span class="main">|</span> Neg <span class="main">=&gt;</span> <span class="main">{</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">atms</span></span></span><span class="main">,</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">A0</span></span></span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">nAs</span></span></span><span class="main">)</span> <span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">subsFAll</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>atom list<span class="main">,</span><span class="main">(</span>nat <span class="main">*</span> formula<span class="main">)</span> list<span class="main">,</span>nat<span class="main">,</span>signs<span class="main">,</span>formula<span class="main">,</span>vbl set<span class="main">]</span> <span class="main">=&gt;</span> pseq set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subsFAll</span> <span class="free"><span class="bound"><span class="entity">atms</span></span></span> <span class="free"><span class="bound"><span class="entity">nAs</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">frees</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="keyword1">of</span>
      Pos <span class="main">=&gt;</span> <span class="main">{</span> <span class="keyword1">let</span> <span class="bound">v</span> <span class="main">=</span> freshVar <span class="free"><span class="bound"><span class="entity">frees</span></span></span> <span class="keyword1">in</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">atms</span></span></span><span class="main">,</span><span class="main">(</span><span class="main">0</span><span class="main">,</span>instanceF <span class="bound">v</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">nAs</span></span></span><span class="main">)</span> <span class="main">}</span>
    <span class="main">|</span> Neg <span class="main">=&gt;</span> <span class="main">{</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">atms</span></span></span><span class="main">,</span><span class="main">(</span><span class="main">0</span><span class="main">,</span>instanceF <span class="main">(</span>X <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">nAs</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span>FAll Neg <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">}</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">subs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pseq <span class="main">=&gt;</span> pseq set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subs</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span> <span class="bound">pseq</span> <span class="main">.</span>
             <span class="keyword1">if</span> SATAxiom <span class="main">(</span>sequent <span class="bound">pseq</span><span class="main">)</span> <span class="keyword1">then</span>
                 <span class="main">{}</span>
             <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">atms</span><span class="main">,</span><span class="bound">nforms</span><span class="main">)</span> <span class="main">=</span> <span class="bound">pseq</span>
                  <span class="keyword1">in</span>  <span class="keyword1">case</span> <span class="bound">nforms</span> <span class="keyword1">of</span>
                         <span class="main">[]</span>     <span class="main">=&gt;</span> <span class="main">{}</span>
                       <span class="main">|</span> <span class="bound">nA</span><span class="main">#</span><span class="bound">nAs</span> <span class="main">=&gt;</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="bound">nA</span>
                                   <span class="keyword1">in</span>  <span class="main">(</span><span class="keyword1">case</span> <span class="bound">A</span> <span class="keyword1">of</span>
                                            FAtom <span class="bound">z</span> <span class="bound">P</span> <span class="bound">vs</span>  <span class="main">=&gt;</span> subsFAtom <span class="bound">atms</span> <span class="bound">nAs</span> <span class="bound">z</span> <span class="bound">P</span> <span class="bound">vs</span>
                                          <span class="main">|</span> FConj <span class="bound">z</span> <span class="bound">A0</span> <span class="bound">A1</span> <span class="main">=&gt;</span> subsFConj <span class="bound">atms</span> <span class="bound">nAs</span> <span class="bound">z</span> <span class="bound">A0</span> <span class="bound">A1</span>
                                          <span class="main">|</span> FAll  <span class="bound">z</span> <span class="bound">A</span>     <span class="main">=&gt;</span> subsFAll  <span class="bound">atms</span> <span class="bound">nAs</span> <span class="bound">n</span> <span class="bound">z</span> <span class="bound">A</span> <span class="main">(</span>freeVarsFL <span class="main">(</span>sequent <span class="bound">pseq</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"proofTree(Gamma) says whether tree(Gamma) is a proof"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">proofTree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">*</span> pseq<span class="main">)</span> set <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">proofTree</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟷</span> bounded <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">&amp;</span> founded subs <span class="main">(</span>SATAxiom <span class="keyword1">o</span> sequent<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"path: considers, contains, costBarrier"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">considers</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat <span class="main">=&gt;</span> pseq<span class="main">,</span>nat <span class="main">*</span> formula<span class="main">,</span>nat<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">considers</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">nA</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>snd <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">=&gt;</span> False <span class="main">|</span> <span class="bound">x</span><span class="main">#</span><span class="bound">xs</span> <span class="main">=&gt;</span> <span class="bound">x</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">nA</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted">"<span class="entity">contains</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat <span class="main">=&gt;</span> pseq<span class="main">,</span>nat <span class="main">*</span> formula<span class="main">,</span>nat<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">contains</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">nA</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">nA</span></span></span> <span class="main">:</span> set <span class="main">(</span>snd <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">costBarrier</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat <span class="main">*</span> formula<span class="main">,</span>pseq<span class="main">]</span> <span class="main">=&gt;</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="comment1">(******
     costBarrier justifies: eventually contains ==&gt; eventually considers
     with a termination thm, (barrier strictly decreases in |N).
     ******)</span>
  <span class="quoted"><span class="quoted">"<span class="free">costBarrier</span> <span class="free"><span class="bound"><span class="entity">nA</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">atms</span><span class="main">,</span><span class="bound">nAs</span><span class="main">)</span><span class="main">.</span>
    <span class="keyword1">let</span> <span class="bound">barrier</span> <span class="main">=</span> takeWhile <span class="main">(</span><span class="main">%</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">nA</span></span></span> <span class="main">~=</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">nAs</span>
    <span class="keyword1">in</span>  <span class="keyword1">let</span> <span class="bound">costs</span> <span class="main">=</span> map <span class="main">(</span>exp <span class="numeral">3</span> <span class="keyword1">o</span> size <span class="keyword1">o</span> snd<span class="main">)</span> <span class="bound">barrier</span>
    <span class="keyword1">in</span>  sumList <span class="bound">costs</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"path: eventually"</span></span>

<span class="comment1">(******
 Could do this with composable temporal operators, but following paper proof first.
 ******)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">EV</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat <span class="main">=&gt;</span> bool<span class="main">]</span> <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">EV</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">==</span> <span class="main">(</span><span class="main">?</span> <span class="bound">n</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span>"</span></span>
        <span class="comment1">(****** 
         This allows blast_tac like searching to be done without hassle
         of removing exists rules. (hopefully).
         ******)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"path: counter model"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">counterM</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">=&gt;</span> pseq<span class="main">)</span> <span class="main">=&gt;</span> object set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">counterM</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> range obj"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">counterEvalP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">=&gt;</span> pseq<span class="main">)</span> <span class="main">=&gt;</span> predicate <span class="main">=&gt;</span> object list <span class="main">=&gt;</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">counterEvalP</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">p</span> <span class="bound">args</span> <span class="main">.</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">.</span> <span class="main">~</span><span class="main">(</span>EV <span class="main">(</span>contains <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span>FAtom Pos <span class="bound">p</span> <span class="main">(</span>map <span class="main">(</span>X <span class="keyword1">o</span> inv obj<span class="main">)</span> <span class="bound">args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">counterModel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">=&gt;</span> pseq<span class="main">)</span> <span class="main">=&gt;</span> model"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">counterModel</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> Abs_model <span class="main">(</span>counterM <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> counterEvalP <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">counterAssign</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vbl <span class="main">=&gt;</span> object"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">counterAssign</span> <span class="main">(</span>X <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> obj <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>  <span class="comment1">(* just deX *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"subs: finite"</span></span>
  
<span class="keyword1" id="Completeness-finite_subs"><span class="command">lemma</span></span> finite_subs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>subs <span class="free">gamma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def subsFAtom_def subsFConj_def subsFAll_def Let_def split_beta <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits list.split formula.split signs.split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-fansSubs"><span class="command">lemma</span></span> fansSubs<span class="main">:</span> <span class="quoted"><span class="quoted">"fans subs"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> fansI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_subs<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-subs_def2"><span class="command">lemma</span></span> subs_def2<span class="main">:</span>  
<span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">gamma</span><span class="main">.</span>
   <span class="main">~</span> SATAxiom <span class="main">(</span>sequent <span class="bound">gamma</span><span class="main">)</span> <span class="main">==&gt;</span> 
   subs <span class="bound">gamma</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> nforms <span class="bound">gamma</span> <span class="keyword1">of</span> 
                     <span class="main">[]</span>     <span class="main">=&gt;</span> <span class="main">{}</span> 
                   <span class="main">|</span> <span class="bound">nA</span><span class="main">#</span><span class="bound">nAs</span> <span class="main">=&gt;</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">n</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="bound">nA</span> 
                               <span class="keyword1">in</span>  <span class="main">(</span><span class="keyword1">case</span> <span class="bound">A</span> <span class="keyword1">of</span> 
                                        FAtom <span class="bound">z</span> <span class="bound">P</span> <span class="bound">vs</span>  <span class="main">=&gt;</span> subsFAtom <span class="main">(</span>atoms <span class="bound">gamma</span><span class="main">)</span> <span class="bound">nAs</span> <span class="bound">z</span> <span class="bound">P</span> <span class="bound">vs</span> 
                                      <span class="main">|</span> FConj <span class="bound">z</span> <span class="bound">A0</span> <span class="bound">A1</span> <span class="main">=&gt;</span> subsFConj <span class="main">(</span>atoms <span class="bound">gamma</span><span class="main">)</span> <span class="bound">nAs</span> <span class="bound">z</span> <span class="bound">A0</span> <span class="bound">A1</span> 
                                      <span class="main">|</span> FAll  <span class="bound">z</span> <span class="bound">A</span>     <span class="main">=&gt;</span> subsFAll  <span class="main">(</span>atoms <span class="bound">gamma</span><span class="main">)</span> <span class="bound">nAs</span> <span class="bound">n</span> <span class="bound">z</span> <span class="bound">A</span> <span class="main">(</span>freeVarsFL <span class="main">(</span>sequent <span class="bound">gamma</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def Let_def nforms_def atoms_def split_beta <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"inherited: proofTree"</span></span>

<span class="keyword1" id="Completeness-proofTree_def2"><span class="command">lemma</span></span> proofTree_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"proofTree <span class="main">=</span> <span class="main">(</span> <span class="main">%</span> <span class="bound">x</span> <span class="main">.</span> bounded <span class="bound">x</span> <span class="main">&amp;</span> founded subs <span class="main">(</span>SATAxiom <span class="keyword1">o</span> sequent<span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proofTree_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-inheritedProofTree"><span class="command">lemma</span></span> inheritedProofTree<span class="main">:</span> <span class="quoted"><span class="quoted">"inherited subs proofTree"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proofTree_def2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inheritedJoinI inheritedBounded inheritedFounded<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-proofTreeI"><span class="command">lemma</span></span> proofTreeI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> bounded <span class="free">A</span><span class="main">;</span> founded subs <span class="main">(</span>SATAxiom <span class="keyword1">o</span> sequent<span class="main">)</span> <span class="free">A</span> <span class="main">|]</span> <span class="main">==&gt;</span> proofTree <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proofTree_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-proofTreeBounded"><span class="command">lemma</span></span> proofTreeBounded<span class="main">:</span> <span class="quoted"><span class="quoted">"proofTree <span class="free">A</span> <span class="main">==&gt;</span> bounded <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proofTree_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-proofTreeTerminal"><span class="command">lemma</span></span> proofTreeTerminal<span class="main">:</span> <span class="quoted"><span class="quoted">"proofTree <span class="free">A</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">delta</span><span class="main">)</span> <span class="main">:</span> <span class="free">A</span> <span class="main">==&gt;</span> terminal subs <span class="free">delta</span> <span class="main">==&gt;</span> SATAxiom <span class="main">(</span>sequent <span class="free">delta</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proofTree_def founded_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"pseq: lemma"</span></span>

<span class="keyword1" id="Completeness-snd_o_Pair"><span class="command">lemma</span></span> snd_o_Pair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="keyword1">o</span> <span class="main">(</span>Pair <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Completeness-sequent_pseq"><span class="command">lemma</span></span> sequent_pseq<span class="main">:</span> <span class="quoted"><span class="quoted">"sequent <span class="main">(</span>pseq <span class="free">fs</span><span class="main">)</span> <span class="main">=</span> <span class="free">fs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pseq_def sequent_def snd_o_Pair<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"SATAxiom: proofTree"</span></span>
    
<span class="keyword1" id="Completeness-SATAxiomTerminal"><span class="command">lemma</span></span> SATAxiomTerminal<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SATAxiom <span class="main">(</span>sequent <span class="free">gamma</span><span class="main">)</span> <span class="main">--&gt;</span> terminal subs <span class="free">gamma</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def proofTree_def terminal_def founded_def bounded_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-SATAxiomBounded"><span class="command">lemma</span></span> SATAxiomBounded<span class="main">:</span><span class="quoted"><span class="quoted">"SATAxiom <span class="main">(</span>sequent <span class="free">gamma</span><span class="main">)</span> <span class="main">==&gt;</span> bounded <span class="main">(</span>tree subs <span class="free">gamma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> SATAxiomTerminal<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> treeEquation<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def proofTree_def terminal_def founded_def bounded_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> boundedByInsert boundedByEmpty<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-SATAxiomFounded"><span class="command">lemma</span></span> SATAxiomFounded<span class="main">:</span> <span class="quoted"><span class="quoted">"SATAxiom <span class="main">(</span>sequent <span class="free">gamma</span><span class="main">)</span> <span class="main">==&gt;</span> founded subs <span class="main">(</span>SATAxiom <span class="keyword1">o</span> sequent<span class="main">)</span> <span class="main">(</span>tree subs <span class="free">gamma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> SATAxiomTerminal<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> treeEquation<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def proofTree_def terminal_def founded_def bounded_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-SATAxiomProofTree"><span class="command">lemma</span></span> SATAxiomProofTree<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SATAxiom <span class="main">(</span>sequent <span class="free">gamma</span><span class="main">)</span> <span class="main">--&gt;</span> proofTree <span class="main">(</span>tree subs <span class="free">gamma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> proofTreeI SATAxiomBounded SATAxiomFounded<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-SATAxiomEq"><span class="command">lemma</span></span> SATAxiomEq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>proofTree <span class="main">(</span>tree subs <span class="free">gamma</span><span class="main">)</span> <span class="main">&amp;</span> terminal subs <span class="free">gamma</span><span class="main">)</span> <span class="main">=</span> SATAxiom <span class="main">(</span>sequent <span class="free">gamma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SATAxiomProofTree proofTreeTerminal tree.tree0  SATAxiomTerminal<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="comment1">― ‹FIXME tjr blast sensitive to obj imp vs meta imp for pTT›</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"SATAxioms are deductions: - needed"</span></span>

<span class="keyword1" id="Completeness-SAT_deduction"><span class="command">lemma</span></span> SAT_deduction<span class="main">:</span> <span class="quoted"><span class="quoted">"SATAxiom <span class="free">x</span> <span class="main">==&gt;</span> <span class="free">x</span> <span class="main">:</span> deductions CutFreePC"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SATAxiom_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>FAtom Pos <span class="improper">n</span> <span class="improper">vs</span><span class="main">,</span>FAtom Neg <span class="improper">n</span> <span class="improper">vs</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> inDed_mono<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SATAxiomI rulesInPCs<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"proofTrees are deductions: subs respects rules - messy start and end"</span></span>

<span class="keyword1" id="Completeness-subsJustified'"><span class="command">lemma</span></span> subsJustified'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">notes</span></span> ss <span class="main">=</span> subs_def2 nforms_def Let_def atoms_def sequent_def subsFAtom_def subsFConj_def subsFAll_def
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> SATAxiom <span class="main">(</span>sequent <span class="main">(</span><span class="free">ats</span><span class="main">,</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">f</span><span class="main">)</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="main">¬</span> terminal subs <span class="main">(</span><span class="free">ats</span><span class="main">,</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">f</span><span class="main">)</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span> 
  <span class="main">--&gt;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">sigma</span><span class="main">∈</span>subs <span class="main">(</span><span class="free">ats</span><span class="main">,</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">f</span><span class="main">)</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span><span class="main">.</span> sequent <span class="bound">sigma</span> <span class="main">∈</span> deductions CutFreePC<span class="main">)</span> 
  <span class="main">--&gt;</span> sequent <span class="main">(</span><span class="free">ats</span><span class="main">,</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span> <span class="free">f</span><span class="main">)</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span> <span class="main">∈</span> deductions CutFreePC"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> formula_signs_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> PermI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> perm_append_Cons<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rulesInPCs<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> PermI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> perm_append_Cons<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rulesInPCs<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ConjI'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rulesInPCs<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> DisjI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rulesInPCs<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> AllI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finiteFreshVar<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finite_freeVarsFL<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rulesInPCs<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ContrI<span class="main">)</span> <span class="comment1">― ‹!›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> w <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"X <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ExI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inDed_mono<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rulesInPCs<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-subsJustified"><span class="command">lemma</span></span> subsJustified<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span> <span class="bound">gamma</span><span class="main">.</span> <span class="main">~</span> terminal subs <span class="bound">gamma</span>
  <span class="main">==&gt;</span> <span class="main">!</span> <span class="bound">sigma</span> <span class="main">:</span> subs <span class="bound">gamma</span> <span class="main">.</span> sequent <span class="bound">sigma</span> <span class="main">:</span> deductions <span class="main">(</span>CutFreePC<span class="main">)</span>
  <span class="main">==&gt;</span> sequent <span class="bound">gamma</span> <span class="main">:</span> deductions <span class="main">(</span>CutFreePC<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"SATAxiom <span class="main">(</span>sequent <span class="improper">gamma</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> SAT_deduction<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">gamma</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> ats nfs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">nfs</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> terminal_def subs_def sequent_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subsJustified'<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"proofTrees are deductions: instance of boundedTreeInduction"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> proofTreeD <span class="main">=</span> proofTree_def <span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">]</span>

<span class="keyword1" id="Completeness-proofTreeDeductionD"><span class="command">lemma</span></span> proofTreeDeductionD<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"proofTree<span class="main">(</span>tree subs <span class="free">gamma</span><span class="main">)</span> <span class="main">⟹</span> sequent <span class="free">gamma</span> <span class="main">:</span> deductions <span class="main">(</span>CutFreePC<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> boundedTreeInduction<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fansSubs<span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> proofTreeBounded<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> foundedMono<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> proofTreeD<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> SAT_deduction foundedMono subsJustified<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>  subsJustified<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"contains, considers:"</span></span>

<span class="keyword1" id="Completeness-contains_def2"><span class="command">lemma</span></span> contains_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"contains <span class="free">f</span> <span class="free">iA</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">iA</span> <span class="main">:</span> set <span class="main">(</span>nforms <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def nforms_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-considers_def2"><span class="command">lemma</span></span> considers_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"considers <span class="free">f</span> <span class="free">iA</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span> <span class="main">?</span> <span class="bound">nAs</span> <span class="main">.</span> nforms <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">iA</span><span class="main">#</span><span class="bound">nAs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> considers_def nforms_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.split<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> containsI <span class="main">=</span> contains_def2<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">]</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"path: nforms = [] implies"</span></span>

<span class="keyword1" id="Completeness-nformsNoContains"><span class="command">lemma</span></span> nformsNoContains<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> branch subs <span class="free">gamma</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span>proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> nforms <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>  <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">~</span> contains <span class="free">f</span> <span class="free">iA</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="comment1">― ‹FIXME tjr assumptions not required›</span>

<span class="keyword1" id="Completeness-nformsTerminal"><span class="command">lemma</span></span> nformsTerminal<span class="main">:</span> <span class="quoted"><span class="quoted">"nforms <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">==&gt;</span> terminal subs <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def Let_def terminal_def nforms_def split_beta<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-nformsStops"><span class="command">lemma</span></span> nformsStops<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">f</span><span class="main">.</span>
  <span class="main">[|</span> branch subs <span class="free">gamma</span> <span class="bound">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span>proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="bound">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     nforms <span class="main">(</span><span class="bound">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> nforms <span class="main">(</span><span class="bound">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">&amp;</span> atoms <span class="main">(</span><span class="bound">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> atoms <span class="main">(</span><span class="bound">f</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="improper">f</span> <span class="free">n</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> branchStops nformsTerminal<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"path: cases"</span></span>

<span class="keyword1" id="Completeness-terminalNFormCases"><span class="command">lemma</span></span> terminalNFormCases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">f</span><span class="main">.</span> terminal subs <span class="main">(</span><span class="bound">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span><span class="main">?</span> <span class="bound">i</span> <span class="bound">A</span> <span class="bound">nAs</span> <span class="main">.</span> nforms <span class="main">(</span><span class="bound">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span><span class="main">#</span><span class="bound">nAs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjCI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nformsTerminal<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"nforms <span class="main">(</span><span class="improper">f</span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-cases"><span class="command">lemma</span></span> cases<span class="main">[</span><span class="operator">elim_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"terminal subs <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span>terminal subs <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">?</span> <span class="bound">i</span> <span class="bound">A</span> <span class="bound">nAs</span> <span class="main">.</span> nforms <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">A</span><span class="main">)</span><span class="main">#</span><span class="bound">nAs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> terminalNFormCases<span class="main"><span class="main">[</span></span><span class="operator">elim_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"path: contains not terminal and propagate condition"</span></span>
    
<span class="keyword1" id="Completeness-containsNotTerminal"><span class="command">lemma</span></span> containsNotTerminal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> branch subs <span class="free">gamma</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span>proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> contains <span class="free">f</span> <span class="free">iA</span> <span class="free">n</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">~</span> <span class="main">(</span>terminal subs <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"SATAxiom <span class="main">(</span>sequent <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> SATAxiomEq<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  subs_def subs_def subsFAtom_def subsFConj_def subsFAll_def Let_def contains_def terminal_def nforms_def split_beta branch_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.split signs.split expand_case_formula<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-containsPropagates"><span class="command">lemma</span></span> containsPropagates<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">f</span><span class="main">.</span>
  <span class="main">[|</span> branch subs <span class="free">gamma</span> <span class="bound">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span>proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="bound">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     contains <span class="bound">f</span> <span class="free">iA</span> <span class="free">n</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> contains <span class="bound">f</span> <span class="free">iA</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">|</span> considers <span class="bound">f</span> <span class="free">iA</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> containsNotTerminal<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> branchSubs<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"considers <span class="improper">f</span> <span class="free">iA</span> <span class="free">n</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">f</span> <span class="free">n</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> split_list<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ys</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> considers_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"SATAxiom <span class="main">(</span>sequent <span class="main">(</span><span class="improper">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> iffD2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> SATAxiomEq<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def2 nforms_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">aa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ba</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsFAtom_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> signs a b<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">signs</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsFConj_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsFConj_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> signs a<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">signs</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsFAll_def Let_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsFAll_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"path: no consider lemmas"</span></span>

<span class="keyword1" id="Completeness-noConsidersD"><span class="command">lemma</span></span> noConsidersD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">f</span><span class="main">.</span> <span class="main">~</span>considers <span class="bound">f</span> <span class="free">iA</span> <span class="free">n</span> <span class="main">==&gt;</span> nforms <span class="main">(</span><span class="bound">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">#</span><span class="free">xs</span> <span class="main">==&gt;</span> <span class="free">iA</span> <span class="main">~=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> considers_def2<span class="main">)</span>

<span class="keyword1" id="Completeness-considersD"><span class="command">lemma</span></span> considersD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">f</span><span class="main">.</span> considers <span class="bound">f</span> <span class="free">iA</span> <span class="free">n</span> <span class="main">==&gt;</span> <span class="main">?</span> <span class="bound">xs</span> <span class="main">.</span> nforms <span class="main">(</span><span class="bound">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">iA</span><span class="main">#</span><span class="bound">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> considers_def2<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"path: contains initially"</span></span>

<span class="keyword1" id="Completeness-contains_initially"><span class="command">lemma</span></span> contains_initially<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"branch subs <span class="main">(</span>pseq <span class="free">gamma</span><span class="main">)</span> <span class="free">f</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">:</span> set <span class="free">gamma</span> <span class="main">⟹</span> <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> branch0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def pseq_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-contains_initialEVs"><span class="command">lemma</span></span> contains_initialEVs<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"branch subs <span class="main">(</span>pseq <span class="free">gamma</span><span class="main">)</span> <span class="free">f</span> <span class="main">⟹</span>  <span class="free">A</span> <span class="main">:</span> set <span class="free">gamma</span> <span class="main">⟹</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> EV_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> contains_initially<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"termination: (for EV contains implies EV considers)"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> r <span class="main">=</span> wf_induct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"measure <span class="free">msrFn</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> wf_measure<span class="main">]</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">msrFn</span>
<span class="keyword1"><span class="command">lemmas</span></span> r' <span class="main">=</span> r<span class="main">[</span><span class="operator">simplified</span> measure_def inv_image_def less_than_def less_eq mem_Collect_eq<span class="main">]</span>

<span class="keyword1" id="Completeness-r''"><span class="command">lemma</span></span> r''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span><span class="free">msrFn</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> nat<span class="main">)</span> <span class="bound">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span><span class="free">msrFn</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat<span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> r' <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">P</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Completeness-terminationRule"><span class="command">lemma</span></span> terminationRule <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">!</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="main">~</span><span class="main">(</span><span class="free">P</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">&amp;</span> <span class="free">msrFn</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">msrFn</span><span class="main">::</span>nat <span class="main">=&gt;</span> nat<span class="main">)</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="free">P</span> <span class="free">m</span> <span class="main">--&gt;</span> <span class="main">(</span><span class="main">?</span> <span class="bound">n</span> <span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">&amp;</span> <span class="main">~</span><span class="main">(</span><span class="free">P</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?P</span> <span class="free">m</span>"</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> r''<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">msrFn</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="comment1">― ‹FIXME ugly›</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"costBarrier: lemmas"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"costBarrier: exp3 lemmas - bit specific..."</span></span>

<span class="keyword1" id="Completeness-exp3Min"><span class="command">lemma</span></span> exp3Min<span class="main">:</span> <span class="quoted"><span class="quoted">"exp <span class="numeral">3</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Completeness-exp1"><span class="command">lemma</span></span> exp1<span class="main">:</span> <span class="quoted"><span class="quoted">"exp <span class="numeral">3</span> <span class="main">(</span><span class="free">A</span><span class="main">)</span> <span class="main">+</span> exp <span class="numeral">3</span> <span class="main">(</span><span class="free">B</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>exp <span class="numeral">3</span> <span class="free">A</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp <span class="numeral">3</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> exp3Min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> exp3Min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"exp <span class="numeral">3</span> <span class="free">A</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp3Min<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"exp <span class="numeral">3</span> <span class="free">B</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp3Min<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-exp1'"><span class="command">lemma</span></span> exp1'<span class="main">:</span> <span class="quoted"><span class="quoted">"exp <span class="numeral">3</span> <span class="main">(</span><span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>exp <span class="numeral">3</span> <span class="free">A</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp <span class="numeral">3</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"exp <span class="numeral">3</span> <span class="main">(</span><span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>exp <span class="numeral">3</span> <span class="free">A</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp <span class="numeral">3</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"exp <span class="numeral">3</span> <span class="free">A</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> exp3Min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"exp <span class="numeral">3</span> <span class="free">B</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> exp3Min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-exp2"><span class="command">lemma</span></span> exp2<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="numeral">3</span> <span class="main">*</span> exp <span class="numeral">3</span> <span class="main">(</span><span class="free">B</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> exp3Min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-expSum"><span class="command">lemma</span></span> expSum<span class="main">:</span> <span class="quoted"><span class="quoted">"exp <span class="free">x</span> <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>exp <span class="free">x</span> <span class="free">a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>exp <span class="free">x</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"costBarrier: decreases whilst contains and unconsiders"</span></span>

<span class="keyword1" id="Completeness-costBarrierDecreases'"><span class="command">lemma</span></span> costBarrierDecreases'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">notes</span></span> ss <span class="main">=</span> subs_def2 nforms_def Let_def subsFAtom_def subsFConj_def subsFAll_def costBarrier_def atoms_def exp3Min expSum
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span>SATAxiom <span class="main">(</span>sequent 
<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="main">(</span><span class="free">num</span><span class="main">,</span><span class="free">fm</span><span class="main">)</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">iA</span> <span class="main">~=</span> <span class="main">(</span><span class="free">num</span><span class="main">,</span> <span class="free">fm</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="main">¬</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="main">(</span><span class="free">num</span><span class="main">,</span> <span class="free">fm</span><span class="main">)</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">fSucn</span> <span class="main">:</span> subs <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="main">(</span><span class="free">num</span><span class="main">,</span> <span class="free">fm</span><span class="main">)</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">iA</span> <span class="main">∈</span> set <span class="free">list</span> <span class="main">--&gt;</span> costBarrier <span class="free">iA</span> <span class="main">(</span><span class="free">fSucn</span><span class="main">)</span> <span class="main">&lt;</span> costBarrier <span class="free">iA</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="main">(</span><span class="free">num</span><span class="main">,</span> <span class="free">fm</span><span class="main">)</span> <span class="main">#</span> <span class="free">list</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">fm</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> formula_signs_cases<span class="main">)</span>
    <span class="comment1">― ‹atoms›</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss<span class="main">)</span>
        <span class="comment1">― ‹conj›</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss exp2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss exp2<span class="main">)</span>
    <span class="comment1">― ‹disj›</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss exp1 exp1'<span class="main">)</span>
    <span class="comment1">― ‹all›</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss size_instance<span class="main">)</span>
  <span class="comment1">― ‹ex›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss size_instance<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-costBarrierDecreases"><span class="command">lemma</span></span> costBarrierDecreases<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> branch subs <span class="free">gamma</span> <span class="free">f</span><span class="main">;</span>
  <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span>proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  contains <span class="free">f</span> <span class="free">iA</span> <span class="free">n</span><span class="main">;</span>
  <span class="main">~</span><span class="main">(</span>considers <span class="free">f</span> <span class="free">iA</span><span class="main">)</span> <span class="free">n</span>
  <span class="main">|]</span> <span class="main">==&gt;</span> costBarrier <span class="free">iA</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> costBarrier <span class="free">iA</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> terminal subs <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> SATAxiom <span class="main">(</span>sequent <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> subs <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">aa</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> num fm<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def considers_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> costBarrierDecreases'<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> branchSubs<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> SATAxiomTerminal<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> containsNotTerminal<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="comment1">― ‹FIXME boring splitting etc.›</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"path: EV contains implies EV considers"</span></span>

<span class="keyword1" id="Completeness-considersContains"><span class="command">lemma</span></span> considersContains<span class="main">:</span> <span class="quoted"><span class="quoted">"considers <span class="free">f</span> <span class="free">iA</span> <span class="free">n</span> <span class="main">⟹</span> contains <span class="free">f</span> <span class="free">iA</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> considers_def contains_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-containsConsiders"><span class="command">lemma</span></span> containsConsiders<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> branch subs <span class="free">gamma</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     EV <span class="main">(</span>contains <span class="free">f</span> <span class="free">iA</span><span class="main">)</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> EV <span class="main">(</span>considers <span class="free">f</span> <span class="free">iA</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> EV_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"considers <span class="free">f</span> <span class="free">iA</span> <span class="improper">n</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>contains <span class="free">f</span> <span class="free">iA</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">¬</span> considers <span class="free">f</span> <span class="free">iA</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">¬</span> <span class="main">(</span>contains <span class="free">f</span> <span class="free">iA</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> considers <span class="free">f</span> <span class="free">iA</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"contains <span class="free">f</span> <span class="free">iA</span> <span class="main">(</span>Suc <span class="improper">na</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> containsPropagates<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> msrFn <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">n</span><span class="main">.</span> costBarrier <span class="free">iA</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">n</span><span class="main">.</span> contains <span class="free">f</span> <span class="free">iA</span> <span class="bound">n</span> <span class="main">&amp;</span> <span class="main">~</span> considers <span class="free">f</span> <span class="free">iA</span> <span class="bound">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> terminationRule<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>contains <span class="free">f</span> <span class="free">iA</span> <span class="main">(</span>Suc <span class="improper">na</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> considers <span class="free">f</span> <span class="free">iA</span> <span class="main">(</span>Suc <span class="improper">na</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> costBarrierDecreases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"EV contains: common lemma"</span></span>

<span class="keyword1" id="Completeness-lemmA"><span class="command">lemma</span></span> lemmA<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> branch subs <span class="free">gamma</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span> <span class="bound">n</span><span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">|]</span>
 <span class="main">==&gt;</span> <span class="main">?</span> <span class="bound">n</span> <span class="bound">nAs</span><span class="main">.</span> <span class="main">~</span>SATAxiom <span class="main">(</span>sequent <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">(</span>nforms <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">#</span> <span class="bound">nAs</span> <span class="main">&amp;</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">:</span> subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> containsConsiders<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> EV_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">frule</span> considersContains<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> considers_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">f</span> <span class="improper">n</span><span class="main">)</span>"</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> SATAxiomEq<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">list</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nforms_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> containsNotTerminal<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> branchSubs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"EV contains: FConj,FDisj,FAll"</span></span>

<span class="keyword1" id="Completeness-EV_disj"><span class="command">lemma</span></span> EV_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>EV <span class="free">P</span> <span class="main">|</span> EV <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> EV <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">|</span> <span class="free">Q</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> EV_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-evContainsConj"><span class="command">lemma</span></span> evContainsConj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span>FConj Pos <span class="free">A0</span> <span class="free">A1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
  branch subs <span class="free">gamma</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
  <span class="main">|]</span> <span class="main">==&gt;</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">A0</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">A1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> lemmA<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"EV <span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">A0</span><span class="main">)</span> <span class="bound">n</span> <span class="main">|</span> contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">A1</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> EV_disj<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> EV_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> n n' nAs<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def2 Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsFConj_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def nforms_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-evContainsDisj"><span class="command">lemma</span></span> evContainsDisj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span>FConj Neg <span class="free">A0</span> <span class="free">A1</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
  branch subs <span class="free">gamma</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
  <span class="main">|]</span> <span class="main">==&gt;</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">A0</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">A1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> lemmA<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> EV_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def2 Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsFConj_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def nforms_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def2 Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsFConj_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def nforms_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="Completeness-evContainsAll"><span class="command">lemma</span></span> evContainsAll<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span>FAll Pos <span class="free">body</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> branch subs <span class="free">gamma</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
     <span class="main">|]</span>
   <span class="main">==&gt;</span> <span class="main">?</span> <span class="bound">v</span> <span class="main">.</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span>instanceF <span class="bound">v</span> <span class="free">body</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> lemmA<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"freshVar<span class="main">(</span>freeVarsFL <span class="main">(</span>sequent <span class="main">(</span><span class="free">f</span> <span class="improper">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> EV_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def2 Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsFAll_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def nforms_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="Completeness-evContainsEx_instance"><span class="command">lemma</span></span> evContainsEx_instance<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span>FAll Neg <span class="free">body</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> branch subs <span class="free">gamma</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
      <span class="main">|]</span>
  <span class="main">==&gt;</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span>instanceF <span class="main">(</span>X <span class="free">i</span><span class="main">)</span> <span class="free">body</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> lemmA<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> EV_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def2 Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsFAll_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def nforms_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-evContainsEx_repeat"><span class="command">lemma</span></span> evContainsEx_repeat<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">[|</span> branch subs <span class="free">gamma</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span>FAll Neg <span class="free">body</span><span class="main">)</span><span class="main">)</span> <span class="main">|]</span>
   <span class="main">==&gt;</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">,</span>FAll Neg <span class="free">body</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> lemmA<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> EV_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def2 Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsFAll_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def nforms_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"EV contains: lemmas (temporal related)"</span></span>

<span class="comment1">(******
 Should have abstracted to have temporal ops:
    EV   : (nat -&gt; bool) -&gt; nat -&gt; bool
    AW   : (nat -&gt; bool) -&gt; nat -&gt; bool
    NEXT : (nat -&gt; bool) -&gt; nat -&gt; bool
 then require:
    EV P and EV B imp (\n. A n &amp; B n)

 already think have done similar proofs to this one elsewhere,
 Q: where? share proofs?
 ******)</span>

<span class="keyword1" id="Completeness-lemma1"><span class="command">lemma</span></span> lemma1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">P</span> <span class="free">A</span> <span class="free">n</span> <span class="main">;</span> <span class="main">!</span><span class="bound">A</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">A</span> <span class="bound">n</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="bound">A</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">|]</span>
   <span class="main">==&gt;</span> <span class="free">P</span> <span class="free">A</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-lemma2"><span class="command">lemma</span></span> lemma2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">P</span> <span class="free">A</span> <span class="free">n</span> <span class="main">;</span> <span class="free">P</span> <span class="free">B</span> <span class="free">m</span> <span class="main">;</span> <span class="main">!</span> <span class="bound">A</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">A</span> <span class="bound">n</span> <span class="main">--&gt;</span> <span class="free">P</span> <span class="bound">A</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> <span class="main">?</span> <span class="bound">n</span> <span class="main">.</span> <span class="free">P</span> <span class="free">A</span> <span class="bound">n</span> <span class="main">&amp;</span> <span class="free">P</span> <span class="free">B</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span><span class="main"><span class="main">+</span></span><span class="free"><span class="free">m</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> lemma1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="main">[</span></span><span class="operator">OF</span> add.commute<span class="main"><span class="main">]</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> lemma1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"EV contains: FAtoms"</span></span>

<span class="keyword1" id="Completeness-notTerminalNotSATAxiom"><span class="command">lemma</span></span> notTerminalNotSATAxiom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> terminal subs <span class="free">gamma</span> <span class="main">⟹</span> <span class="main">¬</span> SATAxiom <span class="main">(</span>sequent <span class="free">gamma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_nn<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> SATAxiomTerminal<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-notTerminalNforms"><span class="command">lemma</span></span> notTerminalNforms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> terminal subs <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> nforms <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_nn<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> nformsTerminal<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="Completeness-atomsPropagate"><span class="command">lemma</span></span> atomsPropagate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> branch subs <span class="free">gamma</span> <span class="free">f</span> <span class="main">|]</span>
   <span class="main">==&gt;</span> <span class="free">x</span> <span class="main">:</span> set <span class="main">(</span>atoms <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">x</span> <span class="main">:</span> set <span class="main">(</span>atoms <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"terminal subs <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> branchStops<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> branchSubs<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> notTerminalNotSATAxiom<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> notTerminalNforms<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def2<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"nforms <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">ba</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsFAtom_def atoms_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsFConj_def atoms_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> signs a b<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">signs</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsFAll_def atoms_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> signs a<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">signs</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"EV contains: FEx cases"</span></span>

<span class="keyword1" id="Completeness-evContainsEx0_allRepeats"><span class="command">lemma</span></span> evContainsEx0_allRepeats<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> branch subs <span class="free">gamma</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span>FAll Neg <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span>FAll Neg <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> evContainsEx_repeat<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-evContainsEx0_allInstances"><span class="command">lemma</span></span> evContainsEx0_allInstances<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> branch subs <span class="free">gamma</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span>FAll Neg <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span>instanceF <span class="main">(</span>X <span class="free">i</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> evContainsEx0_allRepeats <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> evContainsEx_instance<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"pseq: creates initial pseq"</span></span>
    
<span class="keyword1" id="Completeness-containsPSeq0D"><span class="command">lemma</span></span> containsPSeq0D<span class="main">:</span> <span class="quoted"><span class="quoted">"branch subs <span class="main">(</span>pseq <span class="free">fs</span><span class="main">)</span> <span class="free">f</span> <span class="main">⟹</span> contains <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">i</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> branch0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pseq_def contains_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"EV contains: contain any (i,FEx y) means contain all (i,FEx y)"</span></span>
    
<span class="comment1">(******
 Now, show (Suc i,FEx v A) present means (i,FEx v A) present (or at start).
 Assumes initial pseq contains only (0,form) pairs.
 ------
 Show that only way of introducing a (Suc i,FEx_) was from (i,FEx_).
 contains n == considers n or contains n+.

 Want to find the point where it was introduced.
 Have, P true all n or fails at 0 or for a (first) successor.

     (!n. P n) | (~P 0) | (P n &amp; ~ P (Suc n))

 Instance this with P n = ~(contains ..FEx.. n).
 ******)</span>

<span class="keyword1" id="Completeness-claim"><span class="command">lemma</span></span> claim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">|</span> <span class="free">B</span> <span class="main">|</span> <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">~</span><span class="free">C</span> <span class="main">--&gt;</span> <span class="main">~</span><span class="free">B</span> <span class="main">--&gt;</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Completeness-natPredCases"><span class="command">lemma</span></span> natPredCases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">!</span><span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span><span class="main">~</span><span class="free">P</span> <span class="main">0</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span><span class="main">?</span> <span class="bound">n</span> <span class="main">.</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">&amp;</span> <span class="main">~</span> <span class="free">P</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> claim<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> impI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">n</span></span></span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-containsNotTerminal'"><span class="command">lemma</span></span> containsNotTerminal'<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> branch subs <span class="free">gamma</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span>proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> contains <span class="free">f</span> <span class="free">iA</span> <span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">~</span> <span class="main">(</span>terminal subs <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> containsNotTerminal<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-notTerminalSucNotTerminal"><span class="command">lemma</span></span> notTerminalSucNotTerminal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span> terminal subs <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> branch subs <span class="free">gamma</span> <span class="free">f</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span> terminal subs <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_nn<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> branchTerminalPropagates<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="comment1">― ‹FIXME move to Tree?›</span>

<span class="keyword1" id="Completeness-evContainsExSuc_containsEx"><span class="command">lemma</span></span> evContainsExSuc_containsEx<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> branch subs <span class="main">(</span>pseq <span class="free">fs</span><span class="main">)</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">,</span>FAll Neg <span class="free">body</span><span class="main">)</span><span class="main">)</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span>FAll Neg <span class="free">body</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cut_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">n</span><span class="main">.</span> <span class="main">~</span> contains <span class="free">f</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">,</span>FAll Neg <span class="free">body</span><span class="main">)</span> <span class="bound">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> natPredCases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> EV_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> containsPSeq0D<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"EV <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> EV_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> considersContains<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> containsNotTerminal'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> notTerminalSucNotTerminal<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> terminal <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> branchSubs<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> notTerminalNforms<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"SATAxiom <span class="main">(</span>sequent <span class="main">(</span><span class="free">f</span> <span class="improper">n</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> SATAxiomTerminal<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">i</span> <span class="bound">A</span> <span class="bound">nAs</span><span class="main">.</span> nforms <span class="main">(</span><span class="free">f</span> <span class="improper">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">A</span><span class="main">)</span> <span class="main">#</span> <span class="bound">nAs</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> cases<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"nforms <span class="main">(</span><span class="free">f</span> <span class="improper">n</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> considers_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nforms_def<span class="main">)</span>
  <span class="comment1">― ‹shift A into succedent›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">f</span> <span class="improper">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="improper">ia</span><span class="main">,</span> <span class="improper">A</span><span class="main">)</span> <span class="main">#</span> <span class="improper">nAs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_mp<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">f</span> <span class="improper">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="improper">ia</span><span class="main">,</span> <span class="improper">A</span><span class="main">)</span> <span class="main">#</span> <span class="improper">nAs</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> formula_signs_cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def2 nforms_def Let_def subsFAtom_def subsFConj_def subsFAll_def contains_def2 Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="comment1">― ‹phew, bit precarious, but not too much going on besides unfolding defns. and computing a bit. Need to set simps up›</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"EV contains: contain any (i,FEx y) means contain all (i,FEx y)"</span></span>

<span class="keyword1" id="Completeness-evContainsEx_containsEx0"><span class="command">lemma</span></span> evContainsEx_containsEx0<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> branch subs <span class="main">(</span>pseq <span class="free">fs</span><span class="main">)</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span>FAll Neg <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">--&gt;</span>
      EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span>FAll Neg <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> evContainsExSuc_containsEx<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-evContainsExval"><span class="command">lemma</span></span> evContainsExval<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span>FAll Neg <span class="free">body</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> branch subs <span class="main">(</span>pseq <span class="free">fs</span><span class="main">)</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
  <span class="main">|]</span> 
  <span class="main">==&gt;</span> <span class="main">!</span> <span class="bound">v</span> <span class="main">.</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span>instanceF <span class="bound">v</span> <span class="free">body</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">v</span></span></span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> evContainsEx0_allInstances <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> evContainsEx_containsEx0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"EV contains: atoms"</span></span>

<span class="keyword1" id="Completeness-atomsInSequentI"><span class="command">lemma</span></span> atomsInSequentI<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"  <span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">P</span><span class="main">,</span><span class="free">vs</span><span class="main">)</span> <span class="main">:</span> set <span class="main">(</span>fst <span class="free">ps</span><span class="main">)</span> <span class="main">--&gt;</span>
     FAtom <span class="free">z</span> <span class="free">P</span> <span class="free">vs</span> <span class="main">:</span> set <span class="main">(</span>sequent <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sequent_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ps</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="Completeness-evContainsAtom1"><span class="command">lemma</span></span> evContainsAtom1<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> branch subs <span class="main">(</span>pseq <span class="free">fs</span><span class="main">)</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
     EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span>FAtom <span class="free">z</span> <span class="free">P</span> <span class="free">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> <span class="main">?</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">P</span><span class="main">,</span><span class="free">vs</span><span class="main">)</span> <span class="main">:</span> set <span class="main">(</span>fst <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> lemmA<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Suc <span class="improper">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subs_def2 Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsFAtom_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">lemmas</span></span> atomsPropagate'' <span class="main">=</span> atomsPropagate<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> atomsPropagate' <span class="main">=</span> atomsPropagate''<span class="main">[</span><span class="operator">simplified</span> atoms_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Completeness-evContainsAtom"><span class="command">lemma</span></span> evContainsAtom<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> branch subs <span class="main">(</span>pseq <span class="free">fs</span><span class="main">)</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
   EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span>FAtom <span class="free">z</span> <span class="free">P</span> <span class="free">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> <span class="main">?</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="main">!</span> <span class="bound">m</span> <span class="main">.</span> FAtom <span class="free">z</span> <span class="free">P</span> <span class="free">vs</span> <span class="main">:</span> set <span class="main">(</span>sequent <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> evContainsAtom1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> atomsInSequentI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">m</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> atomsPropagate'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-notEvContainsBothAtoms"><span class="command">lemma</span></span> notEvContainsBothAtoms<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> branch subs <span class="main">(</span>pseq <span class="free">fs</span><span class="main">)</span> <span class="free">f</span><span class="main">;</span> <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">|]</span>
  <span class="main">==&gt;</span> <span class="main">~</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span>FAtom Pos <span class="free">p</span> <span class="free">vs</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span>
      <span class="main">~</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span>FAtom Neg <span class="free">p</span> <span class="free">vs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> evContainsAtom<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">j</span><span class="main">,</span> FAtom Neg <span class="free">p</span> <span class="free">vs</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> evContainsAtom<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span> FAtom Pos <span class="free">p</span> <span class="free">vs</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">na</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"SATAxiom <span class="main">(</span>sequent <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="improper">n</span><span class="main">+</span><span class="improper">na</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> SATAxiomProofTree<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SATAxiom_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"counterModel: lemmas"</span></span>
  
<span class="keyword1" id="Completeness-counterModelInRepn"><span class="command">lemma</span></span> counterModelInRepn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>counterM <span class="free">f</span><span class="main">,</span>counterEvalP <span class="free">f</span><span class="main">)</span> <span class="main">:</span> model"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> model_def counterM_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Abs_counterModel_inverse <span class="main">=</span> counterModelInRepn<span class="main">[</span><span class="operator">THEN</span> Abs_model_inverse<span class="main">]</span>

<span class="keyword1" id="Completeness-inv_obj_obj"><span class="command">lemma</span></span> inv_obj_obj<span class="main">:</span> <span class="quoted"><span class="quoted">"inv obj <span class="main">(</span>obj <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inj_obj <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-map_X_map_counterAssign"><span class="command">lemma</span></span> map_X_map_counterAssign<span class="main">:</span> <span class="quoted"><span class="quoted">"map X <span class="main">(</span>map <span class="main">(</span>inv obj<span class="main">)</span> <span class="main">(</span>map counterAssign <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>X <span class="main">∘</span> <span class="main">(</span>inv obj <span class="main">∘</span> counterAssign<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_obj_obj<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      
<span class="keyword1" id="Completeness-objectsCounterModel"><span class="command">lemma</span></span> objectsCounterModel<span class="main">:</span> <span class="quoted"><span class="quoted">"objects <span class="main">(</span>counterModel <span class="free">f</span><span class="main">)</span> <span class="main">=</span>  <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="main">?</span> <span class="bound">i</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> obj <span class="bound">i</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> objects_def counterModel_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_counterModel_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> counterM_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Completeness-inCounterM"><span class="command">lemma</span></span> inCounterM<span class="main">:</span> <span class="quoted"><span class="quoted">"counterAssign <span class="free">v</span> <span class="main">:</span> objects <span class="main">(</span>counterModel <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> objectsCounterModel<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Completeness-counterAssign_eqI"><span class="command">lemma</span></span> counterAssign_eqI<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">:</span> objects <span class="main">(</span>counterModel <span class="free">f</span><span class="main">)</span> <span class="main">--&gt;</span> <span class="free">z</span> <span class="main">=</span> X <span class="main">(</span>inv obj <span class="free">x</span><span class="main">)</span> <span class="main">--&gt;</span> counterAssign <span class="free">z</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> objectsCounterModel inj_obj<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-evalPCounterModel"><span class="command">lemma</span></span> evalPCounterModel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> counterModel <span class="free">f</span> <span class="main">==&gt;</span> evalP <span class="free">M</span> <span class="main">=</span> counterEvalP <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> evalP_def counterModel_def Abs_counterModel_inverse<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"counterModel: all path formula value false - step by step"</span></span>

<span class="keyword1" id="Completeness-path_evalF'"><span class="command">lemma</span></span> path_evalF'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">notes</span></span> ss <span class="main">=</span> evalPCounterModel counterEvalP_def map_X_map_counterAssign map_map<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> ss1 <span class="main">=</span> instanceF_def evalF_subF_eq comp_vblcase id_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> branch subs <span class="main">(</span>pseq <span class="free">fs</span><span class="main">)</span> <span class="free">f</span><span class="main">;</span> 
  <span class="main">!</span><span class="bound">n</span> <span class="main">.</span> <span class="main">~</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
  <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="main">?</span> <span class="bound">i</span> <span class="main">.</span> EV <span class="main">(</span>contains <span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">~</span><span class="main">(</span>evalF <span class="main">(</span>counterModel <span class="free">f</span><span class="main">)</span> counterAssign <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> strong_formula_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> formula_signs_cases<span class="main">)</span>
       <span class="comment1">― ‹atom›</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> map_map<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> map_map<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> notEvContainsBothAtoms<span class="main">)</span>
     <span class="comment1">― ‹conj›</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> evContainsConj<span class="main">)</span>
     <span class="comment1">― ‹disj›</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> evContainsDisj<span class="main">)</span>
   <span class="comment1">― ‹all›</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> evContainsAll<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>instanceF <span class="improper">v</span> <span class="improper">f1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> size_instance<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss1<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"counterAssign <span class="improper">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inCounterM<span class="main">)</span> 
  <span class="comment1">― ‹ex›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> evContainsExval<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> objectsCounterModel<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"X <span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>instanceF <span class="main">(</span>X <span class="improper">i</span><span class="main">)</span> <span class="improper">f1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> size_instance<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ss1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1"><span class="command">lemmas</span></span> path_evalF'' <span class="main">=</span> mp<span class="main">[</span><span class="operator">OF</span> path_evalF'<span class="main">]</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"adequacy"</span></span>

<span class="keyword1" id="Completeness-counterAssignModelAssign"><span class="command">lemma</span></span> counterAssignModelAssign<span class="main">:</span> <span class="quoted"><span class="quoted">"counterAssign <span class="main">:</span> modelAssigns <span class="main">(</span>counterModel <span class="free">gamma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> modelAssigns_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rangeE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inCounterM<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-branch_contains_initially"><span class="command">lemma</span></span> branch_contains_initially<span class="main">:</span> <span class="quoted"><span class="quoted">"branch subs <span class="main">(</span>pseq <span class="free">fs</span><span class="main">)</span> <span class="free">f</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">:</span> set <span class="free">fs</span> <span class="main">⟹</span> contains <span class="free">f</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contains_def branch0 pseq_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-path_evalF"><span class="command">lemma</span></span> path_evalF<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> branch subs <span class="main">(</span>pseq <span class="free">fs</span><span class="main">)</span> <span class="free">f</span><span class="main">;</span>
  <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
  <span class="free">x</span> <span class="main">∈</span> set <span class="free">fs</span>
  <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">¬</span> evalF <span class="main">(</span>counterModel <span class="free">f</span><span class="main">)</span> counterAssign <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> path_evalF''<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> EV_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> branch_contains_initially<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-validProofTree"><span class="command">lemma</span></span> validProofTree<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span>proofTree <span class="main">(</span>tree subs <span class="main">(</span>pseq <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">~</span><span class="main">(</span>validS <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> validS_def evalS_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> branch subs <span class="main">(</span>pseq <span class="free">fs</span><span class="main">)</span> <span class="bound">f</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> proofTree <span class="main">(</span>tree subs <span class="main">(</span><span class="bound">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"counterModel <span class="improper">f</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">counterAssign</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> path_evalF<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> counterAssignModelAssign<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> failingBranchExistence<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inheritedProofTree<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fansSubs<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Completeness-adequacy"><span class="command">lemma</span></span> adequacy<span class="main">[</span><span class="operator">simplified</span> sequent_pseq<span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"validS <span class="free">fs</span> <span class="main">==&gt;</span> <span class="main">(</span>sequent <span class="main">(</span>pseq <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> deductions CutFreePC"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> proofTreeDeductionD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> validProofTree<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Soundness">
<div class="head">
<h1>Theory Soundness</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Soundness"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Soundness <span class="keyword2"><span class="keyword">imports</span></span> <a href="Completeness.html">Completeness</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Soundness-permutation_validS"><span class="command">lemma</span></span> permutation_validS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">&lt;~~&gt;</span> <span class="free">gs</span> <span class="main">--&gt;</span> <span class="main">(</span>validS <span class="free">fs</span> <span class="main">=</span> validS <span class="free">gs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> validS_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> evalS_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perm_set_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Soundness-modelAssigns_vblcase"><span class="command">lemma</span></span> modelAssigns_vblcase<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="main">∈</span> modelAssigns <span class="free">M</span> <span class="main">⟹</span>  <span class="free">x</span> <span class="main">∈</span> objects <span class="free">M</span> <span class="main">⟹</span> vblcase <span class="free">x</span> <span class="free">phi</span> <span class="main">∈</span> modelAssigns <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> modelAssigns_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> rangeE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">xaa</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vbl_casesE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Soundness-tmp"><span class="command">lemma</span></span> tmp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">!</span><span class="bound">x</span> <span class="main">:</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">|</span> <span class="free">Q</span><span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="main">!</span> <span class="bound">x</span> <span class="main">:</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span> <span class="free">Q</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Soundness-soundnessFAll"><span class="command">lemma</span></span> soundnessFAll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">Gamma</span><span class="main">.</span>
  <span class="main">[|</span> <span class="free">u</span> <span class="main">~:</span> freeVarsFL <span class="main">(</span>FAll Pos <span class="free">A</span> <span class="main">#</span> <span class="bound">Gamma</span><span class="main">)</span><span class="main">;</span> 
  validS <span class="main">(</span>instanceF <span class="free">u</span> <span class="free">A</span> <span class="main">#</span> <span class="bound">Gamma</span><span class="main">)</span> <span class="main">|]</span> 
  <span class="main">==&gt;</span> validS <span class="main">(</span>FAll Pos <span class="free">A</span> <span class="main">#</span> <span class="bound">Gamma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> validS_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">M</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> evalF_instance<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tmp<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">%</span> <span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">u</span> <span class="keyword1">then</span> <span class="improper">x</span> <span class="keyword1">else</span> <span class="improper">phi</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> modelAssigns_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"evalF <span class="improper">M</span> <span class="main">(</span>vblcase <span class="improper">x</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">u</span> <span class="keyword1">then</span> <span class="improper">x</span> <span class="keyword1">else</span> <span class="improper">phi</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> evalF <span class="improper">M</span> <span class="main">(</span>vblcase <span class="improper">x</span> <span class="improper">phi</span><span class="main">)</span> <span class="free">A</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> evalF_equiv<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> equalOn_vblcaseI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> freeVarsFL_cons<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalOnI<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"evalS <span class="improper">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">u</span> <span class="keyword1">then</span> <span class="improper">x</span> <span class="keyword1">else</span> <span class="improper">phi</span> <span class="bound">y</span><span class="main">)</span> <span class="improper">Gamma</span> <span class="main">=</span> evalS <span class="improper">M</span> <span class="improper">phi</span> <span class="improper">Gamma</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> evalS_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> equalOnI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> freeVarsFL_cons<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Soundness-soundnessFEx"><span class="command">lemma</span></span> soundnessFEx<span class="main">:</span> <span class="quoted"><span class="quoted">"validS <span class="main">(</span>instanceF <span class="free">x</span> <span class="free">A</span> <span class="main">#</span> <span class="free">Gamma</span><span class="main">)</span> <span class="main">==&gt;</span> validS <span class="main">(</span>FAll Neg <span class="free">A</span> <span class="main">#</span> <span class="free">Gamma</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> validS_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> evalF_instance<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">M</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">phi</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">phi</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> modelAssignsD subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Soundness-soundnessFCut"><span class="command">lemma</span></span> soundnessFCut<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> validS <span class="main">(</span><span class="free">C</span> <span class="main">#</span> <span class="free">Gamma</span><span class="main">)</span><span class="main">;</span> validS <span class="main">(</span>FNot <span class="free">C</span> <span class="main">#</span> <span class="free">Delta</span><span class="main">)</span> <span class="main">|]</span> <span class="main">==&gt;</span> validS <span class="main">(</span><span class="free">Gamma</span> <span class="main">@</span> <span class="free">Delta</span><span class="main">)</span>"</span></span>
<span class="comment1">(*  apply(force simp: validS_def evalS_append evalS_cons evalF_FNot)*)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> validS_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">M</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">M</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">phi</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">phi</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bspec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> evalS_append evalF_FNot<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Soundness-soundness"><span class="command">lemma</span></span> soundness<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">:</span> deductions<span class="main">(</span>PC<span class="main">)</span> <span class="main">==&gt;</span> <span class="main">(</span>validS <span class="free">fs</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> deductions.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> PowD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">prems</span> <span class="main">⊆</span>  <span class="main">{</span><span class="bound">x</span><span class="main">.</span> validS <span class="bound">x</span><span class="main">}</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">prems</span> <span class="main">⊆</span> deductions PC <span class="main">∩</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> validS <span class="bound">x</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PC_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Perms_def permutation_validS<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Axioms_def validS_def evalS_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Conjs_def validS_def evalS_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Disjs_def validS_def evalS_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Alls_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> soundnessFAll<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Exs_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> soundnessFEx<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Weaks_def validS_def evalS_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Contrs_def validS_def evalS_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Cuts_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> soundnessFCut<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Soundness-completeness"><span class="command">lemma</span></span> completeness<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">:</span> deductions <span class="main">(</span>PC<span class="main">)</span> <span class="main">=</span> validS <span class="free">fs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> soundness<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">:</span> deductions CutFreePC"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subsetD<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> mono_deductions<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PC_def CutFreePC_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> adequacy<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>