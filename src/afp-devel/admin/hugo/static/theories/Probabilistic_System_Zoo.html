<div id="Bool_Bounded_Set">
<div class="head">
<h1>Theory Bool_Bounded_Set</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Sets with at Most 2 Elements›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Bool_Bounded_Set
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Cardinals/Cardinals.html">HOL-Cardinals.Cardinals</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="tfree">'a</span> bset <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">A</span> <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">.</span> <span class="main">|</span><span class="bound">A</span><span class="main">|</span> <span class="keyword1">≤o</span> ctwo<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">morphisms</span></span> set_bset Abs_bset
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_of_empty4 ctwo_def<span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_bset

<span class="keyword1"><span class="command">lift_definition</span></span> map_bset <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> bset <span class="main">⇒</span> <span class="tfree">'b</span> bset"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">image</span>
  <span class="keyword1"><span class="command">using</span></span> card_of_image ordLeq_transitive <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">rel_bset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> bset <span class="main">⇒</span> <span class="tfree">'b</span> bset <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">R</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"set_bset <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">rel_bset</span> <span class="free">R</span> <span class="main">(</span>map_bset fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>map_bset snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> bempty <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bset"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_of_empty4 ctwo_def<span class="main">)</span>
<span class="keyword1"><span class="command">lift_definition</span></span> bsingleton <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> bset"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ctwo_def<span class="main">)</span>
<span class="keyword1"><span class="command">lift_definition</span></span> bdoubleton <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> bset"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ctwo_def finite_card_of_iff_card2 card.insert_remove card_Diff_singleton_if<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_bset_bempty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map_bset <span class="free">f</span> bempty <span class="main">=</span> bempty"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> map_bset_eq_bempty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_bset <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> bempty <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> bempty"</span></span>
  <span class="quoted"><span class="quoted">"bempty <span class="main">=</span> map_bset <span class="free">f</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> bempty"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_bset_bsingleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map_bset <span class="free">f</span> <span class="main">(</span>bsingleton <span class="free">x</span><span class="main">)</span> <span class="main">=</span> bsingleton <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> map_bset_bdoubleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map_bset <span class="free">f</span> <span class="main">(</span>bdoubleton <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> bdoubleton <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> bdoubleton_same<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bdoubleton <span class="free">x</span> <span class="free">x</span> <span class="main">=</span> bsingleton <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> bempty_neq_bsingleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bempty <span class="main">≠</span> bsingleton <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"bsingleton <span class="free">x</span> <span class="main">≠</span> bempty"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bempty_neq_bdoubleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bempty <span class="main">≠</span> bdoubleton <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"bdoubleton <span class="free">x</span> <span class="free">y</span> <span class="main">≠</span> bempty"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bsinleton_eq_bdoubleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bsingleton <span class="free">x</span> <span class="main">=</span> bdoubleton <span class="free">y</span> <span class="free">z</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"bdoubleton <span class="free">y</span> <span class="free">z</span> <span class="main">=</span> bsingleton <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bsinleton_inj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bsingleton <span class="free">x</span> <span class="main">=</span> bsingleton <span class="free">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bdoubleton_eq_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bdoubleton <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> bdoubleton <span class="free">z</span> <span class="free">w</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">z</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="free">w</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="free">w</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> doubleton_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> bempty.rep_eq bsingleton.rep_eq bdoubleton.rep_eq

<span class="keyword1"><span class="command">lemma</span></span> bset_cases<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">X</span> <span class="main">=</span> bempty <span class="main">⟹</span> <span class="free">P</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">X</span> <span class="main">=</span> bsingleton <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">;</span> <span class="free">X</span> <span class="main">=</span> bdoubleton <span class="bound">x</span> <span class="bound">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">Z</span><span class="main">|</span> <span class="keyword1">≤o</span> ctwo"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_of_ordLeq_infinite ctwo_def finite_code<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">Z</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ctwo_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> finite_card_of_iff_card2<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">Z</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">;</span> <span class="skolem">Z</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">}</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">P</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">Z</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"card <span class="skolem">Z</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> Suc<span class="main">(</span>2-7<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">P</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_Suc_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">bnf</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'k</span> bset"</span></span>
  map<span class="main">:</span> <span class="quoted">map_bset</span>
  sets<span class="main">:</span> <span class="quoted">set_bset</span>
  bd<span class="main">:</span> <span class="quoted">natLeq</span>
  rel<span class="main">:</span> <span class="quoted">rel_bset</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 4 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 5 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_order_csum natLeq_card_order<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 6 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cinfinite_csum natLeq_cinfinite<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 7 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> ordLeq_transitive<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ordLess_imp_ordLeq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ctwo_ordLess_natLeq<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">R</span> <span class="skolem">S</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rel_bset.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> rel_bset.simps<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z1</span> <span class="skolem">z2</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"set_bset <span class="skolem">z1</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"set_bset <span class="skolem">z2</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="skolem">S</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"map_bset snd <span class="skolem">z1</span> <span class="main">=</span> map_bset fst <span class="skolem">z2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> map_bset fst <span class="skolem">z1</span> <span class="main">=</span> map_bset fst <span class="bound">x</span> <span class="main">∧</span> map_bset snd <span class="skolem">z2</span> <span class="main">=</span> map_bset snd <span class="bound">x</span> <span class="main">∧</span>
      set_bset <span class="bound">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="skolem">R</span> <span class="keyword1">OO</span> <span class="skolem">S</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">z1</span></span> <span class="quoted"><span class="skolem">z2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> bset_cases<span class="main"><span class="main">[</span></span><span class="operator">case_product</span> bset_cases<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"bsingleton <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main"><span class="main">]</span></span>
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> spec<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"bdoubleton <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">R</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rel_bset.intros <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_bset.cases<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="Finitely_Bounded_Set_Counterexample">
<div class="head">
<h1>Theory Finitely_Bounded_Set_Counterexample</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Sets Bounded by a Finite Cardinal $&gt;2$ Are Not BNFs›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Finitely_Bounded_Set_Counterexample
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Cardinals/Cardinals.html">HOL-Cardinals.Cardinals</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Do not import this theory. It contains an inconsistent axiomatization.
The point is to exhibit the particular inconsistency.›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bset <span class="main">(</span><span class="quoted">"_ <span class="keyword1">set[</span>_<span class="keyword1">]</span>"</span> <span class="main">[</span>22<span class="main">,</span> 21<span class="main">]</span> 21<span class="main">)</span> <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">A</span> <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">.</span> <span class="main">|</span><span class="bound">A</span><span class="main">|</span> <span class="keyword1">&lt;o</span> <span class="main">|</span>UNIV <span class="main">::</span> <span class="tfree">'k</span> set<span class="main">|</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">morphisms</span></span> set_bset Abs_bset
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_of_empty4 csum_def<span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_bset

<span class="keyword1"><span class="command">lift_definition</span></span> map_bset <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="keyword1">set[</span><span class="tfree">'k</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="keyword1">set[</span><span class="tfree">'k</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">image</span>
  <span class="keyword1"><span class="command">using</span></span> card_of_image ordLeq_ordLess_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">rel_bset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bset <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bset <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">R</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"set_bset <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">rel_bset</span> <span class="free">R</span> <span class="main">(</span>map_bset fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>map_bset snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We axiomatize the relator commutation property and show that we can deduce <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">False</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> from it.

We cannot do this with a locale, since we need the fully polymorphic version of the following axiom.
›</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  inconsistent<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_bset <span class="free">R1</span> <span class="keyword1">OO</span> rel_bset <span class="free">R2</span> <span class="main">≤</span> rel_bset <span class="main">(</span><span class="free">R1</span> <span class="keyword1">OO</span> <span class="free">R2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">bnf</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bset"</span></span>
  map<span class="main">:</span> <span class="quoted">map_bset</span>
  sets<span class="main">:</span> <span class="quoted">set_bset</span>
  bd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">|</span>UNIV <span class="main">::</span> <span class="tfree">'k</span> set<span class="main">|</span> <span class="keyword1">+c</span> natLeq"</span></span>
  rel<span class="main">:</span> <span class="quoted">rel_bset</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 4 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 5 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_order_csum natLeq_card_order<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 6 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cinfinite_csum natLeq_cinfinite<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 7 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> ordLeq_transitive<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ordLess_imp_ordLeq ordLeq_csum1<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 8 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inconsistent<span class="main">)</span> <span class="comment1">― ‹BAAAAAMMMM›</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 9 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rel_bset.intros <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_bset.cases<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> card_option_finite<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'k</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'k</span> option set<span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'k</span> set<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?L</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="var">?R</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?L</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span><span class="var">?L</span> <span class="main">-</span> <span class="main">{</span>None<span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card.remove<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="var">?L</span> <span class="main">-</span> <span class="main">{</span>None<span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="var">?R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_same_card<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">the</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def inj_on_def image_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"Some <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">x</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> <span class="quoted">enum</span><span class="main">)</span> x <span class="main">=</span> A <span class="main">|</span> B <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> option"</span></span> <span class="main">|</span> C

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Bs</span> <span class="main">≡</span> B <span class="main">`</span> <span class="main">(</span>insert None <span class="main">(</span>Some <span class="main">`</span> set Enum.enum<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> UNIV_x<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>UNIV <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> enum<span class="main">)</span> x set<span class="main">)</span> <span class="main">=</span> <span class="main">{</span>A<span class="main">,</span> C<span class="main">}</span> <span class="main">∪</span> Bs"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> x"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enum_UNIV<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> Collect_split_in_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> in_rel <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">=</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lift_definition</span></span> X <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> enum x<span class="main">,</span> <span class="tfree">'a</span> x<span class="main">)</span> bset"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"insert A Bs"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> finite_card_of_iff_card3<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card.insert_remove card_Diff_singleton_if<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> Y <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> enum x<span class="main">,</span> <span class="tfree">'a</span> x<span class="main">)</span> bset"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"insert C Bs"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> finite_card_of_iff_card3<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card.insert_remove card_Diff_singleton_if<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> Z <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> enum x<span class="main">,</span> <span class="tfree">'a</span> x<span class="main">)</span> bset"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>A<span class="main">,</span> C<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> finite_card_of_iff_card3<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card.insert_remove card_Diff_singleton_if<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> R <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> x <span class="main">×</span> <span class="tfree">'a</span> x<span class="main">,</span> <span class="tfree">'a</span> <span class="main">::</span> enum x<span class="main">)</span> bset"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>A<span class="main">,</span> A<span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">B</span><span class="main">,</span> C<span class="main">)</span><span class="main">)</span> <span class="main">`</span> Bs<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> finite_card_of_iff_card3<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card.insert_remove card_Diff_singleton_if image_iff card_image inj_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> S <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> x <span class="main">×</span> <span class="tfree">'a</span> x<span class="main">,</span> <span class="tfree">'a</span> <span class="main">::</span> enum x<span class="main">)</span> bset"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>C<span class="main">,</span> C<span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span>A<span class="main">,</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> Bs<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> finite_card_of_iff_card3<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card.insert_remove card_Diff_singleton_if image_iff card_image inj_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> in_brel <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bset <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">in_rel</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">False</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_bset <span class="main">(</span>in_brel R<span class="main">)</span> X Z"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bset.in_rel mem_Collect_eq
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">R</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_bset <span class="main">(</span>in_brel S<span class="main">)</span> Z Y"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bset.in_rel mem_Collect_eq
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">S</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_bset <span class="main">(</span>in_brel R <span class="keyword1">OO</span> in_brel S<span class="main">)</span> X Y"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bset.rel_compp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>A<span class="main">,</span> A<span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">B</span><span class="main">,</span> C<span class="main">)</span><span class="main">)</span> <span class="main">`</span> Bs<span class="main">)</span> <span class="keyword1">O</span> insert <span class="main">(</span>C<span class="main">,</span> C<span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span>A<span class="main">,</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> Bs<span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">B</span><span class="main">,</span> C<span class="main">)</span><span class="main">)</span> <span class="main">`</span> Bs<span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">B</span><span class="main">.</span> <span class="main">(</span>A<span class="main">,</span> <span class="bound">B</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> Bs<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?RS</span>"</span></span> <span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> rel_bset <span class="main">(</span>in_brel R <span class="keyword1">OO</span> in_brel S<span class="main">)</span> X Y"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bset.in_rel mem_Collect_eq
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> relcompp_in_rel * Collect_split_in_rel<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> enum x <span class="main">×</span> <span class="tfree">'a</span> x<span class="main">)</span> set"</span></span>
    <span class="keyword1"><span class="command">note</span></span> enum_UNIV<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> UNIV_option_conv<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">⊆</span> <span class="var">?RS</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="skolem">Z</span> <span class="main">=</span> insert A Bs"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="skolem">Z</span> <span class="main">=</span> insert C Bs"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="var">?RS</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fst_eq_Domain snd_eq_Range <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="skolem">Z</span><span class="main">|</span> <span class="keyword1">&lt;o</span> <span class="main">|</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> x set<span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Z</span> <span class="main">=</span> <span class="var">?RS</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> finite_card_of_iff_card3<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> card_Un_disjoint<span class="main">)</span>
        <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card.insert_remove card_Diff_singleton_if card_image inj_on_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="Nonempty_Bounded_Set">
<div class="head">
<h1>Theory Nonempty_Bounded_Set</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Nonempty Sets Strictly Bounded by an Infinite Cardinal›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Nonempty_Bounded_Set
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Cardinals/Bounded_Set.html">HOL-Cardinals.Bounded_Set</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> nebset <span class="main">(</span><span class="quoted">"_ <span class="keyword1">set![</span>_<span class="keyword1">]</span>"</span> <span class="main">[</span>22<span class="main">,</span> 21<span class="main">]</span> 21<span class="main">)</span> <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">A</span> <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">.</span> <span class="bound">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">|</span><span class="bound">A</span><span class="main">|</span> <span class="keyword1">&lt;o</span> natLeq <span class="keyword1">+c</span> <span class="main">|</span>UNIV <span class="main">::</span> <span class="tfree">'k</span> set<span class="main">|</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">morphisms</span></span> set_nebset Abs_nebset
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span>undefined<span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Cfinite_ordLess_Cinfinite<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cfinite_def cinfinite_csum natLeq_cinfinite Card_order_csum<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_nebset

<span class="keyword1"><span class="command">lift_definition</span></span> map_nebset <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">image</span>
  <span class="keyword1"><span class="command">using</span></span> card_of_image ordLeq_ordLess_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lift_definition</span></span> rel_nebset <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">rel_set</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> nebinsert <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"insert"</span></span>
  <span class="keyword1"><span class="command">using</span></span> infinite_card_of_insert ordIso_ordLess_trans Field_card_of Field_natLeq UNIV_Plus_UNIV
   csum_def finite_Plus_UNIV_iff finite_insert finite_ordLess_infinite2 infinite_UNIV_nat
   insert_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lift_definition</span></span> nebsingleton <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Cfinite_ordLess_Cinfinite<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cfinite_def cinfinite_csum natLeq_cinfinite Card_order_csum<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_nebset_to_set_nebset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">|</span><span class="free">A</span><span class="main">|</span> <span class="keyword1">&lt;o</span> natLeq <span class="keyword1">+c</span> <span class="main">|</span>UNIV <span class="main">::</span> <span class="tfree">'k</span> set<span class="main">|</span> <span class="main">⟹</span>
  set_nebset <span class="main">(</span>the_inv set_nebset <span class="free">A</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> f_the_inv_into_f<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> inj_on_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_nebset_inject range_eqI Abs_nebset_inverse<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> range_eqI Abs_nebset_inverse<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> CollectI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_nebset_aux_infinite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">t</span> <span class="main">∈</span> set_nebset <span class="free">a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="main">∈</span> set_nebset <span class="free">b</span><span class="main">.</span> <span class="free">R</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> set_nebset <span class="free">b</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span> <span class="main">∈</span> set_nebset <span class="free">a</span><span class="main">.</span> <span class="free">R</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⟷</span>
   <span class="main">(</span><span class="main">(</span>BNF_Def.Grp <span class="main">{</span><span class="bound">a</span><span class="main">.</span> set_nebset <span class="bound">a</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="free">R</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span><span class="main">}</span> <span class="main">(</span>map_nebset fst<span class="main">)</span><span class="main">)</span><span class="main">¯¯</span> <span class="keyword1">OO</span>
    BNF_Def.Grp <span class="main">{</span><span class="bound">a</span><span class="main">.</span> set_nebset <span class="bound">a</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="free">R</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span><span class="main">}</span> <span class="main">(</span>map_nebset snd<span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R'</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R'</span> <span class="main">=</span> the_inv set_nebset <span class="main">(</span>Collect <span class="main">(</span>case_prod <span class="free">R</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>set_nebset <span class="free">a</span> <span class="main">×</span> set_nebset <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> the_inv set_nebset <span class="var">?L'</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L'</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="var">?L'</span><span class="main">|</span> <span class="keyword1">&lt;o</span> natLeq <span class="keyword1">+c</span> <span class="main">|</span>UNIV <span class="main">::</span> <span class="tfree">'k</span> set<span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> csum_def Field_natLeq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ordLeq_ordLess_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> card_of_mono1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Int_lower2<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span>
      card_of_Times_ordLess_infinite<span class="main">)</span>
      <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csum_def Field_natLeq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"set_nebset <span class="skolem">R'</span> <span class="main">=</span> <span class="var">?L'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_nebset_to_set_nebset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Grp_def relcompp.simps conversep.simps
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> CollectI case_prodI exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">R'</span></span></span></span><span class="main"><span class="main">]</span></span> conjI refl<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> map_nebset fst <span class="skolem">R'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conjunct1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_def Int_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> map_nebset snd <span class="skolem">R'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conjunct2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_def Int_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Grp_def relcompp.simps conversep.simps
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">bnf</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span>"</span></span>
  map<span class="main">:</span> <span class="quoted">map_nebset</span>
  sets<span class="main">:</span> <span class="quoted">set_nebset</span>
  bd<span class="main">:</span> <span class="quoted"><span class="quoted">"natLeq <span class="keyword1">+c</span> <span class="main">|</span>UNIV <span class="main">::</span> <span class="tfree">'k</span> set<span class="main">|</span>"</span></span>
  rel<span class="main">:</span> <span class="quoted">rel_nebset</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map_nebset id <span class="main">=</span> id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map_nebset <span class="main">(</span><span class="skolem">f</span> <span class="keyword1">o</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> map_nebset <span class="skolem">f</span> <span class="keyword1">o</span> map_nebset <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">f</span> <span class="skolem">g</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set_nebset <span class="skolem">X</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">z</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map_nebset <span class="skolem">f</span> <span class="skolem">X</span> <span class="main">=</span> map_nebset <span class="skolem">g</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_nebset <span class="main">∘</span> map_nebset <span class="skolem">f</span> <span class="main">=</span> <span class="main">(`)</span> <span class="skolem">f</span> <span class="main">∘</span> set_nebset"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span>set_nebset <span class="skolem">X</span><span class="main">|</span> <span class="keyword1">≤o</span> natLeq <span class="keyword1">+c</span> <span class="main">|</span>UNIV <span class="main">::</span> <span class="tfree">'k</span> set<span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ordLess_imp_ordLeq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">R</span> <span class="skolem">S</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rel_nebset <span class="skolem">R</span> <span class="keyword1">OO</span> rel_nebset <span class="skolem">S</span> <span class="main">≤</span> rel_nebset <span class="main">(</span><span class="skolem">R</span> <span class="keyword1">OO</span> <span class="skolem">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> predicate2I<span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_set_OO<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rel_nebset <span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">.</span> set_nebset <span class="bound">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">∧</span>
    map_nebset fst <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> map_nebset snd <span class="bound">z</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span> <span class="main">⇒</span> bool<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_nebset_def map_fun_def o_def rel_set_def
      rel_nebset_aux_infinite<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> OO_Grp_alt<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_order_csum natLeq_card_order cinfinite_csum natLeq_cinfinite<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_nebset_nebinsert<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map_nebset <span class="free">f</span> <span class="main">(</span>nebinsert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> nebinsert <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span>map_nebset <span class="free">f</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> map_nebset_nebsingleton<span class="main">:</span> <span class="quoted"><span class="quoted">"map_nebset <span class="free">f</span> <span class="main">(</span>nebsingleton <span class="free">x</span><span class="main">)</span> <span class="main">=</span> nebsingleton <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nebsingleton_inj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nebsingleton <span class="free">x</span> <span class="main">=</span> nebsingleton <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_nebsingleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_nebset <span class="free">R</span> <span class="main">(</span>nebsingleton <span class="free">x1</span><span class="main">)</span> <span class="main">(</span>nebsingleton <span class="free">x2</span><span class="main">)</span> <span class="main">=</span> <span class="free">R</span> <span class="free">x1</span> <span class="free">x2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_nebset_nebsingleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_nebset <span class="free">R</span> <span class="main">(</span>nebsingleton <span class="free">x1</span><span class="main">)</span> <span class="free">X</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x2</span><span class="main">∈</span>set_nebset <span class="free">X</span><span class="main">.</span> <span class="free">R</span> <span class="free">x1</span> <span class="bound">x2</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"rel_nebset <span class="free">R</span> <span class="free">X</span> <span class="main">(</span>nebsingleton <span class="free">x2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x1</span><span class="main">∈</span>set_nebset <span class="free">X</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x1</span> <span class="free">x2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_set_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_nebset_False<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_nebset <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> False<span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> set_nebset_nebsingleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> nebsingleton.rep_eq

<span class="keyword1"><span class="command">lemma</span></span> nebinsert_absorb<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nebinsert <span class="free">a</span> <span class="main">(</span>nebinsert <span class="free">a</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> nebinsert <span class="free">a</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> bset_of_nebset <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="keyword1">set[</span><span class="tfree">'k</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> conjunct2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_bset_bset_of_nebset<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_bset <span class="free">R</span> <span class="main">(</span>bset_of_nebset <span class="free">X</span><span class="main">)</span> <span class="main">(</span>bset_of_nebset <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> rel_nebset <span class="free">R</span> <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_nebset_conj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_nebset <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">P</span> <span class="main">∧</span> rel_nebset <span class="free">Q</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"rel_nebset <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">P</span> <span class="main">∧</span> rel_nebset <span class="free">Q</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_set_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_bset_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set_bset <span class="free">X</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="free">X</span> <span class="main">=</span> bempty"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="comment1">(* FIXME for ONDRA*)</span>
<span class="comment1">(*
declare nebset.rel_eq[relator_eq]
declare nebset.rel_mono[relator_mono]
declare nebset.rel_compp[symmetric, relator_distr]
declare nebset.rel_transfer[transfer_rule]

lemma nebset_quot_map[quot_map]: "Quotient R Abs Rep T ⟹
  Quotient (rel_nebset R) (map_nebset Abs) (map_nebset Rep) (rel_nebset T)"
  unfolding Quotient_alt_def5 nebset.rel_Grp[of UNIV, simplified, symmetric]
    nebset.rel_conversep[symmetric] nebset.rel_compp[symmetric]
    by (auto elim: nebset.rel_mono_strong)

lemma set_relator_eq_onp [relator_eq_onp]:
  "rel_nebset (eq_onp P) = eq_onp (λA. Ball (set_nebset A) P)"
  unfolding fun_eq_iff eq_onp_def by transfer (auto simp: rel_set_def)
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Probabilistic_Hierarchy">
<div class="head">
<h1>Theory Probabilistic_Hierarchy</h1>
</div>
<pre class="source">
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Probabilistic_Hierarchy
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Probability/Probability.html">HOL-Probability.Probability</a>"</span>
  <a href="Nonempty_Bounded_Set.html">Nonempty_Bounded_Set</a>
  <span class="quoted">"<a href="../../HOL/HOL-Eisbach/Eisbach.html">HOL-Eisbach.Eisbach</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Bisimilarity›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bisimilar</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bisimilar</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="bound">R</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">R</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bisimilar_mc</span> <span class="main">≡</span> bisimilar <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> rel_pmf <span class="bound">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bisimilar_dlts</span> <span class="main">≡</span> bisimilar <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> rel_fun <span class="main">(=)</span> <span class="main">(</span>rel_option <span class="bound">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bisimilar_lts</span> <span class="main">≡</span> bisimilar <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> rel_bset <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="bound">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bisimilar_react</span> <span class="main">≡</span> bisimilar <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> rel_fun <span class="main">(=)</span> <span class="main">(</span>rel_option <span class="main">(</span>rel_pmf <span class="bound">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bisimilar_lmc</span> <span class="main">≡</span> bisimilar <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> rel_prod <span class="main">(=)</span> <span class="main">(</span>rel_pmf <span class="bound">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bisimilar_lmdp</span> <span class="main">≡</span> bisimilar <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> rel_prod <span class="main">(=)</span> <span class="main">(</span>rel_nebset <span class="main">(</span>rel_pmf <span class="bound">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bisimilar_gen</span> <span class="main">≡</span> bisimilar <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> rel_option <span class="main">(</span>rel_pmf <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="bound">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bisimilar_str</span> <span class="main">≡</span> bisimilar <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> rel_sum <span class="main">(</span>rel_pmf <span class="bound">R</span><span class="main">)</span> <span class="main">(</span>rel_option <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="bound">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bisimilar_alt</span> <span class="main">≡</span> bisimilar <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> rel_sum <span class="main">(</span>rel_pmf <span class="bound">R</span><span class="main">)</span> <span class="main">(</span>rel_bset <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="bound">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bisimilar_sseg</span> <span class="main">≡</span> bisimilar <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> rel_bset <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="main">(</span>rel_pmf <span class="bound">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bisimilar_seg</span> <span class="main">≡</span> bisimilar <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> rel_bset <span class="main">(</span>rel_pmf <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="bound">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bisimilar_bun</span> <span class="main">≡</span> bisimilar <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> rel_pmf <span class="main">(</span>rel_bset <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="bound">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bisimilar_pz</span> <span class="main">≡</span> bisimilar <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> rel_bset <span class="main">(</span>rel_pmf <span class="main">(</span>rel_bset <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="bound">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bisimilar_mg</span> <span class="main">≡</span> bisimilar <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> rel_bset <span class="main">(</span>rel_pmf <span class="main">(</span>rel_bset <span class="main">(</span>rel_sum <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="bound">R</span><span class="main">)</span> <span class="bound">R</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Systems›</span></span>

<span class="keyword1"><span class="command">codatatype</span></span> mc <span class="main">=</span> MC <span class="quoted"><span class="quoted">"mc pmf"</span></span>
<span class="keyword1"><span class="command">codatatype</span></span> <span class="tfree">'a</span> dlts <span class="main">=</span> DLTS <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> dlts option"</span></span>
<span class="keyword1"><span class="command">codatatype</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> lts <span class="main">=</span> LTS <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> lts<span class="main">)</span> <span class="keyword1">set[</span><span class="tfree">'k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">codatatype</span></span> <span class="tfree">'a</span> react <span class="main">=</span> React <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> react pmf option"</span></span>
<span class="keyword1"><span class="command">codatatype</span></span> <span class="tfree">'a</span> lmc <span class="main">=</span> LMC <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> lmc pmf"</span></span>
<span class="keyword1"><span class="command">codatatype</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> lmdp <span class="main">=</span> LMDP <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> lmdp pmf <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">codatatype</span></span> <span class="tfree">'a</span> gen <span class="main">=</span> Gen <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> gen<span class="main">)</span> pmf option"</span></span>
<span class="keyword1"><span class="command">codatatype</span></span> <span class="tfree">'a</span> str <span class="main">=</span> Str <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> str pmf <span class="main">+</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> str<span class="main">)</span> option"</span></span>
<span class="keyword1"><span class="command">codatatype</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> alt <span class="main">=</span> Alt <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> alt pmf <span class="main">+</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> alt<span class="main">)</span> <span class="keyword1">set[</span><span class="tfree">'k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">codatatype</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> sseg <span class="main">=</span> SSeg <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> sseg pmf<span class="main">)</span> <span class="keyword1">set[</span><span class="tfree">'k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">codatatype</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> seg <span class="main">=</span> Seg <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> seg<span class="main">)</span> pmf <span class="keyword1">set[</span><span class="tfree">'k</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">codatatype</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bun <span class="main">=</span> Bun <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bun<span class="main">)</span> <span class="keyword1">set[</span><span class="tfree">'k</span><span class="main">]</span><span class="main">)</span> pmf"</span></span>
<span class="keyword1"><span class="command">codatatype</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> pz <span class="main">=</span> PZ <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> pz<span class="main">)</span> <span class="keyword1">set[</span><span class="tfree">'k1</span><span class="main">]</span><span class="main">)</span> pmf <span class="keyword1">set[</span><span class="tfree">'k2</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">codatatype</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> mg <span class="main">=</span> MG <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> mg <span class="main">+</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> mg<span class="main">)</span> <span class="keyword1">set[</span><span class="tfree">'k1</span><span class="main">]</span><span class="main">)</span> pmf <span class="keyword1">set[</span><span class="tfree">'k2</span><span class="main">]</span>"</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Unfolds›</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">unfold_mc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> pmf<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> mc"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unfold_mc</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> MC <span class="main">(</span>map_pmf <span class="main">(</span><span class="free">unfold_mc</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">unfold_dlts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> option<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> dlts"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unfold_dlts</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> DLTS <span class="main">(</span>map_option <span class="main">(</span><span class="free">unfold_dlts</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">unfold_lts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">set[</span><span class="tfree">'k</span><span class="main">]</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> lts"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unfold_lts</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> LTS <span class="main">(</span>map_bset <span class="main">(</span>map_prod id <span class="main">(</span><span class="free">unfold_lts</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">unfold_react</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> pmf option<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> react"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unfold_react</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> React <span class="main">(</span>map_option <span class="main">(</span>map_pmf <span class="main">(</span><span class="free">unfold_react</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">unfold_lmc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'a</span> pmf<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> lmc"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unfold_lmc</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> LMC <span class="main">(</span>map_prod id <span class="main">(</span>map_pmf <span class="main">(</span><span class="free">unfold_lmc</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">unfold_lmdp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'a</span> pmf <span class="keyword1">set![</span><span class="tfree">'k</span><span class="main">]</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> lmdp"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unfold_lmdp</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> LMDP <span class="main">(</span>map_prod id <span class="main">(</span>map_nebset <span class="main">(</span>map_pmf <span class="main">(</span><span class="free">unfold_lmdp</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">unfold_gen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> pmf<span class="main">)</span> option<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> gen"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unfold_gen</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Gen <span class="main">(</span>map_option <span class="main">(</span>map_pmf <span class="main">(</span>map_prod id <span class="main">(</span><span class="free">unfold_gen</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">unfold_str</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> pmf <span class="main">+</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> option<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> str"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unfold_str</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Str <span class="main">(</span>map_sum <span class="main">(</span>map_pmf <span class="main">(</span><span class="free">unfold_str</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map_option <span class="main">(</span>map_prod id <span class="main">(</span><span class="free">unfold_str</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">unfold_alt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> pmf <span class="main">+</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">set[</span><span class="tfree">'k</span><span class="main">]</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> alt"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unfold_alt</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Alt <span class="main">(</span>map_sum <span class="main">(</span>map_pmf <span class="main">(</span><span class="free">unfold_alt</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map_bset <span class="main">(</span>map_prod id <span class="main">(</span><span class="free">unfold_alt</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">unfold_sseg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'a</span> pmf<span class="main">)</span> <span class="keyword1">set[</span><span class="tfree">'k</span><span class="main">]</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> sseg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unfold_sseg</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> SSeg <span class="main">(</span>map_bset <span class="main">(</span>map_prod id <span class="main">(</span>map_pmf <span class="main">(</span><span class="free">unfold_sseg</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">unfold_seg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> pmf<span class="main">)</span> <span class="keyword1">set[</span><span class="tfree">'k</span><span class="main">]</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> seg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unfold_seg</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Seg <span class="main">(</span>map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_prod id <span class="main">(</span><span class="free">unfold_seg</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">unfold_bun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">set[</span><span class="tfree">'k</span><span class="main">]</span><span class="main">)</span> pmf<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bun"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unfold_bun</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Bun <span class="main">(</span>map_pmf <span class="main">(</span>map_bset <span class="main">(</span>map_prod id <span class="main">(</span><span class="free">unfold_bun</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">unfold_pz</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">set[</span><span class="tfree">'k1</span><span class="main">]</span><span class="main">)</span> pmf <span class="keyword1">set[</span><span class="tfree">'k2</span><span class="main">]</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> pz"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unfold_pz</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> PZ <span class="main">(</span>map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_bset <span class="main">(</span>map_prod id <span class="main">(</span><span class="free">unfold_pz</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">unfold_mg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">+</span> <span class="tfree">'a</span><span class="main">)</span> <span class="keyword1">set[</span><span class="tfree">'k1</span><span class="main">]</span><span class="main">)</span> pmf <span class="keyword1">set[</span><span class="tfree">'k2</span><span class="main">]</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> mg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unfold_mg</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> MG <span class="main">(</span>map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_bset <span class="main">(</span>map_sum <span class="main">(</span>map_prod id <span class="main">(</span><span class="free">unfold_mg</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">unfold_mg</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Embeddings›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">react_of_dlts_emb</span> <span class="free"><span class="bound"><span class="entity">dlts</span></span></span> <span class="main">≡</span> map_option return_pmf <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">dlts</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">lts_of_dlts_emb</span> <span class="main">≡</span> bgraph"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">sseg_of_react_emb</span> <span class="main">≡</span> bgraph"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">gen_of_lmc_emb</span> <span class="main">≡</span> Some <span class="keyword1">o</span> case_prod <span class="main">(</span>map_pmf <span class="keyword1">o</span> Pair<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">lmdp_of_lmc_emb</span> <span class="main">≡</span> map_prod id nebsingleton"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">sseg_of_lmdp_emb</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> map_bset <span class="main">(</span>Pair <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>bset_of_nebset <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">sseg_of_lts_emb</span> <span class="main">≡</span> map_bset <span class="main">(</span>map_prod id return_pmf<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">ssegopt_of_alt_emb</span> <span class="main">≡</span> case_sum
   <span class="main">(</span>map_bset <span class="main">(</span>Pair None<span class="main">)</span> <span class="keyword1">o</span> bsingleton<span class="main">)</span>
   <span class="main">(</span>map_bset <span class="main">(</span>map_prod Some return_pmf<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">bunopt_of_alt_emb</span> <span class="main">≡</span> case_sum
   <span class="main">(</span>map_pmf <span class="main">(</span>bsingleton <span class="keyword1">o</span> Pair None<span class="main">)</span><span class="main">)</span>
   <span class="main">(</span>map_pmf <span class="main">(</span>map_bset <span class="main">(</span>map_prod Some id<span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> return_pmf<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">segopt_of_seg_emb</span> <span class="main">≡</span> map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_prod Some id<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">ssegopt_of_sseg_emb</span> <span class="main">≡</span> map_bset <span class="main">(</span>map_prod Some id<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">bunopt_of_bun_emb</span> <span class="main">≡</span> map_pmf <span class="main">(</span>map_bset <span class="main">(</span>map_prod Some id<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">pzopt_of_pz_emb</span> <span class="main">≡</span> map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_bset <span class="main">(</span>map_prod Some id<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">seg_of_sseg_emb</span> <span class="main">≡</span> map_bset <span class="main">(</span>case_prod <span class="main">(</span>map_pmf <span class="keyword1">o</span> Pair<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">pz_of_seg_emb</span> <span class="main">≡</span> map_bset <span class="main">(</span>map_pmf bsingleton<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">pz_of_bun_emb</span> <span class="main">≡</span> bsingleton"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">seg_of_gen_emb</span> <span class="main">≡</span>  bset_of_option"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">bun_of_lts_emb</span> <span class="main">≡</span> return_pmf"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">bun_of_gen_emb</span> <span class="main">≡</span> case_option <span class="main">(</span>return_pmf bempty<span class="main">)</span> <span class="main">(</span>map_pmf bsingleton<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">str_of_mc_emb</span> <span class="main">≡</span> Inl"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">alt_of_str_emb</span> <span class="main">≡</span> map_sum id bset_of_option"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">pzopt_of_mg_emb</span> <span class="main">≡</span> map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_bset <span class="main">(</span>case_sum <span class="main">(</span>map_prod Some id<span class="main">)</span> <span class="main">(</span>Pair None<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">mg_of_pzopt_emb</span> <span class="main">≡</span> map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_bset <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> case_option <span class="main">(</span>Inr <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>Inl <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Obsolete edges (susumed by transitive ones)›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">mg_of_pz_emb</span> <span class="main">≡</span> map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_bset Inl<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">mg_of_alt1_emb</span> <span class="main">≡</span> case_sum
   <span class="main">(</span>map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_bset Inr <span class="keyword1">o</span> bsingleton<span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> bsingleton<span class="main">)</span>
   <span class="main">(</span>map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_bset Inl <span class="keyword1">o</span> bsingleton<span class="main">)</span> <span class="keyword1">o</span> return_pmf<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">mg_of_alt2_emb</span> <span class="main">≡</span> case_sum
   <span class="main">(</span>map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_bset Inr <span class="keyword1">o</span> bsingleton<span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> bsingleton<span class="main">)</span>
   <span class="main">(</span>map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_bset Inl<span class="main">)</span> <span class="keyword1">o</span> return_pmf<span class="main">)</span> <span class="keyword1">o</span> bsingleton<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">pz_of_alt1_emb</span> <span class="main">≡</span> case_sum
   <span class="main">(</span>map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_bset <span class="main">(</span>Pair None<span class="main">)</span> <span class="keyword1">o</span> bsingleton<span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> bsingleton<span class="main">)</span>
   <span class="main">(</span>map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_bset <span class="main">(</span>map_prod Some id<span class="main">)</span> <span class="keyword1">o</span> bsingleton<span class="main">)</span> <span class="keyword1">o</span> return_pmf<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">pz_of_alt2_emb</span> <span class="main">≡</span> case_sum
   <span class="main">(</span>map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_bset <span class="main">(</span>Pair None<span class="main">)</span> <span class="keyword1">o</span> bsingleton<span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> bsingleton<span class="main">)</span>
   <span class="main">(</span>map_bset <span class="main">(</span>map_pmf <span class="main">(</span>map_bset <span class="main">(</span>map_prod Some id<span class="main">)</span><span class="main">)</span> <span class="keyword1">o</span> return_pmf<span class="main">)</span> <span class="keyword1">o</span> bsingleton<span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">react_of_dlts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dlts <span class="main">⇒</span> <span class="tfree">'a</span> react"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">react_of_dlts</span> <span class="main">=</span> unfold_react <span class="main">(</span>react_of_dlts_emb <span class="keyword1">o</span> un_DLTS<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lts_of_dlts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dlts <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span> set<span class="main">)</span> lts"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lts_of_dlts</span> <span class="main">=</span> unfold_lts <span class="main">(</span>lts_of_dlts_emb <span class="keyword1">o</span> un_DLTS<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sseg_of_react</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> react <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span> set<span class="main">)</span> sseg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sseg_of_react</span> <span class="main">=</span> unfold_sseg <span class="main">(</span>sseg_of_react_emb <span class="keyword1">o</span> un_React<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lmdp_of_lmc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lmc <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> lmdp"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">lmdp_of_lmc</span> <span class="main">=</span> unfold_lmdp <span class="main">(</span>lmdp_of_lmc_emb <span class="keyword1">o</span> un_LMC<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gen_of_lmc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> lmc <span class="main">⇒</span> <span class="tfree">'a</span> gen"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gen_of_lmc</span> <span class="main">=</span> unfold_gen <span class="main">(</span>gen_of_lmc_emb <span class="keyword1">o</span> un_LMC<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sseg_of_lmdp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> lmdp <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> sseg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sseg_of_lmdp</span> <span class="main">=</span> unfold_sseg <span class="main">(</span>sseg_of_lmdp_emb <span class="keyword1">o</span> un_LMDP<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sseg_of_lts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> lts <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> sseg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sseg_of_lts</span> <span class="main">=</span> unfold_sseg <span class="main">(</span>sseg_of_lts_emb <span class="keyword1">o</span> un_LTS<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ssegopt_of_alt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> alt <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> option<span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> sseg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ssegopt_of_alt</span> <span class="main">=</span> unfold_sseg <span class="main">(</span>ssegopt_of_alt_emb <span class="keyword1">o</span> un_Alt<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bunopt_of_alt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> alt <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> option<span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bun"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bunopt_of_alt</span> <span class="main">=</span> unfold_bun <span class="main">(</span>bunopt_of_alt_emb <span class="keyword1">o</span> un_Alt<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">seg_of_sseg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> sseg <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> seg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">seg_of_sseg</span> <span class="main">=</span> unfold_seg <span class="main">(</span>seg_of_sseg_emb <span class="keyword1">o</span> un_SSeg<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">seg_of_gen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> gen <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> seg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">seg_of_gen</span> <span class="main">=</span> unfold_seg <span class="main">(</span>seg_of_gen_emb <span class="keyword1">o</span> un_Gen<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bun_of_lts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> lts <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bun"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bun_of_lts</span> <span class="main">=</span> unfold_bun <span class="main">(</span>bun_of_lts_emb <span class="keyword1">o</span> un_LTS<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bun_of_gen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> gen <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bun"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bun_of_gen</span> <span class="main">=</span> unfold_bun <span class="main">(</span>bun_of_gen_emb <span class="keyword1">o</span> un_Gen<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pz_of_seg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> seg <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> pz"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pz_of_seg</span> <span class="main">=</span> unfold_pz <span class="main">(</span>pz_of_seg_emb <span class="keyword1">o</span> un_Seg<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pz_of_bun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bun <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">)</span> pz"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pz_of_bun</span> <span class="main">=</span> unfold_pz <span class="main">(</span>pz_of_bun_emb <span class="keyword1">o</span> un_Bun<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mg_of_pz</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> pz <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> mg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mg_of_pz</span> <span class="main">=</span> unfold_mg <span class="main">(</span>mg_of_pz_emb <span class="keyword1">o</span> un_PZ<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">str_of_mc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"mc <span class="main">⇒</span> <span class="tfree">'a</span> str"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">str_of_mc</span> <span class="main">=</span> unfold_str <span class="main">(</span>str_of_mc_emb <span class="keyword1">o</span> un_MC<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">alt_of_str</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> str <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> alt"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">alt_of_str</span> <span class="main">=</span> unfold_alt <span class="main">(</span>alt_of_str_emb <span class="keyword1">o</span> un_Str<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ssegopt_of_sseg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> sseg <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> option<span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> sseg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ssegopt_of_sseg</span> <span class="main">=</span> unfold_sseg <span class="main">(</span>ssegopt_of_sseg_emb <span class="keyword1">o</span> un_SSeg<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">segopt_of_seg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> seg <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> option<span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> seg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">segopt_of_seg</span> <span class="main">=</span> unfold_seg <span class="main">(</span>segopt_of_seg_emb <span class="keyword1">o</span> un_Seg<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bunopt_of_bun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bun <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> option<span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bun"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bunopt_of_bun</span> <span class="main">=</span> unfold_bun <span class="main">(</span>bunopt_of_bun_emb <span class="keyword1">o</span> un_Bun<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pzopt_of_pz</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> pz <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> option<span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> pz"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pzopt_of_pz</span> <span class="main">=</span> unfold_pz <span class="main">(</span>pzopt_of_pz_emb <span class="keyword1">o</span> un_PZ<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pzopt_of_mg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> mg <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> option<span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> pz"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pzopt_of_mg</span> <span class="main">=</span> unfold_pz <span class="main">(</span>pzopt_of_mg_emb <span class="keyword1">o</span> un_MG<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mg_of_pzopt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> option<span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> pz <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> mg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mg_of_pzopt</span> <span class="main">=</span> unfold_mg <span class="main">(</span>mg_of_pzopt_emb <span class="keyword1">o</span> un_PZ<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mg_of_alt1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> alt <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> mg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mg_of_alt1</span> <span class="main">=</span> unfold_mg <span class="main">(</span>mg_of_alt1_emb <span class="keyword1">o</span> un_Alt<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mg_of_alt2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> alt <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">,</span> <span class="tfree">'k1</span><span class="main">)</span> mg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mg_of_alt2</span> <span class="main">=</span> unfold_mg <span class="main">(</span>mg_of_alt2_emb <span class="keyword1">o</span> un_Alt<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pz_of_alt1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> alt <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> option<span class="main">,</span> <span class="tfree">'k1</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> pz"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pz_of_alt1</span> <span class="main">=</span> unfold_pz <span class="main">(</span>pz_of_alt1_emb <span class="keyword1">o</span> un_Alt<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pz_of_alt2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> alt <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> option<span class="main">,</span> <span class="tfree">'k</span><span class="main">,</span> <span class="tfree">'k2</span><span class="main">)</span> pz"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">pz_of_alt2</span> <span class="main">=</span> unfold_pz <span class="main">(</span>pz_of_alt2_emb <span class="keyword1">o</span> un_Alt<span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Automation Setup›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mc_rel_eq<span class="main">[</span><span class="operator">unfolded</span> vimage2p_def<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"BNF_Def.vimage2p un_MC un_MC <span class="main">(</span>rel_pmf <span class="main">(=)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def pmf.rel_eq option.rel_eq fun.rel_eq fun_eq_iff mc.expand<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> dlts_rel_eq<span class="main">[</span><span class="operator">unfolded</span> vimage2p_def<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"BNF_Def.vimage2p un_DLTS un_DLTS <span class="main">(</span>rel_fun <span class="main">(=)</span> <span class="main">(</span>rel_option <span class="main">(=)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def pmf.rel_eq option.rel_eq fun.rel_eq fun_eq_iff dlts.expand<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> react_rel_eq<span class="main">[</span><span class="operator">unfolded</span> vimage2p_def<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"BNF_Def.vimage2p un_React un_React <span class="main">(</span>rel_fun <span class="main">(=)</span> <span class="main">(</span>rel_option <span class="main">(</span>rel_pmf <span class="main">(=)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def pmf.rel_eq option.rel_eq fun.rel_eq fun_eq_iff react.expand<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> all_neq_Inl_ex_eq_Inr<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="free">x</span> <span class="main">≠</span> Inl <span class="bound">l</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> Inr <span class="bound">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> all_neq_Inr_ex_eq_Inl<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="free">x</span> <span class="main">≠</span> Inr <span class="bound">r</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> Inl <span class="bound">l</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> all2_neq_Inl_ex_eq_Inr<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">x</span> <span class="main">≠</span> Inl <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> Inr <span class="bound">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> all2_neq_Inr_ex_eq_Inl<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">x</span> <span class="main">≠</span> Inr <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">l</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> Inl <span class="bound">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_prod_simp_asym<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> rel_prod <span class="free">R</span> <span class="free">S</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">z</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">x'</span> <span class="main">∧</span> <span class="free">S</span> <span class="bound">y</span> <span class="bound">y'</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> rel_prod <span class="free">R</span> <span class="free">S</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">y'</span><span class="main">,</span> <span class="bound">z'</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">R</span> <span class="bound">y'</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">S</span> <span class="bound">z'</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> map_prod_eq_Pair_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_prod <span class="free">f</span> <span class="free">g</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">g</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">abs_def</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span> <span class="main">=</span>
  sum.rel_map prod.rel_map option.rel_map pmf.rel_map bset.rel_map fun.rel_map nebset.rel_map

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span>
  lts.rel_eq lmc.rel_eq lmdp.rel_eq gen.rel_eq str.rel_eq alt.rel_eq sseg.rel_eq seg.rel_eq
  bun.rel_eq pz.rel_eq mg.rel_eq
  rel_pmf_return_pmf1 rel_pmf_return_pmf2 set_pmf_not_empty rel_pmf_rel_prod
  bset.set_map nebset.set_map

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span>
  split_paired_Ex

<span class="keyword1"><span class="command">lemma</span></span> bisimilar_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">R</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">R</span> <span class="free">x</span> <span class="free">y</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">R</span> <span class="main">(</span><span class="free">s1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">s2</span> <span class="bound">y</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span>  <span class="free">P</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="free">P</span> <span class="main">(</span><span class="free">s1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">s2</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bisimilar <span class="free">Q</span> <span class="free">s1</span> <span class="free">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="free">P</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> bisimilar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">bundle</span></span> probabilistic_hierarchy <span class="main">=</span>
  rel_fun_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  sum.splits<span class="main">[</span><span class="operator">split</span><span class="main">]</span>
  prod.splits<span class="main">[</span><span class="operator">split</span><span class="main">]</span>
  option.splits<span class="main">[</span><span class="operator">split</span><span class="main">]</span>

  predicate2_eqD<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">OF</span> mc_rel_eq<span class="main">,</span> <span class="operator">dest</span><span class="main">]</span>
  predicate2_eqD<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">OF</span> dlts_rel_eq<span class="main">,</span> <span class="operator">dest</span><span class="main">]</span>
  predicate2_eqD<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">OF</span> lts.rel_eq<span class="main">,</span> <span class="operator">dest</span><span class="main">]</span>
  predicate2_eqD<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">OF</span> react_rel_eq<span class="main">,</span> <span class="operator">dest</span><span class="main">]</span>
  predicate2_eqD<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">OF</span> lmc.rel_eq<span class="main">,</span> <span class="operator">dest</span><span class="main">]</span>
  predicate2_eqD<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">OF</span> lmdp.rel_eq<span class="main">,</span> <span class="operator">dest</span><span class="main">]</span>
  predicate2_eqD<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">OF</span> gen.rel_eq<span class="main">,</span> <span class="operator">dest</span><span class="main">]</span>
  predicate2_eqD<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">OF</span> str.rel_eq<span class="main">,</span> <span class="operator">dest</span><span class="main">]</span>
  predicate2_eqD<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">OF</span> alt.rel_eq<span class="main">,</span> <span class="operator">dest</span><span class="main">]</span>
  predicate2_eqD<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">OF</span> sseg.rel_eq<span class="main">,</span> <span class="operator">dest</span><span class="main">]</span>
  predicate2_eqD<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">OF</span> seg.rel_eq<span class="main">,</span> <span class="operator">dest</span><span class="main">]</span>
  predicate2_eqD<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">OF</span> bun.rel_eq<span class="main">,</span> <span class="operator">dest</span><span class="main">]</span>
  predicate2_eqD<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">OF</span> pz.rel_eq<span class="main">,</span> <span class="operator">dest</span><span class="main">]</span>
  predicate2_eqD<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">,</span> <span class="operator">OF</span> mg.rel_eq<span class="main">,</span> <span class="operator">dest</span><span class="main">]</span>

  iffD1<span class="main">[</span><span class="operator">OF</span> lts.rel_sel<span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  iffD1<span class="main">[</span><span class="operator">OF</span> lmc.rel_sel<span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  iffD1<span class="main">[</span><span class="operator">OF</span> lmdp.rel_sel<span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  iffD1<span class="main">[</span><span class="operator">OF</span> gen.rel_sel<span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  iffD1<span class="main">[</span><span class="operator">OF</span> str.rel_sel<span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  iffD1<span class="main">[</span><span class="operator">OF</span> alt.rel_sel<span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  iffD1<span class="main">[</span><span class="operator">OF</span> sseg.rel_sel<span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  iffD1<span class="main">[</span><span class="operator">OF</span> seg.rel_sel<span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  iffD1<span class="main">[</span><span class="operator">OF</span> bun.rel_sel<span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  iffD1<span class="main">[</span><span class="operator">OF</span> pz.rel_sel<span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  iffD1<span class="main">[</span><span class="operator">OF</span> mg.rel_sel<span class="main">,</span> <span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span>

  pmf.rel_refl<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
  bset.rel_refl<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
  nebset.rel_refl<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
  prod.rel_refl<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
  sum.rel_refl<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
  option.rel_refl<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>

  pmf.rel_mono_strong<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
  bset.rel_mono_strong<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
  nebset.rel_mono_strong<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
  prod.rel_mono_strong<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
  sum.rel_mono_strong<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
  option.rel_mono_strong<span class="main">[</span><span class="operator">intro</span><span class="main">]</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Proofs›</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">includes</span></span> probabilistic_hierarchy
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">method</span></span> bisimilar_alt <span class="main">=</span>
  <span class="operator">rule</span> bisimilar_eqI<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">conclusion</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">u1</span> <span class="free">s1</span> <span class="free">x</span> <span class="main">=</span> <span class="free">u2</span> <span class="free">s2</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">u1</span> <span class="free">u2</span> <span class="free">s1</span> <span class="free">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main"><span class="main">⇒</span></span>
    <span class="quoted">‹<span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main">:</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="keyword3">,</span> <span class="operator">fastforce</span>›</span><span class="main"><span class="keyword3">,</span></span>
  <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> bisimilar_alt<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_mc <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>unfold_mc <span class="bound">s1</span> <span class="free">x</span> <span class="main">=</span> unfold_mc <span class="bound">s2</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_dlts <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>unfold_dlts <span class="bound">s1</span> <span class="free">x</span> <span class="main">=</span> unfold_dlts <span class="bound">s2</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_lts <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>unfold_lts <span class="bound">s1</span> <span class="free">x</span> <span class="main">=</span> unfold_lts <span class="bound">s2</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_react <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>unfold_react <span class="bound">s1</span> <span class="free">x</span> <span class="main">=</span> unfold_react <span class="bound">s2</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_lmc <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>unfold_lmc <span class="bound">s1</span> <span class="free">x</span> <span class="main">=</span> unfold_lmc <span class="bound">s2</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_lmdp <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>unfold_lmdp <span class="bound">s1</span> <span class="free">x</span> <span class="main">=</span> unfold_lmdp <span class="bound">s2</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_gen <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>unfold_gen <span class="bound">s1</span> <span class="free">x</span> <span class="main">=</span> unfold_gen <span class="bound">s2</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_str <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>unfold_str <span class="bound">s1</span> <span class="free">x</span> <span class="main">=</span> unfold_str <span class="bound">s2</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_alt <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>unfold_alt <span class="bound">s1</span> <span class="free">x</span> <span class="main">=</span> unfold_alt <span class="bound">s2</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_sseg <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>unfold_sseg <span class="bound">s1</span> <span class="free">x</span> <span class="main">=</span> unfold_sseg <span class="bound">s2</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_seg <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>unfold_seg <span class="bound">s1</span> <span class="free">x</span> <span class="main">=</span> unfold_seg <span class="bound">s2</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_bun <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>unfold_bun <span class="bound">s1</span> <span class="free">x</span> <span class="main">=</span> unfold_bun <span class="bound">s2</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_pz <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>unfold_pz <span class="bound">s1</span> <span class="free">x</span> <span class="main">=</span> unfold_pz <span class="bound">s2</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_mg <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>unfold_mg <span class="bound">s1</span> <span class="free">x</span> <span class="main">=</span> unfold_mg <span class="bound">s2</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">bisimilar_alt</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">method</span></span> commute_prover <span class="main">=</span>
  <span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">conclusion</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">u1</span> <span class="free">s1</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">emb</span> <span class="keyword1">o</span> <span class="free">u2</span> <span class="free">s2</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">emb</span> <span class="free">u1</span> <span class="free">u2</span> <span class="free">s1</span> <span class="free">s2</span> <span class="free">x</span> <span class="main"><span class="main">⇒</span></span>
     <span class="quoted">‹<span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main">:</span> <span class="quoted"><span class="free">x</span></span><span class="keyword3">,</span> <span class="operator">fastforce</span>›</span>

<span class="keyword1"><span class="command">lemma</span></span> emb_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_lts <span class="main">(</span>lts_of_dlts_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> lts_of_dlts <span class="keyword1">o</span> unfold_dlts <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_gen <span class="main">(</span>gen_of_lmc_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> gen_of_lmc <span class="keyword1">o</span> unfold_lmc <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_lmdp <span class="main">(</span>lmdp_of_lmc_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> lmdp_of_lmc <span class="keyword1">o</span> unfold_lmc <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_react <span class="main">(</span>react_of_dlts_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> react_of_dlts <span class="keyword1">o</span> unfold_dlts <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_sseg <span class="main">(</span>sseg_of_lmdp_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> sseg_of_lmdp <span class="keyword1">o</span> unfold_lmdp <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_sseg <span class="main">(</span>sseg_of_lts_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> sseg_of_lts <span class="keyword1">o</span> unfold_lts <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_sseg <span class="main">(</span>ssegopt_of_alt_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> ssegopt_of_alt <span class="keyword1">o</span> unfold_alt <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_sseg <span class="main">(</span>sseg_of_react_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> sseg_of_react <span class="keyword1">o</span> unfold_react <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_seg <span class="main">(</span>seg_of_sseg_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> seg_of_sseg <span class="keyword1">o</span> unfold_sseg <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_seg <span class="main">(</span>seg_of_gen_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> seg_of_gen <span class="keyword1">o</span> unfold_gen <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_bun <span class="main">(</span>bun_of_lts_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> bun_of_lts <span class="keyword1">o</span> unfold_lts <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_bun <span class="main">(</span>bunopt_of_alt_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> bunopt_of_alt <span class="keyword1">o</span> unfold_alt <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_bun <span class="main">(</span>bun_of_gen_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> bun_of_gen <span class="keyword1">o</span> unfold_gen <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_pz <span class="main">(</span>pz_of_seg_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> pz_of_seg <span class="keyword1">o</span> unfold_seg <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_pz <span class="main">(</span>pz_of_bun_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> pz_of_bun <span class="keyword1">o</span> unfold_bun <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_str <span class="main">(</span>str_of_mc_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> str_of_mc <span class="keyword1">o</span> unfold_mc <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_alt <span class="main">(</span>alt_of_str_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> alt_of_str <span class="keyword1">o</span> unfold_str <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_sseg <span class="main">(</span>ssegopt_of_sseg_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> ssegopt_of_sseg <span class="keyword1">o</span> unfold_sseg <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_seg <span class="main">(</span>segopt_of_seg_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> segopt_of_seg <span class="keyword1">o</span> unfold_seg <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_bun <span class="main">(</span>bunopt_of_bun_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> bunopt_of_bun <span class="keyword1">o</span> unfold_bun <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_pz <span class="main">(</span>pzopt_of_pz_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> pzopt_of_pz <span class="keyword1">o</span> unfold_pz <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_pz <span class="main">(</span>pzopt_of_mg_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> pzopt_of_mg <span class="keyword1">o</span> unfold_mg <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_mg <span class="main">(</span>mg_of_pzopt_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> mg_of_pzopt <span class="keyword1">o</span> unfold_pz <span class="bound">s</span>"</span></span>

  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_mg <span class="main">(</span>mg_of_pz_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> mg_of_pz <span class="keyword1">o</span> unfold_pz <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_mg <span class="main">(</span>mg_of_alt1_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> mg_of_alt1 <span class="keyword1">o</span> unfold_alt <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_mg <span class="main">(</span>mg_of_alt2_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> mg_of_alt2 <span class="keyword1">o</span> unfold_alt <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_pz <span class="main">(</span>pz_of_alt1_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> pz_of_alt1 <span class="keyword1">o</span> unfold_alt <span class="bound">s</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> unfold_pz <span class="main">(</span>pz_of_alt2_emb <span class="keyword1">o</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> pz_of_alt2 <span class="keyword1">o</span> unfold_alt <span class="bound">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">commute_prover</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">method</span></span> inj_prover <span class="main">=</span>
  <span class="operator">intro</span> injI<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">conclusion</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">x</span> <span class="free">y</span> <span class="main"><span class="main">⇒</span></span> <span class="quoted">‹<span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main">:</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="keyword3">,</span> <span class="operator">fastforce</span>›</span>

<span class="keyword1"><span class="command">lemma</span></span> inj<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inj lts_of_dlts"</span></span>
  <span class="quoted"><span class="quoted">"inj react_of_dlts"</span></span>
  <span class="quoted"><span class="quoted">"inj gen_of_lmc"</span></span>
  <span class="quoted"><span class="quoted">"inj lmdp_of_lmc"</span></span>
  <span class="quoted"><span class="quoted">"inj sseg_of_lmdp"</span></span>
  <span class="quoted"><span class="quoted">"inj sseg_of_react"</span></span>
  <span class="quoted"><span class="quoted">"inj sseg_of_lts"</span></span>
  <span class="quoted"><span class="quoted">"inj ssegopt_of_alt"</span></span>
  <span class="quoted"><span class="quoted">"inj seg_of_gen"</span></span>
  <span class="quoted"><span class="quoted">"inj seg_of_sseg"</span></span>
  <span class="quoted"><span class="quoted">"inj bun_of_lts"</span></span>
  <span class="quoted"><span class="quoted">"inj bunopt_of_alt"</span></span>
  <span class="quoted"><span class="quoted">"inj bun_of_gen"</span></span>
  <span class="quoted"><span class="quoted">"inj pz_of_seg"</span></span>
  <span class="quoted"><span class="quoted">"inj pz_of_bun"</span></span>
  <span class="quoted"><span class="quoted">"inj str_of_mc"</span></span>
  <span class="quoted"><span class="quoted">"inj alt_of_str"</span></span>
  <span class="quoted"><span class="quoted">"inj ssegopt_of_sseg"</span></span>
  <span class="quoted"><span class="quoted">"inj segopt_of_seg"</span></span>
  <span class="quoted"><span class="quoted">"inj bunopt_of_bun"</span></span>
  <span class="quoted"><span class="quoted">"inj pzopt_of_pz"</span></span>
  <span class="quoted"><span class="quoted">"inj pzopt_of_mg"</span></span>
  <span class="quoted"><span class="quoted">"inj mg_of_pzopt"</span></span>

  <span class="quoted"><span class="quoted">"inj mg_of_pz"</span></span>
  <span class="quoted"><span class="quoted">"inj mg_of_alt1"</span></span>
  <span class="quoted"><span class="quoted">"inj mg_of_alt2"</span></span>
  <span class="quoted"><span class="quoted">"inj pz_of_alt1"</span></span>
  <span class="quoted"><span class="quoted">"inj pz_of_alt2"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">inj_prover</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hierarchy<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_dlts <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_lts <span class="main">(</span>lts_of_dlts_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>lts_of_dlts_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_lmc <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_gen <span class="main">(</span>gen_of_lmc_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>gen_of_lmc_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_lmc <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_lmdp <span class="main">(</span>lmdp_of_lmc_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>lmdp_of_lmc_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_dlts <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_react <span class="main">(</span>react_of_dlts_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>react_of_dlts_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_lmdp <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_sseg <span class="main">(</span>sseg_of_lmdp_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>sseg_of_lmdp_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_lts <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_sseg <span class="main">(</span>sseg_of_lts_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>sseg_of_lts_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_alt <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_sseg <span class="main">(</span>ssegopt_of_alt_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>ssegopt_of_alt_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_react <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_sseg <span class="main">(</span>sseg_of_react_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>sseg_of_react_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_sseg <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_seg <span class="main">(</span>seg_of_sseg_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>seg_of_sseg_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">s1</span> <span class="main">::</span> <span class="main">_</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> option <span class="main">×</span> <span class="main">_</span> pmf<span class="main">)</span> <span class="keyword1">set[</span><span class="main">_</span><span class="main">]</span><span class="main">)</span> <span class="bound">s2</span><span class="main">.</span>
     bisimilar_sseg <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_seg <span class="main">(</span>seg_of_sseg_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>seg_of_sseg_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_gen <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_seg <span class="main">(</span>seg_of_gen_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>seg_of_gen_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_lts <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_bun <span class="main">(</span>bun_of_lts_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>bun_of_lts_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_alt <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_bun <span class="main">(</span>bunopt_of_alt_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>bunopt_of_alt_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_gen <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_bun <span class="main">(</span>bun_of_gen_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>bun_of_gen_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_seg <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_pz <span class="main">(</span>pz_of_seg_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>pz_of_seg_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_bun <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_pz <span class="main">(</span>pz_of_bun_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>pz_of_bun_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">s1</span> <span class="main">::</span> <span class="main">_</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> option <span class="main">×</span> <span class="main">_</span><span class="main">)</span> pmf <span class="keyword1">set[</span><span class="main">_</span><span class="main">]</span><span class="main">)</span> <span class="bound">s2</span><span class="main">.</span>
     bisimilar_seg <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_pz <span class="main">(</span>pz_of_seg_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>pz_of_seg_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">s1</span> <span class="main">::</span> <span class="main">_</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> option <span class="main">×</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">set[</span><span class="main">_</span><span class="main">]</span><span class="main">)</span> pmf<span class="main">)</span> <span class="bound">s2</span><span class="main">.</span>
     bisimilar_bun <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_pz <span class="main">(</span>pz_of_bun_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>pz_of_bun_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_mc <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_str <span class="main">(</span>str_of_mc_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>str_of_mc_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_sseg <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_sseg <span class="main">(</span>ssegopt_of_sseg_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>ssegopt_of_sseg_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_seg <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_seg <span class="main">(</span>segopt_of_seg_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>segopt_of_seg_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_bun <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_bun <span class="main">(</span>bunopt_of_bun_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>bunopt_of_bun_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_pz <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_pz <span class="main">(</span>pzopt_of_pz_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>pzopt_of_pz_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_str <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_alt <span class="main">(</span>alt_of_str_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>alt_of_str_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_mg <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_pz <span class="main">(</span>pzopt_of_mg_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>pzopt_of_mg_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inj<span class="main">[</span><span class="operator">THEN</span> inj_eq<span class="main">]</span> bisimilar_alt emb_commute o_apply <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹An edge that would make the graph cyclic›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_pz <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_mg <span class="main">(</span>mg_of_pz_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>mg_of_pz_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inj<span class="main">[</span><span class="operator">THEN</span> inj_eq<span class="main">]</span> bisimilar_alt emb_commute o_apply <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some redundant (historic) transitive edges›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_pz <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_mg <span class="main">(</span>mg_of_pzopt_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>mg_of_pzopt_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_alt <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_mg <span class="main">(</span>mg_of_alt1_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>mg_of_alt1_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_alt <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_mg <span class="main">(</span>mg_of_alt2_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>mg_of_alt2_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_alt <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_pz <span class="main">(</span>pz_of_alt1_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>pz_of_alt1_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> bisimilar_alt <span class="bound">s1</span> <span class="bound">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_pz <span class="main">(</span>pz_of_alt2_emb <span class="keyword1">o</span> <span class="bound">s1</span><span class="main">)</span> <span class="main">(</span>pz_of_alt2_emb <span class="keyword1">o</span> <span class="bound">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inj<span class="main">[</span><span class="operator">THEN</span> inj_eq<span class="main">]</span> bisimilar_alt emb_commute o_apply <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Some special proofs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Two views on LTS›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'s</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'s</span> set<span class="main">)</span><span class="main">.</span> bij <span class="bound">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_def inj_on_def fun_eq_iff image_iff
    <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">S</span> <span class="bound">a</span><span class="main">.</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">f</span> <span class="bound">a</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">f</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'s</span><span class="main">)</span> <span class="keyword1">set[</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'s</span><span class="main">)</span> set<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="keyword1">set[</span><span class="tfree">'s</span> set<span class="main">]</span><span class="main">)</span><span class="main">.</span> bij <span class="bound">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_def inj_on_def fun_eq_iff image_iff bset_eq_iff
    <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">S</span> <span class="bound">a</span><span class="main">.</span> bCollect <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> bmember <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">S</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span>
            exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"bCollect <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">.</span> bmember <span class="bound">b</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">f</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹mc is trivial›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mc_unit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">mc</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pmf.in_rel map_fst_pair_pmf map_snd_pair_pmf <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"pair_pmf <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"bisimilar_mc <span class="free">s1</span> <span class="free">s2</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bisimilar_alt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mc_unit<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Printing the Hierarchy Graph›</span></span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword2"><span class="keyword">local</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">trim</span> <span class="main">=</span> filter <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">s</span> <span class="main">=&gt;</span> <span class="entity">s</span> &lt;&gt; <span class="inner_quoted">""</span> <span class="keyword1"><span class="keyword">andalso</span></span> <span class="entity">s</span> &lt;&gt; <span class="inner_quoted">"set"</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">str_of_T</span> <span class="main">(</span>Type <span class="main">(</span><span class="entity">c</span><span class="main">,</span> <span class="entity">Ts</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    space_implode <span class="inner_quoted">" "</span> <span class="main">(</span><span class="entity">trim</span> <span class="main">[</span>commas <span class="main">(</span><span class="entity">trim</span> <span class="main">(</span>map <span class="entity">str_of_T</span> <span class="entity">Ts</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Long_Name.base_name <span class="entity">c</span><span class="main">]</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">str_of_T</span> <span class="main">_</span> <span class="main">=</span> <span class="inner_quoted">""</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_edge</span> <span class="entity">thm</span> <span class="main">=</span> <span class="entity">thm</span>
  |&gt; Thm.concl_of
  |&gt; <span class="entity">HOLogic.dest_Trueprop</span>
  |&gt; <span class="entity">HOLogic.dest_eq</span> |&gt; fst
  |&gt; dest_comb |&gt; fst
  |&gt; fastype_of
  |&gt; dest_funT
  |&gt; apply2 <span class="entity">str_of_T</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">edges</span> <span class="main">=</span> map <span class="entity">get_edge</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> hierarchy<span class="main">[</span><span class="operator">unfolded</span> bisimilar_alt emb_commute o_apply<span class="main">,</span> <span class="operator">THEN</span> iffD1<span class="main">]</span><span class="antiquote">}</span></span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">nodes</span> <span class="main">=</span> distinct <span class="main">(</span><span class="keyword1"><span class="keyword">op</span></span> <span class="main">=</span><span class="main">)</span> <span class="main">(</span>maps <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">y</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">[</span><span class="entity">x</span><span class="main">,</span> <span class="entity">y</span><span class="main">]</span><span class="main">)</span> <span class="entity">edges</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">node_graph</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">s</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">(</span><span class="entity">s</span><span class="main">,</span> <span class="entity">Graph_Display.content_node</span> <span class="entity">s</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span> <span class="main">:</span> string list<span class="main">)</span><span class="main">)</span> <span class="entity">nodes</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">graph</span> <span class="main">=</span> fold <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">y</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">g</span> <span class="main">=&gt;</span>
  AList.map_entry <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="main">(</span><span class="entity">y</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="entity">x</span> <span class="main">=</span> <span class="entity">y</span><span class="main">)</span> <span class="entity">x</span> <span class="main">(</span>cons <span class="entity">y</span><span class="main">)</span> <span class="entity">g</span><span class="main">)</span> <span class="entity">edges</span> <span class="entity">node_graph</span>

<span class="keyword2"><span class="keyword">in</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> <span class="entity">Graph_Display.display_graph</span> <span class="entity">graph</span>

<span class="keyword2"><span class="keyword">end</span></span>
›</span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="Vardi">
<div class="head">
<h1>Theory Vardi</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Vardi Systems›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Vardi
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="Probabilistic_Hierarchy.html">Probabilistic_Hierarchy</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">bnf_internals</span><span class="main">]</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var0 <span class="main">=</span> PMF <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> pmf"</span></span> <span class="main">|</span> BPS <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">set[</span><span class="tfree">'k</span><span class="main">]</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">var_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var0 <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var0 <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∼</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  var_eq_reflp<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">∼</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"PMF <span class="main">(</span>return_pmf <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∼</span></span> BPS <span class="main">(</span>bsingleton <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"BPS <span class="main">(</span>bsingleton <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∼</span></span> PMF <span class="main">(</span>return_pmf <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> var_eq_symp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∼</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> var_eq.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> var_eq_transp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∼</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∼</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> var_eq.cases<span class="main">)</span>

<span class="keyword1"><span class="command">quotient_type</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var0"</span></span> <span class="main">/</span> <span class="quoted"><span class="quoted">"<span class="main">(∼)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> equivpI reflpI sympI transpI  var_eq_symp var_eq_transp<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> map_var  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'c</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">map_var0</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> var_eq.cases <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_bset_bsingleton<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> set1_var  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">set1_var0</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> var_eq.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> set2_var  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">set2_var0</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> var_eq.cases<span class="main">)</span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">rel_var</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'c</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">R</span> <span class="entity">S</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"set1_var <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">⟹</span> set2_var <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">S</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">⟹</span>
    <span class="free">rel_var</span> <span class="free">R</span> <span class="free">S</span> <span class="main">(</span>map_var fst fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>map_var snd snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">var0_of_gen_emb</span> <span class="main">≡</span> case_option <span class="main">(</span>BPS bempty<span class="main">)</span> PMF"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">var0_of_lts_emb</span> <span class="main">≡</span> BPS"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> var_of_gen_emb <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> pmf option <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">var0_of_gen_emb</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> var_of_lts_emb <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">set[</span><span class="tfree">'k</span><span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">var0_of_lts_emb</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">bisimilar_var</span> <span class="main">≡</span> bisimilar <span class="main">(</span><span class="main">λ</span><span class="bound">R</span><span class="main">.</span> rel_var <span class="main">(=)</span> <span class="bound">R</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_var0_eq_BPS_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_var0 <span class="free">f</span> <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> BPS <span class="free">X</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="free">z</span> <span class="main">=</span> BPS <span class="bound">Y</span> <span class="main">∧</span> map_bset <span class="main">(</span>map_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="bound">Y</span> <span class="main">=</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> map_var0_eq_PMF_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_var0 <span class="free">f</span> <span class="free">g</span> <span class="free">z</span> <span class="main">=</span> PMF <span class="free">p</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="free">z</span> <span class="main">=</span> PMF <span class="bound">q</span> <span class="main">∧</span> map_pmf <span class="main">(</span>map_prod <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="bound">q</span> <span class="main">=</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"bisimilar_lts <span class="free">s1</span> <span class="free">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_var <span class="main">(</span>var_of_lts_emb <span class="keyword1">o</span> <span class="free">s1</span><span class="main">)</span> <span class="main">(</span>var_of_lts_emb <span class="keyword1">o</span> <span class="free">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟷</span> bisimilar_var <span class="main">(</span><span class="var">?emb1</span> <span class="keyword1">o</span> <span class="main">_</span><span class="main">)</span> <span class="main">(</span><span class="var">?emb2</span> <span class="keyword1">o</span> <span class="main">_</span><span class="main">)</span> <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> bisimilar_def o_apply <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">R</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    bis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> rel_bset <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">(</span><span class="free">s1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">s2</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="free">x</span> <span class="free">y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="bound">R</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> rel_var <span class="main">(=)</span> <span class="bound">R</span> <span class="main">(</span><span class="var">?emb1</span> <span class="main">(</span><span class="free">s1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?emb2</span> <span class="main">(</span><span class="free">s2</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">R</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> bis <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_bset <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">(</span><span class="free">s1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">s2</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"set_bset <span class="skolem">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> rel_prod <span class="main">(=)</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"map_bset fst <span class="skolem">z</span> <span class="main">=</span> <span class="free">s1</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"map_bset snd <span class="skolem">z</span> <span class="main">=</span> <span class="free">s2</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bset.in_rel<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rel_var <span class="main">(=)</span> <span class="skolem">R</span> <span class="main">(</span><span class="var">?emb1</span> <span class="main">(</span><span class="free">s1</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?emb2</span> <span class="main">(</span><span class="free">s2</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rel_var.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span>
        <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bset.map_comp o_def split_beta prod_set_simps
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"BPS <span class="main">(</span>map_bset <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">R</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    bis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> rel_var <span class="main">(=)</span> <span class="skolem">R</span> <span class="main">(</span><span class="var">?emb1</span> <span class="main">(</span><span class="free">s1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?emb2</span> <span class="main">(</span><span class="free">s2</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="free">x</span> <span class="free">y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="bound">R</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> rel_bset <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="bound">R</span><span class="main">)</span> <span class="main">(</span><span class="free">s1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">s2</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">R</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> bis <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_var <span class="main">(=)</span> <span class="skolem">R</span> <span class="main">(</span><span class="var">?emb1</span> <span class="main">(</span><span class="free">s1</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?emb2</span> <span class="main">(</span><span class="free">s2</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span>
      <span class="quoted"><span class="quoted">"set1_var <span class="skolem">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"set2_var <span class="skolem">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="var">?emb1</span> <span class="main">(</span><span class="free">s1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> map_var fst fst <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?emb2</span> <span class="main">(</span><span class="free">s2</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> map_var snd snd <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_var.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rel_bset <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">(</span><span class="free">s1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">s2</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s1</span></span> <span class="quoted"><span class="free">s2</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bset.in_rel bset.map_comp o_def map_pmf_eq_return_pmf_iff
        split_beta<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> map_prod_def subset_eq split_beta prod_set_defs <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> var_eq.cases
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"map_bset <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">z</span><span class="main"><span class="main">]</span></span>
          exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"bsingleton <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"bisimilar_gen <span class="free">s1</span> <span class="free">s2</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> bisimilar_var <span class="main">(</span>var_of_gen_emb <span class="keyword1">o</span> <span class="free">s1</span><span class="main">)</span> <span class="main">(</span>var_of_gen_emb <span class="keyword1">o</span> <span class="free">s2</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟷</span> bisimilar_var <span class="main">(</span><span class="var">?emb1</span> <span class="keyword1">o</span> <span class="main">_</span><span class="main">)</span> <span class="main">(</span><span class="var">?emb2</span> <span class="keyword1">o</span> <span class="main">_</span><span class="main">)</span> <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> bisimilar_def o_apply <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">R</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    bis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> rel_option <span class="main">(</span>rel_pmf <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="skolem">R</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">s1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">s2</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="free">x</span> <span class="free">y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="bound">R</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> rel_var <span class="main">(=)</span> <span class="bound">R</span> <span class="main">(</span><span class="var">?emb1</span> <span class="main">(</span><span class="free">s1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?emb2</span> <span class="main">(</span><span class="free">s2</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">R</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> bis <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_option <span class="main">(</span>rel_pmf <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="skolem">R</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">s1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">s2</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rel_var <span class="main">(=)</span> <span class="skolem">R</span> <span class="main">(</span><span class="var">?emb1</span> <span class="main">(</span><span class="free">s1</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?emb2</span> <span class="main">(</span><span class="free">s2</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s2</span> <span class="skolem">y</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> option.exhaust<span class="main"><span class="main">[</span></span><span class="operator">case_product</span> option.exhaust<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None_None <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rel_var.simps
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s1</span></span> <span class="quoted"><span class="free">s2</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bempty.rep_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"BPS bempty"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some_Some <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"set_pmf <span class="skolem">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> rel_prod <span class="main">(=)</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"map_pmf fst <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"map_pmf snd <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pmf.in_rel<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> Some_Some <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rel_var.simps
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s1</span></span> <span class="quoted"><span class="free">s2</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pmf.map_comp o_def split_beta prod_set_simps
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"PMF <span class="main">(</span>map_pmf <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">R</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    bis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> rel_var <span class="main">(=)</span> <span class="skolem">R</span> <span class="main">(</span><span class="var">?emb1</span> <span class="main">(</span><span class="free">s1</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?emb2</span> <span class="main">(</span><span class="free">s2</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="free">x</span> <span class="free">y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> <span class="bound">R</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">R</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span>
     rel_option <span class="main">(</span>rel_pmf <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="bound">R</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">s1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">s2</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">R</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> bis <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_var <span class="main">(=)</span> <span class="skolem">R</span> <span class="main">(</span><span class="var">?emb1</span> <span class="main">(</span><span class="free">s1</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?emb2</span> <span class="main">(</span><span class="free">s2</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span>
        <span class="quoted"><span class="quoted">"set1_var <span class="skolem">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"set2_var <span class="skolem">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="var">?emb1</span> <span class="main">(</span><span class="free">s1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> map_var fst fst <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?emb2</span> <span class="main">(</span><span class="free">s2</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> map_var snd snd <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_var.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rel_option <span class="main">(</span>rel_pmf <span class="main">(</span>rel_prod <span class="main">(=)</span> <span class="skolem">R</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">s1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">s2</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s2</span> <span class="skolem">y</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> option.exhaust<span class="main"><span class="main">[</span></span><span class="operator">case_product</span> option.exhaust<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Some_None
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bempty.rep_eq <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> var_eq.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> None_Some
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> var_eq.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some_Some <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_eq split_beta prod_set_defs
          <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> var_eq.cases <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rel_pmf_reflI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="Vardi_Counterexample">
<div class="head">
<h1>Theory Vardi_Counterexample</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Vardi Systems Are Not a BNF›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Vardi_Counterexample
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Vardi.html">Vardi</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Do not import this theory. It contains an inconsistent axiomatization.
The point is to exhibit the particular inconsistency.›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹

Let V = (P + D) / ~ be the Vardi functor
  (P - powerset functor, 
   D - probability distribution functor,
   ~ - relation identifying singleton sets with Dirac distributions).

Lemma: V does not preserve weak pullbacks

By contradiction. Let X = {a, b}, C = {a}, f : X -&gt; C with f(x) = a. Consider the cospan

X --f-&gt; C &lt;-f-- X,

which has the pullback Q = {(a, a), (a, b), (b, a), (b, b)}.

Then let VQ be a pullback of the cospan

V X --V f-&gt; V C &lt;-V f--V X.

Now pick x = L {a, b} : V X and y = R [a -&gt; 0.5, b -&gt; 0.5] : V X (L and R are the sum's injections).

We have V f x = L {a} = R [a -&gt; 1] = V f y.

Therefore the pullback VQ must contain an element z s.t. V fst z = {a, b} and V snd z = [a -&gt; 0.5, b -&gt; 0.5]
 where fst (x, y) = x and snd (x, y) = y are the standard projections. There is however no such element z.
›</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We axiomatize the relator commutation property and show that we can deduce <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">False</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> from it.

We cannot do this with a locale, since we need the fully polymorphic version of the following axiom.
›</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  inconsistent<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_var <span class="free">R1</span> <span class="free">S1</span> <span class="keyword1">OO</span> rel_var <span class="free">R2</span> <span class="free">S2</span> <span class="main">≤</span> rel_var <span class="main">(</span><span class="free">R1</span> <span class="keyword1">OO</span> <span class="free">R2</span><span class="main">)</span> <span class="main">(</span><span class="free">S1</span> <span class="keyword1">OO</span> <span class="free">S2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">bnf</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var"</span></span>
  map<span class="main">:</span> <span class="quoted">map_var</span>
  sets<span class="main">:</span> <span class="quoted">set1_var</span> <span class="quoted">set2_var</span>
  bd<span class="main">:</span> <span class="quoted"><span class="quoted">"bd_pre_var0 <span class="main">::</span> <span class="tfree">'k</span> var0_pre_var0_bdT rel"</span></span>
  rel<span class="main">:</span> <span class="quoted">rel_var</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var0.map_id<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var0.map_comp<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> var0.map_cong0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 4 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var0.set_map0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 5 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var0.set_map0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 6 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> var0.bd_card_order<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 7 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var0.bd_cinfinite<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">x</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subset_eq set1_var_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var0.set_bd<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">x</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subset_eq set2_var_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> var0.set_bd<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 10 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inconsistent<span class="main">)</span> <span class="comment1">― ‹BAAAAAMMMM›</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 11 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rel_var.simps<span class="main">[</span><span class="operator">abs_def</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> X <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"BPS <span class="main">(</span>binsert <span class="main">(</span>True<span class="main">,</span> undefined<span class="main">)</span> <span class="main">(</span>binsert <span class="main">(</span>False<span class="main">,</span> undefined<span class="main">)</span> bempty<span class="main">)</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> Y <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"PMF <span class="main">(</span>pmf_of_set <span class="main">{</span><span class="main">(</span>True<span class="main">,</span> undefined<span class="main">)</span><span class="main">,</span> <span class="main">(</span>False<span class="main">,</span> undefined<span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> Z <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"PMF <span class="main">(</span>return_pmf <span class="main">(</span>True<span class="main">,</span> undefined<span class="main">)</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> Z' <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bool<span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"BPS <span class="main">(</span>bsingleton <span class="main">(</span>True<span class="main">,</span> undefined<span class="main">)</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> C <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bool<span class="main">×</span>bool<span class="main">,</span> <span class="tfree">'b</span><span class="main">×</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"BPS <span class="main">(</span>binsert <span class="main">(</span><span class="main">(</span>True<span class="main">,</span> True<span class="main">)</span><span class="main">,</span> <span class="main">(</span>undefined<span class="main">,</span> undefined<span class="main">)</span><span class="main">)</span> <span class="main">(</span>binsert <span class="main">(</span><span class="main">(</span>False<span class="main">,</span> True<span class="main">)</span><span class="main">,</span> <span class="main">(</span>undefined<span class="main">,</span> undefined<span class="main">)</span><span class="main">)</span> bempty<span class="main">)</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> C' <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bool<span class="main">×</span>bool<span class="main">,</span> <span class="tfree">'b</span><span class="main">×</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> var"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"PMF <span class="main">(</span>map_pmf <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pair_pmf <span class="main">(</span>return_pmf <span class="main">(</span>True<span class="main">,</span> undefined<span class="main">)</span><span class="main">)</span> <span class="main">(</span>pmf_of_set <span class="main">{</span><span class="main">(</span>True<span class="main">,</span> undefined<span class="main">)</span><span class="main">,</span> <span class="main">(</span>False<span class="main">,</span> undefined<span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Z_eq_Z'<span class="main">:</span> <span class="quoted"><span class="quoted">"Z <span class="main">=</span> Z'"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted">False</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> pmf_of_set <span class="main">{</span><span class="main">(</span>True<span class="main">,</span> undefined<span class="main">)</span><span class="main">,</span> <span class="main">(</span>False<span class="main">,</span> undefined<span class="main">)</span><span class="main">}</span> <span class="main">≠</span> return_pmf <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pmf_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> split_indicator<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> binsert <span class="main">(</span>True<span class="main">,</span> undefined<span class="main">)</span> <span class="main">(</span>binsert <span class="main">(</span>False<span class="main">,</span> undefined<span class="main">)</span> bempty<span class="main">)</span> <span class="main">≠</span> bsingleton <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bsingleton_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">bool</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_var <span class="skolem">R</span> <span class="main">(=)</span> X Z'"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> R_def var.in_rel mem_Collect_eq subset_eq
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">C</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_bset binsert.rep_eq fsts.simps snds.simps bempty.rep_eq bsingleton_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">bool</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_var <span class="skolem">S</span> <span class="main">(=)</span> Z Y"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> S_def var.in_rel mem_Collect_eq subset_eq
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">C'</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fsts.simps snds.simps pmf.map_comp comp_def split_beta map_fst_pair_pmf map_snd_pair_pmf<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_var <span class="main">(</span><span class="skolem">R</span> <span class="keyword1">OO</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">(</span><span class="main">(=)</span> <span class="keyword1">OO</span> <span class="main">(=)</span><span class="main">)</span> X Y"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"rel_var <span class="var">?R</span> <span class="var">?S</span> X Y"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> var.rel_compp <span class="keyword1"><span class="command">unfolding</span></span> Z_eq_Z' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> rel_var <span class="var">?R</span> <span class="var">?S</span> X Y"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> var.in_rel mem_Collect_eq subset_eq
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> split_beta<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer'</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> var_eq.cases<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper">z</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> snds.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div>